webpackJsonp([119],{J65q:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),s=a.n(r),i=a("lC5x"),n=a.n(i),o=a("J0Oq"),l=a.n(o),u={data:function(){var e=this;return{navTitle:"",isLoad:!1,pickerOptions:{disabledDate:function(e){return e.getTime()<Date.now()-864e5}},checkList:[],options:[],value:[],authList:[{title:"推荐人",key:"inv_user",is_check:!0},{title:"被推荐人",key:"to_inv_user",tips:"勾选被推荐人，被推荐人授权用户信息及手机号后即可获得相应奖励"}],subForm:{id:0,is_atv_status:1,status:1,share_img:[],time:[],inv_user_num:"",inv_time:"",atv_num:"",inv_user:1,to_inv_user:0,coupon:[]},subFormRules:{is_atv_status:{required:!0,type:"number",message:"请选择",trigger:"blur"},status:{required:!0,type:"number",message:"请选择",trigger:"blur"},share_img:{required:!0,type:"array",message:"请上传图片",trigger:"blur"},time:{required:!0,type:"array",message:"请选择活动时间",trigger:"blur"},inv_user_num:{required:!0,type:"number",message:"请输入邀请好友数",trigger:"blur"},inv_time:{required:!0,type:"number",message:"请输入邀请有效期",trigger:"blur"},atv_num:{required:!0,type:"number",message:"请输入发起活动次数",trigger:"blur"},inv_user:{required:!0,validator:function(t,a,r){0===e.subForm.inv_user&&0===e.subForm.to_inv_user?r(new Error("请选择获得奖励人")):r()},trigger:"blur"},coupon:{required:!0,type:"array",message:"请选择获得卡券",trigger:"blur"}},searchForm:{page:1,limit:10,status:1,send_type:0,name:""},total:0,loading:!1,tableData:[],multipleSelection:[],showDialog:!1}},created:function(){this.getDetail()},methods:{getDetail:function(e){var t=this;return l()(n.a.mark(function e(){var a,r,s,i,o;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.market.couponAtvInfo();case 2:if(a=e.sent,r=a.code,s=a.data,200===r){e.next=7;break}return e.abrupt("return");case 7:for(o in s.inv_user=1,s.share_img=s.share_img?[{url:s.share_img}]:[],s.coupon=s.coupon||[],s.time=[1e3*s.start_time,1e3*s.end_time],i=[],t.authList.map(function(e){1===s[e.key]&&i.push(e.title)}),t.checkList=i,t.subForm)t.subForm[o]=s[o];t.isLoad=!0;case 16:case"end":return e.stop()}},e,t)}))()},getCover:function(e){this.subForm.share_img=e},changeCheckBox:function(e){var t=this;this.authList.map(function(a){t.subForm[a.key]=e.includes(a.title)?1:0})},toShowDialog:function(){var e=this;return l()(n.a.mark(function t(){return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.searchForm.name="",t.next=3,e.getTableDataList();case 3:e.showDialog=!e.showDialog;case 4:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;return l()(n.a.mark(function a(){var r,s,i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e&&(t.searchForm.page=e),t.tableData=[],t.loading=!0,a.next=5,t.$api.market.couponList(t.searchForm);case 5:if(r=a.sent,s=r.code,i=r.data,t.loading=!1,200===s){a.next=11;break}return a.abrupt("return");case 11:t.tableData=i.data,t.total=i.total;case 13:case"end":return a.stop()}},a,t)}))()},handleSelectionChange:function(e){this.multipleSelection=e},handleDialogConfirm:function(){if(0!==this.multipleSelection.length){var e=JSON.parse(s()(this.subForm.coupon)),t=e.length>0?e.map(function(e){return e.id}):[];this.multipleSelection.map(function(a){t.includes(a.id)||(a.num=a.num||1,e.push(a))}),this.subForm.coupon=e,this.showDialog=!1}else this.$message.error("请选择卡券")},toDelItem:function(e){this.subForm.coupon.splice(e,1)},toChangeAtv:function(){var e=this,t=this.subForm.is_atv_status;this.$api.market.couponAtvUpdate({is_atv_status:t}).then(function(t){200===t.code&&e.$message.success(e.$t("tips.successRev"))})},submitFormInfo:function(){var e=this,t=!0;if(this.$refs.subForm.validate(function(e){e||(t=!1)}),t){var a=JSON.parse(s()(this.subForm));a.share_img=a.share_img[0].url,a.start_time=a.time[0]/1e3,a.end_time=a.time[1]/1e3;var r=a.coupon.map(function(e){return{id:e.id,num:e.num}});a.coupon=r,delete a.time,this.$api.market.couponAtvUpdate(a).then(function(t){200===t.code&&e.$message.success(e.$t("tips.successRev"))})}}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-market-atv"},[a("top-nav"),e._v(" "),e.isLoad?a("div",{staticClass:"page-main"},[a("lb-tips",[a("div",[e._v("\n        推荐人：邀请一定数量的好友授权用户信息及手机号后才可获得相应奖励\n      ")]),e._v(" "),a("div",{staticClass:"mt-sm"},[e._v("\n        被推荐人：被推荐人授权用户信息及手机号后即可获得相应奖励\n      ")])]),e._v(" "),a("el-form",{ref:"subForm",staticClass:"basic-form",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"140px"},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"邀请有礼活动",prop:"is_atv_status"}},[a("el-radio-group",{on:{change:e.toChangeAtv},model:{value:e.subForm.is_atv_status,callback:function(t){e.$set(e.subForm,"is_atv_status",t)},expression:"subForm.is_atv_status"}},[a("el-radio",{attrs:{label:1}},[e._v(e._s(e.$t("action.ON")))]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v(e._s(e.$t("action.OFF")))])],1),e._v(" "),a("lb-tool-tips",[e._v("开启后，手机端个人中心会展示「邀请有礼」模块，如果有用户投诉，域名则可能被封")])],1),e._v(" "),a("block",{directives:[{name:"show",rawName:"v-show",value:1===e.subForm.is_atv_status,expression:"subForm.is_atv_status === 1"}]},[a("el-form-item",{attrs:{label:"开启活动",prop:"status"}},[a("el-radio-group",{model:{value:e.subForm.status,callback:function(t){e.$set(e.subForm,"status",t)},expression:"subForm.status"}},[a("el-radio",{attrs:{label:1}},[e._v(e._s(e.$t("action.ON")))]),e._v(" "),a("el-radio",{attrs:{label:0}},[e._v(e._s(e.$t("action.OFF")))])],1),e._v(" "),a("lb-tool-tips",[e._v("开启后，在活动有效时间内，用户可参与活动")])],1),e._v(" "),a("el-form-item",{attrs:{label:"分享图",prop:"share_img"}},[a("lb-cover",{attrs:{fileList:e.subForm.share_img},on:{selectedFiles:e.getCover}}),e._v(" "),a("lb-tool-tips",[e._v("图片建议尺寸: 652 * 652")])],1),e._v(" "),a("el-form-item",{attrs:{label:"活动时间",prop:"time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间","value-format":"timestamp","picker-options":e.pickerOptions},model:{value:e.subForm.time,callback:function(t){e.$set(e.subForm,"time",t)},expression:"subForm.time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邀请好友数",prop:"inv_user_num"}},[a("el-input-number",{staticClass:"lb-input-number",attrs:{controls:!1,min:1,precision:0,placeholder:"请输入邀请好友数"},model:{value:e.subForm.inv_user_num,callback:function(t){e.$set(e.subForm,"inv_user_num",t)},expression:"subForm.inv_user_num"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邀请有效期",prop:"inv_time"}},[a("el-input-number",{staticClass:"lb-input-number",attrs:{controls:!1,min:1,precision:0,placeholder:"请输入邀请有效期"},model:{value:e.subForm.inv_time,callback:function(t){e.$set(e.subForm,"inv_time",t)},expression:"subForm.inv_time"}}),e._v(" "),a("block",[e._v("小时")])],1),e._v(" "),a("el-form-item",{attrs:{label:"发起活动次数",prop:"atv_num"}},[a("el-input-number",{staticClass:"lb-input-number",attrs:{controls:!1,min:1,precision:0,placeholder:"请输入发起活动次数"},model:{value:e.subForm.atv_num,callback:function(t){e.$set(e.subForm,"atv_num",t)},expression:"subForm.atv_num"}}),e._v(" "),a("block",[e._v("次/人")])],1),e._v(" "),a("el-form-item",{attrs:{label:"获得奖励人",prop:"inv_user"}},[a("el-checkbox-group",{on:{change:e.changeCheckBox},model:{value:e.checkList,callback:function(t){e.checkList=t},expression:"checkList"}},e._l(e.authList,function(t,r){return a("div",{key:r,style:{display:"inline-block",marginLeft:0===r?0:"15px"}},[a("el-checkbox",{attrs:{disabled:!!t.is_check,label:t.title}}),e._v(" "),t.tips?a("lb-tool-tips",[e._v(e._s(t.tips))]):e._e()],1)}),0)],1),e._v(" "),a("el-form-item",{attrs:{label:"获得卡券",prop:"coupon"}},[a("lb-button",{attrs:{type:"primary",icon:"el-icon-plus"},on:{click:e.toShowDialog}},[e._v("选择卡券")]),e._v(" "),a("el-table",{staticClass:"mt-lg",staticStyle:{width:"100%"},attrs:{data:e.subForm.coupon,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"卡券名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"num",label:"卡券数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{staticClass:"lb-input-number mini",attrs:{controls:!1,min:1,precision:0,placeholder:"请输入卡券数量"},model:{value:t.row.num,callback:function(a){e.$set(t.row,"num",a)},expression:"scope.row.num"}})]}}],null,!1,2558025957)}),e._v(" "),a("el-table-column",{attrs:{width:"180",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table-operate"},[a("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return e.toDelItem(t.$index)}}},[e._v(e._s(e.$t("action.delete")))])],1)]}}],null,!1,2461405206)})],1)],1),e._v(" "),a("el-form-item",[a("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.submitFormInfo}},[e._v(e._s(e.$t("action.submit")))])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"获得卡券",visible:e.showDialog,width:"800px",top:"5vh",center:""},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm,"label-width":"70px"}},[a("el-form-item",{attrs:{label:"输入查询",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入卡券名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),e._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),a("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"卡券名称"}})],1),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1):e._e()],1)},staticRenderFns:[]};var m=a("C7Lr")(u,c,!1,function(e){a("M61X")},"data-v-4d4f5162",null);t.default=m.exports},M61X:function(e,t){}});