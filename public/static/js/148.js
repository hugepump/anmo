webpackJsonp([148],{"/qUM":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=a("hRKE"),i=a.n(n),s=a("lC5x"),r=a.n(s),o=a("rVsN"),l=a.n(o),c=a("KH7x"),d=a.n(c),u=a("J0Oq"),p=a.n(u),v=a("4YfN"),f=a.n(v),m=a("bSIt"),_=a("PxTW"),g=a.n(_),h={inject:["reload"],data:function(){return{isLoad:!1,loading:!1,upgradeInfo:{},searchForm:{page:1,limit:5},total:0,tableData:[]}},created:function(){this.getDetail()},computed:f()({},Object(m.e)({routesItem:function(t){return t.routes}})),methods:{getDetail:function(){var t=this;return p()(r.a.mark(function e(){var a,n,i,s;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,l.a.all([t.$api.system.getUpgradeInfo(),t.getTableDataList()]);case 2:a=e.sent,n=d()(a,1),(i=n[0]).data.data.version&&(s=i.data.data.version.description,i.data.data.version.description=s&&s.length>0?s.replace(/\n/g,"<br>"):""),t.upgradeInfo=i.data;case 7:case"end":return e.stop()}},e,t)}))()},toChangeItem:function(t){this.tableData[t].is_show=!this.tableData[t].is_show},handleCurrentChange:function(){var t=this.searchForm,e=t.page;e*t.limit>this.total||(this.searchForm.page=1*e+1,this.getTableDataList())},getTableDataList:function(t){var e=this;return p()(r.a.mark(function a(){var n,s,o;return r.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t&&(e.searchForm.page=t),e.loading=!0,a.next=4,e.$api.system.getUpRecord(e.searchForm);case 4:if(n=a.sent,s=n.code,o=n.data,e.loading=!1,200===s){a.next=10;break}return a.abrupt("return");case 10:o&&"object"===(void 0===o?"undefined":i()(o))&&(o.data.map(function(t){t.is_show=!1,t.description=t.description?t.description.replace(/\n/g,"<br>"):"暂无记录"}),e.tableData=e.tableData.concat(o.data),e.total=o.total);case 11:case"end":return a.stop()}},a,e)}))()},confirmUpdate:function(){var t=this;this.$confirm("更新系统将覆盖服务器里面的代码文件，请谨慎操作，是否要更新？",this.$t("tips.reminder"),{confirmButtonText:this.$t("action.comfirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){t.updateSysVersion()})},updateSysVersion:function(){var t=this;return p()(r.a.mark(function e(){var a,n,i;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading=!0,e.next=3,t.$api.system.upgrade();case 3:if(a=e.sent,n=a.code,i=a.data,t.loading=!1,200===n){e.next=9;break}return e.abrupt("return");case 9:if(!i.code||-1!==i.code){e.next=12;break}return t.$message.error(i.msg),e.abrupt("return");case 12:return t.$message.success("更新成功！"),e.next=15,t.$api.base.clearCache();case 15:window.location.reload();case 16:case"end":return e.stop()}},e,t)}))()}},filters:{handleTime:function(t,e){return 1===e?g()(1e3*t).format("YYYY-MM-DD"):2===e?g()(1e3*t).format("HH:mm:ss"):g()(1e3*t).format("YYYY-MM-DD HH:mm:ss")}}},b={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-system-upgrade"},[a("top-nav"),t._v(" "),a("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"page-main"},[t.upgradeInfo&&2e4===t.upgradeInfo.code?a("div",[a("lb-tips",[t._v("更新系统将覆盖服务器里面的代码文件，请谨慎操作")]),t._v(" "),a("el-form",{staticClass:"config-form",attrs:{model:t.upgradeInfo,"label-width":"160px"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("lb-classify-title",{attrs:{title:"基本信息"}}),t._v(" "),a("div",{staticStyle:{height:"20px"}}),t._v(" "),a("el-form-item",{attrs:{label:"授权域名："}},[a("span",[t._v(t._s(t.upgradeInfo.data.domain.url))])]),t._v(" "),a("el-form-item",{attrs:{label:"更新到期时间："}},[a("span",[t._v(t._s(t._f("handleTime")(t.upgradeInfo.data.domain.update_service_time)))])]),t._v(" "),a("div",{staticStyle:{height:"20px"}}),t._v(" "),t.upgradeInfo.data.version?a("div",[a("lb-classify-title",{attrs:{title:"版本更新"}}),t._v(" "),a("el-form-item",{attrs:{label:"创建时间："}},[a("span",[t._v(t._s(t.upgradeInfo.data.version.create_time))])]),t._v(" "),a("el-form-item",{attrs:{label:"版本名称："}},[a("span",[t._v(t._s(t.upgradeInfo.data.version.title))])]),t._v(" "),a("el-form-item",{attrs:{label:"更新说明："}},[a("div",{staticClass:"description",domProps:{innerHTML:t._s(t.upgradeInfo.data.version.description)}})])],1):t._e(),t._v(" "),a("div",{staticStyle:{height:"20px"}}),t._v(" "),a("lb-classify-title",{attrs:{title:"版本号"}}),t._v(" "),a("div",{staticStyle:{height:"20px"}}),t._v(" "),a("el-form-item",{attrs:{label:"当前版本："}},[a("span",[t._v(t._s(t.upgradeInfo.location_version_no))])]),t._v(" "),t.upgradeInfo.data.version?a("el-form-item",{attrs:{label:"最新版本："}},[a("span",[t._v(t._s(t.upgradeInfo.data.version.no))]),t._v(" "),t.routesItem.auth.upgrade&&!0===t.upgradeInfo.is_upgrade&&t.upgradeInfo.location_version_no!==t.upgradeInfo.data.version.no?a("lb-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"danger",loading:t.loading,plain:""},on:{click:t.confirmUpdate}},[t._v("更新系统")]):t._e()],1):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"版本历史记录："}},[t._l(t.tableData,function(e,n){return a("div",{key:n,staticClass:"el-textarea b-1px-b"},[a("div",{staticClass:"flex-between c-caption"},[a("div",{staticClass:"c-title text-bold"},[t._v("\n                "+t._s(e.title)+"\n              ")]),t._v(" "),a("div",[t._v(t._s(e.create_time))])]),t._v(" "),a("div",{staticClass:"f-desc",class:[{"ellipsis-4":!e.is_show}],domProps:{innerHTML:t._s(e.description)}}),t._v(" "),a("div",{staticClass:"flex-between"},[a("div"),t._v(" "),a("div",{staticClass:"flex-y-center c-link cursor-pointer",on:{click:function(e){return t.toChangeItem(n)}}},[t._v("\n                "+t._s(e.is_show?"收起更多":"展开更多")),a("i",{staticClass:"iconfont icon-right text-bold ml-sm",class:[{"rotate-90":!e.is_show},{"rotate-270":e.is_show}]})])])])}),t._v(" "),t.tableData.length<t.total?a("div",{staticClass:"flex-y-center c-link cursor-pointer",on:{click:t.handleCurrentChange}},[t._v("\n            展开更多"),a("i",{staticClass:"iconfont icon-right text-bold ml-sm rotate-90"})]):t._e()],2),t._v(" "),a("div",{staticStyle:{height:"30px"}})],1)],1):t._e(),t._v(" "),t.upgradeInfo&&t.upgradeInfo.msg?a("block",[a("lb-tips",[t._v(t._s(t.upgradeInfo.msg))])],1):t._e()],1)],1)},staticRenderFns:[]};var x=a("C7Lr")(h,b,!1,function(t){a("tvhB")},"data-v-3729b74d",null);e.default=x.exports},tvhB:function(t,e){}});