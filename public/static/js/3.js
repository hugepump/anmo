webpackJsonp([3],{dY7D:function(e,t){},q8bm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n("ZLEe"),a=n.n(o),r=n("3cXf"),s=n.n(r),i=n("rVsN"),c=n.n(i),l=n("KH7x"),u=n.n(l),d=n("4YfN"),p=n.n(d),m=n("lC5x"),f=n.n(m),h=n("J0Oq"),g=n.n(h),v=n("bSIt"),w={name:"Login",data:function(){var e=this;return{isLoad:!1,loginText:"",authPhone:0,fHtml:"",identifyCode:"",authTime:0,timer:null,loginForm:{username:"",passwd:"",codeText:""},loginRules:{username:[{required:!0,trigger:"blur",validator:this.$reg.isNotNull,reg_type:2,text:"账号"}],passwd:[{required:!0,trigger:"blur",validator:function(e,t,n){t.length<6||t.length>30?n(new Error("请输入6-30位数的密码")):n()}}],codeText:[{required:!0,trigger:"blur",validator:function(t,n,o){var a=e.authPhone;""===n?o(new Error(a?"请输入短信验证码":"请输入验证码")):!a||/^[0-9]+$/.test(n)&&6===n.length?a||/^[a-z0-9]+$/.test(n)&&4===n.length?o():o(new Error("请输入4位数的验证码，仅限英文小写字母或数字")):o(new Error("请输入6位数的验证码"))}}]},passwordType:"password",capsTooltip:!1,loading:!1,lockTap:!1,showDialog:!1,redirect:void 0,otherQuery:{}}},watch:{$route:{handler:function(e){var t=e.query;t&&(this.redirect=t.redirect,this.otherQuery=this.getOtherQuery(t))},immediate:!0}},created:function(){},mounted:function(){var e=this;return g()(f.a.mark(function t(){return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getBaseInfo();case 2:e.isLoad=!0,setTimeout(function(){""===e.loginForm.username?e.$refs.username.focus():""===e.loginForm.passwd?e.$refs.passwd.focus():""===e.loginForm.codeText&&e.$refs.codeText.focus()},100);case 4:case"end":return t.stop()}},t,e)}))()},computed:p()({},Object(v.e)({routesItem:function(e){return e.routes}})),methods:p()({},Object(v.d)(["changeRoutesItem"]),{getBaseInfo:function(){var e=this;return g()(f.a.mark(function t(){var n,o,a,r,s,i,l,d,p,m,h;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,c.a.all([e.$api.base.authPhone(),e.$api.base.getConfig()]);case 2:if(n=t.sent,o=u()(n,2),a=o[0],r=o[1],e.authPhone=a.data,a.data||e.makeCode(),s=r.data,i=s.record_type,l=s.record_no,d=s.login_des,e.loginText=d,l){t.next=12;break}return t.abrupt("return");case 12:p=2===i?l.replace(/[^0-9]/gi,""):"",m=1===i?"":'<image class="mr-sm" src="https://lbqny.migugu.com/admin/public/information.png"></image>',h=1===i?"https://beian.miit.gov.cn/":"https://www.beian.gov.cn/portal/registerSystemInfo?recordcode="+p,e.fHtml='<div class="flex-y-center c-base">备案号：'+m+' <a class="c-base" href="'+h+'" target="_blank">'+l+"</a></div>";case 16:case"end":return t.stop()}},t,e)}))()},checkCapslock:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.shiftKey,n=e.key;n&&1===n.length&&(this.capsTooltip=!!(t&&n>="a"&&n<="z"||!t&&n>="A"&&n<="Z")),"CapsLock"===n&&!0===this.capsTooltip&&(this.capsTooltip=!1)},showPwd:function(){var e=this;"password"===this.passwordType?this.passwordType="":this.passwordType="password",this.$nextTick(function(){e.$refs.password.focus()})},setCookie:function(e,t,n){var o=new Date;o.setTime(o.getTime()+24*n*60*60*1e3);var a="expires="+o.toGMTString();document.cookie=e+"="+t+";"+a+";"},refreshCode:function(){this.makeCode()},makeCode:function(){this.identifyCode=Math.random().toString(36).substr(2,4),this.setCookie("codeText",this.identifyCode,3)},toClearTimer:function(){this.authTime=0,clearInterval(this.timer)},toSend:function(){var e=this;return g()(f.a.mark(function t(){var n,o,a,r,s,i,c,l;return f.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.authTime){t.next=3;break}return t.abrupt("return");case 3:if(n=e.loginForm,o=n.username,a=n.passwd,o=o?o.replace(/(^\s*)|(\s*$)/g,""):""){t.next=8;break}return e.$message.error("请输入账号"),t.abrupt("return");case 8:if(!(a.length<6||a.length>30)){t.next=11;break}return e.$message.error("请输入6-30位数的密码"),t.abrupt("return");case 11:if(r=e.$util.pick(e.loginForm,["username","passwd"]),!e.lockTap){t.next=14;break}return t.abrupt("return");case 14:return e.lockTap=!0,t.prev=15,t.next=18,e.$api.base.sendAuthCode(r);case 18:if(s=t.sent,i=s.code,c=s.data,e.lockTap=!1,e.loginForm.codeText="",200===i){t.next=25;break}return t.abrupt("return");case 25:e.$message.success("已向 "+c+" 发送短信验证码，请注意查收"),l=60,e.timer=setInterval(function(){0!==l?(l--,e.authTime=l):e.toClearTimer()},1e3),t.next=33;break;case 30:t.prev=30,t.t0=t.catch(15),setTimeout(function(){e.lockTap=!1},2e3);case 33:case"end":return t.stop()}},t,e,[[15,30]])}))()},handleLogin:function(){var e=this;this.loading=!0,this.$refs.loginForm.validate(function(t){if(!t)return e.loading=!1,!1;e.timer&&e.toClearTimer();var n=JSON.parse(s()(e.loginForm));e.authPhone&&(n.short_code=n.codeText,delete n.codeText),e.$api.base.login(n).then(function(t){if(e.loading=!1,200===t.code){var n=t.data,o=n.user,a=n.token,r=o.admin_id,i=void 0===r?0:r,c=o.is_admin,l=void 0===c?0:c,u=o.username;3===l&&i&&(o.is_admin=0),e.changeRoutesItem({key:"isLogin",val:!0}),e.changeRoutesItem({key:"userInfo",val:o}),window.localStorage.setItem("massage_minitk",a),window.localStorage.setItem("massage_ms_username",u),window.localStorage.setItem("massage_userInfo",s()(o)),window.sessionStorage.removeItem("currentPage"),e.$router.push("/")}else e.refreshCode()})})},getOtherQuery:function(e){return a()(e).reduce(function(t,n){return"redirect"!==n&&(t[n]=e[n]),t},{})}})},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"lb-login"},[e.isLoad?n("el-form",{ref:"loginForm",staticClass:"login-form",attrs:{model:e.loginForm,rules:e.loginRules,autocomplete:"on","label-position":"left"},nativeOn:{submit:function(e){e.preventDefault()}}},[n("div",{staticClass:"title-container"},[n("h3",{staticClass:"title"},[e._v(e._s(e.loginText))])]),e._v(" "),n("el-form-item",{attrs:{prop:"username"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"iconfont icon-username"})]),e._v(" "),n("el-input",{ref:"username",attrs:{placeholder:"请输入账号",name:"username",type:"text",tabindex:"1",autocomplete:"on"},model:{value:e.loginForm.username,callback:function(t){e.$set(e.loginForm,"username",t)},expression:"loginForm.username"}})],1),e._v(" "),n("el-tooltip",{attrs:{content:"Caps lock is On",placement:"right",manual:""},model:{value:e.capsTooltip,callback:function(t){e.capsTooltip=t},expression:"capsTooltip"}},[n("el-form-item",{attrs:{prop:"passwd"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"iconfont icon-mima"})]),e._v(" "),n("el-input",{key:e.passwordType,ref:"password",attrs:{type:e.passwordType,placeholder:"请输入密码",name:"passwd",tabindex:"2",autocomplete:"on"},on:{blur:function(t){e.capsTooltip=!1}},nativeOn:{keyup:function(t){return e.checkCapslock.apply(null,arguments)}},model:{value:e.loginForm.passwd,callback:function(t){e.$set(e.loginForm,"passwd",t)},expression:"loginForm.passwd"}}),e._v(" "),n("span",{staticClass:"show-pwd",on:{click:e.showPwd}},[n("i",{class:"password"===e.passwordType?"iconfont icon-eyeclose":"iconfont icon-eyeopen"})])],1)],1),e._v(" "),n("el-form-item",{attrs:{prop:"codeText"}},[n("span",{staticClass:"svg-container"},[n("i",{staticClass:"iconfont",class:[{iconduanxinyanzhengma:e.authPhone},{iconemiyanzhengma:!e.authPhone}]})]),e._v(" "),n("el-input",{ref:"codeText",staticStyle:{width:"280px"},attrs:{placeholder:e.authPhone?"请输入短信验证码":"请输入验证码",name:"codeText",type:"text",tabindex:"3",autocomplete:"on"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleLogin.apply(null,arguments)}},model:{value:e.loginForm.codeText,callback:function(t){e.$set(e.loginForm,"codeText",t)},expression:"loginForm.codeText"}}),e._v(" "),e.authPhone?n("div",{staticClass:"code-text flex-between f-desc",staticStyle:{color:"#889aa4"},on:{click:e.toSend}},[n("div"),e._v(" "),n("div",[e._v("\n          "+e._s(e.authTime>0?"("+e.authTime+"s)后重新获取":"获取验证码")+"\n        ")])]):e._e(),e._v(" "),e.authPhone?e._e():n("div",{staticClass:"code-text",on:{click:e.refreshCode}},[n("lb-identify",{attrs:{identifyCode:e.identifyCode,fontSizeMin:30,fontSizeMax:30}})],1)],1),e._v(" "),n("el-button",{staticStyle:{width:"100%","margin-bottom":"30px",height:"40px"},attrs:{loading:e.loading,type:"primary"},nativeOn:{click:function(t){return t.preventDefault(),e.handleLogin.apply(null,arguments)}}},[e._v("登录")])],1):e._e(),e._v(" "),n("div",{staticClass:"lb-footer-html",domProps:{innerHTML:e._s(e.fHtml)}})],1)},staticRenderFns:[]};var T=n("C7Lr")(w,x,!1,function(e){n("zu0P"),n("dY7D")},"data-v-138f2c56",null);t.default=T.exports},zu0P:function(e,t){}});