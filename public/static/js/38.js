webpackJsonp([38],{"FR+V":function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r("3cXf"),a=r.n(n),o=r("lC5x"),i=r.n(o),l=r("J0Oq"),s=r.n(l),u={data:function(){return{navTitle:"",subForm:{id:"",title:"",day:"",price:"",init_price:"",icon:"",top:0,coupon:[]},subFormRules:{title:{required:!0,validator:this.$reg.isNotNull,reg_type:2,text:"套餐名称",trigger:"blur"},day:{required:!0,validator:this.$reg.isNum,reg_type:2,text:"天数",trigger:"blur"},price:{required:!0,validator:this.$reg.isMoney,text:"套餐现价",trigger:"blur"},init_price:{required:!0,validator:this.$reg.isMoney,text:"套餐划线价格",trigger:"blur"},top:{required:!0,type:"number",message:"请输入排序值",trigger:"blur"}},searchForm:{page:1,limit:10,status:1,send_type:3,name:""},total:0,loading:!1,tableData:[],multipleSelection:[],showDialog:{coupon:!1}}},created:function(){var e=this;return s()(i.a.mark(function t(){var r,n;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=e.$route.query.id,n=void 0===r?0:r,e.navTitle=e.$t(n?"menu.CustomMemberdiscountCardEdit":"menu.CustomMemberdiscountCardAdd"),e.subForm.id=n,!n){t.next=6;break}return t.next=6,e.getDetail();case 6:case"end":return t.stop()}},t,e)}))()},methods:{getDetail:function(){var e=this;return s()(i.a.mark(function t(){var r,n,a,o,l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.subForm.id,t.next=3,e.$api.memberdiscount.cardInfo({id:r});case 3:if(n=t.sent,a=n.code,o=n.data,200===a){t.next=8;break}return t.abrupt("return");case 8:for(l in o.coupon=o.coupon?o.coupon.map(function(e){return e.id=e.coupon_id,e}):[],e.subForm)e.subForm[l]=o[l];case 10:case"end":return t.stop()}},t,e)}))()},toShowDialog:function(e){var t=this;return s()(i.a.mark(function r(){return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t.searchForm.page=1,t.searchForm.name="",r.next=4,t.getTableDataList();case 4:t.showDialog[e]=!t.showDialog[e];case 5:case"end":return r.stop()}},r,t)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;return s()(i.a.mark(function r(){var n,a,o,l,s;return i.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e&&(t.searchForm.page=e),t.loading=!0,r.next=4,t.$api.market.couponList(t.searchForm);case 4:if(n=r.sent,a=n.code,o=n.data,t.loading=!1,200===a){r.next=10;break}return r.abrupt("return");case 10:l=t.subForm.coupon,s=l.map(function(e){return e.id}),o.data.map(function(e){if(e.num=1,s.includes(e.id)){var t=l.findIndex(function(t){return e.id===t.id});e.num=l[t].num}}),t.tableData=o.data,t.total=o.total;case 15:case"end":return r.stop()}},r,t)}))()},handleSelectionChange:function(e){this.multipleSelection=e},handleDialogConfirm:function(){if(0!==this.multipleSelection.length){var e=JSON.parse(a()(this.subForm.coupon)),t=e.length>0?e.map(function(e){return e.id}):[];this.multipleSelection.map(function(r){if(t.includes(r.id)){var n=e.findIndex(function(e){return e.id===r.id});e[n].num=r.num}else e.push(r)}),this.subForm.coupon=e,this.showDialog.coupon=!1}else this.$message.error("请选择卡券")},toDelItem:function(e){this.subForm.coupon.splice(e,1)},submitFormInfo:function(){var e=this;return s()(i.a.mark(function t(){var r,n,o,l;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,e.$refs.subForm.validate(function(e){e||(r=!1)}),r){t.next=4;break}return t.abrupt("return");case 4:if(!(1*(n=JSON.parse(a()(e.subForm))).price>=1*n.init_price)){t.next=8;break}return e.$message.error("套餐划线价必须大于套餐现价！"),t.abrupt("return");case 8:return n.coupon=n.coupon.length>0?n.coupon.map(function(e){return{coupon_id:e.id,num:e.num||0}}):[],o=n.id?"cardUpdate":"cardAdd",t.next=12,e.$api.memberdiscount[o](n);case 12:if(l=t.sent,200===l.code){t.next=16;break}return t.abrupt("return");case 16:e.$message.success(e.$t("tips.successSub")),e.$router.back(-1);case 18:case"end":return t.stop()}},t,e)}))()}}},c={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-custom-member-card-edit"},[r("top-nav",{attrs:{title:e.navTitle,isBack:!0}}),e._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",staticClass:"basic-form",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"140px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"套餐名称",prop:"title"}},[r("el-input",{attrs:{maxlength:"5","show-word-limit":"",placeholder:"请输入会员套餐名称，例如：年卡会员"},model:{value:e.subForm.title,callback:function(t){e.$set(e.subForm,"title",t)},expression:"subForm.title"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"套餐期限",prop:"day"}},[e._v("\n        自购买日起\n        "),r("el-input",{staticClass:"mini ml-md mr-md",attrs:{disabled:1*e.subForm.id>0,placeholder:"请输入天数"},model:{value:e.subForm.day,callback:function(t){e.$set(e.subForm,"day",e._n(t))},expression:"subForm.day"}}),e._v("\n        天内有效\n      ")],1),e._v(" "),r("el-form-item",{attrs:{label:"套餐现价",prop:"price"}},[r("el-input",{attrs:{placeholder:"请输入套餐现价"},model:{value:e.subForm.price,callback:function(t){e.$set(e.subForm,"price",t)},expression:"subForm.price"}},[r("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"套餐划线价",prop:"init_price"}},[r("el-input",{attrs:{placeholder:"请输入套餐划线价"},model:{value:e.subForm.init_price,callback:function(t){e.$set(e.subForm,"init_price",t)},expression:"subForm.init_price"}},[r("template",{slot:"append"},[e._v("元")])],2)],1),e._v(" "),r("el-form-item",{attrs:{label:"套餐标签",prop:"icon"}},[r("el-input",{attrs:{maxlength:"5","show-word-limit":"",placeholder:"请输入会员套餐标签"},model:{value:e.subForm.icon,callback:function(t){e.$set(e.subForm,"icon",t)},expression:"subForm.icon"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"排序值",prop:"top"}},[r("el-input-number",{staticClass:"lb-input-number",attrs:{controls:!1,precision:0,min:0,placeholder:"请输入排序值"},model:{value:e.subForm.top,callback:function(t){e.$set(e.subForm,"top",t)},expression:"subForm.top"}}),e._v(" "),r("lb-tool-tips",[e._v("值越大, 排序越靠前")])],1),e._v(" "),r("el-form-item",{attrs:{label:"选择优惠券",prop:"coupon"}},[r("lb-button",{attrs:{type:"danger",size:"small",icon:"el-icon-plus"},on:{click:function(t){return e.toShowDialog("coupon")}}},[e._v("选择卡券")]),e._v(" "),r("div",{staticClass:"space-lg"}),e._v(" "),r("el-table",{staticStyle:{width:"600px"},attrs:{data:e.subForm.coupon,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[r("el-table-column",{attrs:{prop:"title",label:"优惠券名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"title",label:"使用条件"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v("\n                "+e._s(0===t.row.type?"消费满¥"+t.row.full+"减¥"+t.row.discount:"立减¥"+t.row.discount)+"\n              ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"num",label:"数量",width:"220"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{precision:0,min:1,max:1e3},model:{value:t.row.num,callback:function(r){e.$set(t.row,"num",r)},expression:"scope.row.num"}})]}}])}),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"table-operate"},[r("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(r){return e.toDelItem(t.$index)}}},[e._v(e._s(e.$t("action.delete")))])],1)]}}])})],1)],1),e._v(" "),r("div",{staticStyle:{height:"30px"}}),e._v(" "),r("el-form-item",[r("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.submitFormInfo}},[e._v(e._s(e.$t("action.submit")))]),e._v(" "),r("lb-button",{on:{click:function(t){return e.$router.back(-1)}}},[e._v(e._s(e.$t("action.back")))])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"选择卡券",visible:e.showDialog.coupon,width:"900px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"coupon",t)}}},[r("el-form",{ref:"searchForm",staticClass:"dialog-form",attrs:{inline:!0,model:e.searchForm,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入卡券名称"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"},on:{"selection-change":e.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),r("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),r("el-table-column",{attrs:{prop:"title",label:"卡券名称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"type",label:"使用条件"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("p",[e._v("\n              "+e._s(0===t.row.type?"消费满¥"+t.row.full+"减¥"+t.row.discount:"立减¥"+t.row.discount)+"\n            ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"title",label:"数量",width:"260"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("el-input-number",{attrs:{precision:0,min:1,max:1e3},model:{value:t.row.num,callback:function(r){e.$set(t.row,"num",r)},expression:"scope.row.num"}})]}}])})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.coupon=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var p=r("C7Lr")(u,c,!1,function(e){r("mHB1")},"data-v-ea156b8e",null);t.default=p.exports},mHB1:function(e,t){}});