webpackJsonp([116],{NNsM:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("3cXf"),r=a.n(s),i=a("lC5x"),o=a.n(i),n=a("J0Oq"),l=a.n(n),c=a("4YfN"),m=a.n(c),u=a("bSIt"),p=a("PxTW"),d=a.n(p),h={data:function(){var t=this;return{typeText:{1:"图片",2:"视频"},statusText:{1:{type:"info",text:"审核中"},2:{type:"",text:"审核通过"},3:{type:"danger",text:"已驳回"}},pickerOptions:{disabledDate:function(t){return t.getTime()>1e3*(d()(d()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},searchForm:{page:1,limit:10,status:0,start_time:"",end_time:"",coach_name:""},loading:!1,tableData:[],total:0,count:{},showApply:!1,applyForm:{},subForm:{id:0,status:2,check_text:""},subFormRules:{status:{required:!0,validator:function(e,a,s){t.subForm.status?s():s(new Error("请选择审核结果"))},trigger:"blur"}}}},created:function(){this.getTableDataList(1)},computed:m()({},Object(u.e)({routesItem:function(t){return t.routes}})),methods:{resetForm:function(t){this.$refs[t].resetFields(),this.getTableDataList(1)},handleSizeChange:function(t){this.searchForm.limit=t,this.handleCurrentChange(1)},handleCurrentChange:function(t){this.searchForm.page=t,this.getTableDataList()},toChange:function(t){var e=this;return l()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:e.searchForm.status=t,e.getTableDataList(1);case 2:case"end":return a.stop()}},a,e)}))()},getTableDataList:function(t){var e=this;return l()(o.a.mark(function a(){var s,i,n,l,c,m,u,p,d,h;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t&&(e.searchForm.page=t),e.tableData=[],e.loading=!0,s=JSON.parse(r()(e.searchForm)),(i=s.start_time)&&i.length>1?(s.start_time=i[0]/1e3,s.end_time=i[1]/1e3):(s.start_time="",s.end_time=""),-1===s.status&&(s.is_update=1,delete s.status),a.next=9,e.$api.dynamic.dynamicList(s);case 9:if(n=a.sent,l=n.code,c=n.data,e.loading=!1,200===l){a.next=15;break}return a.abrupt("return");case 15:m=c.all,u=c.nopass,p=c.ing,d=c.pass,h=c.total,e.tableData=c.data,e.total=h,e.count={all:m,nopass:u,ing:p,pass:d};case 19:case"end":return a.stop()}},a,e)}))()},toShowApply:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return l()(o.a.mark(function a(){var s,r,i;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.dynamic.dynamicInfo({id:e});case 2:if(s=a.sent,r=s.code,i=s.data,200===r){a.next=7;break}return a.abrupt("return");case 7:i.imgs=i.imgs.map(function(t){return{url:t}}),i.text=i.text?i.text.replace(/\n/g,"<br>"):"-",t.applyForm=i,t.subForm={id:e,status:2,check_text:""},t.showApply=!t.showApply;case 12:case"end":return a.stop()}},a,t)}))()},confirmDel:function(t,e){var a=this;this.$confirm(this.$t(3===e?"tips.confirmNoPass":"tips.confirmDelete"),this.$t("tips.reminder"),{confirmButtonText:this.$t("action.comfirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){a.updateItem(1,t,-1)}).catch(function(){})},updateItem:function(t,e,a){var s=this;return l()(o.a.mark(function r(){var i,n;return o.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=1===t?{id:e}:{id:e,top:a},n=1===t?"dynamicDel":"dynamicTop",s.$api.dynamic[n](i).then(function(e){200===e.code&&(s.$message.success(s.$t(1===t?"tips.successDel":"tips.successOper")),-1===a&&(s.searchForm.page=s.searchForm.page<Math.ceil((s.total-1)/s.searchForm.limit)?s.searchForm.page:Math.ceil((s.total-1)/s.searchForm.limit)),s.getTableDataList())});case 3:case"end":return r.stop()}},r,s)}))()},submitFormInfo:function(){var t=this,e=!0;if(this.$refs.subForm.validate(function(t){t||(e=!1)}),e){var a=JSON.parse(r()(this.subForm));this.$api.dynamic.dynamicCheck(a).then(function(e){200===e.code&&(t.$message.success(t.$t("tips.successSub")),t.showApply=!1,t.getTableDataList())})}}},filters:{handleTime:function(t,e){return 1===e?d()(1e3*t).format("YYYY-MM-DD"):2===e?d()(1e3*t).format("HH:mm:ss"):d()(1e3*t).format("YYYY-MM-DD HH:mm:ss")}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-dynamic-list"},[a("top-nav"),t._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-top-operate"},[a("el-button",{attrs:{type:0===t.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(0)}}},[t._v("全部（"+t._s(t.count.all||0)+"）")]),t._v(" "),a("el-badge",{staticStyle:{margin:"14px 12px 0 0"},style:{marginRight:t.count.ing>99?"32px":t.count.ing>9?"22px":"12px"},attrs:{value:t.count.ing>0?t.count.ing:"",max:99}},[a("el-button",{staticStyle:{"margin-right":"0"},attrs:{type:1===t.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(1)}}},[t._v("审核中"),0===t.count.ing?a("span",[t._v("（0）")]):t._e()])],1),t._v(" "),a("el-button",{attrs:{type:2===t.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(2)}}},[t._v("审核通过（"+t._s(t.count.pass||0)+"）")]),t._v(" "),a("el-button",{attrs:{type:3===t.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(3)}}},[t._v("已驳回（"+t._s(t.count.nopass||0)+"）")])],1),t._v(" "),a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:t.searchForm},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"输入查询",prop:"coach_name"}},[a("el-input",{attrs:{placeholder:"请输入发布人姓名"},model:{value:t.searchForm.coach_name,callback:function(e){t.$set(t.searchForm,"coach_name",e)},expression:"searchForm.coach_name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"发布时间",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":t.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(e){return t.getTableDataList(1)}},model:{value:t.searchForm.start_time,callback:function(e){t.$set(t.searchForm,"start_time",e)},expression:"searchForm.start_time"}})],1),t._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.getTableDataList(1)}}},[t._v(t._s(t.$t("action.search")))]),t._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(e){return t.resetForm("searchForm")}}},[t._v(t._s(t.$t("action.reset")))])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cover",label:"封面图"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.cover}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"title",label:"标题","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"mobile",label:"发布类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.typeText[e.row.type])+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"coach_name",label:"发布人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cover",label:"发布人头像"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.work_img}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"发布时间","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,2)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"是否置顶"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{disabled:!t.$route.meta.pagePermission[0].auth.includes("edit"),"active-value":1,"inactive-value":0},on:{change:function(a){return t.updateItem(2,e.row.id,e.row.top)}},model:{value:e.row.top,callback:function(a){t.$set(e.row,"top",a)},expression:"scope.row.top"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:t.statusText[e.row.status].type}},[t._v("\n            "+t._s(t.statusText[e.row.status].text)+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"table-operate"},[a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:1===e.row.status?t.$route.name+"-examine":t.$route.name+"-view",expression:"\n                scope.row.status === 1\n                  ? `${$route.name}-examine`\n                  : `${$route.name}-view`\n              "}],attrs:{size:"mini",plain:"",type:1===e.row.status?"primary":"success"},on:{click:function(a){return t.toShowApply(e.row.id)}}},[t._v(t._s(t.$t(1===e.row.status?"action.examine":"action.view")))]),t._v(" "),a("lb-button",{directives:[{name:"show",rawName:"v-show",value:1!==e.row.status,expression:"scope.row.status !== 1"},{name:"hasPermi",rawName:"v-hasPermi",value:t.$route.name+"-delete",expression:"`${$route.name}-delete`"}],attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return t.confirmDel(e.row.id)}}},[t._v(t._s(t.$t("action.delete")))])],1)]}}])})],1),t._v(" "),a("lb-page",{attrs:{batch:!1,page:t.searchForm.page,pageSize:t.searchForm.limit,total:t.total},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),t._v(" "),a("el-dialog",{attrs:{title:"发布详情",visible:t.showApply,width:"800px",top:"10vh",center:""},on:{"update:visible":function(e){t.showApply=e}}},[t.showApply?a("div",{staticStyle:{height:"60vh",overflow:"auto"}},[a("el-form",{attrs:{model:t.applyForm,"label-width":"130px",size:"mini"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"内容："}},[1===t.applyForm.type?a("div",{staticClass:"flex-warp"},[a("lb-cover",{attrs:{fileList:t.applyForm.imgs,isToDel:!1,size:"small",type:"more",fileSize:t.applyForm.imgs.length}})],1):t._e(),t._v(" "),2===t.applyForm.type?a("video",{attrs:{controls:"",width:"500",height:"300",src:t.applyForm.imgs[0].url}}):t._e()]),t._v(" "),a("el-form-item",{attrs:{label:"标题："}},[a("div",[t._v(t._s(t.applyForm.title))])]),t._v(" "),a("el-form-item",{attrs:{label:"正文："}},[a("div",{domProps:{innerHTML:t._s(t.applyForm.text)}})]),t._v(" "),a("el-form-item",{attrs:{label:"地点："}},[a("div",[t._v(t._s(t.applyForm.address))])]),t._v(" "),a("el-form-item",{attrs:{label:"发布人："}},[t.applyForm.coach_info?a("div",{staticClass:"flex-y-center"},[a("img",{staticClass:"avatar sm radius",attrs:{src:t.applyForm.coach_info.work_img}}),t._v(" "),a("div",{staticClass:"ml-md"},[t._v(t._s(t.applyForm.coach_info.coach_name))])]):a("div",[t._v(t._s(t.applyForm.coach_id))])]),t._v(" "),a("el-form-item",{attrs:{label:"发布时间："}},[a("div",[t._v(t._s(t._f("handleTime")(t.applyForm.create_time)))])]),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg b-1px-t"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),1!==t.applyForm.status?a("block",[a("div",{staticClass:"flex-warp"},[a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"审核结果：",prop:"status"}},[a("el-tag",{attrs:{size:"small",type:t.statusText[t.applyForm.status].type}},[t._v(t._s(t.statusText[t.applyForm.status].text))])],1),t._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:1!==t.applyForm.status&&t.applyForm.check_time,expression:"applyForm.status !== 1 && applyForm.check_time"}],staticStyle:{width:"50%"},attrs:{label:"审核时间：",prop:""}},[a("div",{staticClass:"c-warning"},[t._v("\n                  "+t._s(t._f("handleTime")(t.applyForm.check_time))+"\n                ")])])],1),t._v(" "),t.applyForm.check_text?a("el-form-item",{attrs:{label:"审核意见：",prop:"check_text"}},[a("div",[t._v(t._s(t.applyForm.check_text))])]):t._e()],1):t._e()],1),t._v(" "),1===t.applyForm.status?a("el-form",{ref:"subForm",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"130px",size:"mini"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{staticStyle:{width:"50%"},attrs:{label:"审核结果：",prop:"status"}},[a("el-radio-group",{model:{value:t.subForm.status,callback:function(e){t.$set(t.subForm,"status",e)},expression:"subForm.status"}},[a("el-radio",{attrs:{label:2}},[t._v("通过")]),t._v(" "),1===t.applyForm.status?a("el-radio",{attrs:{label:3}},[t._v("驳回")]):t._e()],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"审核意见："}},[a("el-input",{attrs:{type:"textarea",rows:10,maxlength:"300","show-word-limit":"",resize:"none",placeholder:"请输入审核意见"},model:{value:t.subForm.check_text,callback:function(e){t.$set(t.subForm,"check_text",e)},expression:"subForm.check_text"}})],1)],1):t._e()],1):t._e(),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showApply=!1}}},[t._v(t._s(t.$t("action.cancel")))]),t._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:1===t.applyForm.status,expression:"applyForm.status === 1"},{name:"hasPermi",rawName:"v-hasPermi",value:t.$route.name+"-examine",expression:"`${$route.name}-examine`"},{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.submitFormInfo}},[t._v(t._s(t.$t("action.comfirm")))])],1)])],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(h,v,!1,function(t){a("x5qi")},"data-v-50f70138",null);e.default=f.exports},x5qi:function(t,e){}});