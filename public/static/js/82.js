webpackJsonp([82],{ZpHF:function(t,e){},dpJr:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=r("3cXf"),i=r.n(s),a=r("lC5x"),n=r.n(a),c=r("J0Oq"),l=r.n(c),o=r("PxTW"),_=r.n(o),u={data:function(){var t=this,e=function(e,r,s){var i=t.subForm[e.list],a=t.subForm[e.min],n=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;if(2===r){for(var c in i){var l=1*c+1,o=i[c],_=o.km,u=o.cash,p=1*c==0?a:i[1*c-1].km;if(!_||!n.test(_)||1*_<=1*p){var m=_?n.test(_)?"必须大于"+p+"公里":"请输入正确的公里数，最多保留2位小数":"请输入公里数";return void s(new Error("第"+l+"条数据："+m))}if(!u||!n.test(u))return void s(new Error("第"+l+"条数据："+(u?"请输入正确的价格，最多保留2位小数":"请输入价格")))}i.filter(function(t){return t.km&&t.cash.length>0}).length===i.length&&s()}else{var d=t.subForm[e.price];""!==d&&n.test(d)?s():s(new Error(d?"请输入正确的里程计价，最多保留2位小数":"请输入里程计价"))}};return{subForm:{car_price_start:"",car_price_end:"",start_distance:"",start_price:"",cash_type:1,distance_price:"",cash_setting_day:[{km:"",cash:""}],start_distance_night:"",start_price_night:"",cash_type_night:1,distance_price_night:"",cash_setting_night:[{km:"",cash:""}],invented_distance:""},subFormRules:{car_price_start:{required:!0,validator:function(e,r,s){var i=t.subForm,a=i.car_price_start,n=i.car_price_end;a&&n&&a!==n?s():s(new Error(a?n?"开始时间与结束时间不能相同":"请选择结束时间":"请选择开始时间"))},trigger:"blur"},start_distance:{required:!0,validator:this.$reg.isFloatNum,text:"起步距离",trigger:"blur"},start_price:{required:!0,validator:this.$reg.isMoney,text:"起步价",trigger:"blur"},distance_price:{required:!0,validator:this.$reg.isMoney,trigger:"blur"},start_distance_night:{required:!0,validator:this.$reg.isFloatNum,text:"起步距离",trigger:"blur"},start_price_night:{required:!0,validator:this.$reg.isMoney,text:"起步价",trigger:"blur"},distance_price_night:{required:!0,validator:this.$reg.isMoney,trigger:"blur"},invented_distance:{required:!0,validator:this.$reg.isPercent,trigger:"blur"},cash_type:{required:!0,validator:e,min:"start_distance",list:"cash_setting_day",price:"distance_price",trigger:["blur","change"]},cash_type_night:{required:!0,validator:e,min:"start_distance_night",list:"cash_setting_night",price:"distance_price_night",trigger:["blur","change"]}}}},created:function(){this.getFormInfo()},methods:{getFormInfo:function(){var t=this;return l()(n.a.mark(function e(){var r,s,i,a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.system.carConfigInfo();case 2:if(r=e.sent,s=r.code,i=r.data,200===s){e.next=7;break}return e.abrupt("return");case 7:for(a in t.subForm)t.subForm[a]=i[a];case 8:case"end":return e.stop()}},e,t)}))()},toChangeType:function(t,e){2!==t||this.subForm[e]&&0!==this.subForm[e].length||(this.subForm[e]=[{km:"",cash:""}])},toAddItem:function(t,e,r){var s=this;return l()(n.a.mark(function i(){return n.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:2===t?s.subForm[e].splice(r,1):s.subForm[e].push({km:"",cash:""});case 1:case"end":return i.stop()}},i,s)}))()},submitFormInfo:function(){var t=this,e=!0;if(this.$refs.subForm.validate(function(t){t||(e=!1)}),e){var r=JSON.parse(i()(this.subForm));1===r.cash_type&&(r.cash_setting_day=r.cash_setting_day.filter(function(t){return t.km&&t.cash.length>0})),1===r.cash_type_night&&(r.cash_setting_night=r.cash_setting_night.filter(function(t){return t.km&&t.cash.length>0})),this.$api.system.carConfigUpdate(r).then(function(e){200===e.code&&(t.$message.success(t.$t("tips.successSub")),t.getFormInfo())})}}},filters:{handlePriceTime:function(t){var e="无夜间时间段",r=t.car_price_start,s=t.car_price_end;if(r&&s&&r!==s){if("00:00"!==r||"24:00"!==s){var i=_()(Date.now()).format("YYYY-MM-DD"),a="00:00"===r?"23:59":r,n="24:00"===s?"00:01":s,c=_()(i+" "+a).unix(),l=_()(i+" "+n).unix();"00:00"!==r&&(c-=60),"24:00"!==s&&(l+=60);var o="00:00"!==r&&"24:00"!==s?" 次日":"";e=_()(1e3*l).format("HH:mm")+" - "+o+_()(1e3*c).format("HH:mm")}"00:00"===r&&"23:59"===s&&(e="23:59 - 00:00")}return e}}},p={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"lb-system-car-fee-set"},[r("top-nav"),t._v(" "),r("div",{staticClass:"page-main"},[r("lb-tips",[t._v("\n      未单独设置车费的区县，将默认使用该区县所属城市设置的车费模式，若该城市也未设置车费模式，将使用默认的全局设置车费模式\n      "),r("div",{staticClass:"mt-sm"},[t._v("\n        如有单独设置城市/区县车费，将使用对应城市/区县的车费模式，全局模式失效\n      ")])]),t._v(" "),r("el-form",{ref:"subForm",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"160px"},nativeOn:{submit:function(t){t.preventDefault()}}},[r("lb-classify-title",{attrs:{title:"时间段设置"}}),t._v(" "),r("div",{staticClass:"flex-y-center"},[r("el-form-item",{attrs:{label:"日间时段：",prop:"car_price_start"}},[r("el-time-select",{staticStyle:{width:"150px"},attrs:{placeholder:"开始时间","picker-options":{start:"00:00",step:"00:01",end:"24:00"}},model:{value:t.subForm.car_price_start,callback:function(e){t.$set(t.subForm,"car_price_start",e)},expression:"subForm.car_price_start"}}),t._v(" "),r("block",[t._v("-")]),t._v(" "),r("el-time-select",{staticStyle:{width:"150px"},attrs:{placeholder:"结束时间","picker-options":{start:"00:00",step:"00:01",end:"24:00"}},model:{value:t.subForm.car_price_end,callback:function(e){t.$set(t.subForm,"car_price_end",e)},expression:"subForm.car_price_end"}}),t._v(" "),r("lb-tool-tips",[t._v("选择后，剩余未选择时段即为夜间时段")])],1),t._v(" "),r("el-form-item",{attrs:{label:"夜间时段：",prop:""}},[t._v("\n          "+t._s(t._f("handlePriceTime")(t.subForm))+"\n        ")])],1),t._v(" "),r("lb-classify-title",{attrs:{title:"日间车费设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"起步距离",prop:"start_distance"}},[r("el-input",{attrs:{placeholder:"请输入起步距离"},model:{value:t.subForm.start_distance,callback:function(e){t.$set(t.subForm,"start_distance",e)},expression:"subForm.start_distance"}},[r("template",{slot:"append"},[t._v("km")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"起步价",prop:"start_price"}},[r("el-input",{attrs:{placeholder:"请输入起步价"},model:{value:t.subForm.start_price,callback:function(e){t.$set(t.subForm,"start_price",e)},expression:"subForm.start_price"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"里程计价",prop:"cash_type"}},[r("el-radio-group",{on:{change:function(e){return t.toChangeType(e,"cash_setting_day")}},model:{value:t.subForm.cash_type,callback:function(e){t.$set(t.subForm,"cash_type",e)},expression:"subForm.cash_type"}},[r("el-radio",{attrs:{label:1}},[t._v("固定里程计价")]),t._v(" "),r("el-radio",{attrs:{label:2}},[t._v("自定义里程计价")])],1),t._v(" "),r("div",[1===t.subForm.cash_type?r("el-input",{attrs:{placeholder:"请输入里程计价"},model:{value:t.subForm.distance_price,callback:function(e){t.$set(t.subForm,"distance_price",e)},expression:"subForm.distance_price"}},[r("template",{slot:"append"},[t._v("元/km")])],2):r("block",t._l(t.subForm.cash_setting_day,function(e,s){return r("div",{key:s,staticClass:"mb-md"},[r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入公里数"},model:{value:e.km,callback:function(r){t.$set(e,"km",r)},expression:"item.km"}}),t._v("\n              公里以内，"),r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入价格"},model:{value:e.cash,callback:function(r){t.$set(e,"cash",r)},expression:"item.cash"}}),t._v("\n              元/公里\n              "),t.subForm.cash_setting_day.length>1||1===t.subForm.cash_setting_day.length&&0!==s?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"danger",size:"mini",plain:"",icon:"el-icon-delete"},on:{click:function(e){return t.toAddItem(2,"cash_setting_day",s)}}},[t._v("删除")]):t._e(),t._v(" "),s===t.subForm.cash_setting_day.length-1?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.toAddItem(1,"cash_setting_day",s)}}},[t._v("新增")]):t._e()],1)}),0)],1)],1),t._v(" "),"00:00"!==t.subForm.car_price_start||"24:00"!==t.subForm.car_price_end?r("block",[r("lb-classify-title",{attrs:{title:"夜间车费设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"起步距离",prop:"start_distance_night"}},[r("el-input",{attrs:{placeholder:"请输入起步距离"},model:{value:t.subForm.start_distance_night,callback:function(e){t.$set(t.subForm,"start_distance_night",e)},expression:"subForm.start_distance_night"}},[r("template",{slot:"append"},[t._v("km")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"起步价",prop:"start_price_night"}},[r("el-input",{attrs:{placeholder:"请输入起步价"},model:{value:t.subForm.start_price_night,callback:function(e){t.$set(t.subForm,"start_price_night",e)},expression:"subForm.start_price_night"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"里程计价",prop:"cash_type_night"}},[r("el-radio-group",{on:{change:function(e){return t.toChangeType(e,"cash_setting_night")}},model:{value:t.subForm.cash_type_night,callback:function(e){t.$set(t.subForm,"cash_type_night",e)},expression:"subForm.cash_type_night"}},[r("el-radio",{attrs:{label:1}},[t._v("固定里程计价")]),t._v(" "),r("el-radio",{attrs:{label:2}},[t._v("自定义里程计价")])],1),t._v(" "),r("div",[1===t.subForm.cash_type_night?r("el-input",{attrs:{placeholder:"请输入里程计价"},model:{value:t.subForm.distance_price_night,callback:function(e){t.$set(t.subForm,"distance_price_night",e)},expression:"subForm.distance_price_night"}},[r("template",{slot:"append"},[t._v("元/km")])],2):r("block",t._l(t.subForm.cash_setting_night,function(e,s){return r("div",{key:s,staticClass:"mb-md"},[r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入公里数"},model:{value:e.km,callback:function(r){t.$set(e,"km",r)},expression:"item.km"}}),t._v("\n                公里以内，"),r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入价格"},model:{value:e.cash,callback:function(r){t.$set(e,"cash",r)},expression:"item.cash"}}),t._v("\n                元/公里\n                "),t.subForm.cash_setting_night.length>1||1===t.subForm.cash_setting_night.length&&0!==s?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"danger",size:"mini",plain:"",icon:"el-icon-delete"},on:{click:function(e){return t.toAddItem(2,"cash_setting_night",s)}}},[t._v("删除")]):t._e(),t._v(" "),s===t.subForm.cash_setting_night.length-1?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.toAddItem(1,"cash_setting_night",s)}}},[t._v("新增")]):t._e()],1)}),0)],1)],1)],1):t._e(),t._v(" "),r("lb-classify-title",{attrs:{title:"虚拟里程设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"虚拟里程",prop:"invented_distance"}},[r("el-input",{attrs:{placeholder:"请输入虚拟里程"},model:{value:t.subForm.invented_distance,callback:function(e){t.$set(t.subForm,"invented_distance",e)},expression:"subForm.invented_distance"}},[r("template",{slot:"append"},[t._v("%")])],2),t._v(" "),r("lb-tool-tips",[t._v("虚拟里程用于 距离计算短、车费计算少\n          的情况可在后台增加一部分虚拟里程，减少"+t._s(t.$t("action.attendantName"))+"损失\n          "),r("div",{staticClass:"mt-sm"},[t._v("\n            用户端显示的距离=实际距离+实际距离*虚拟里程百分比\n          ")])])],1),t._v(" "),r("el-form-item",[r("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.submitFormInfo}},[t._v(t._s(t.$t("action.submit")))])],1)],1)],1)],1)},staticRenderFns:[]};var m=r("C7Lr")(u,p,!1,function(t){r("ZpHF")},"data-v-77274756",null);e.default=m.exports}});