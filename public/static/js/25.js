webpackJsonp([25],{"5dyO":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("p00s"),r=a.n(n),i=a("3cXf"),s=a.n(i),o=a("4YfN"),l=a.n(o),c=a("lC5x"),_=a.n(c),m=a("J0Oq"),u=a.n(m),p=a("PxTW"),d=a.n(p),h=a("bSIt"),f={data:function(){return{loading:!1,downloadLoading:!1,print:!1,pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(d()(d()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},base_channel:[],statusOptions:[{label:"全部订单",value:0},{label:"待服务",value:2},{label:this.$t("action.attendantName")+"接单",value:3},{label:this.$t("action.attendantName")+"出发",value:4},{label:this.$t("action.attendantName")+"到达",value:5},{label:"服务中",value:6},{label:"已完成",value:7}],coachTypeList:[{id:0,title:"全部"+this.$t("action.attendantName")},{id:1,title:"入驻"+this.$t("action.attendantName")},{id:2,title:"非入驻"+this.$t("action.attendantName")}],serviceTypeList:[{id:0,title:"全部服务"},{id:2,title:"上门服务"},{id:1,title:"到店服务"}],carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付",4:"折扣卡支付"},statusType:{"-1":"已取消",1:"待支付",2:"待服务",3:this.$t("action.attendantName")+"接单",4:this.$t("action.attendantName")+"出发",5:this.$t("action.attendantName")+"到达",6:"服务中",7:"已完成"},printTableData:[],searchForm:{page:1,limit:10,goods_name:"",coach_name:"",channel_qr_name:"",is_channel:1,channel_name:"",channel_cate_id:0,order_code:"",transaction_id:"",mobile:"",start_time:"",end_time:"",pay_type:0,is_coach:0,is_store:0},tableData:[],total:0,count:{}}},created:function(){var e=this;return u()(_.a.mark(function t(){return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getBaseInfo();case 2:e.getTableDataList();case 3:case"end":return t.stop()}},t,e)}))()},computed:l()({},Object(h.e)({routesItem:function(e){return e.routes}})),methods:{getBaseInfo:function(){var e=this;return u()(_.a.mark(function t(){var a,n;return _.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.channel.cateSelect();case 2:a=t.sent,(n=a.data).unshift({id:0,title:"全部"}),e.base_channel=n;case 6:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;e&&(this.searchForm.page=e),this.loading=!0;var a=JSON.parse(s()(this.searchForm)),n=a.start_time;n&&n.length>1?(a.start_time=n[0]/1e3,a.end_time=n[1]/1e3):(a.start_time="",a.end_time=""),this.$api.shop.orderTotalData(a).then(function(e){t.count=e.data}),this.$api.shop.orderList(a).then(function(e){if(t.loading=!1,200===e.code){var a=e.data,n=a.data,r=a.total;n.map(function(e){e.is_balance=1*e.balance>0?1:0,e.refund_price=1*e.refund_price>0?e.refund_price:""}),t.tableData=n,t.total=r;var i=t.routesItem.auth,s=i.channel,o=i.channel_auth,l=i.channelcate,c=t.routesItem.userInfo.is_admin,_=s&&(c||!c&&o),m=n.map(function(e){e.goods_text="",e.order_goods.map(function(t){e.goods_text+=t.goods_name+" 数量：x"+t.num+"；"});var a=["","平台补贴",t.$t("action.attendantName")+"补贴",t.$t("action.agentName")+"补贴"],n=e.free_fare?a[e.free_fare]:"",r=1===e.car_type?"全程"+e.distance+"，车费"+e.car_price+" "+n:"";return e.car_text=e.store_id?"":""+t.carType[e.car_type]+r+" ",[e.id,e.goods_text,e.user_name,e.mobile,e.coach_name,e.coach_id?"入驻"+t.$t("action.attendantName"):"非入驻"+t.$t("action.attendantName"),e.store_id?"到店服务":"上门服务",d()(1e3*e.start_time).format("YYYY-MM-DD HH:mm:ss"),e.car_text,e.init_service_price,e.pay_price,e.refund_price,e.order_code,e.transaction_id,e.admin_name].concat(_&&l?[e.channel_name,e.channel_qr_name,e.channel,d()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),t.payType[e.pay_model],t.statusType[e.pay_type]]:_?[e.channel_name,e.channel_qr_name,d()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),t.payType[e.pay_model],t.statusType[e.pay_type]]:[d()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),t.payType[e.pay_model],t.statusType[e.pay_type]])}),u=["ID","服务项目信息","下单人","下单手机号",t.$t("action.attendantName"),t.$t("action.attendantName")+"类型","服务方式","服务开始时间","出行费用","服务项目费用","实收金额","退款金额","系统订单号","付款订单号",t.$t("action.agentName")].concat(_&&l?[t.$t("action.channelName"),"渠道码","渠道","下单时间","支付方式","状态"]:_?[t.$t("action.channelName"),"渠道码","下单时间","支付方式","状态"]:["下单时间","支付方式","状态"]);t.printTableData=[u,m],t.routesItem.auth.channelcate||(t.printTableData[0].splice(17,1),t.printTableData[1].map(function(e,t){e.splice(17,1)}))}})},toExportExcel:function(){var e=this,t=this.total;if(t>1e4)this.$message.error("最多只能导出10000条数据，当前"+t+"条，请筛选数据点击搜索后再操作导出数据！");else{this.downloadLoading=!0;var a=JSON.parse(s()(this.searchForm)),n=a.start_time;n&&n.length>1?(a.start_time=n[0]/1e3,a.end_time=n[1]/1e3):(a.start_time="",a.end_time="");var i=this.$util.getProCurrentHref(),o=i.indexOf("?")>0?"":"?",l=i.indexOf("?")>0;r()(a).forEach(function(e,t){o+=l?"&"+e+"="+a[e]:e+"="+a[e],l=!0});var c=window.localStorage.getItem("massage_minitk"),_=i+"/massage/admin/AdminExcel/orderList"+o+"&token="+c;window.location.href=_,setTimeout(function(){e.downloadLoading=!1},5e3)}},printTable:function(){var e=this;this.print=!0,setTimeout(function(){e.$print(e.$refs.print),e.print=!1},50)}},filters:{handleTime:function(e,t){return 1===t?d()(1e3*e).format("YYYY-MM-DD"):2===t?d()(1e3*e).format("HH:mm:ss"):d()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-channel-finance"},[a("top-nav"),e._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"服务名称",prop:"goods_name"}},[a("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.searchForm.goods_name,callback:function(t){e.$set(e.searchForm,"goods_name",t)},expression:"searchForm.goods_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("action.attendantName")+"姓名",prop:"coach_name"}},[a("el-input",{attrs:{placeholder:"请输入"+e.$t("action.attendantName")+"姓名"},model:{value:e.searchForm.coach_name,callback:function(t){e.$set(e.searchForm,"coach_name",t)},expression:"searchForm.coach_name"}})],1),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?a("el-form-item",{attrs:{label:e.$t("action.channelName")+"姓名",prop:"channel_name"}},[a("el-input",{attrs:{placeholder:"请输入"+e.$t("action.channelName")+"姓名"},model:{value:e.searchForm.channel_name,callback:function(t){e.$set(e.searchForm,"channel_name",t)},expression:"searchForm.channel_name"}})],1):e._e(),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?a("el-form-item",{attrs:{label:"渠道码名称",prop:"channel_qr_name"}},[a("el-input",{attrs:{placeholder:"请输入渠道码名称"},model:{value:e.searchForm.channel_qr_name,callback:function(t){e.$set(e.searchForm,"channel_qr_name",t)},expression:"searchForm.channel_qr_name"}})],1):e._e(),e._v(" "),e.routesItem.auth.channelcate?a("el-form-item",{attrs:{label:"渠道",prop:"channel_cate_id"}},[a("el-select",{attrs:{filterable:"",clearable:"",placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.channel_cate_id,callback:function(t){e.$set(e.searchForm,"channel_cate_id",t)},expression:"searchForm.channel_cate_id"}},e._l(e.base_channel,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[a("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:e.searchForm.order_code,callback:function(t){e.$set(e.searchForm,"order_code",t)},expression:"searchForm.order_code"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"付款订单号",prop:"transaction_id"}},[a("el-input",{attrs:{placeholder:"请输入付款订单号"},model:{value:e.searchForm.transaction_id,callback:function(t){e.$set(e.searchForm,"transaction_id",t)},expression:"searchForm.transaction_id"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"下单手机号",prop:"mobile"}},[a("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入下单时填写的手机号"},model:{value:e.searchForm.mobile,callback:function(t){e.$set(e.searchForm,"mobile",t)},expression:"searchForm.mobile"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"日期",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.start_time,callback:function(t){e.$set(e.searchForm,"start_time",t)},expression:"searchForm.start_time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$t("action.attendantName")+"类型",prop:"is_coach"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.is_coach,callback:function(t){e.$set(e.searchForm,"is_coach",t)},expression:"searchForm.is_coach"}},e._l(e.coachTypeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),e.routesItem.auth.store?a("el-form-item",{attrs:{label:"服务方式",prop:"is_store"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.is_store,callback:function(t){e.$set(e.searchForm,"is_store",t)},expression:"searchForm.is_store"}},e._l(e.serviceTypeList,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"状态",prop:"pay_type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.pay_type,callback:function(t){e.$set(e.searchForm,"pay_type",t)},expression:"searchForm.pay_type"}},e._l(e.statusOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),a("el-row",{staticClass:"page-top-operate"},[a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-print",expression:"`${$route.name}-print`"}],attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-printer"},on:{click:e.printTable}},[e._v(e._s(e.$t("action.print")))]),e._v(" "),a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-export",expression:"`${$route.name}-export`"}],attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.toExportExcel}},[e._v("\n        "+e._s(e.$t("action.export"))+"\n      ")]),e._v(" "),a("div",{staticClass:"pb-lg"},[e._v("\n        共"),a("span",{staticClass:"c-warning"},[e._v(e._s(e.total||0)+"条")]),e._v("数据，订单总额共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.pay_price||0)+"元")]),e._v("，服务费共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.service_price||0)+"元")]),e._v("，"+e._s(e.$t("action.materialText"))+"共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.material_price||0)+"元")]),e._v("，车费共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.car_price||0)+"元")]),e._v("，服务费退款共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_service_price||0)+"元")]),e._v("，"+e._s(e.$t("action.materialText"))+"退款共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_material_price||0)+"元")]),e._v("，车费退款共计："),a("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_car_price||0)+"元")])])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),e._v(" "),a("el-table-column",{attrs:{prop:"goods_info_text",width:"210",label:"服务项目信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.order_goods,function(t,n){return a("div",{key:n,staticClass:"goods-info-text flex-warp pt-md pb-sm"},[a("lb-image",{staticClass:"radius-5",attrs:{src:t.goods_cover}}),e._v(" "),a("div",{staticClass:"info-item flex-1 f-icontext c-caption ml-md"},[a("div",{staticClass:"flex-between"},[a("div",{staticClass:"f-caption c-title ellipsis",class:[{"max-160":t.refund_num>0}],staticStyle:{"line-height":"1.2"}},[e._v("\n                  "+e._s(t.goods_name)+"\n                ")]),e._v(" "),t.refund_num>0?a("div",{staticClass:"c-warning"},[e._v("\n                  已退x"+e._s(t.refund_num)+"\n                ")]):e._e()]),e._v(" "),a("div",{staticClass:"flex-y-center",staticStyle:{"line-height":"1.4"}},[e._v("\n                时长："+e._s(t.time_long)+" 分钟\n              ")]),e._v(" "),1*t.init_material_price>0?a("div",{staticClass:"flex-y-center",staticStyle:{"line-height":"1.4"}},[e._v("\n                "+e._s(e.$t("action.materialText"))+"：\n                "),a("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.init_material_price))])]):e._e(),e._v(" "),a("div",{staticClass:"flex-between mt-sm",staticStyle:{"line-height":"1.4"}},[a("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.price))]),e._v(" "),a("div",[e._v("x"+e._s(t.num))])])])],1)})}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"下单人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"mobile","min-width":"110",label:"下单手机号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"coach_info.coach_name",label:e.$t("action.attendantName")}}),e._v(" "),a("el-table-column",{attrs:{prop:"coach_id",label:e.$t("action.attendantName")+"类型","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("\n            "+e._s(t.row.coach_id?"入驻":"非入驻")+e._s(e.$t("action.attendantName"))+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"store_id",label:"服务方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.store_id?"到店服务":"上门服务"))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"start_time","min-width":"110",label:"服务开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"car_type","min-width":"120",label:"出行费用"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.store_id?void 0:[a("div",[e._v("\n            "+e._s(e.carType[t.row.car_type])+"\n          ")]),e._v(" "),1==t.row.car_type?a("div",{staticClass:"flex-y-center"},[e._v("\n            全程"+e._s(t.row.distance)+"，车费¥"+e._s(t.row.car_price)+"\n          ")]):e._e(),e._v(" "),t.row.free_fare?a("div",{staticClass:"c-warning"},[e._v("\n            "+e._s(["","平台补贴",e.$t("action.attendantName")+"补贴",e.$t("action.agentName")+"补贴"][t.row.free_fare])+"\n          ")]):e._e()]}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"init_service_price",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.init_service_price)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_price",label:"实收金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v("¥"+e._s(t.row.pay_price))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"refund_price",label:"退款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.refund_price?[a("div",[e._v("¥"+e._s(t.row.refund_price))])]:void 0}}],null,!0)}),e._v(" "),a("el-table-column",{attrs:{prop:"order_code","min-width":"130",label:"系统订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"transaction_id","min-width":"130",label:"付款订单号"}}),e._v(" "),a("el-table-column",{attrs:{prop:"admin_name",label:""+e.$t("action.agentName")}}),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?a("el-table-column",{attrs:{prop:"channel_name",label:e.$t("action.channelName")}}):e._e(),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?a("el-table-column",{attrs:{prop:"channel_qr_name",label:"渠道码","min-width":"100"}}):e._e(),e._v(" "),e.routesItem.auth.channel&&e.routesItem.auth.channelcate?a("el-table-column",{attrs:{prop:"channel",label:"渠道"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"create_time","min-width":"110",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),a("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"pay_model",label:"支付方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.payType[t.row.pay_model])+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.statusType[t.row.pay_type])+"\n        ")]}}])})],1),e._v(" "),a("table",{directives:[{name:"show",rawName:"v-show",value:e.print,expression:"print"}],ref:"print",staticStyle:{"font-size":"12px"},attrs:{border:"0",cellspacing:"0",cellapdding:"0"}},[a("thead",[a("tr",e._l(e.printTableData[0],function(t,n){return a("th",{key:n,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)]),e._v(" "),a("tbody",e._l(e.printTableData[1],function(t,n){return a("tr",{key:n},e._l(t,function(t,n){return a("td",{key:n,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)}),0)]),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}})],1)],1)},staticRenderFns:[]};var b=a("C7Lr")(f,v,!1,function(e){a("PWA8"),a("frGe")},"data-v-38f28911",null);t.default=b.exports},PWA8:function(e,t){},frGe:function(e,t){}});