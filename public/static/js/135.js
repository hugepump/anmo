webpackJsonp([135],{jNut:function(t,e){},xy4e:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=r("3cXf"),a=r.n(i),s=r("lC5x"),n=r.n(s),c=r("J0Oq"),l=r.n(c),o=r("PxTW"),u=r.n(o),_={data:function(){var t=this,e=function(e,r,i){var a=t.subForm[e.list],s=t.subForm[e.min],n=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;if(2===r){for(var c in a){var l=1*c+1,o=a[c],u=o.km,_=o.cash,p=1*c==0?s:a[1*c-1].km;if(!u||!n.test(u)||1*u<=1*p){var m=u?n.test(u)?"必须大于"+p+"公里":"请输入正确的公里数，最多保留2位小数":"请输入公里数";return void i(new Error("第"+l+"条数据："+m))}if(!_||!n.test(_))return void i(new Error("第"+l+"条数据："+(_?"请输入正确的价格，最多保留2位小数":"请输入价格")))}a.filter(function(t){return t.km&&t.cash.length>0}).length===a.length&&i()}else{var d=t.subForm[e.price];""!==d&&n.test(d)?i():i(new Error(d?"请输入正确的里程计价，最多保留2位小数":"请输入里程计价"))}};return{navTitle:"",base_city:[],subForm:{id:0,city_id:"",car_price_start:"",car_price_end:"",start_distance:"",start_price:"",cash_type:1,distance_price:"",cash_setting_day:[{km:"",cash:""}],start_distance_night:"",start_price_night:"",cash_type_night:1,distance_price_night:"",cash_setting_night:[{km:"",cash:""}],invented_distance:""},subFormRules:{city_id:{required:!0,type:"array",message:"请选择城市/区县",trigger:"blur"},car_price_start:{required:!0,validator:function(e,r,i){var a=t.subForm,s=a.car_price_start,n=a.car_price_end;s&&n&&s!==n?i():i(new Error(s?n?"开始时间与结束时间不能相同":"请选择结束时间":"请选择开始时间"))},trigger:"blur"},start_distance:{required:!0,validator:this.$reg.isFloatNum,text:"起步距离",trigger:"blur"},start_price:{required:!0,validator:this.$reg.isMoney,text:"起步价",trigger:"blur"},distance_price:{required:!0,validator:this.$reg.isMoney,trigger:"blur"},cash_type:{required:!0,validator:e,min:"start_distance",list:"cash_setting_day",price:"distance_price",trigger:["blur","change"]},start_distance_night:{required:!0,validator:this.$reg.isFloatNum,text:"起步距离",trigger:"blur"},start_price_night:{required:!0,validator:this.$reg.isMoney,text:"起步价",trigger:"blur"},distance_price_night:{required:!0,validator:this.$reg.isMoney,trigger:"blur"},cash_type_night:{required:!0,validator:e,min:"start_distance_night",list:"cash_setting_night",price:"distance_price_night",trigger:["blur","change"]},invented_distance:{required:!0,validator:this.$reg.isPercent,trigger:"blur"}}}},created:function(){var t=this;return l()(n.a.mark(function e(){var r;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$route.query.id,t.subForm.id=r,t.navTitle=t.$t(r?"menu.SystemCarFeeCityEdit":"menu.SystemCarFeeCityAdd"),e.next=5,t.getBaseInfo();case 5:if(r){e.next=7;break}return e.abrupt("return");case 7:t.getDetail();case 8:case"end":return e.stop()}},e,t)}))()},methods:{getBaseInfo:function(){var t=this;return l()(n.a.mark(function e(){var r,i,a;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.system.citySelect();case 2:if(r=e.sent,i=r.code,a=r.data,200===i){e.next=7;break}return e.abrupt("return");case 7:a.map(function(t){t.children.map(function(t){delete t.children})}),t.base_city=a;case 9:case"end":return e.stop()}},e,t)}))()},getDetail:function(){var t=this;return l()(n.a.mark(function e(){var r,i,a,s,c;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.subForm.id,e.next=3,t.$api.system.getCarConfigInfo({id:r});case 3:if(i=e.sent,a=i.code,s=i.data,200===a){e.next=8;break}return e.abrupt("return");case 8:for(c in t.subForm)t.subForm[c]=s[c];case 9:case"end":return e.stop()}},e,t)}))()},toChangeType:function(t,e){2!==t||this.subForm[e]&&0!==this.subForm[e].length||(this.subForm[e]=[{km:"",cash:""}])},toAddItem:function(t,e,r){var i=this;return l()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:2===t?i.subForm[e].splice(r,1):i.subForm[e].push({km:"",cash:""});case 1:case"end":return a.stop()}},a,i)}))()},submitFormInfo:function(){var t=this,e=!0;if(this.$refs.subForm.validate(function(t){t||(e=!1)}),e){var r=JSON.parse(a()(this.subForm));r.city_id=r.city_id[r.city_id.length-1],1===r.cash_type&&(r.cash_setting_day=r.cash_setting_day.filter(function(t){return t.km&&t.cash.length>0})),1===r.cash_type_night&&(r.cash_setting_night=r.cash_setting_night.filter(function(t){return t.km&&t.cash.length>0}));var i=r.id?"getCarConfigUpdate":"getCarConfigAdd";this.$api.system[i](r).then(function(e){200===e.code&&(t.$message.success(t.$t("tips.successSub")),t.$router.back(-1))})}}},filters:{handlePriceTime:function(t){var e="无夜间时间段",r=t.car_price_start,i=t.car_price_end;if(r&&i&&r!==i){if("00:00"!==r||"24:00"!==i){var a=u()(Date.now()).format("YYYY-MM-DD"),s="00:00"===r?"23:59":r,n="24:00"===i?"00:01":i,c=u()(a+" "+s).unix(),l=u()(a+" "+n).unix();"00:00"!==r&&(c-=60),"24:00"!==i&&(l+=60);var o="00:00"!==r&&"24:00"!==i?" 次日":"";e=u()(1e3*l).format("HH:mm")+" - "+o+u()(1e3*c).format("HH:mm")}"00:00"===r&&"23:59"===i&&(e="23:59 - 00:00")}return e}}},p={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"lb-system-car-fee-edit"},[r("top-nav",{attrs:{title:t.navTitle,isBack:!0}}),t._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"160px"},nativeOn:{submit:function(t){t.preventDefault()}}},[r("el-form-item",{attrs:{label:"城市/区县",prop:"city_id"}},[r("el-cascader",{attrs:{options:t.base_city,props:{checkStrictly:!0,label:"title",value:"id"},placeholder:"请选择城市/区县"},model:{value:t.subForm.city_id,callback:function(e){t.$set(t.subForm,"city_id",e)},expression:"subForm.city_id"}})],1),t._v(" "),r("lb-classify-title",{attrs:{title:"时间段设置"}}),t._v(" "),r("div",{staticClass:"flex-y-center"},[r("el-form-item",{attrs:{label:"日间时段：",prop:"car_price_start"}},[r("el-time-select",{staticStyle:{width:"150px"},attrs:{placeholder:"开始时间","picker-options":{start:"00:00",step:"00:01",end:"24:00"}},model:{value:t.subForm.car_price_start,callback:function(e){t.$set(t.subForm,"car_price_start",e)},expression:"subForm.car_price_start"}}),t._v(" "),r("block",[t._v("-")]),t._v(" "),r("el-time-select",{staticStyle:{width:"150px"},attrs:{placeholder:"结束时间","picker-options":{start:"00:00",step:"00:01",end:"24:00"}},model:{value:t.subForm.car_price_end,callback:function(e){t.$set(t.subForm,"car_price_end",e)},expression:"subForm.car_price_end"}}),t._v(" "),r("lb-tool-tips",[t._v("选择后，剩余未选择时段即为夜间时段")])],1),t._v(" "),r("el-form-item",{attrs:{label:"夜间时段：",prop:""}},[t._v("\n          "+t._s(t._f("handlePriceTime")(t.subForm))+"\n        ")])],1),t._v(" "),r("lb-classify-title",{attrs:{title:"日间车费设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"起步距离",prop:"start_distance"}},[r("el-input",{attrs:{placeholder:"请输入起步距离"},model:{value:t.subForm.start_distance,callback:function(e){t.$set(t.subForm,"start_distance",e)},expression:"subForm.start_distance"}},[r("template",{slot:"append"},[t._v("km")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"起步价",prop:"start_price"}},[r("el-input",{attrs:{placeholder:"请输入起步价"},model:{value:t.subForm.start_price,callback:function(e){t.$set(t.subForm,"start_price",e)},expression:"subForm.start_price"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"里程计价",prop:"cash_type"}},[r("el-radio-group",{on:{change:function(e){return t.toChangeType(e,"cash_setting_day")}},model:{value:t.subForm.cash_type,callback:function(e){t.$set(t.subForm,"cash_type",e)},expression:"subForm.cash_type"}},[r("el-radio",{attrs:{label:1}},[t._v("固定里程计价")]),t._v(" "),r("el-radio",{attrs:{label:2}},[t._v("自定义里程计价")])],1),t._v(" "),r("div",[1===t.subForm.cash_type?r("el-input",{attrs:{placeholder:"请输入里程计价"},model:{value:t.subForm.distance_price,callback:function(e){t.$set(t.subForm,"distance_price",e)},expression:"subForm.distance_price"}},[r("template",{slot:"append"},[t._v("元/km")])],2):r("block",t._l(t.subForm.cash_setting_day,function(e,i){return r("div",{key:i,staticClass:"mb-md"},[r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入公里数"},model:{value:e.km,callback:function(r){t.$set(e,"km",r)},expression:"item.km"}}),t._v("\n              公里以内，"),r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入价格"},model:{value:e.cash,callback:function(r){t.$set(e,"cash",r)},expression:"item.cash"}}),t._v("\n              元/公里\n              "),t.subForm.cash_setting_day.length>1||1===t.subForm.cash_setting_day.length&&0!==i?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"danger",size:"mini",plain:"",icon:"el-icon-delete"},on:{click:function(e){return t.toAddItem(2,"cash_setting_day",i)}}},[t._v("删除")]):t._e(),t._v(" "),i===t.subForm.cash_setting_day.length-1?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.toAddItem(1,"cash_setting_day",i)}}},[t._v("新增")]):t._e()],1)}),0)],1)],1),t._v(" "),"00:00"!==t.subForm.car_price_start||"24:00"!==t.subForm.car_price_end?r("block",[r("lb-classify-title",{attrs:{title:"夜间车费设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"起步距离",prop:"start_distance_night"}},[r("el-input",{attrs:{placeholder:"请输入起步距离"},model:{value:t.subForm.start_distance_night,callback:function(e){t.$set(t.subForm,"start_distance_night",e)},expression:"subForm.start_distance_night"}},[r("template",{slot:"append"},[t._v("km")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"起步价",prop:"start_price_night"}},[r("el-input",{attrs:{placeholder:"请输入起步价"},model:{value:t.subForm.start_price_night,callback:function(e){t.$set(t.subForm,"start_price_night",e)},expression:"subForm.start_price_night"}},[r("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),r("el-form-item",{attrs:{label:"里程计价",prop:"cash_type_night"}},[r("el-radio-group",{on:{change:function(e){return t.toChangeType(e,"cash_setting_night")}},model:{value:t.subForm.cash_type_night,callback:function(e){t.$set(t.subForm,"cash_type_night",e)},expression:"subForm.cash_type_night"}},[r("el-radio",{attrs:{label:1}},[t._v("固定里程计价")]),t._v(" "),r("el-radio",{attrs:{label:2}},[t._v("自定义里程计价")])],1),t._v(" "),r("div",[1===t.subForm.cash_type_night?r("el-input",{attrs:{placeholder:"请输入里程计价"},model:{value:t.subForm.distance_price_night,callback:function(e){t.$set(t.subForm,"distance_price_night",e)},expression:"subForm.distance_price_night"}},[r("template",{slot:"append"},[t._v("元/km")])],2):r("block",t._l(t.subForm.cash_setting_night,function(e,i){return r("div",{key:i,staticClass:"mb-md"},[r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入公里数"},model:{value:e.km,callback:function(r){t.$set(e,"km",r)},expression:"item.km"}}),t._v("\n                公里以内，"),r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入价格"},model:{value:e.cash,callback:function(r){t.$set(e,"cash",r)},expression:"item.cash"}}),t._v("\n                元/公里\n                "),t.subForm.cash_setting_night.length>1||1===t.subForm.cash_setting_night.length&&0!==i?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"danger",size:"mini",plain:"",icon:"el-icon-delete"},on:{click:function(e){return t.toAddItem(2,"cash_setting_night",i)}}},[t._v("删除")]):t._e(),t._v(" "),i===t.subForm.cash_setting_night.length-1?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.toAddItem(1,"cash_setting_night",i)}}},[t._v("新增")]):t._e()],1)}),0)],1)],1)],1):t._e(),t._v(" "),r("lb-classify-title",{attrs:{title:"虚拟里程设置"}}),t._v(" "),r("el-form-item",{attrs:{label:"虚拟里程",prop:"invented_distance"}},[r("el-input",{attrs:{placeholder:"请输入虚拟里程"},model:{value:t.subForm.invented_distance,callback:function(e){t.$set(t.subForm,"invented_distance",e)},expression:"subForm.invented_distance"}},[r("template",{slot:"append"},[t._v("%")])],2),t._v(" "),r("lb-tool-tips",[t._v("虚拟里程用于 距离计算短、车费计算少\n          的情况可在后台增加一部分虚拟里程，减少"+t._s(t.$t("action.attendantName"))+"损失\n          "),r("div",{staticClass:"mt-sm"},[t._v("\n            用户端显示的距离=实际距离+实际距离*虚拟里程百分比\n          ")])])],1),t._v(" "),r("el-form-item",[r("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.submitFormInfo}},[t._v(t._s(t.$t("action.submit")))]),t._v(" "),r("lb-button",{on:{click:function(e){return t.$router.back(-1)}}},[t._v(t._s(t.$t("action.back")))])],1)],1)],1)],1)},staticRenderFns:[]};var m=r("C7Lr")(_,p,!1,function(t){r("jNut")},"data-v-4211f57d",null);e.default=m.exports}});