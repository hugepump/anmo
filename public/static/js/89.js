webpackJsonp([89],{"0OJD":function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=s("4YfN"),a=s.n(r),n=s("lC5x"),o=s.n(n),i=s("J0Oq"),l=s.n(i),c=s("bSIt"),u=s("PxTW"),_=s.n(u),m={data:function(){return{loading:!1,navTitle:"",pagePermission:[],carType:{0:"公交/地铁",1:"出租车"},statusType:{"-1":"已取消",1:"待退款",2:"同意退款",3:"拒绝退款",4:"退款中",5:"退款失败"},subForm:{id:0},dialogRefund:!1,refundMoney:"",lockRefund:!1}},created:function(){var e=this;return l()(o.a.mark(function t(){var s,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s=e.$route.query.id,t.next=3,e.getDetail(s);case 3:r=1===e.subForm.is_add?"ShopBellRefund":"ShopRefund",e.routesItem.routes.map(function(t){"/shop"===t.path&&t.children.map(function(t){t.name===r&&(e.pagePermission=t.meta.pagePermission[0].auth)})});case 5:case"end":return t.stop()}},t,e)}))()},computed:a()({},Object(c.e)({routesItem:function(e){return e.routes}})),methods:{getDetail:function(e){var t=this;return l()(o.a.mark(function s(){var r,a,n;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,t.$api.shop.refundOrderInfo({id:e});case 2:if(r=s.sent,a=r.code,n=r.data,200===a){s.next=7;break}return s.abrupt("return");case 7:t.subForm=n;case 8:case"end":return s.stop()}},s,t)}))()},showRefundDialog:function(){var e=this.subForm.apply_price;this.refundTotalMoney=e,this.refundMoney=e,this.dialogRefund=!0},toPassRefund:function(){var e=this;return l()(o.a.mark(function t(){var s,r,a,n,i,l;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.lockRefund){t.next=2;break}return t.abrupt("return");case 2:if(s=e.subForm,r=s.id,a=s.apply_price,n=e.refundMoney,i={id:r,price:1*n,text:""},!(0===a&&0===n||n>0&&n<=a&&/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/.test(n))){t.next=21;break}return t.next=9,e.$api.shop.passRefund(i);case 9:if(l=t.sent,200===l.code){t.next=13;break}return t.abrupt("return");case 13:return e.$message.success(e.$t("tips.successSub")),e.dialogRefund=!1,e.refundMoney="",t.next=18,e.getDetail(r);case 18:e.lockRefund=!1,t.next=22;break;case 21:e.$message.error("请核对金额再提交！");case 22:case"end":return t.stop()}},t,e)}))()}},watch:{$route:function(e){var t=this;return l()(o.a.mark(function s(){var r,a;return o.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:r=e.query.id,1*(a=void 0===r?0:r)!==t.subForm.id&&t.getDetail(a);case 2:case"end":return s.stop()}},s,t)}))()}},filters:{handleTime:function(e,t){return 1===t?_()(1e3*e).format("YYYY-MM-DD"):2===t?_()(1e3*e).format("HH:mm:ss"):_()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},d={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"lb-shop-refund-detail"},[s("top-nav",{attrs:{isBack:!0}}),e._v(" "),s("div",{staticClass:"page-main"},[s("lb-tips",{attrs:{isIcon:!1}},[s("div",{staticClass:"flex-y-center"},[e._v("\n        "+e._s(e.statusType[e.subForm.status])+"\n        "),5===e.subForm.status&&e.subForm.failure_reason?s("el-popover",{attrs:{placement:"top-start",width:"400",trigger:"hover"}},[s("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[s("div",{staticClass:"c-caption pb-sm"},[e._v("失败原因：")]),e._v(" "),s("div",{domProps:{innerHTML:e._s(e.subForm.failure_reason)}})]),e._v(" "),s("span",{staticClass:"iconfont iconwentifankui1 c-warning",attrs:{slot:"reference"},slot:"reference"})]):e._e(),e._v(" "),2===e.subForm.status?s("div",{staticClass:"flex-y-center"},[e._v("\n          ，退款金额：¥"+e._s(e.subForm.refund_price)+"\n          "),1*e.subForm.refund_car_price==-1&&1*e.subForm.car_price>0&&!e.subForm.free_fare||1*e.subForm.refund_car_price>0&&1*e.subForm.refund_car_price>0?s("div",{staticClass:"ml-md c-warning"},[e._v("\n            含车费：¥"+e._s(1*e.subForm.refund_car_price==-1?e.subForm.car_price:e.subForm.refund_car_price)+"\n          ")]):e._e(),e._v(" "),1*e.subForm.refund_material_price>0?s("div",{staticClass:"ml-md c-warning"},[e._v("\n            含"+e._s(e.$t("action.materialText"))+"：¥"+e._s(e.subForm.refund_material_price)+"\n          ")]):e._e(),e._v(" "),1*e.subForm.apply_empty_cash>0?s("div",{staticClass:"ml-md c-warning"},[e._v("\n            含空单费退款：¥"+e._s(e.subForm.apply_empty_cash)+"\n          ")]):e._e()]):e._e()],1)]),e._v(" "),s("el-form",{attrs:{model:e.subForm,"label-width":"130px",size:"mini"},nativeOn:{submit:function(e){e.preventDefault()}}},[s("lb-classify-title",{attrs:{title:"用户信息"}}),e._v(" "),s("el-form-item",{attrs:{label:"用户ID："}},[s("div",[e._v(e._s(e.subForm.user_id))])]),e._v(" "),s("el-form-item",{attrs:{label:"姓名："}},[s("div",[e._v(e._s(e.subForm.address_info.user_name))])]),e._v(" "),s("el-form-item",{attrs:{label:"手机号："}},[s("div",[e._v(e._s(e.subForm.address_info.mobile))])]),e._v(" "),e.subForm.is_add?e._e():s("el-form-item",{attrs:{label:"车费详情："}},[s("div",{staticClass:"flex-y-center"},[e._v("\n          "+e._s(e.carType[e.subForm.car_type])+"\n          "),1==e.subForm.car_type?s("div",{staticClass:"ml-md"},[e._v("\n            全程"+e._s(e.subForm.distance)+"，车费¥"+e._s(e.subForm.pay_car_price)+"\n            "),e.subForm.free_fare?s("span",{staticClass:"c-warning ml-md"},[e._v("\n              "+e._s(["","平台补贴",e.$t("action.attendantName")+"补贴",e.$t("action.agentName")+"补贴"][e.subForm.free_fare])+"\n            ")]):e._e()]):e._e()])]),e._v(" "),s("el-form-item",{attrs:{label:"服务地址："}},[s("div",[e._v("\n          "+e._s(""+e.subForm.address_info.address+e.subForm.address_info.address_info)+"\n        ")])]),e._v(" "),s("lb-classify-title",{attrs:{title:e.$t("action.attendantName")+"信息"}}),e._v(" "),s("el-form-item",{attrs:{label:e.$t("action.attendantName")+"："}},[s("div",[e._v("\n          "+e._s(e.subForm.coach_info?e.subForm.coach_info.coach_name:"-")+"\n        ")])]),e._v(" "),s("el-form-item",{attrs:{label:e.$t("action.attendantName")+"头像："}},[e.subForm.coach_info?s("lb-cover",{attrs:{fileList:[{url:e.subForm.coach_info.work_img}],isToDel:!1,size:"small",type:"more",fileSize:1}}):s("block",[e._v("-")])],1),e._v(" "),s("el-form-item",{attrs:{label:"联系电话："}},[s("div",[e._v(e._s(e.subForm.coach_info?e.subForm.coach_info.mobile:"-"))])]),e._v(" "),s("lb-classify-title",{attrs:{title:"订单信息"}}),e._v(" "),s("el-form-item",{attrs:{label:"付款订单号："}},[s("div",[e._v(e._s(e.subForm.pay_order_code))])]),e._v(" "),s("el-form-item",{attrs:{label:"退款订单号："}},[s("div",[e._v(e._s(e.subForm.order_code))])]),e._v(" "),e.subForm.out_refund_no?s("el-form-item",{attrs:{label:"微信退款订单号："}},[s("div",[e._v(e._s(e.subForm.out_refund_no))])]):e._e(),e._v(" "),e.subForm.admin_id?s("el-form-item",{attrs:{label:e.$t("action.agentName")+"："}},[s("div",[e._v(e._s(e.subForm.admin_name))])]):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"申请退款时间："}},[s("div",[e._v(e._s(e.subForm.create_time))])]),e._v(" "),1!==e.subForm.status&&e.subForm.refund_time?s("el-form-item",{attrs:{label:"审核时间："}},[s("div",[e._v(e._s(e.subForm.refund_time))])]):e._e(),e._v(" "),e.subForm.check_user_name?s("el-form-item",{attrs:{label:"审核人："}},[s("div",[e._v(e._s(e.subForm.check_user_name))])]):e._e(),e._v(" "),s("el-form-item",{attrs:{label:"退款原因："}},[s("div",[e._v(e._s(e.subForm.text||"-"))])]),e._v(" "),e.subForm.imgs&&e.subForm.imgs.length>0?s("el-form-item",{attrs:{label:"上传图片："}},[s("div",{staticClass:"flex-warp"},e._l(e.subForm.imgs,function(e,t){return s("div",{key:t,staticClass:"mr-md"},[s("lb-image",{attrs:{src:e}})],1)}),0)]):e._e(),e._v(" "),s("el-form-item",{directives:[{name:"show",rawName:"v-show",value:(e.pagePermission.includes("agreeRefund")||e.pagePermission.includes("rejectRefund"))&&[1,5].includes(e.subForm.status),expression:"\n          (pagePermission.includes('agreeRefund') ||\n            pagePermission.includes('rejectRefund')) &&\n          [1, 5].includes(subForm.status)\n        "}],attrs:{label:"处理退款："}},[s("lb-button",{directives:[{name:"show",rawName:"v-show",value:e.pagePermission.includes("rejectRefund"),expression:"pagePermission.includes('rejectRefund')"}],attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(t){return e.$refs.lb_refund_order.toRefuseRefund(e.subForm.id)}}},[e._v(e._s(e.$t("action.rejectRefund")))]),e._v(" "),s("lb-button",{directives:[{name:"show",rawName:"v-show",value:e.pagePermission.includes("agreeRefund"),expression:"pagePermission.includes('agreeRefund')"}],attrs:{size:"mini",plain:"",type:"success"},on:{click:function(t){return e.$refs.lb_refund_order.toPassRefund(e.subForm.id)}}},[e._v(e._s(e.$t("action.agreeRefund")))])],1),e._v(" "),1*e.subForm.apply_empty_cash>0||1*e.subForm.refund_empty_cash>0?s("el-form-item",{attrs:{label:"空单费："}},[s("div",{staticClass:"c-warning"},[e._v("\n          ¥"+e._s((1*e.subForm.apply_empty_cash+1*e.subForm.refund_empty_cash).toFixed(2))+"\n          "),1*e.subForm.apply_empty_cash>0?s("span",[e._v("\n            （ 空单费退款：¥"+e._s(e.subForm.apply_empty_cash)+"，实际扣款：¥"+e._s(e.subForm.refund_empty_cash)+"）\n          ")]):e._e()])]):e._e(),e._v(" "),1*e.subForm.refund_comm_cash>0?s("el-form-item",{attrs:{label:"退款手续费："}},[s("div",{staticClass:"c-warning"},[e._v("¥"+e._s(e.subForm.refund_comm_cash))])]):e._e()],1),e._v(" "),s("lb-classify-title",{attrs:{title:"退款服务"}}),e._v(" "),s("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.subForm.order_goods,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[s("el-table-column",{attrs:{prop:"goods_cover",label:"服务图片"},scopedSlots:e._u([{key:"default",fn:function(e){return[s("lb-image",{attrs:{src:e.row.goods_cover}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"goods_name",label:"服务名称"}}),e._v(" "),s("el-table-column",{attrs:{prop:"goods_price",label:"服务价格"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.goods_price)+"\n          "),s("div",{staticClass:"f-caption c-link"},[e._v("\n            退款价格：¥"+e._s((1*t.row.refund_goods_price+1*t.row.comm_service_cash/t.row.num+1*t.row.empty_service_cash/t.row.num).toFixed(2))+"\n          ")])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"init_material_price",label:e.$t("action.materialText")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.material_price)+"\n          "),s("div",{staticClass:"f-caption c-link"},[e._v("\n            退款价格：¥"+e._s((1*t.row.refund_material_price+1*t.row.comm_material_cash/t.row.num+1*t.row.empty_material_cash/t.row.num).toFixed(2))+"\n          ")])]}}])}),e._v(" "),1*e.subForm.refund_comm_cash>0?s("el-table-column",{attrs:{prop:"refund_comm_cash",label:"退款手续费"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"c-warning",staticStyle:{"line-height":"1.4"}},[e._v("\n            ¥"+e._s((t.row.refund_comm_cash/t.row.num).toFixed(2))+"\n            "),1*t.row.comm_service_cash>0?s("div",{staticClass:"f-icontext"},[e._v("\n              服务费承担：¥"+e._s((1*t.row.comm_service_cash/t.row.num).toFixed(2))+"\n            ")]):e._e(),e._v(" "),1*t.row.comm_material_cash>0?s("div",{staticClass:"f-icontext"},[e._v("\n              "+e._s(e.$t("action.materialText"))+"承担：¥"+e._s((1*t.row.comm_material_cash/t.row.num).toFixed(2))+"\n            ")]):e._e()])]}}],null,!1,3367308604)}):e._e(),e._v(" "),1*e.subForm.refund_empty_cash>0?s("el-table-column",{attrs:{prop:"refund_empty_cash",label:"空单费"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",{staticClass:"c-warning",staticStyle:{"line-height":"1.4"}},[e._v("\n            ¥"+e._s((1*t.row.refund_empty_cash/t.row.num).toFixed(2))+"\n            "),1*t.row.empty_service_cash>0?s("div",{staticClass:"f-icontext"},[e._v("\n              服务费承担：¥"+e._s((1*t.row.empty_service_cash/t.row.num).toFixed(2))+"\n            ")]):e._e(),e._v(" "),1*t.row.empty_material_cash>0?s("div",{staticClass:"f-icontext"},[e._v("\n              "+e._s(e.$t("action.materialText"))+"承担：¥"+e._s((1*t.row.empty_material_cash/t.row.num).toFixed(2))+"\n            ")]):e._e()])]}}],null,!1,2777947039)}):e._e(),e._v(" "),s("el-table-column",{attrs:{prop:"time_long",label:"服务时长"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.time_long?t.row.time_long+"分钟":"")+"\n        ")]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"num",label:"服务数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" x"+e._s(t.row.num||1)+" ")]}}])})],1),e._v(" "),s("div",{staticClass:"space-lg mt-lg mb-lg"},[e._v("\n      合计数量："+e._s(e.subForm.all_goods_num||1)+"\n    ")]),e._v(" "),s("lb-button",{attrs:{type:"primary"},on:{click:function(t){return e.$router.back(-1)}}},[e._v(e._s(e.$t("action.back")))]),e._v(" "),s("lb-refund-order",{ref:"lb_refund_order",on:{change:function(t){return e.getDetail(e.subForm.id)}}}),e._v(" "),s("el-dialog",{attrs:{title:"立即退款",visible:e.dialogRefund,width:"400px",center:""},on:{"update:visible":function(t){e.dialogRefund=t}}},[s("div",{staticClass:"refund-inner"},[s("lb-tips",{attrs:{isIcon:!1}},[e._v("请核对信息后输入需要退款的金额")]),e._v(" "),s("el-input",{staticStyle:{width:"100%"},attrs:{disabled:1*e.refundTotalMoney==0,placeholder:"请输入退款金额"},model:{value:e.refundMoney,callback:function(t){e.refundMoney=t},expression:"refundMoney"}}),e._v(" "),s("p",{staticClass:"mt-lg"},[e._v("\n          实际可退款金额\n          "),s("span",{staticClass:"c-warning"},[e._v("￥"+e._s(e.refundTotalMoney))])]),e._v(" "),s("p",[e._v("退款金额不能大于可退款金额")])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.dialogRefund=!1}}},[e._v(e._s(e.$t("action.cancel")))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:e.toPassRefund}},[e._v("确认退款")])],1)])],1)],1)},staticRenderFns:[]};var f=s("C7Lr")(m,d,!1,function(e){s("npWP")},"data-v-6873425f",null);t.default=f.exports},npWP:function(e,t){}});