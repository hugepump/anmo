webpackJsonp([182],{YyyB:function(e,t){},bzf8:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a("3cXf"),i=a.n(n),s=a("lC5x"),l=a.n(s),r=a("J0Oq"),o=a.n(r),c=a("PxTW"),u=a.n(c),m={components:{},data:function(){var e=this;return{loading:!1,storeList:[],searchForm:{page:1,limit:10},tableData:[],total:0,cycleList:[{id:0,title:"不限"},{id:1,title:"每周"},{id:5,title:"每半月"},{id:2,title:"每月"},{id:3,title:"每季度"},{id:4,title:"每年"}],is_have_add:!1,showDialog:{sub:!1,setting:!1},subForm:{id:"",title:"",time_long:"",online_time:"",online_change_integral_status:0,online_change_integral:"",balance:"",add_balance_status:0,add_basis_balance:"",price:"",add_balance:"",integral:""},subFormRules:{title:{required:!0,validator:this.$reg.isNotNull,text:this.$t("action.attendantName")+"等级",reg_type:2,trigger:"blur"},time_long:{required:!0,validator:this.$reg.isNum,text:"服务时长",trigger:"blur"},online_time:{required:!0,validator:function(t,a,n){var i=e.subForm,s=i.online_time,l=i.online_change_integral_status,r=i.online_change_integral;""!==s&&/^\+?[0-9]*$/.test(s)?!l||""!==r&&/^[1-9]\d*$/.test(r)?n():n(new Error(""===r?"请输入积分":"请输入正确的积分，必须大于0，不支持小数")):n(new Error(""===s?"请输入在线时长":"请输入正确的在线时长，不支持小数"))},trigger:"blur"},balance:{required:!0,validator:function(t,a,n){var i=e.subForm,s=i.balance,l=i.add_balance_status,r=i.add_basis_balance,o=/^(?:0|[1-9][0-9]?|100)$/;""!==s&&o.test(s)?!l||""!==r&&o.test(r)?n():n(new Error(""===r?"请输入百分比":"请输入正确的百分比，取值0-100，不支持小数")):n(new Error(""===s?"请输入提成比例":"请输入正确的提成比例，取值0-100，不支持小数"))},trigger:"blur"},add_balance:{required:!0,validator:this.$reg.isPercent,trigger:"blur"},price:{required:!0,validator:this.$reg.isMoney,text:"最低业绩",reg_type:2,trigger:"blur"},integral:{required:!0,validator:this.$reg.isNum,text:"积分",trigger:"blur"}},settingForm:{level_cycle:0}}},created:function(){var e=this;return o()(l.a.mark(function t(){return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getBaseInfo();case 2:e.getTableDataList();case 3:case"end":return t.stop()}},t,e)}))()},methods:{getBaseInfo:function(){var e=this;return o()(l.a.mark(function t(){var a,n,i;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.service.addClockInfo();case 2:a=t.sent,n=a.code,i=a.data,200===n&&(e.is_have_add=!i.clock_cash_status||1===i.clock_cash_status&&1===i.clock_cash_type);case 6:case"end":return t.stop()}},t,e)}))()},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},getTableDataList:function(e){var t=this;e&&(this.searchForm.page=e),this.loading=!0,this.$api.technician.levelList(this.searchForm).then(function(e){t.loading=!1,200===e.code&&(t.tableData=e.data.data,t.total=e.data.total)})},confirmDel:function(e){var t=this;this.$confirm(this.$t("tips.confirmDelete"),this.$t("tips.reminder"),{confirmButtonText:this.$t("action.comfirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){t.updateItem(e,-1)})},updateItem:function(e,t){var a=this;return o()(l.a.mark(function n(){return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:a.$api.technician.levelUpdate({id:e,status:t}).then(function(e){if(200===e.code){if(a.$message.success(a.$t(-1===t?"tips.successDel":"tips.successOper")),-1!==t)return;a.searchForm.page=a.searchForm.page<Math.ceil((a.total-1)/a.searchForm.limit)?a.searchForm.page:Math.ceil((a.total-1)/a.searchForm.limit),a.getTableDataList()}else{if(-1===t)return;a.getTableDataList()}});case 1:case"end":return n.stop()}},n,a)}))()},toShowDialog:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return o()(l.a.mark(function n(){var s,r,o;return l.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(a=JSON.parse(i()(a)),"sub"===e&&(a.online_change_integral_status=1===a.online_change_integral_status,a.online_change_integral=a.online_change_integral||"",a.add_balance_status=1===a.add_balance_status),"setting"!==e){n.next=8;break}return n.next=5,t.$api.system.configInfo();case 5:s=n.sent,r=s.data,a.level_cycle=r.level_cycle;case 8:for(o in t[e+"Form"])t[e+"Form"][o]=a[o];t.showDialog[e]=!t.showDialog[e],["sub"].includes(e)&&t.$refs[e+"Form"].validate&&t.$refs[e+"Form"].clearValidate();case 11:case"end":return n.stop()}},n,t)}))()},submitFormInfo:function(e){var t=this;return o()(l.a.mark(function a(){var n,s,r,o,c,u,m;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(n=!0,t.$refs[e+"Form"].validate(function(e){e||(n=!1)}),n){a.next=4;break}return a.abrupt("return");case 4:return s=JSON.parse(i()(t[e+"Form"])),"sub"===e&&(s.online_change_integral_status=s.online_change_integral_status?1:0,s.add_balance_status=s.add_balance_status?1:0),r={setting:{methodKey:"system",methodModel:"configUpdate"},sub:{methodKey:"technician",methodModel:s.id?"levelUpdate":"levelAdd"}},o=r[e],c=o.methodKey,u=o.methodModel,a.next=10,t.$api[c][u](s);case 10:if(m=a.sent,200===m.code){a.next=14;break}return a.abrupt("return");case 14:if(t.$message.success(t.$t("setting"!==e&&s.id?"tips.successRev":"tips.successSub")),t.showDialog[e]=!1,"setting"!==e){a.next=18;break}return a.abrupt("return");case 18:t.getTableDataList();case 19:case"end":return a.stop()}},a,t)}))()}},filters:{handleTime:function(e,t){return 1===t?u()(1e3*e).format("YYYY-MM-DD"):2===t?u()(1e3*e).format("HH:mm:ss"):u()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-technician-level"},[a("top-nav"),e._v(" "),a("div",{staticClass:"page-main"},[a("lb-tips",[e._v("服务累计时长：输入分钟数后，系统会自动计算区间；例如：\n      "),a("div",{staticClass:"mt-md"},[e._v("\n        第一次新增的"+e._s(e.$t("action.attendantName"))+"等级输入的分钟数为100，则显示的服务累计时长为：0至100分钟\n      ")]),e._v(" "),a("div",{staticClass:"mt-sm"},[e._v("\n        第二次新增的"+e._s(e.$t("action.attendantName"))+"等级输入的分钟数为200，则显示的服务累计时长为：100至200分钟\n      ")]),e._v(" "),a("div",{staticClass:"mt-lg"},[e._v("\n        "+e._s(e.$t("action.attendantName"))+"在本周期（T周期）折算之后，等级提成将会在T+1个周期生效，即"+e._s(e.$t("action.attendantName"))+"这个月的维度考核达标后，可升等级，第二个周期按照新升级的等级计算\n      ")])]),e._v(" "),a("el-row",{staticClass:"page-top-operate"},[a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-add",expression:"`${$route.name}-add`"}],attrs:{size:"medium",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.toShowDialog("sub")}}},[e._v(e._s(e.$t("menu.TechnicianLevelAdd")))]),e._v(" "),a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-setCycle",expression:"`${$route.name}-setCycle`"}],attrs:{size:"medium",type:"danger",icon:"el-icon-setting"},on:{click:function(t){return e.toShowDialog("setting")}}},[e._v(e._s(e.$t("action.setCycle")))])],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"top",label:"等级排序"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s("V"+t.row.top)+"\n        ")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:e.$t("action.attendantName")+"等级","min-width":"120"}}),e._v(" "),a("el-table-column",{attrs:{prop:"time_long",label:"服务时长","min-width":"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.lower+"至"+t.row.time_long)+"分钟")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"online_time",label:"在线时长"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(""+t.row.online_time)+"小时")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"price",label:"最低业绩"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v("¥"+e._s(t.row.price))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"time_long",label:"加钟率"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.add_balance)+"%")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"integral",label:"积分"}}),e._v(" "),a("el-table-column",{attrs:{prop:"balance",label:"提成比例"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(t.row.balance)+"%")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"创建时间","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),a("p",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table-operate"},[a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-edit",expression:"`${$route.name}-edit`"}],attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(a){return e.toShowDialog("sub",t.row)}}},[e._v(e._s(e.$t("action.edit")))]),e._v(" "),a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-delete",expression:"`${$route.name}-delete`"}],attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return e.confirmDel(t.row.id)}}},[e._v(e._s(e.$t("action.delete")))])],1)]}}])})],1),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:e.$t(e.subForm.id?"menu.TechnicianLevelEdit":"menu.TechnicianLevelAdd"),visible:e.showDialog.sub,width:"600px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"sub",t)}}},[a("el-form",{ref:"subForm",staticClass:"dialog-form",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"140px"}},[a("el-form-item",{attrs:{label:e.$t("action.attendantName")+"等级",prop:"title"}},[a("el-input",{attrs:{maxlength:"5","show-word-limit":"",placeholder:"请输入"+e.$t("action.attendantName")+"等级名称"},model:{value:e.subForm.title,callback:function(t){e.$set(e.subForm,"title",t)},expression:"subForm.title"}}),e._v(" "),a("lb-tool-tips",[e._v(e._s(e.$t("action.attendantName"))+"等级名称唯一性，不可重复")])],1),e._v(" "),a("el-form-item",{attrs:{label:"服务时长",prop:"time_long"}},[a("el-input",{attrs:{placeholder:"输入分钟"},model:{value:e.subForm.time_long,callback:function(t){e.$set(e.subForm,"time_long",t)},expression:"subForm.time_long"}},[a("template",{slot:"append"},[e._v("分钟")])],2),e._v(" "),a("lb-tool-tips",[e._v(e._s(e.$t("action.attendantName"))+"在提成折算周期内的服务时长，输入0则表示不设置该维度的考核")])],1),e._v(" "),a("el-form-item",{attrs:{label:"在线时长",prop:"online_time"}},[a("el-input",{attrs:{placeholder:"输入小时"},model:{value:e.subForm.online_time,callback:function(t){e.$set(e.subForm,"online_time",t)},expression:"subForm.online_time"}},[a("template",{slot:"append"},[e._v("小时")])],2),e._v(" "),a("lb-tool-tips",[e._v(e._s(e.$t("action.attendantName"))+"在提成折算周期内的"+e._s(e.$t("action.attendantName"))+"的在线工作时间，输入0则表示不设置该维度的考核")]),e._v(" "),a("div",{staticClass:"mt-md"},[a("div",{staticClass:"flex-y-center text-bold"},[a("el-checkbox",{model:{value:e.subForm.online_change_integral_status,callback:function(t){e.$set(e.subForm,"online_change_integral_status",t)},expression:"subForm.online_change_integral_status"}},[e._v("可换积分，1小时换\n                "),a("el-input",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{placeholder:"请输入积分"},model:{value:e.subForm.online_change_integral,callback:function(t){e.$set(e.subForm,"online_change_integral",t)},expression:"subForm.online_change_integral"}}),e._v("\n                积分")],1)],1),e._v(" "),a("div",{staticClass:"f-caption c-warning mt-md",staticStyle:{"line-height":"1"}},[e._v("\n              在线时长超过设置的门槛值，超出部分可以转换为积分\n            ")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"最低业绩",prop:"price"}},[a("el-input",{attrs:{placeholder:"输入最低业绩"},model:{value:e.subForm.price,callback:function(t){e.$set(e.subForm,"price",t)},expression:"subForm.price"}},[a("template",{slot:"append"},[e._v("元")])],2),e._v(" "),a("lb-tool-tips",[e._v(e._s(e.$t("action.attendantName"))+"在提成折算周期内的订单实际支付金额总和")])],1),e._v(" "),a("el-form-item",{attrs:{label:"加钟率",prop:"add_balance"}},[a("el-input",{attrs:{placeholder:"输入百分比"},model:{value:e.subForm.add_balance,callback:function(t){e.$set(e.subForm,"add_balance",t)},expression:"subForm.add_balance"}},[a("template",{slot:"append"},[e._v("%")])],2),e._v(" "),a("lb-tool-tips",[e._v(e._s(e.$t("action.attendantName"))+"在提成折算周期内的加钟费用计算\n            "),a("div",{staticClass:"mt-sm"},[e._v("\n              加钟金额=最低业绩*加钟率，加钟订单金额大于等于加钟金额即可满足条件\n            ")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"积分",prop:"integral"}},[a("el-input",{attrs:{placeholder:"输入积分"},model:{value:e.subForm.integral,callback:function(t){e.$set(e.subForm,"integral",t)},expression:"subForm.integral"}}),e._v(" "),a("lb-tool-tips",[e._v("\n            若储值返佣设置勾选了返积分，则"+e._s(e.$t("action.attendantName"))+"邀请用户充值将获得积分，积分和金额按照1:1比例换算\n            "),a("div",{staticClass:"mt-sm"},[e._v("\n              例如：充值1000元，获得积分1000，输入0则表示无要求\n            ")])])],1),e._v(" "),a("el-form-item",{attrs:{label:"提成比例",prop:"balance"}},[a("el-input",{attrs:{placeholder:"输入百分比"},model:{value:e.subForm.balance,callback:function(t){e.$set(e.subForm,"balance",t)},expression:"subForm.balance"}},[a("template",{slot:"append"},[e._v("%")])],2),e._v(" "),a("lb-tool-tips",[a("p",{staticClass:"mb-sm"},[e._v("提成比例取值0%到100%")]),e._v("\n            设置比例之后，"+e._s(e.$t("action.attendantName"))+"提成金额=实际金额*设置的百分比")]),e._v(" "),e.is_have_add?a("div",{staticClass:"mt-md"},[a("div",{staticClass:"flex-y-center text-bold"},[a("el-checkbox",{model:{value:e.subForm.add_balance_status,callback:function(t){e.$set(e.subForm,"add_balance_status",t)},expression:"subForm.add_balance_status"}},[e._v("加钟基础值\n                "),a("el-input",{staticStyle:{width:"120px",margin:"0 10px"},attrs:{placeholder:"请输入百分比"},model:{value:e.subForm.add_basis_balance,callback:function(t){e.$set(e.subForm,"add_basis_balance",t)},expression:"subForm.add_basis_balance"}}),e._v("\n                %")],1)],1),e._v(" "),a("div",{staticClass:"f-caption c-warning mt-md",staticStyle:{"line-height":"1"}},[e._v("\n              不设置则默认加钟基础值和首单提成比例一致\n            ")])]):e._e()],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog.sub=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(t){return e.submitFormInfo("sub")}}},[e._v("确 定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"设置折算周期",visible:e.showDialog.setting,width:"600px",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"setting",t)}}},[a("lb-tips",[e._v("每周默认是从周一到周日计算来循环\n        "),a("div",{staticClass:"mt-sm"},[e._v("\n          每半月是指以每月1号到15号、16号到月末最后一天为周期来循环\n        ")]),e._v(" "),a("div",{staticClass:"mt-sm"},[e._v("每月默认是从每月1号到月末的最后一天来循环")]),e._v(" "),a("div",{staticClass:"mt-sm mb-sm"},[e._v("\n          每个季度折算周期是默认1、2、3为一个季度，4、5、6为一个季度，7、8、9为一个季度，10、11、12为一个季度\n        ")]),e._v("\n        每年默认从1月1日到12月最后一天为一个折算周期")]),e._v(" "),a("el-form",{ref:"settingForm",staticClass:"dialog-form",attrs:{model:e.settingForm,rules:e.settingFormRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"折算周期",prop:"level_cycle"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.settingForm.level_cycle,callback:function(t){e.$set(e.settingForm,"level_cycle",t)},expression:"settingForm.level_cycle"}},e._l(e.cycleList,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog.setting=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(t){return e.submitFormInfo("setting")}}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var _=a("C7Lr")(m,d,!1,function(e){a("YyyB")},"data-v-15c61f36",null);t.default=_.exports}});