webpackJsonp([26],{QjWe:function(t,e){},WOXy:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=a("3cXf"),n=a.n(r),i=a("4YfN"),s=a.n(i),l=a("lC5x"),o=a.n(l),d=a("J0Oq"),c=a.n(d),u=a("PxTW"),m=a.n(u),_=a("bSIt"),p={data:function(){return{pickerOptions:{disabledDate:function(t){return t.getTime()>1e3*(m()(m()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},abnormalTypeList:[{id:0,title:"全部"},{id:1,title:this.$t("action.attendantName")+"拒单"},{id:2,title:"超时接单"},{id:3,title:"客户差评"},{id:4,title:"行为规范"},{id:5,title:"话术规范"},{id:6,title:"客户投诉"},{id:7,title:"退车费"},{id:8,title:"到达后取消"},{id:9,title:"订单取消"},{id:10,title:"私收小费"},{id:11,title:"用户退款"},{id:12,title:"分城市提交"},{id:13,title:"其他"}],statusTypeList:[{id:1,title:"待处理"},{id:2,title:"已处理"}],carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付",4:"折扣卡支付"},statusType:{"-1":"已取消",1:"待支付",2:"待服务",3:this.$t("action.attendantName")+"接单",4:this.$t("action.attendantName")+"出发",5:this.$t("action.attendantName")+"到达",6:"服务中",7:"已完成",8:"待转单"},cityType:{3:{type:"success",text:"省"},1:{type:"primary",text:"市"},2:{type:"danger",text:"区县"}},count:{ing:0,already:0},loading:{list:!1},searchForm:{list:{page:1,limit:10,status:1,order_code:"",type:0,start_time:"",end_time:""}},tableData:{list:[]},total:{list:0},order_price:0,car_price:0,downloadLoading:!1,lockTap:!1}},activated:function(){var t=this;return c()(o.a.mark(function e(){var a;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a=1,Number(window.sessionStorage.getItem("currentPage"))&&(a=Number(window.sessionStorage.getItem("currentPage")),window.sessionStorage.removeItem("currentPage")),t.getTableDataList(a,"list");case 3:case"end":return e.stop()}},e,t)}))()},beforeRouteLeave:function(t,e,a){"ShopAbnormalOrderDetail"===t.name&&window.sessionStorage.setItem("currentPage",this.searchForm.list.page),a()},computed:s()({},Object(_.e)({routesItem:function(t){return t.routes}})),methods:{resetForm:function(t){var e=t+"Form";this.$refs[e].resetFields(),this.getTableDataList(1,t)},handleSizeChange:function(t,e){this.searchForm[e].limit=t,this.handleCurrentChange(1,e)},handleCurrentChange:function(t,e){this.searchForm[e].page=t,this.getTableDataList("",e)},toChange:function(t){var e=this;return c()(o.a.mark(function a(){return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:e.searchForm.list.status=t,e.getTableDataList(1,"list");case 2:case"end":return a.stop()}},a,e)}))()},getTableDataList:function(t,e){var a=this;t&&(this.searchForm[e].page=t),this.loading[e]=!0;var r=JSON.parse(n()(this.searchForm[e]));if("list"===e){var i=r.start_time;i&&i.length>1?(r.start_time=i[0]/1e3,r.end_time=i[1]/1e3):(r.start_time="",r.end_time="")}var s=r.status;delete r.status;var l={list:1===s?"pendingOrderList":"alreadyOrderList"};2===s&&(r.is_handle=1);var o=l[e];this.$api.shop[o](r).then(function(t){if(a.loading[e]=!1,200===t.code){var r=t.data,n=r.data,i=r.total,l=r.already_count,o=r.pending_count;n.map(function(t){t.bad_text=t.bad_text.replace(/\n/g,"<br>"),t.customer_text=t.customer_text.replace(/\n/g,"<br>")}),a.tableData[e]=n,a.total[e]=i,a.count={ing:1===s?i:o,already:2===s?i:l}}})}},filters:{handleTime:function(t,e){return 1===e?m()(1e3*t).format("YYYY-MM-DD"):2===e?m()(1e3*t).format("HH:mm:ss"):m()(1e3*t).format("YYYY-MM-DD HH:mm:ss")},handleTitle:function(t,e){var a=e.filter(function(e){return e.id===t});return a&&a.length>0?a[0].title:""}}},h={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-shop-abnormal-list"},[a("top-nav"),t._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-top-operate"},[a("el-badge",{staticStyle:{margin:"14px 12px 0 0"},style:{marginRight:t.count.ing>99?"32px":t.count.ing>9?"22px":"12px"},attrs:{value:t.count.ing>0?t.count.ing:"",max:99}},[a("el-button",{staticStyle:{"margin-right":"0"},attrs:{type:1===t.searchForm.list.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(1)}}},[t._v("待处理"),0===t.count.ing?a("span",[t._v("（0）")]):t._e()])],1),t._v(" "),1===t.routesItem.userInfo.is_admin?a("el-button",{attrs:{type:2===t.searchForm.list.status?"primary":"",plain:"",size:"medium"},on:{click:function(e){return t.toChange(2)}}},[t._v("已处理（"+t._s(t.count.already||0)+"）")]):t._e()],1),t._v(" "),a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"listForm",attrs:{inline:!0,model:t.searchForm.list},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[a("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:t.searchForm.list.order_code,callback:function(e){t.$set(t.searchForm.list,"order_code",e)},expression:"searchForm.list.order_code"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"异常类型",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},on:{change:function(e){return t.getTableDataList(1,"list")}},model:{value:t.searchForm.list.type,callback:function(e){t.$set(t.searchForm.list,"type",e)},expression:"searchForm.list.type"}},t._l(t.abnormalTypeList,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"首次处理时间",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":t.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(e){return t.getTableDataList(1,"list")}},model:{value:t.searchForm.list.start_time,callback:function(e){t.$set(t.searchForm.list,"start_time",e)},expression:"searchForm.list.start_time"}})],1),t._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.getTableDataList(1,"list")}}},[t._v(t._s(t.$t("action.search")))]),t._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(e){return t.resetForm("list")}}},[t._v(t._s(t.$t("action.reset")))])],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.list,expression:"loading.list"}],staticStyle:{width:"100%"},attrs:{data:t.tableData.list,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID",width:"80"}}),t._v(" "),a("el-table-column",{attrs:{prop:"order_code","min-width":"130",label:"系统订单号"}}),t._v(" "),a("el-table-column",{attrs:{prop:"admin_name",label:""+t.$t("action.agentName")}}),t._v(" "),a("el-table-column",{attrs:{prop:"coach_name",label:t.$t("action.attendantName")}}),t._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"下单人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"order_create_time","min-width":"110",label:"下单时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(t._f("handleTime")(e.row.order_create_time,1)))]),t._v(" "),a("div",[t._v(t._s(t._f("handleTime")(e.row.order_create_time,2)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"type",label:"异常类型"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t._f("handleTitle")(e.row.type,t.abnormalTypeList))+"\n        ")]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"admin_name",label:"差评原因"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",width:"350",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("差评原因：")]),t._v(" "),a("div",{staticStyle:{"max-height":"80vh",overflow:"auto"},domProps:{innerHTML:t._s(e.row.bad_text)}})]),t._v(" "),a("div",{staticClass:"ellipsis-2",attrs:{slot:"reference"},domProps:{innerHTML:t._s(e.row.bad_text)},slot:"reference"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"admin_name",label:"客服处理意见"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-popover",{attrs:{placement:"top-start",width:"350",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("客服处理意见：")]),t._v(" "),a("div",{staticStyle:{"max-height":"80vh",overflow:"auto"},domProps:{innerHTML:t._s(e.row.customer_text)}})]),t._v(" "),a("div",{staticClass:"ellipsis-2",attrs:{slot:"reference"},domProps:{innerHTML:t._s(e.row.customer_text)},slot:"reference"})])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"first_handle","min-width":"110",label:"首次处理时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v(t._s(t._f("handleTime")(e.row.first_handle.time,1)))]),t._v(" "),a("div",[t._v(t._s(t._f("handleTime")(e.row.first_handle.time,2)))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"first_handle","min-width":"110",label:"首次处理人"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",[t._v("\n            "+t._s(e.row.first_handle.user_name)+"\n            "),e.row.first_handle.role?a("span",[t._v("\n              ("+t._s(e.row.first_handle.role)+")\n            ")]):t._e()])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"deduct_cash",label:"建议扣款"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"c-warning"},[t._v(t._s("¥"+e.row.deduct_cash))])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"have_deduct_cash",label:"扣除分成金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{class:[{"c-warning":1===e.row.is_deduct}]},[t._v("\n            "+t._s(1===e.row.is_deduct?"¥"+e.row.have_deduct_cash:"-")+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"is_deduct",label:"是否已扣款"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:1===e.row.is_deduct?"success":"danger"}},[t._v("\n            "+t._s(1===e.row.is_deduct?"是":"否")+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"end_handle","min-width":"110",label:"最终处理时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.end_handle&&e.row.end_handle.time?a("div",[a("div",[t._v(t._s(t._f("handleTime")(e.row.end_handle.time,1)))]),t._v(" "),a("div",[t._v(t._s(t._f("handleTime")(e.row.end_handle.time,2)))])]):a("div",[t._v("-")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"admin_name",label:"最终处理意见"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.end_handle&&e.row.end_handle.time?a("div",[a("div",[t._v("\n              "+t._s(e.row.end_handle.user_name)+"\n              "),e.row.end_handle.role?a("span",[t._v("\n                ("+t._s(e.row.end_handle.role)+")\n              ")]):t._e()]),t._v(" "),a("el-tag",{attrs:{size:"small",type:2===e.row.end_handle.status?"success":"danger"}},[t._v("\n              "+t._s(2===e.row.end_handle.status?"同意":"拒绝")+"\n            ")])],1):a("div",[t._v("-")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"deduct_time","min-width":"110",label:"最终扣款时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.deduct_time?a("div",[a("div",[t._v(t._s(t._f("handleTime")(e.row.deduct_time,1)))]),t._v(" "),a("div",[t._v(t._s(t._f("handleTime")(e.row.deduct_time,2)))])]):a("div",[t._v("--")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"status",label:"当前进度","min-width":"90"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-tag",{attrs:{size:"small",type:1===e.row.status?"danger":"success"}},[t._v("\n            "+t._s(1===e.row.status?"处理中":"处理完成")+"\n          ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"90",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"table-operate"},[a("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:t.$route.name+"-view",expression:"`${$route.name}-view`"}],attrs:{size:"mini",type:"primary",plain:""},on:{click:function(a){return t.$router.push("/shop/abnormal/detail?id="+e.row.order_id+"&aid="+e.row.id)}}},[t._v(t._s(t.$t("action.view")))])],1)]}}])})],1),t._v(" "),a("lb-page",{attrs:{batch:!1,page:t.searchForm.list.page,pageSize:t.searchForm.list.limit,total:t.total.list},on:{handleSizeChange:function(e){return t.handleSizeChange(e,"list")},handleCurrentChange:function(e){return t.handleCurrentChange(e,"list")}}})],1)],1)},staticRenderFns:[]};var v=a("C7Lr")(p,h,!1,function(t){a("QjWe"),a("xtM0")},"data-v-32c4c764",null);e.default=v.exports},xtM0:function(t,e){}});