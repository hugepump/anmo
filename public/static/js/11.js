webpackJsonp([11,163],{"6LZp":function(t,e){},"E/Gp":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("rVsN"),r=a.n(s),i=a("aA9S"),n=a.n(i),o=a("lC5x"),l=a.n(o),c=a("3cXf"),d=a.n(c),m=a("J0Oq"),_=a.n(m),u=a("4YfN"),p=a.n(u),v=a("PxTW"),b=a.n(v),f=a("bSIt"),h={props:{abnormal:{type:Number,default:function(){return 0}}},data:function(){var t=this;return{navTitle:"",carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付",4:"折扣卡支付"},statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},orderStatusType:{"-1":"订单取消",1:"订单生成",2:"付款成功",3:this.$t("action.attendantName")+"接单",4:this.$t("action.attendantName")+"出发",5:this.$t("action.attendantName")+"到达",6:"开始服务",7:"服务完成",8:this.$t("action.attendantName")+"拒单"},orderTypeText:{1:"订单",2:"服务退款",3:"服务升级",4:"服务加钟",5:"用户评价",6:"订单转单",7:"修改下单手机号",8:"修改下单地址"},lineList:[],base_service:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:4,title:this.$t("action.attendantName")+"出发",time:"serout_time",addr:"serout_address",icon:"iconjishichufa"},{pay_type:5,title:this.$t("action.attendantName")+"到达",time:"arrive_time",img:"arrive_img",addr:"arr_address",icon:"iconjishidaoda"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"},{pay_type:7,title:"签字确认",time:"sign_time",img:"sign_img",icon:""}],base_bell:[{pay_type:3,title:this.$t("action.attendantName")+"接单",time:"receiving_time",icon:"iconjishijiedan"},{pay_type:6,title:"开始服务",time:"start_service_time",icon:"iconjishifuwu"},{pay_type:7,title:"服务完成",time:"order_end_time",img:"end_img",addr:"end_address",icon:"iconjishiwancheng"}],activeName:"info",pagePermission:[],pagePermissionBell:[],pagePermissionCustom:[],subForm:{},upRecord:{},commissionInfo:{},is_show:!1,labelForm:{},showMap:!1,showDialog:{label:!1,file:!1,editphone:!1,editaddr:!1},fileForm:{record_url:""},editphoneForm:{order_id:""},editphoneFormRules:{mobile:{required:!0,validator:this.$reg.isTel,text:"下单手机号",reg_type:2,trigger:"blur"}},editaddrForm:{order_id:""},editaddrFormRules:{address:{required:!0,validator:function(e,a,s){var r=t.editaddrForm,i=r.lat,n=r.lng,o=r.address_info;o=o?o.replace(/(^\s*)|(\s*$)/g,""):"",i&&n?o?s():s(new Error("请输入小区、写字楼、门牌号等")):s(new Error("请获取经纬度"))},trigger:"blur"}},pickerOptions:{disabledDate:function(t){return t.getTime()>1e3*(b()(b()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},loading:{list:!1,order:!1,label:!1},searchForm:{list:{page:1,limit:10,start_time:"",end_time:""},order:{page:1,limit:10},label:{page:1,limit:10,user_id:""}},tableData:{list:[],order:[],label:[]},total:{list:0,order:0,label:0},map:null,isInitMap:!1}},created:function(){var t=this;this.routesItem.routes.map(function(e){"/shop"===e.path&&e.children.map(function(e){"ShopOrder"===e.name&&(t.pagePermission=e.meta.pagePermission[0].auth),"ShopBellOrder"===e.name&&(t.pagePermissionBell=e.meta.pagePermission[0].auth)}),"/custom"===e.path&&e.children.map(function(e){"CustomList"===e.name&&(t.pagePermissionCustom=e.meta.pagePermission[0].auth)})});var e=this.$route.query.id;this.subForm.id=e,this.editphoneForm.order_id=e,this.editaddrForm.order_id=e,this.getDetail(e)},destroyed:function(){this.destroyMap()},computed:p()({},Object(f.e)({routesItem:function(t){return t.routes}})),methods:{handleClick:function(t){var e=t.name;this.activeName=e;var a=this.subForm.id;switch(e){case"info":this.getDetail(a);break;case"service":this.getUpRecord(a);break;case"virtual":this.searchForm.list.order_id=a,this.getTableDataList(1,"list");break;case"coachtravel":if(!this.isInitMap){var s=this;this.loadMap().then(function(){s.initMap()})}break;case"order":this.searchForm.order.order_id=a,this.getTableDataList(1,e);break;case"commission":this.getCommission(a)}},getDetail:function(t){var e=this;return _()(l.a.mark(function a(){var s,r,i,n,o,c,m,_,u,p;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$api.shop.orderInfo({id:t});case 2:if(s=a.sent,r=s.code,i=s.data,200===r){a.next=7;break}return a.abrupt("return");case 7:i.is_balance=1*i.balance>0?1:0,n=i.text,o=i.coach_refund_text,c=i.receiving_time,m=void 0===c?"":c,_=i.start_service_time,u=void 0===_?"":_,i.is_add&&(!m&&i.pay_type>3&&(i.receiving_time=u),!u&&i.pay_type>5&&(i.start_service_time=m)),i.text=n&&n.length>0?n.replace(/\n/g,"<br>"):"",i.coach_refund_text=o&&o.length>0?o.replace(/\n/g,"<br>"):"没有填写原因哦",i.dispatch_record.map(function(t){t.text=0===t.now_coach_id?t.text.replace(/\n/g,"<br>"):""}),i.service_recording.map(function(t){t.record_url=t.link}),p=JSON.parse(d()(i.is_add||i.store_id?e.base_bell:e.base_service)),i.store_id&&p.push({pay_type:7,title:"签字确认",time:"sign_time",icon:""}),e.lineList=p,i.text_img=i.text_img&&i.text_img.length>0?i.text_img.map(function(t){return{url:t}}):[],e.subForm=i;case 19:case"end":return a.stop()}},a,e)}))()},getUpRecord:function(t){var e=this;return _()(l.a.mark(function a(){var s,r,i;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$api.shop.orderUpRecord({order_id:t});case 2:if(s=a.sent,r=s.code,i=s.data,200===r){a.next=7;break}return a.abrupt("return");case 7:i.map(function(t){t.order_goods.map(function(t){var e=t.true_price,a=t.material_price,s=t.original_order_goods,r=s.true_price,i=s.material_price;t.init_add_price=(1*e+1*a-1*r-1*i).toFixed(2)})}),e.upRecord=i;case 9:case"end":return a.stop()}},a,e)}))()},getCommission:function(t){var e=this;return _()(l.a.mark(function a(){var s,r,i;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$api.shop.coachCommissionInfo({order_id:t});case 2:if(s=a.sent,r=s.code,i=s.data,200===r){a.next=7;break}return a.abrupt("return");case 7:e.commissionInfo=i;case 8:case"end":return a.stop()}},a,e)}))()},resetForm:function(t){var e=t+"Form";this.$refs[e].resetFields(),this.getTableDataList(1,t)},handleSizeChange:function(t,e){this.searchForm[e].limit=t,this.handleCurrentChange(1,e)},handleCurrentChange:function(t,e){this.searchForm[e].page=t,this.getTableDataList("",e)},getTableDataList:function(t,e){var a=this;return _()(l.a.mark(function s(){var r,i,n,o,c,m,_,u,p;return l.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if("list"!==e){s.next=4;break}if(r=a.routesItem.auth.virtual,void 0!==r&&r){s.next=4;break}return s.abrupt("return");case 4:return t&&(a.searchForm[e].page=t),a.loading[e]=!0,i=JSON.parse(d()(a.searchForm[e])),"list"===e&&((n=i.start_time)&&n.length>1?(i.start_time=n[0]/1e3,i.end_time=n[1]/1e3):(i.start_time="",i.end_time="")),o={list:{methodKey:"system",methodModel:"phoneRecordList"},order:{methodKey:"shop",methodModel:"orderControlRecord"},label:{methodKey:"custom",methodModel:"coachCommentUserData"}}[e],c=o.methodKey,m=o.methodModel,s.next=12,a.$api[c][m](i);case 12:if(_=s.sent,u=_.code,p=_.data,a.loading[e]=!1,200===u){s.next=18;break}return s.abrupt("return");case 18:"label"===e&&(1===i.page&&(a.labelForm=p.user_label),p.list.data.map(function(t){t.text=t.text?t.text.replace(/\n/g,"<br>"):"暂无内容"})),"order"===e?(a.tableData[e]=p,a.total[e]=p.length):(a.tableData[e]="label"===e?p.list.data:p.data,a.total[e]="label"===e?p.list.total:p.total);case 20:case"end":return s.stop()}},s,a)}))()},toShowLabel:function(){this.is_show=!this.is_show},toDelLabel:function(t){var e=this;return _()(l.a.mark(function a(){var s,r,i;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return s=e.searchForm.label.user_id,r=e.labelForm[t].label_id,a.next=4,e.$api.custom.delUserLabel({user_id:s,label_id:r});case 4:if(i=a.sent,200===i.code){a.next=8;break}return a.abrupt("return");case 8:e.$message.success(e.$t("tips.successDel")),e.labelForm.splice(t,1);case 10:case"end":return a.stop()}},a,e)}))()},getLatLng:function(t){var e=t.lat,a=t.lng,s=t.address,r=t.addressComponents,i=r.province,o=r.city,l=r.district,c=r.street,d=r.streetNumber,m=d?d.split(c)[1]:"";m&&(s=s.split(m)[0]);var _=n()(this.editaddrForm,{lat:e,lng:a,province:i,city:o,area:l,address:s,address_info:m});this.editaddrForm=_},toShowDialog:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _()(l.a.mark(function s(){var r,i,o,c,d,m;return l.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.t0=t,s.next="label"===s.t0?3:"file"===s.t0?8:"editphone"===s.t0?10:"editaddr"===s.t0?13:16;break;case 3:return r=e.subForm.user_id,e.searchForm.label.user_id=r,s.next=7,e.getTableDataList(1,"label");case 7:return s.abrupt("break",16);case 8:for(i in e.fileForm)e.fileForm[i]=a[i];return s.abrupt("break",16);case 10:return o=e.subForm.address_info.mobile,e.editphoneForm=n()({},e.editphoneForm,{old_text:o,mobile:""}),s.abrupt("break",16);case 13:return c=e.subForm.address_info,d=c.address,m=c.address_info,e.editaddrForm=n()({},e.editaddrForm,{old_text:""+d+m,lat:"",lng:"",address:"",address_info:"",province:"",city:"",area:""}),s.abrupt("break",16);case 16:e.showDialog[t]=!e.showDialog[t];case 17:case"end":return s.stop()}},s,e)}))()},submitFormInfo:function(t){var e=this;return _()(l.a.mark(function a(){var s,r,i,n,o,c;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=!0,e.$refs[t+"Form"].validate(function(t){t||(s=!1)}),s){a.next=4;break}return a.abrupt("return");case 4:return delete(r=JSON.parse(d()(e[t+"Form"]))).old_text,i={editphone:{methodKey:"shop",methodModel:"updateOrderMobile"},editaddr:{methodKey:"shop",methodModel:"updateOrderAddress"}}[t],n=i.methodKey,o=i.methodModel,a.next=10,e.$api[n][o](r);case 10:if(c=a.sent,200===c.code){a.next=14;break}return a.abrupt("return");case 14:e.$message.success(e.$t("tips.successRev")),e.showDialog[t]=!1,e.getDetail(r.order_id);case 17:case"end":return a.stop()}},a,e)}))()},loadMap:function(){return new r.a(function(t,e){window.initMap=function(){t()};var a=document.createElement("script");a.src="https://map.qq.com/api/gljs?v=1.exp&key=OB4BZ-D4W3U-B7VVO-4PJWW-6TKDJ-WPB77&callback=initMap",a.onerror=e,a.onload=a.onreadystatechange=function(){document.head.removeChild(a)},document.head.appendChild(a)})},initMap:function(){var t=this;return _()(l.a.mark(function e(){var a,s,r,i,n,o,c,d,m,_,u,p,v,b,f,h,g,w,F,y,x,C;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.routesItem.auth.coachtravel,s=void 0!==a&&a,r=t.subForm,i=r.id,n=r.car_type,o=r.pay_type,c=r.address_info,s&&n&&!(o<4)){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,t.$api.shop.coachTrajectory({order_id:i});case 6:if(d=e.sent,m=d.data,_=m.have_list,u=m.list,p=void 0===u?[]:u,v=c.lat,b=c.lng,f=c.coach_lat,h=c.coach_lng,t.map=new TMap.Map("map-container-box",{center:new TMap.LatLng(f,h),zoom:13,minZoom:12,maxZoom:15}),t.isInitMap=!0,g=[],_.map(function(t,e){g.push(new TMap.LatLng(1*t.lat,1*t.lng))}),p.length>0){for(w=1e6,F=2;F<p.length;F++)p[F]=Number(p[F-2])+Number(p[F])/w;for(y=0;y<p.length;y+=2)g.push(new TMap.LatLng(1*p[y],1*p[y+1]))}x=new TMap.MultiPolyline({map:t.map,styles:{style_blue:new TMap.PolylineStyle({color:"#3777FF",width:4,borderWidth:2,borderColor:"#FFF",lineCap:"round",eraseColor:"rgba(190,188,188,1)"})},geometries:[{id:"erasePath",styleId:"style_blue",paths:g}]}),(C=new TMap.MultiMarker({map:t.map,styles:{"car-down":new TMap.MarkerStyle({width:40,height:40,anchor:{x:20,y:20},faceTo:"map",rotate:180,src:"https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/car.png"}),start:new TMap.MarkerStyle({width:25,height:35,anchor:{x:16,y:32},src:"https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/start.png"}),end:new TMap.MarkerStyle({width:25,height:35,anchor:{x:16,y:32},src:"https://mapapi.qq.com/web/lbs/javascriptGL/demo/img/end.png"})},geometries:[{id:"car",styleId:"car-down",position:new TMap.LatLng(f,h)},{id:"start",styleId:"start",position:new TMap.LatLng(f,h)},{id:"end",styleId:"end",position:new TMap.LatLng(v,b)}]})).moveAlong({car:{path:g,speed:500}},{autoRotation:!0}),C.on("moving",function(t){var e=t.car&&t.car.passedLatLngs;e&&x.eraseTo("erasePath",e.length-1,e[e.length-1])});case 19:case"end":return e.stop()}},e,t)}))()},destroyMap:function(){this.isInitMap&&this.map.destroy()},toDownLoad:function(t){var e=t.record_url,a=e.includes("?Expires=")?e.split("?Expires=")[0]:e,s=a.substring(a.lastIndexOf("/")+1),r=document.createElement("a"),i=new MouseEvent("click");r.download=s,r.href=e,r.dispatchEvent(i)}},watch:{$route:function(t){var e=this;return _()(l.a.mark(function a(){var s,r;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:s=t.query.id,1*(r=void 0===s?0:s)!==e.subForm.id&&e.getDetail(r);case 2:case"end":return a.stop()}},a,e)}))()},"showDialog.file":function(t,e){!1===t&&this.$refs.audio_item.pause()}},filters:{handleTime:function(t,e){return 1===e?b()(1e3*t).format("YYYY-MM-DD"):2===e?b()(1e3*t).format("HH:mm:ss"):3===e?b()(1e3*t).format("YYYY-MM-DD HH:mm"):4===e?b()(1e3*t).format("HH:mm"):b()(1e3*t).format("YYYY-MM-DD HH:mm:ss")},handlePayOrder:function(t){return t?1===t?"首次下单":"第"+t+"次下单":"-"},handleFileName:function(t){var e="-";if(t){var a=t.includes("?Expires=")?t.split("?Expires=")[0]:t;e=a.substring(a.lastIndexOf("/")+1)}return e}}},g={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-shop-order-detail"},[t.abnormal?t._e():a("top-nav",{attrs:{isBack:!0}}),t._v(" "),a("div",{class:[{"page-main":!t.abnormal}]},[t.subForm.id?a("block",[a("lb-tips",{attrs:{isIcon:!1}},[a("div",{staticClass:"flex-warp",class:[{"flex-y-center":6===t.subForm.pay_type}]},[a("div",[t._v("\n            "+t._s(t.statusType[t.subForm.pay_type])+"\n          ")]),t._v(" "),(-1===t.subForm.pay_type||8===t.subForm.pay_type)&&1*t.subForm.coach_refund_time>0?a("div",{staticClass:"f-desc c-warning ml-md"},[a("div",{staticClass:"flex-y-center"},[t._v("\n              "+t._s(t.$t("action.attendantName"))+"拒单\n              "),a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("拒单原因：")]),t._v(" "),a("div",{staticStyle:{"max-height":"80vh",overflow:"auto"},domProps:{innerHTML:t._s(t.subForm.coach_refund_text)}}),t._v(" "),a("div",{staticClass:"f-caption c-caption mt-md"},[t._v("\n                    拒单时间："+t._s(t._f("handleTime")(t.subForm.coach_refund_time))+"\n                  ")])]),t._v(" "),a("span",{staticClass:"iconfont iconwentifankui1 c-warning",attrs:{slot:"reference"},slot:"reference"})])],1)]):t._e(),t._v(" "),t.subForm.is_show&&t.subForm.coach_show||t.subForm.coach_refund_time?t._e():a("div",{staticClass:"f-desc c-warning ml-md"},[t.subForm.is_show?t._e():a("span",{staticClass:"mr-sm"},[t._v("用户已删除")]),t._v(" "),t.subForm.coach_show?t._e():a("span",[t._v(t._s(t.$t("action.attendantName"))+"已删除")])])]),t._v(" "),t.subForm.is_show&&t.subForm.coach_show||-1!==t.subForm.pay_type&&8!==t.subForm.pay_type||!t.subForm.coach_refund_time?t._e():a("div",{staticClass:"f-desc c-warning mt-sm",staticStyle:{"margin-left":"52px"}},[t.subForm.is_show?t._e():a("span",{staticClass:"mr-sm"},[t._v("用户已删除")]),t._v(" "),t.subForm.coach_show?t._e():a("span",[t._v(t._s(t.$t("action.attendantName"))+"已删除")])])]),t._v(" "),a("div",{staticClass:"mg-lg"},[a("el-timeline",t._l(t.lineList,function(e,s){return a("el-timeline-item",{key:s,attrs:{color:t.subForm[e.time]&&1*t.subForm[e.time]>0?"#409EFF":""}},[a("div",{staticClass:"flex-y-center"},[t._v("\n              "+t._s(e.title)+"\n              "),a("div",{staticClass:"ml-md f-caption c-caption"},[t._v("\n                "+t._s(t.subForm[e.time]&&1*t.subForm[e.time]>0?"":"签字确认"!==e.title||t.subForm.sign_img?"状态未开始":"暂未签字确认")+"\n              ")])]),t._v(" "),t.subForm[e.time]&&1*t.subForm[e.time]>0?a("div",{staticClass:"mt-sm"},[t._v("\n              "+t._s(t._f("handleTime")(t.subForm[e.time]))+"\n            ")]):t._e(),t._v(" "),e.img&&t.subForm[e.img]?a("div",{staticClass:"mt-md"},[a("lb-cover",{attrs:{fileList:[{url:t.subForm[e.img]}],isToDel:!1,fileType:"image",type:"more",size:"small",fileSize:1}})],1):t._e(),t._v(" "),e.addr&&t.subForm[e.addr]?a("div",{staticClass:"f-caption c-title"},[t._v("\n              "+t._s(t.subForm[e.addr])),t.subForm.map_type.includes(e.pay_type)?a("span",{staticClass:"c-warning ml-sm"},[t._v("手动修改")]):t._e()]):t._e()])}),1)],1),t._v(" "),a("el-tabs",{attrs:{type:"card"},on:{"tab-click":t.handleClick},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"订单信息",name:"info"}},[a("lb-classify-title",{attrs:{title:"用户信息"}}),t._v(" "),a("div",{staticClass:"info-list flex-warp"},[a("div",{staticClass:"info-item"},[t._v("\n              用户ID："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.user_id))])]),t._v(" "),a("div",{staticClass:"info-item"},[t._v("\n              用户昵称："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.user_info?t.subForm.user_info.nickName:"-"))])]),t._v(" "),a("div",{staticClass:"info-item"},[t._v("\n              绑定手机号："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.user_info?t.subForm.user_info.phone:"-"))])]),t._v(" "),a("div",{staticClass:"info-item"},[t._v("\n              消费次数："),a("span",{staticClass:"c-warning"},[t._v(t._s(t._f("handlePayOrder")(t.subForm.pay_order_times)))])])]),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"上门信息"}}),t._v(" "),a("div",{staticClass:"info-list flex-warp"},[a("div",{staticClass:"info-item"},[t._v("\n              下单人：\n              "),a("span",[t._v(t._s(t.subForm.address_info.user_name)+"\n                "),a("span",{staticClass:"ml-md c-link cursor-pointer",on:{click:function(e){return t.toShowDialog("label")}}},[t._v("\n                  查看标签\n                ")])])]),t._v(" "),a("div",{staticClass:"info-item"},[t._v("\n              联系方式："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.address_info.mobile))]),t._v(" "),[2,3,4,5,6].includes(t.subForm.pay_type)&&(!t.subForm.is_add&&t.pagePermission.includes("updateOrderPhone")||t.subForm.is_add&&t.pagePermissionBell.includes("updateOrderPhone"))?a("span",{staticClass:"ml-md c-link cursor-pointer",on:{click:function(e){return t.toShowDialog("editphone")}}},[t._v("\n                修改号码\n              ")]):t._e()]),t._v(" "),t.subForm.store_id?t._e():a("div",{staticClass:"info-item",staticStyle:{width:"50%"}},[t._v("\n              服务地址："),a("span",{staticClass:"c-title"},[t._v("\n                "+t._s(t.subForm.address_info.address+" "+t.subForm.address_info.address_info))]),t._v(" "),[3,4,5].includes(t.subForm.pay_type)&&(!t.subForm.is_add&&t.pagePermission.includes("updateOrderAddress")||t.subForm.is_add&&t.pagePermissionBell.includes("updateOrderAddress"))?a("span",{staticClass:"ml-md c-link cursor-pointer",on:{click:function(e){return t.toShowDialog("editaddr")}}},[t._v("\n                修改地址\n              ")]):t._e()])]),t._v(" "),t.subForm.store_id?a("block",[a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"门店信息"}}),t._v(" "),a("div",{staticClass:"info-list flex-center"},[a("div",{staticClass:"info-item flex-center"},[a("lb-cover",{attrs:{fileList:[{url:t.subForm.store_info.cover}],isToDel:!1,size:"small",type:"more",fileSize:1}}),t._v(" "),a("div",{staticClass:"flex-1 ml-sm c-title"},[a("div",[t._v("\n                    "+t._s(t.subForm.store_info.title)+"\n                  ")]),t._v(" "),a("div",{staticClass:"mt-sm mb-md"},[t._v("\n                    "+t._s(t.subForm.store_info.phone||"-")+"\n                  ")])])],1),t._v(" "),a("div",{staticClass:"info-item",staticStyle:{width:"75%"}},[t._v("\n                门店地址："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.store_info.address||"-"))])])])],1):t._e(),t._v(" "),t.subForm.coach_info&&t.subForm.coach_info.coach_name?a("block",[a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:t.$t("action.attendantName")+"信息"}}),t._v(" "),a("div",{staticClass:"info-list flex-center"},[a("div",{staticClass:"info-item flex-center"},[a("lb-cover",{attrs:{fileList:[{url:t.subForm.coach_info?t.subForm.coach_info.work_img:"https://lbqny.migugu.com/admin/anmo/technician/default_technician.png"}],isToDel:!1,size:"small",type:"more",fileSize:1}}),t._v(" "),a("div",{staticClass:"flex-1 ml-sm c-title"},[a("div",[t._v("\n                    "+t._s(t.subForm.coach_info?t.subForm.coach_info.coach_name:"-")+"\n                  ")]),t._v(" "),a("div",{staticClass:"mt-sm mb-md"},[t._v("\n                    "+t._s(t.subForm.coach_info?t.subForm.coach_info.mobile:"-")+"\n                  ")])])],1),t._v(" "),a("div",{staticClass:"info-item",staticStyle:{width:"75%"}},[t._v("\n                用户下单时"+t._s(t.$t("action.attendantName"))+"地址："),a("span",{staticClass:"c-title"},[t._v(t._s(t.subForm.address_info.coach_address||"-"))])])])],1):t._e(),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"订单信息"}}),t._v(" "),a("el-form",{attrs:{model:t.subForm,"label-width":"110px",size:"mini"},nativeOn:{submit:function(t){t.preventDefault()}}},[t.subForm.is_add?a("el-form-item",{attrs:{label:"主订单号："}},[a("div",{staticClass:"c-warning cursor-pointer",on:{click:function(e){t.abnormal?t.$router.push("/shop/order/detail?id="+t.subForm.add_pid.id):t.$router.replace({query:{id:t.subForm.add_pid.id}})}}},[t._v("\n                "+t._s(t.subForm.add_pid.order_code)+"\n              ")])]):t._e(),t._v(" "),!t.subForm.is_add&&t.subForm.add_order_id&&t.subForm.add_order_id.length>0?a("el-form-item",{attrs:{label:"子订单号："}},t._l(t.subForm.add_order_id,function(e,s){return a("div",{key:s,staticClass:"c-warning cursor-pointer",on:{click:function(a){t.abnormal?t.$router.push("/shop/order/detail?id="+e.id):t.$router.replace({query:{id:e.id}})}}},[t._v("\n                "+t._s(e.order_code)+"\n              ")])}),0):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"系统订单号："}},[a("div",[t._v(t._s(t.subForm.order_code))])]),t._v(" "),t.subForm.transaction_id?a("el-form-item",{attrs:{label:"付款订单号："}},[a("div",[t._v(t._s(t.subForm.transaction_id))])]):t._e(),t._v(" "),t.subForm.admin_name?a("el-form-item",{attrs:{label:t.$t("action.agentName")+"："}},[a("div",[t._v(t._s(t.subForm.admin_name))])]):t._e(),t._v(" "),t.subForm.channel_name?a("el-form-item",{attrs:{label:t.$t("action.channelName")+"："}},[a("div",[t._v(t._s(t.subForm.channel_name))])]):t._e(),t._v(" "),t.subForm.channel_qr_name?a("el-form-item",{attrs:{label:"渠道码："}},[a("div",[t._v(t._s(t.subForm.channel_qr_name))])]):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"下单时间："}},[a("div",[t._v(t._s(t._f("handleTime")(t.subForm.create_time)))])]),t._v(" "),a("el-form-item",{attrs:{label:"服务时间："}},[a("div",[t._v("\n                "+t._s(t._f("handleTime")(t.subForm.start_time,3))+" -\n                "+t._s(t._f("handleTime")(t.subForm.end_time,4))+"\n              ")])]),t._v(" "),a("el-form-item",{attrs:{label:"服务时长："}},[a("div",[t._v(t._s(t.subForm.time_long)+"分钟")])]),t._v(" "),t.subForm.is_add||t.subForm.store_id?t._e():a("block",[a("el-form-item",{attrs:{label:"车费详情："}},[a("div",[t._v("\n                  "+t._s(t.carType[t.subForm.car_type])+"\n                  "),1==t.subForm.car_type?a("span",{staticClass:"ml-md"},[t._v("\n                    全程"+t._s(t.subForm.distance)+"\n                  ")]):t._e()])]),t._v(" "),1===t.subForm.car_type?a("el-form-item",{attrs:{label:"出行费用："}},[a("div",{staticClass:"c-warning"},[t._v("\n                  ¥"+t._s(t.subForm.car_price)+"\n                  "),1===t.subForm.car_admin?a("span",[t._v("（车费归属"+t._s(t.$t("action.agentName"))+"）")]):t._e(),t._v(" "),t.subForm.free_fare?a("span",{staticClass:"c-warning ml-md"},[t._v("\n                    "+t._s(["","平台补贴",t.$t("action.attendantName")+"补贴",t.$t("action.agentName")+"补贴"][t.subForm.free_fare])+"\n                  ")]):t._e()])]):t._e()],1),t._v(" "),a("el-form-item",{attrs:{label:"服务项目费用："}},[a("div",{staticClass:"c-warning"},[t._v("¥"+t._s(t.subForm.init_service_price))])]),t._v(" "),a("el-form-item",{attrs:{label:t.$t("action.materialText")+"："}},[a("div",{staticClass:"c-warning"},[t._v("¥"+t._s(t.subForm.init_material_price))])]),t._v(" "),1*t.subForm.discount>0?a("el-form-item",{attrs:{label:"卡券优惠："}},[a("div",{staticClass:"c-warning"},[t._v("-¥"+t._s(t.subForm.discount))])]):t._e(),t._v(" "),1*t.subForm.member_discount_balance>0?a("el-form-item",{attrs:{label:"会员卡折扣："}},[a("div",{staticClass:"c-warning"},[t._v("\n                "+t._s(t.subForm.member_discount_balance)+"折（优惠¥"+t._s(t.subForm.member_discount_cash)+"）\n              ")])]):t._e(),t._v(" "),1*t.subForm.balance_discount_cash>0?a("el-form-item",{attrs:{label:"储值卡折扣："}},[a("div",{staticClass:"c-warning"},[t._v("\n                "+t._s(t.subForm.balance_discount_num)+"张折扣卡（优惠¥"+t._s(t.subForm.balance_discount_cash)+"）\n              ")]),t._v(" "),a("div",{staticClass:"fill-body pd-lg radius-16 mt-sm",staticStyle:{width:"600px"}},t._l(t.subForm.balance_discount_list,function(e,s){return a("div",{key:s,staticClass:"c-title",class:[{"mt-md":0!==s}]},[0==s?a("div",{staticClass:"flex-center c-title text-bold pb-md",staticStyle:{"line-height":"1.4","border-bottom":"1px dashed #999"}},[a("div",{staticStyle:{width:"24%","margin-left":"4%"}},[t._v("卡名称")]),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("\n                      消费"),a("lb-tool-tips",{attrs:{padding:0}},[t._v("用此卡消费的金额")])],1),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("\n                      抵扣"),a("lb-tool-tips",{attrs:{padding:0}},[t._v("能抵扣原服务项目价格的金额")])],1),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("\n                      优惠"),a("lb-tool-tips",{attrs:{padding:0}},[t._v("优惠=抵扣金额-消费金额")])],1)]):t._e(),t._v(" "),a("div",{staticClass:"flex-center f-desc c-title mt-lg",staticStyle:{"line-height":"1"}},[a("div",{staticStyle:{width:"24%","margin-left":"4%"}},[t._v("\n                      "+t._s(e.title)+" ("+t._s(e.discount)+"折)\n                    ")]),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("¥"+t._s(e.value_cash))]),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("¥"+t._s(e.cash))]),t._v(" "),a("div",{staticStyle:{width:"24%"}},[t._v("¥"+t._s(e.discount_cash))])])])}),0)]):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"实付金额："}},[a("div",{staticClass:"c-warning"},[t._v("¥"+t._s(t.subForm.pay_price))])]),t._v(" "),a("el-form-item",{attrs:{label:"支付方式："}},[t._v("\n              "+t._s(t.payType[t.subForm.pay_model])+"\n            ")]),t._v(" "),t.subForm.text||t.subForm.text_img&&t.subForm.text_img.length>0?a("el-form-item",{attrs:{label:"订单备注："}},[t.subForm.text?a("div",{domProps:{innerHTML:t._s(t.subForm.text)}}):t._e(),t._v(" "),t.subForm.text_img&&t.subForm.text_img.length>0?a("div",{staticClass:"flex-warp",class:[{"mt-sm":t.subForm.text}]},[a("lb-cover",{attrs:{fileList:t.subForm.text_img,isToDel:!1,size:"small",type:"more",fileSize:t.subForm.text_img.length}})],1):t._e()]):t._e()],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"服务内容",name:"service"}},[a("lb-classify-title",{attrs:{title:"服务项目"}}),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.subForm.order_goods,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"goods_cover",label:"服务项目"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.goods_cover}})]}}],null,!1,121304493)}),t._v(" "),a("el-table-column",{attrs:{prop:"goods_name",label:"服务名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"price",label:"服务价格"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                ¥"+t._s(e.row.price)+"\n                "),1*e.row.true_price<1*e.row.price?a("div",{staticClass:"f-icontext c-warning mt-sm"},[t._v("\n                  "+t._s("优惠¥"+(1*e.row.price-1*e.row.true_price).toFixed(2))+"\n                ")]):t._e()]}}],null,!1,1473179311)}),t._v(" "),a("el-table-column",{attrs:{prop:"material_price",label:t.$t("action.materialText")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                ¥"+t._s(e.row.init_material_price)+"\n                "),1*e.row.material_price<1*e.row.init_material_price?a("div",{staticClass:"f-icontext c-warning mt-sm"},[t._v("\n                  "+t._s("优惠¥"+(1*e.row.init_material_price-1*e.row.material_price).toFixed(2))+"\n                ")]):t._e()]}}],null,!1,398764340)}),t._v(" "),a("el-table-column",{attrs:{prop:"time_long",label:"服务时长"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                "+t._s(e.row.time_long)+"分钟\n              ")]}}],null,!1,1661912260)}),t._v(" "),a("el-table-column",{attrs:{prop:"num",label:"服务数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex-y-center"},[t._v("\n                  x"+t._s(e.row.num)+"\n                  "),e.row.refund_num?a("div",{staticClass:"f-icontext c-warning ml-sm"},[t._v("\n                    "+t._s("已退x"+e.row.refund_num)+"\n                  ")]):t._e()]),t._v(" "),e.row.refund_num?a("div",{staticClass:"f-icontext c-warning"},[a("div",{staticStyle:{"line-height":"1.4"}},[t._v("\n                    服务项目退款金额：¥"+t._s(e.row.refund_goods_price)+"\n                  ")]),t._v(" "),1*e.row.material_price>0?a("div",{staticStyle:{"line-height":"1.4"}},[t._v("\n                    "+t._s(t.$t("action.materialText"))+"退款金额：¥"+t._s(e.row.refund_material_price)+"\n                  ")]):t._e()]):t._e()]}}],null,!1,4002786753)})],1),t._v(" "),!t.subForm.is_add&&t.subForm.add_order_id&&t.subForm.add_order_id.length>0?a("block",t._l(t.subForm.add_order_id,function(e,s){return a("block",{key:s},[a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:t.subForm.add_order_id.length>1?0===s?"首次加钟项目":"第"+(1*s+1)+"次加钟项目":"加钟项目"}}),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.order_goods,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"goods_cover",label:"服务项目"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.goods_cover}})]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"goods_name",label:"服务名称"}}),t._v(" "),a("el-table-column",{attrs:{prop:"price",label:"服务价格"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    ¥"+t._s(e.row.price)+"\n                    "),1*e.row.true_price<1*e.row.price?a("div",{staticClass:"f-icontext c-warning mt-sm"},[t._v("\n                      "+t._s("优惠"+(1*e.row.price-1*e.row.true_price).toFixed(2))+"\n                    ")]):t._e()]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"material_price",label:t.$t("action.materialText")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    ¥"+t._s(e.row.init_material_price)+"\n                    "),1*e.row.material_price<1*e.row.init_material_price?a("div",{staticClass:"f-icontext c-warning mt-sm"},[t._v("\n                      "+t._s("优惠"+(1*e.row.init_material_price-1*e.row.material_price).toFixed(2))+"\n                    ")]):t._e()]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"time_long",label:"服务时长"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                    "+t._s(e.row.time_long)+"分钟\n                  ")]}}],null,!0)}),t._v(" "),a("el-table-column",{attrs:{prop:"num",label:"服务数量"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{staticClass:"flex-y-center"},[t._v("\n                      x"+t._s(e.row.num)+"\n                      "),e.row.refund_num?a("div",{staticClass:"f-icontext c-warning ml-sm"},[t._v("\n                        "+t._s("已退x"+e.row.refund_num)+"\n                      ")]):t._e()]),t._v(" "),e.row.refund_num?a("div",{staticClass:"f-icontext c-warning"},[a("div",{staticStyle:{"line-height":"1.4"}},[t._v("\n                        服务项目退款金额：¥"+t._s(e.row.refund_goods_price)+"\n                      ")]),t._v(" "),1*e.row.material_price>0?a("div",{staticStyle:{"line-height":"1.4"}},[t._v("\n                        "+t._s(t.$t("action.materialText"))+"退款金额：¥"+t._s(e.row.refund_material_price)+"\n                      ")]):t._e()]):t._e()]}}],null,!0)})],1)],1)}),1):t._e(),t._v(" "),t.subForm.dispatch_record.length>0?a("block",[a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"转派记录"}}),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.subForm.dispatch_record,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"old_coach_name",label:"原"+t.$t("action.attendantName")},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(e.row.old_coach_name)+"\n                  "),0===e.$index&&t.subForm.coach_refund_time?a("el-popover",{attrs:{placement:"top-start",width:"300",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("拒单原因：")]),t._v(" "),a("div",{domProps:{innerHTML:t._s(t.subForm.coach_refund_text)}}),t._v(" "),a("div",{staticClass:"f-caption c-caption mt-md"},[t._v("\n                        拒单时间："+t._s(t._f("handleTime")(t.subForm.coach_refund_time))+"\n                      ")])]),t._v(" "),a("span",{staticClass:"iconfont iconwentifankui1 c-warning",attrs:{slot:"reference"},slot:"reference"})]):t._e()]}}],null,!1,3835236455)}),t._v(" "),a("el-table-column",{attrs:{prop:"old_coach_img",label:"原"+t.$t("action.attendantName")+"头像"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.old_coach_img}})]}}],null,!1,1398870509)}),t._v(" "),a("el-table-column",{attrs:{prop:"old_coach_mobile",label:"原"+t.$t("action.attendantName")+"联系电话","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"now_coach_name",label:"现"+t.$t("action.attendantName")}}),t._v(" "),a("el-table-column",{attrs:{prop:"now_coach_img",label:t.$t("action.attendantName")+"头像"},scopedSlots:t._u([{key:"default",fn:function(t){return[a("lb-image",{attrs:{src:t.row.now_coach_img}})]}}],null,!1,4164780700)}),t._v(" "),a("el-table-column",{attrs:{prop:"now_coach_mobile",label:"现"+t.$t("action.attendantName")+"联系电话","min-width":"120"}}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"转派时间","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,2)))])]}}],null,!1,2718285459)}),t._v(" "),a("el-table-column",{attrs:{prop:"text",label:"转派备注","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("div",{domProps:{innerHTML:t._s(e.row.text)}})]}}],null,!1,3719080649)})],1)],1):t._e(),t._v(" "),t.upRecord.length>0?a("block",[a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"服务升级记录"}}),t._v(" "),a("el-timeline",{staticStyle:{"padding-left":"2px"}},t._l(t.upRecord,function(e,s){return a("el-timeline-item",{key:s},[a("div",{staticClass:"c-title text-bold mb-md"},[t._v("\n                  "+t._s(t._f("handleTime")(e.create_time))+"\n                ")]),t._v(" "),t._l(e.order_goods,function(e,s){return a("div",{key:s,staticClass:"pd-lg f-desc c-caption",class:[{"mt-md":0!==s}],staticStyle:{width:"400px",border:"1px solid #eee"}},[e.original_order_goods&&e.original_order_goods.goods_name?a("block",[a("div",{staticClass:"flex-y-center"},[a("div",{staticClass:"c-success"},[t._v("原项目")]),t._v("\n                      名称：\n                      "),a("div",{staticClass:"c-title"},[t._v("\n                        "+t._s(e.original_order_goods.goods_name)+"\n                      ")])]),t._v(" "),a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                      价格：\n                      "),a("div",{staticClass:"c-title"},[t._v("\n                        ¥ "+t._s(e.original_order_goods.true_price)+"\n                      ")])]),t._v(" "),1*e.original_order_goods.material_price>0?a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                      "+t._s(t.$t("action.materialText"))+"：\n                      "),a("div",{staticClass:"c-title"},[t._v("\n                        ¥ "+t._s(e.original_order_goods.material_price)+"\n                      ")])]):t._e()]):t._e(),t._v(" "),a("div",{staticClass:"flex-y-center mt-sm"},[a("div",{staticClass:"c-warning"},[t._v("升级项目")]),t._v("\n                    名称：\n                    "),a("div",{staticClass:"c-title"},[t._v(t._s(e.goods_name))])]),t._v(" "),a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                    价格：\n                    "),a("div",{staticClass:"c-title"},[t._v("¥ "+t._s(e.true_price))])]),t._v(" "),1*e.material_price>0?a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                    "+t._s(t.$t("action.materialText"))+"：\n                    "),a("div",{staticClass:"c-title"},[t._v("¥ "+t._s(e.material_price))])]):t._e(),t._v(" "),a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                    升级项目数量：\n                    "),a("div",{staticClass:"c-title"},[t._v("x"+t._s(e.num))])]),t._v(" "),a("div",{staticClass:"flex-y-center mt-sm"},[t._v("\n                    补差价：\n                    "),a("div",{staticClass:"c-title"},[t._v("\n                      ¥\n                      "+t._s(e.init_add_price)+"\n                    ")])])],1)}),t._v(" "),a("div",{staticClass:"mt-md flex-y-center"},[t._v("\n                  合计补差价：\n                  "),a("div",{staticClass:"c-warning"},[t._v("¥"+t._s(e.pay_price))])])],2)}),1)],1):t._e()],1),t._v(" "),t.routesItem.auth.virtual||t.routesItem.auth.recording&&(!t.subForm.is_add||t.subForm.is_add&&t.subForm.service_recording.length>0)?a("el-tab-pane",{attrs:{label:"录音文件",name:"virtual"}},[t.routesItem.auth.virtual?a("block",[a("lb-classify-title",{attrs:{title:"电话录音文件"}}),t._v(" "),a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"listForm",attrs:{inline:!0,model:t.searchForm.list},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"拨打时间",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":t.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(e){return t.getTableDataList(1,"list")}},model:{value:t.searchForm.list.start_time,callback:function(e){t.$set(t.searchForm.list,"start_time",e)},expression:"searchForm.list.start_time"}})],1)],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.list,expression:"loading.list"}],staticStyle:{width:"100%"},attrs:{data:t.tableData.list,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),a("el-table-column",{attrs:{prop:"record_url",label:"文件名称","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(t._f("handleFileName")(e.row.record_url))+"\n                ")]}}],null,!1,3304824278)}),t._v(" "),a("el-table-column",{attrs:{prop:"call_time",label:"拨打时间","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.call_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.call_time,2)))])]}}],null,!1,3226877139)}),t._v(" "),a("el-table-column",{attrs:{prop:"start_time",label:"接通时间","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.start_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.start_time,2)))])]}}],null,!1,2578612083)}),t._v(" "),a("el-table-column",{attrs:{prop:"end_time",label:"挂断时间","min-width":"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.end_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.end_time,2)))])]}}],null,!1,3744910355)}),t._v(" "),a("el-table-column",{attrs:{prop:"phone_a",label:t.$t("action.attendantName")+"号码","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phone_b",label:"客户号码","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{prop:"phone_x",label:"虚拟号码","min-width":"110"}}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.record_url?a("div",{staticClass:"table-operate"},[a("lb-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(a){return t.toShowDialog("file",e.row)}}},[t._v("播放")]),t._v(" "),a("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return t.toDownLoad(e.row)}}},[t._v("下载")])],1):t._e()]}}],null,!1,863203469)})],1),t._v(" "),t.total.list>0?a("lb-page",{attrs:{batch:!1,page:t.searchForm.list.page,pageSize:t.searchForm.list.limit,total:t.total.list},on:{handleSizeChange:function(e){return t.handleSizeChange(e,"list")},handleCurrentChange:function(e){return t.handleCurrentChange(e,"list")}}}):t._e(),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"})],1):t._e(),t._v(" "),t.routesItem.auth.recording&&(!t.subForm.is_add||t.subForm.is_add&&t.subForm.service_recording.length>0)?a("block",[a("lb-classify-title",{attrs:{title:"服务过程录音文件"}}),t._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.subForm.service_recording,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"link",label:"文件名称","min-width":"200"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n                  "+t._s(t._f("handleFileName")(e.row.link))+"\n                ")]}}],null,!1,1532070415)}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"录音时间","min-width":"120"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,2)))])]}}],null,!1,2718285459)}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.link?a("div",{staticClass:"table-operate"},[a("lb-button",{attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(a){return t.toShowDialog("file",e.row)}}},[t._v("播放")]),t._v(" "),a("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return t.toDownLoad(e.row)}}},[t._v("下载")])],1):t._e()]}}],null,!1,1776412532)})],1)],1):t._e()],1):t._e(),t._v(" "),t.routesItem.auth.coachtravel&&1===t.subForm.car_type&&t.subForm.pay_type>3?a("el-tab-pane",{attrs:{label:"路程轨迹",name:"coachtravel"}},[a("lb-tips",[t._v(t._s(t.$t("action.attendantName"))+"在订单列表或是详情页面，从点击【已出发】直到点击【拍照确认到达】期间，需要一直停留在系统才能记录到真实的轨迹，熄屏将不再记录")]),t._v(" "),a("div",{attrs:{id:"map-container-box"}})],1):t._e(),t._v(" "),a("el-tab-pane",{attrs:{label:"订单记录",name:"order"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.loading.order,expression:"loading.order"}],staticStyle:{width:"100%"},attrs:{data:t.tableData.order,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"}},[a("el-table-column",{attrs:{prop:"text",label:"操作记录"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.type?a("block",[t._v(t._s(t.orderStatusType[e.row.pay_type]))]):2===e.row.type?a("block",[t._v(t._s(-1===e.row.pay_type?"取消退款":["","申请退款","同意退款","拒绝退款"][e.row.pay_type]))]):a("block",[t._v("\n                  "+t._s(t.orderTypeText[e.row.type])+"\n                  "),7===e.row.type?a("div",{staticClass:"f-caption c-caption",staticStyle:{"line-height":"1.5"}},[t._v("\n                    原手机号:"+t._s(e.row.old_mobile)+"\n                  ")]):t._e(),t._v(" "),8===e.row.type?a("div",{staticClass:"f-caption c-caption",staticStyle:{"line-height":"1.5"}},[t._v("\n                    原地址:"+t._s(""+e.row.address.address+e.row.address.address_info)+"\n                  ")]):t._e()])]}}],null,!1,3477659988)}),t._v(" "),a("el-table-column",{attrs:{prop:"user_name",label:"操作人"}}),t._v(" "),a("el-table-column",{attrs:{prop:"cach",label:"金额"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.type&&2===e.row.pay_type||[2,3,4].includes(e.row.type)?a("div",{class:[{"c-title":[1,3,4].includes(e.row.type)},{"c-tips":2===e.row.type&&-1===e.row.pay_type},{"c-link":2===e.row.type&&1===e.row.pay_type},{"c-success":2===e.row.type&&2===e.row.pay_type},{"c-warning":2===e.row.type&&3===e.row.pay_type}]},[t._v("\n                  "+t._s(2===e.row.type&&2===e.row.pay_type?"-":"")+"¥"+t._s(e.row.price||0)+"\n                ")]):a("block",[t._v("-")])]}}],null,!1,1178758473)}),t._v(" "),a("el-table-column",{attrs:{prop:"order_code",label:"付款/退款单号","min-width":"150"},scopedSlots:t._u([{key:"default",fn:function(e){return[1===e.row.type&&2===e.row.pay_type||2===e.row.type||4===e.row.type?a("block",[t._v("\n                  "+t._s(e.row.order_code))]):a("block",[t._v("-")])]}}],null,!1,332711370)}),t._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"操作时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,1)))]),t._v(" "),a("p",[t._v(t._s(t._f("handleTime")(e.row.create_time,2)))])]}}],null,!1,2718285459)})],1)],1),t._v(" "),a("el-tab-pane",{attrs:{label:"分销佣金",name:"commission"}},[a("el-form",{attrs:{model:t.subForm,"label-width":"130px",size:"mini"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"订单金额："}},[a("div",[t._v("¥"+t._s(t.subForm.pay_price))])]),t._v(" "),a("el-form-item",{attrs:{label:"服务项目费："}},[a("div",[t._v("¥"+t._s(t.subForm.init_service_price))])]),t._v(" "),a("el-form-item",{attrs:{label:t.$t("action.materialText")+"："}},[a("div",[t._v("¥"+t._s(t.subForm.init_material_price))])]),t._v(" "),1*t.subForm.discount>0?a("el-form-item",{attrs:{label:"卡券优惠："}},[a("div",{staticClass:"c-warning"},[t._v("-¥"+t._s(t.subForm.discount))])]):t._e(),t._v(" "),1*t.subForm.member_discount_balance>0?a("el-form-item",{attrs:{label:"会员卡折扣："}},[a("div",{staticClass:"c-warning"},[t._v("\n                -¥"+t._s(t.subForm.member_discount_balance)+"\n              ")])]):t._e(),t._v(" "),1*t.subForm.balance_discount_cash>0?a("el-form-item",{attrs:{label:"储值卡折扣："}},[a("div",{staticClass:"c-warning"},[t._v("\n                -¥"+t._s(t.subForm.balance_discount_cash)+"\n              ")])]):t._e(),t._v(" "),1*t.subForm.refund_price>0?a("el-form-item",{attrs:{label:"退款金额："}},[a("div",{staticClass:"c-warning"},[t._v("-¥"+t._s(t.subForm.refund_price))])]):t._e(),t._v(" "),1*t.commissionInfo.refund_empty_cash>0?a("el-form-item",{attrs:{label:"空单费："}},[a("div",{staticClass:"c-warning"},[t._v("\n                ¥"+t._s(t.commissionInfo.refund_empty_cash)+"\n              ")])]):t._e(),t._v(" "),1*t.commissionInfo.refund_comm_cash>0?a("el-form-item",{attrs:{label:"退款手续费："}},[a("div",{staticClass:"c-warning"},[t._v("\n                ¥"+t._s(t.commissionInfo.refund_comm_cash)+"\n              ")])]):t._e(),t._v(" "),t.subForm.is_add||t.subForm.store_id||1!==t.subForm.car_type?t._e():a("el-form-item",{attrs:{label:"车费："}},[a("div",[t._v("\n                ¥"+t._s(t.subForm.car_price)+"\n                "),1===t.subForm.car_admin?a("span",[t._v("（车费归属"+t._s(t.$t("action.agentName"))+"）")]):t._e(),t._v(" "),t.subForm.free_fare?a("span",{staticClass:"c-warning ml-md"},[t._v("\n                  "+t._s(["","平台补贴",t.$t("action.attendantName")+"补贴",t.$t("action.agentName")+"补贴"][t.subForm.free_fare])+"\n                ")]):t._e()])])],1),t._v(" "),a("el-form",{attrs:{model:t.commissionInfo,"label-width":"130px",size:"mini"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:this.$t("action.attendantName")+"提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.coach_cash))])]),t._v(" "),t.subForm.is_add||t.subForm.store_id||1!==t.subForm.car_type?t._e():a("el-form-item",{attrs:{label:this.$t("action.attendantName")+"车费："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.car_cash))])]),t._v(" "),t.routesItem.auth.reseller&&(t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&t.routesItem.auth.reseller_auth)||1*t.commissionInfo.reseller_cash>0||1*t.commissionInfo.level_reseller_cash>0?a("block",[a("el-form-item",{attrs:{label:"一级"+t.$t("action.resellerName")+"提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.reseller_cash))])]),t._v(" "),a("el-form-item",{attrs:{label:"二级"+t.$t("action.resellerName")+"提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.level_reseller_cash))])])],1):t._e(),t._v(" "),t.routesItem.auth.coachbroker&&(t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&t.routesItem.auth.partner_auth)||1*t.commissionInfo.broker_cash>0?a("el-form-item",{attrs:{label:t.$t("action.brokerName")+"提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.broker_cash))])]):t._e(),t._v(" "),t.routesItem.auth.channel&&(t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&t.routesItem.auth.channel_auth)||1*t.commissionInfo.channel_cash>0?a("el-form-item",{attrs:{label:this.$t("action.channelName")+"："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.channel_cash))])]):t._e(),t._v(" "),t.routesItem.auth.salesman&&(t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&t.routesItem.auth.salesman_auth)||1*t.commissionInfo.salesman_cash>0?a("el-form-item",{attrs:{label:"业务员提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.salesman_cash))])]):t._e(),t._v(" "),t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&3===t.routesItem.userInfo.city_type?a("el-form-item",{attrs:{label:"省代理提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.province_admin_cash))])]):t._e(),t._v(" "),t.routesItem.userInfo.is_admin||!t.routesItem.userInfo.is_admin&&2!==t.routesItem.userInfo.city_type?a("el-form-item",{attrs:{label:"市代理提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.admin_cash))])]):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"区县代理提成："}},[a("div",[t._v("¥"+t._s(t.commissionInfo.level_admin_cash))])])],1)],1)],1)],1):t._e(),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-button",{attrs:{type:"primary"},on:{click:function(e){return t.$router.back(-1)}}},[t._v(t._s(t.$t("action.back")))])],1),t._v(" "),a("el-dialog",{attrs:{title:t.$t("action.userLabelAndEva"),visible:t.showDialog.label,width:"800px",top:"5vh",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"label",e)}}},[a("div",{staticClass:"c-title text-bold pb-md"},[t._v("标签：")]),t._v(" "),a("div",{staticClass:"flex-warp pb-lg"},[t._l(t.labelForm,function(e,s){return a("block",{key:s},[a("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.is_show?s<t.labelForm.length:s<9,expression:"is_show ? index < labelForm.length : index < 9"}],staticClass:"mr-md mt-sm mb-sm",attrs:{size:"small",closable:t.pagePermissionCustom.includes("deleteTag")},on:{close:function(e){return t.toDelLabel(s)}}},[t._v(t._s(e.title))])],1)}),t._v(" "),t.labelForm.length>9?a("div",{staticClass:"flex-center f-paragraph c-link cursor-pointer",on:{click:t.toShowLabel}},[t._v("\n        "+t._s(t.is_show?"收起更多":"展开更多")+"\n        "),a("i",{staticClass:"iconfont",class:[{iconshang:t.is_show},{iconxia:!t.is_show}],staticStyle:{"font-size":"10px"}})]):t._e(),t._v(" "),0===t.labelForm.length?a("block",[a("div",{staticClass:"f-caption c-caption"},[t._v("暂无数据")]),t._v(" "),a("div",{staticStyle:{height:"50px"}})]):t._e()],2),t._v(" "),a("div",{staticClass:"c-title text-bold pt-lg pb-md"},[t._v("评价内容：")]),t._v(" "),0===t.tableData.label.length?a("block",[a("div",{staticClass:"f-caption c-caption"},[t._v("暂无数据")]),t._v(" "),a("div",{staticStyle:{height:"200px"}})]):t._e(),t._v(" "),t._l(t.tableData.label,function(e,s){return a("div",{key:s,staticClass:"label-eva-item flex-warp pt-lg pb-lg",class:[{"b-1px-t":0!=s}]},[a("img",{staticClass:"avatar radius",attrs:{src:e.work_img}}),t._v(" "),a("div",{staticClass:"flex-1 ml-md"},[a("div",{staticClass:"name flex-between"},[a("div",{staticClass:"c-title text-bold"},[t._v("\n            "+t._s(e.coach_name)+"\n          ")]),t._v(" "),a("div",{staticClass:"f-caption c-caption"},[t._v("\n            "+t._s(t._f("handleTime")(e.create_time))+"\n          ")])]),t._v(" "),a("div",{staticClass:"c-paragraph",domProps:{innerHTML:t._s(e.text)}})])])}),t._v(" "),t.total.label>0?a("lb-page",{attrs:{batch:!1,page:t.searchForm.label.page,pageSize:t.searchForm.label.limit,total:t.total.label},on:{handleSizeChange:function(e){return t.handleSizeChange(e,"label")},handleCurrentChange:function(e){return t.handleCurrentChange(e,"label")}}}):t._e()],2),t._v(" "),a("el-dialog",{attrs:{title:"音频内容",visible:t.showDialog.file,"close-on-click-modal":!1,"show-close":!1,width:"600px",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"file",e)}}},[a("div",{staticClass:"flex-center flex-column",staticStyle:{padding:"50px"}},[a("audio",{ref:"audio_item",attrs:{controls:"",src:t.fileForm.record_url}}),t._v(" "),a("div",{staticClass:"f-title c-title text-bold pt-lg"},[t._v("\n        "+t._s(t._f("handleFileName")(t.fileForm.record_url))+"\n      ")])]),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showDialog.file=!1}}},[t._v("取 消")])],1)]),t._v(" "),a("el-dialog",{attrs:{title:t.$t("action.updateOrderPhone"),visible:t.showDialog.editphone,width:"600px",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"editphone",e)}}},[a("el-form",{ref:"editphoneForm",staticClass:"dialog-form",attrs:{model:t.editphoneForm,rules:t.editphoneFormRules,"label-width":"140px"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"原下单手机号"}},[t._v("\n        "+t._s(t.editphoneForm.old_text)+"\n      ")]),t._v(" "),a("el-form-item",{attrs:{label:"现下单手机号",prop:"mobile"}},[a("el-input",{attrs:{maxlength:"11","show-word-limit":"",placeholder:"请输入下单手机号"},model:{value:t.editphoneForm.mobile,callback:function(e){t.$set(t.editphoneForm,"mobile",e)},expression:"editphoneForm.mobile"}})],1)],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showDialog.editphone=!1}}},[t._v(t._s(t.$t("action.cancel")))]),t._v(" "),a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(e){return t.submitFormInfo("editphone")}}},[t._v(t._s(t.$t("action.comfirm")))])],1)],1),t._v(" "),a("el-dialog",{attrs:{title:t.$t("action.updateOrderAddress"),visible:t.showDialog.editaddr,width:"600px",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"editaddr",e)}}},[a("el-form",{ref:"editaddrForm",staticClass:"dialog-form",attrs:{model:t.editaddrForm,rules:t.editaddrFormRules,"label-width":"140px"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"原下单地址"}},[t._v("\n        "+t._s(t.editaddrForm.old_text)+"\n      ")]),t._v(" "),a("el-form-item",{attrs:{label:"现下单地址",prop:"address"}},[t._v("\n        "+t._s(t.editaddrForm.address)+"\n        "),a("div",{staticClass:"flex-y-center"},[a("el-input",{staticStyle:{width:"260px","margin-right":"10px"},attrs:{placeholder:"请输入某酒店/XX房间(某小区/XX号)"},model:{value:t.editaddrForm.address_info,callback:function(e){t.$set(t.editaddrForm,"address_info",e)},expression:"editaddrForm.address_info"}}),t._v(" "),a("lb-button",{attrs:{type:"primary",plain:""},on:{click:function(e){t.showMap=!0}}},[t._v("获取经纬度")])],1)])],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showDialog.editaddr=!1}}},[t._v(t._s(t.$t("action.cancel")))]),t._v(" "),a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(e){return t.submitFormInfo("editaddr")}}},[t._v(t._s(t.$t("action.comfirm")))])],1)],1),t._v(" "),a("lb-map",{attrs:{dialogVisible:t.showMap},on:{"update:dialogVisible":function(e){t.showMap=e},"update:dialog-visible":function(e){t.showMap=e},selectedLatLng:t.getLatLng}})],1)},staticRenderFns:[]};var w=a("C7Lr")(h,g,!1,function(t){a("6LZp")},"data-v-29491c90",null);e.default=w.exports},YwmG:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=a("3cXf"),r=a.n(s),i=a("4YfN"),n=a.n(i),o=a("lC5x"),l=a.n(o),c=a("J0Oq"),d=a.n(c),m=a("PxTW"),_=a.n(m),u=a("bSIt"),p={components:{lbOrderDetail:a("E/Gp").default},data:function(){return{navTitle:"",abnormalTypeList:[{id:1,title:this.$t("action.attendantName")+"拒单"},{id:2,title:"超时接单"},{id:3,title:"客户差评"},{id:4,title:"行为规范"},{id:5,title:"话术规范"},{id:6,title:"客户投诉"},{id:7,title:"退车费"},{id:8,title:"到达后取消"},{id:9,title:"订单取消"},{id:10,title:"私收小费"},{id:11,title:"用户退款"},{id:12,title:"分城市提交"},{id:13,title:"其他"}],showDialog:{check:!1},processList:[],abnormalForm:{id:0,order_id:0,type:"",bad_text:"",customer_text:"",deduct_cash:"",have_deduct_cash:""},abnormalFormRules:{type:{required:!0,type:"number",message:"请选择异常类型",trigger:"blur"},bad_text:{required:!0,type:"string",validator:this.$reg.isNotNull,text:"差评原因",reg_type:2,trigger:"blur"},customer_text:{required:!0,type:"string",validator:this.$reg.isNotNull,text:"客服处理意见",reg_type:2,trigger:"blur"},deduct_cash:{required:!1,validator:function(t,e,a){e&&!/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/.test(e)?a(new Error("请输入正确的建议扣款金额")):a()},trigger:"blur"}},checkForm:{id:"",status:2,text:"",deduct_cash:"",deduct_status:0},checkFormRules:{status:{required:!0,type:"number",message:"请选择审批结果",trigger:"blur"},deduct_cash:{required:!0,type:"string",validator:this.$reg.isMoney,text:"扣款金额",trigger:"blur"},text:{required:!0,type:"string",validator:this.$reg.isNotNull,text:"拒绝原因",reg_type:2,trigger:"blur"}}}},created:function(){var t=this;return d()(l.a.mark(function e(){var a,s,r,i;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.$route.query,s=a.id,r=a.aid,i=void 0===r?0:r,i*=1,t.abnormalForm.order_id=s,t.abnormalForm.id=i,!i){e.next=7;break}return e.next=7,t.getAbnormal(i);case 7:t.navTitle=t.$t(i?"menu.ShopAbnormalOrderDetail":"action.operAbnormal");case 8:case"end":return e.stop()}},e,t)}))()},destroyed:function(){this.destroyMap()},computed:n()({},Object(u.e)({routesItem:function(t){return t.routes}})),methods:{submitFormInfo:function(t){var e=this;return d()(l.a.mark(function a(){var s,i,n,o,c,d;return l.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(s=!0,e.$refs[t+"Form"].validate(function(t){t||(s=!1)}),s){a.next=4;break}return a.abrupt("return");case 4:return i=JSON.parse(r()(e[t+"Form"])),"check"===t&&delete i.deduct_status,n="abnormal"===t?i.id?"updateOrder":"orderAdd":"handleOrder",a.next=9,e.$api.shop[n](i);case 9:if(o=a.sent,c=o.code,d=o.data,200===c){a.next=14;break}return a.abrupt("return");case 14:e.$message.success(e.$t("tips.successSub")),"abnormal"!==t||i.id?e.showDialog[t]=!1:(e.$router.replace({query:{id:i.order_id,aid:d}}),e[t+"Form"].id=d),e.getAbnormal();case 17:case"end":return a.stop()}},a,e)}))()},getAbnormal:function(){var t=this;return d()(l.a.mark(function e(){var a,s,r,i,n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.abnormalForm.id,e.next=3,t.$api.shop.abnormalOrderInfo({id:a});case 3:s=e.sent,r=s.data,i=r.info,n=r.process,i.bad_text=i.bad_text.replace(/\n/g,"<br>"),i.customer_text=i.customer_text.replace(/\n/g,"<br>"),t.abnormalForm=i,n.map(function(t){t.role_list.map(function(t){t.text=t.text?t.text.replace(/\n/g,"<br>"):""})}),t.processList=n;case 11:case"end":return e.stop()}},e,t)}))()},toShowDialog:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return d()(l.a.mark(function s(){var r;return l.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:s.t0=t,s.next="check"===s.t0?3:5;break;case 3:for(r in e[t+"Form"])e[t+"Form"][r]=a[r];return s.abrupt("break",5);case 5:e.showDialog[t]=!e.showDialog[t];case 6:case"end":return s.stop()}},s,e)}))()}},filters:{handleTime:function(t,e){return 1===e?_()(1e3*t).format("YYYY-MM-DD"):2===e?_()(1e3*t).format("HH:mm:ss"):3===e?_()(1e3*t).format("YYYY-MM-DD HH:mm"):4===e?_()(1e3*t).format("HH:mm"):_()(1e3*t).format("YYYY-MM-DD HH:mm:ss")},handleTitle:function(t,e){var a=e.filter(function(e){return e.id===t});return a&&a.length>0?a[0].title:""},handleUserName:function(t,e,a){return t===e&&(t="我"),t?"admin"===t?t:1===a?t.substring(0,2):t||"-":"-"}}},v={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"lb-shop-abnormal-detail"},[a("top-nav",{attrs:{title:t.navTitle,isBack:!0}}),t._v(" "),a("div",{staticClass:"page-main"},[a("lb-classify-title",{attrs:{title:t.abnormalForm.id?"处理结果":"异常申请"}}),t._v(" "),a("el-form",{ref:"abnormalForm",attrs:{model:t.abnormalForm,rules:t.abnormalFormRules,"label-width":"140px",size:!t.abnormalForm.id||t.abnormalForm.first_cancel?"":"mini"}},[!t.abnormalForm.id||t.abnormalForm.first_cancel?a("block",[a("el-form-item",{attrs:{label:"异常类型：",prop:"type"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:t.abnormalForm.type,callback:function(e){t.$set(t.abnormalForm,"type",e)},expression:"abnormalForm.type"}},t._l(t.abnormalTypeList,function(t){return a("el-option",{key:t.id,attrs:{label:t.title,value:t.id}})}),1)],1),t._v(" "),a("el-form-item",{attrs:{label:"差评原因：",prop:"bad_text"}},[a("el-input",{attrs:{type:"textarea",resize:"none",rows:10,maxlength:"1000","show-word-limit":"",placeholder:"请输入差评原因"},model:{value:t.abnormalForm.bad_text,callback:function(e){t.$set(t.abnormalForm,"bad_text",e)},expression:"abnormalForm.bad_text"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"客服处理意见：",prop:"customer_text"}},[a("el-input",{attrs:{type:"textarea",resize:"none",rows:10,maxlength:"1000","show-word-limit":"",placeholder:"请输入客服处理意见"},model:{value:t.abnormalForm.customer_text,callback:function(e){t.$set(t.abnormalForm,"customer_text",e)},expression:"abnormalForm.customer_text"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"建议扣款：",prop:"deduct_cash"}},[a("el-input",{attrs:{placeholder:"请输入建议扣款金额"},model:{value:t.abnormalForm.deduct_cash,callback:function(e){t.$set(t.abnormalForm,"deduct_cash",e)},expression:"abnormalForm.deduct_cash"}})],1),t._v(" "),a("el-form-item",{attrs:{label:""}},[a("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"},{name:"hasPermi",rawName:"v-hasPermi",value:"ShopOrder-operAbnormal",expression:"`ShopOrder-operAbnormal`"}],attrs:{type:"primary"},on:{click:function(e){return t.submitFormInfo("abnormal")}}},[t._v("提交审核")])],1)],1):a("block",[a("el-form-item",{attrs:{label:"异常类型："}},[t._v("\n          "+t._s(t._f("handleTitle")(t.abnormalForm.type,t.abnormalTypeList))+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"差评原因："}},[a("div",{staticClass:"text-box pd-lg mb-md radius-10",domProps:{innerHTML:t._s(t.abnormalForm.bad_text)}})]),t._v(" "),a("el-form-item",{attrs:{label:"客服处理意见："}},[a("div",{staticClass:"text-box pd-lg mb-sm radius-10",domProps:{innerHTML:t._s(t.abnormalForm.customer_text)}})]),t._v(" "),a("el-form-item",{attrs:{label:"建议扣款："}},[t._v("\n          ¥"+t._s(t.abnormalForm.deduct_cash||0)+"\n        ")]),t._v(" "),a("el-form-item",{attrs:{label:"首次处理时间："}},[a("div",[t._v(t._s(t._f("handleTime")(t.abnormalForm.first_handle.time)))])]),t._v(" "),a("el-form-item",{attrs:{label:"首次处理人："}},[t.abnormalForm.first_handle?a("div",[t._v("\n            "+t._s(t.abnormalForm.first_handle.user_name)+"\n            "),t.abnormalForm.first_handle.role?a("span",[t._v("\n              ("+t._s(t.abnormalForm.first_handle.role)+")\n            ")]):t._e()]):a("div",[t._v("-")])]),t._v(" "),a("el-form-item",{attrs:{label:"是否已扣款："}},[a("el-tag",{attrs:{size:"small",type:1===t.abnormalForm.is_deduct?"success":"danger"}},[t._v("\n            "+t._s(1===t.abnormalForm.is_deduct?"是":"否")+"\n          ")])],1),t._v(" "),1===t.abnormalForm.is_deduct?a("el-form-item",{attrs:{label:"扣除分成金额："}},[a("div",{staticClass:"c-warning"},[t._v("\n            ¥"+t._s(t.abnormalForm.have_deduct_cash||0)+"\n          ")])]):t._e(),t._v(" "),a("el-form-item",{attrs:{label:"最终处理意见："}},[t.abnormalForm.end_handle&&t.abnormalForm.end_handle.time?a("div",[t._v("\n            "+t._s(t.abnormalForm.end_handle.user_name)+"\n            "),t.abnormalForm.end_handle.role?a("span",[t._v("\n              ("+t._s(t.abnormalForm.end_handle.role)+")\n            ")]):t._e(),t._v(" "),a("el-tag",{attrs:{size:"small",type:2===t.abnormalForm.end_handle.status?"success":"danger"}},[t._v("\n              "+t._s(2===t.abnormalForm.end_handle.status?"同意":"拒绝")+"\n            ")])],1):a("div",[t._v("-")])]),t._v(" "),a("el-form-item",{attrs:{label:"最终处理时间："}},[t.abnormalForm.end_handle&&t.abnormalForm.end_handle.time?a("div",[t._v("\n            "+t._s(t._f("handleTime")(t.abnormalForm.end_handle.time))+"\n          ")]):a("div",[t._v("-")])]),t._v(" "),a("el-form-item",{attrs:{label:"最终扣款时间："}},[t.abnormalForm.deduct_time?a("div",[t._v("\n            "+t._s(t._f("handleTime")(t.abnormalForm.deduct_time))+"\n          ")]):a("div",[t._v("-")])]),t._v(" "),a("el-form-item",{attrs:{label:"当前进度："}},[a("el-tag",{attrs:{size:"small",type:1===t.abnormalForm.status?"danger":"success"}},[t._v("\n            "+t._s(1===t.abnormalForm.status?"处理中":"处理完成")+"\n          ")])],1)],1)],1),t._v(" "),t.abnormalForm.id&&t.processList.length>0?a("div",{staticClass:"abnormal-list pd-lg mt-lg"},[a("div",{staticClass:"c-title text-bold pb-lg"},[t._v("流程")]),t._v(" "),a("div",{staticClass:"list-item mb-lg"},[a("div",{staticClass:"flex-warp"},[a("div",{staticClass:"user flex-center f-caption c-base"},[t._v("\n            "+t._s(t._f("handleUserName")(t.abnormalForm.first_handle.user_name,t.routesItem.userInfo.agent_name,1))+"\n          ")]),t._v(" "),a("div",{staticClass:"flex-1 ml-lg"},[a("div",{staticClass:"flex-between"},[a("div",[a("div",[t._v("发起处理申请")]),t._v(" "),a("div",{staticClass:"c-title mt-sm"},[t._v("\n                  "+t._s(t._f("handleUserName")(t.abnormalForm.first_handle.user_name,t.routesItem.userInfo.agent_name,2))+"\n                ")])]),t._v(" "),a("div",{staticClass:"c-caption"},[t._v("\n                "+t._s(t._f("handleTime")(t.abnormalForm.first_handle.time))+"\n              ")])]),t._v(" "),a("div",{staticClass:"flex-warp mt-lg b-1px-l",staticStyle:{height:"30px"}})])])]),t._v(" "),t._l(t.processList,function(e,s){return a("div",{key:s,staticClass:"list-item mb-lg"},[a("div",{staticClass:"flex-warp"},[a("div",{staticClass:"user flex-center f-caption c-base"},[e.role_list.length>1?a("i",{staticClass:"iconfont iconshenqingfenxiaoshang"}):a("block",[t._v("\n              "+t._s(t._f("handleUserName")(e.role_list[0].user_name,t.routesItem.userInfo.agent_name,1)))])],1),t._v(" "),a("div",{staticClass:"flex-1 ml-lg"},[1===e.role_list.length?a("div",{staticClass:"flex-between",staticStyle:{"min-height":"45px"}},[a("div",{staticStyle:{width:"500px"}},[a("div",[t._v("\n                  审批结果："),a("span",{class:[["","c-link","c-success","c-warning"][e.status]]},[t._v(t._s(["","待审批","同意","拒绝"][e.status]))]),t._v(" "),3===e.status?a("el-popover",{attrs:{placement:"top-start",width:"350",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("拒绝原因：")]),t._v(" "),a("div",{staticStyle:{"max-height":"80vh",overflow:"auto"},domProps:{innerHTML:t._s(e.role_list[0].text)}})]),t._v(" "),a("i",{staticClass:"el-icon-question",staticStyle:{color:"#000"},attrs:{slot:"reference"},slot:"reference"})]):t._e(),t._v(" "),2===e.status&&1*e.deduct_cash>0?a("span",{staticClass:"c-warning"},[t._v("(扣款：¥"+t._s(e.deduct_cash)+")")]):t._e()],1),t._v(" "),a("div",{staticClass:"mt-sm"},[a("span",{staticClass:"c-title"},[t._v("\n                    "+t._s(t._f("handleUserName")(e.role_list[0].user_name,t.routesItem.userInfo.agent_name,2))+"\n                  ")]),t._v(" "),e.role_list[0].role?a("span",[t._v("("+t._s(e.role_list[0].role)+")")]):t._e()])]),t._v(" "),e.create_time&&e.create_time>0?a("div",{staticClass:"c-caption"},[t._v("\n                "+t._s(t._f("handleTime")(e.create_time))+"\n              ")]):t._e(),t._v(" "),1===e.can_handle?a("el-tag",{staticClass:"cursor-pointer",attrs:{size:"small",type:"danger"},on:{click:function(a){return t.toShowDialog("check",{id:e.id,status:2,text:"",deduct_cash:"",deduct_status:e.deduct_status})}}},[t._v("审批")]):t._e()],1):t._e(),t._v(" "),e.role_list.length>1?a("div",{staticClass:"list-user",class:[{"b-1px-l":s!==t.processList.length-1},{"mt-sm":0!==t.aindex}],style:{paddingBottom:2===e.role_list.length&&s!==t.processList.length-1?"46px":"16px"}},t._l(e.role_list,function(s,r){return a("div",{key:r,staticClass:"flex-warp",style:{marginTop:0!==r?"10px":""}},[a("div",{staticStyle:{width:"280px"}},[a("span",{staticClass:"c-title"},[t._v("\n                    "+t._s(t._f("handleUserName")(s.user_name,t.routesItem.userInfo.agent_name,2))+"\n                  ")]),t._v(" "),s.role?a("span",[t._v("("+t._s(s.role)+")")]):t._e()]),t._v(" "),a("div",{staticClass:"flex-1 flex-warp ml-sm"},[a("div",{staticClass:"flex-1"},[a("span",[t._v("\n                      审批结果：\n                      "),a("span",{class:[["","c-link","c-success","c-warning"][s.handle_status]]},[t._v(t._s(["","待审批","同意","拒绝"][s.handle_status]))]),t._v(" "),3===s.handle_status?a("el-popover",{attrs:{placement:"top-start",width:"350",trigger:"hover"}},[a("div",{staticClass:"f-caption c-title",attrs:{slot:""},slot:"default"},[a("div",{staticClass:"c-caption pb-sm"},[t._v("拒绝原因：")]),t._v(" "),a("div",{staticStyle:{"max-height":"80vh",overflow:"auto"},domProps:{innerHTML:t._s(s.text)}})]),t._v(" "),a("i",{staticClass:"el-icon-question",staticStyle:{color:"#000"},attrs:{slot:"reference"},slot:"reference"})]):t._e()],1),t._v(" "),2===s.handle_status&&1*s.deduct_cash>0?a("span",{staticClass:"c-warning"},[t._v("\n                      (扣款：¥"+t._s(s.deduct_cash)+")\n                    ")]):t._e()]),t._v(" "),s.create_time&&s.create_time>0?a("div",{staticClass:"c-caption"},[t._v("\n                    "+t._s(t._f("handleTime")(s.create_time))+"\n                  ")]):t._e()]),t._v(" "),1===e.can_handle&&0===r?a("el-tag",{staticClass:"cursor-pointer",attrs:{size:"small",type:"danger"},on:{click:function(a){return t.toShowDialog("check",{id:e.id,status:2,text:"",deduct_cash:"",deduct_status:e.deduct_status})}}},[t._v("审批")]):t._e()],1)}),0):s!==t.processList.length-1?a("div",{staticClass:"flex-warp mt-lg b-1px-l",staticStyle:{height:"20px"}}):t._e()])])])})],2):t._e(),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("div",{staticClass:"space-lg"}),t._v(" "),a("lb-classify-title",{attrs:{title:"订单详情"}}),t._v(" "),a("lb-order-detail",{attrs:{abnormal:1}})],1),t._v(" "),a("el-dialog",{attrs:{title:"审批",visible:t.showDialog.check,width:"600px",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"check",e)}}},[a("el-form",{ref:"checkForm",attrs:{model:t.checkForm,rules:t.checkFormRules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"审批结果：",prop:"status"}},[a("el-radio-group",{model:{value:t.checkForm.status,callback:function(e){t.$set(t.checkForm,"status",e)},expression:"checkForm.status"}},[a("el-radio",{attrs:{label:2}},[t._v("同意")]),t._v(" "),a("el-radio",{attrs:{label:3}},[t._v("拒绝")])],1)],1),t._v(" "),2===t.checkForm.status&&t.checkForm.deduct_status?a("el-form-item",{attrs:{label:"扣款金额：",prop:"deduct_cash"}},[a("el-input",{attrs:{placeholder:"请输入扣款金额"},model:{value:t.checkForm.deduct_cash,callback:function(e){t.$set(t.checkForm,"deduct_cash",e)},expression:"checkForm.deduct_cash"}})],1):t._e(),t._v(" "),3===t.checkForm.status?a("el-form-item",{attrs:{label:"拒绝原因：",prop:"text"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",resize:"none",rows:10,maxlength:"400","show-word-limit":"",placeholder:"请输入拒绝原因"},model:{value:t.checkForm.text,callback:function(e){t.$set(t.checkForm,"text",e)},expression:"checkForm.text"}})],1):t._e()],1),t._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(e){t.showDialog.check=!1}}},[t._v("取 消")]),t._v(" "),a("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(e){return t.submitFormInfo("check")}}},[t._v(t._s(t.$t("action.submit")))])],1)],1)],1)},staticRenderFns:[]};var b=a("C7Lr")(p,v,!1,function(t){a("zkhw")},"data-v-833e541e",null);e.default=b.exports},zkhw:function(t,e){}});