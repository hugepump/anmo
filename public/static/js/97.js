webpackJsonp([97],{"2+oe":function(e,t){},O5w2:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("3cXf"),o=r.n(a),n=r("4YfN"),s=r.n(n),i=r("lC5x"),u=r.n(i),l=r("J0Oq"),c=r.n(l),m=r("bSIt"),d=r("PxTW"),h=r.n(d),b={data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(h()(h()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},navTitle:"",cityType:{3:{type:"success",text:"省"},1:{type:"primary",text:"市"},2:{type:"danger",text:"区县"}},have_user_id:!1,searchForm:{user:{page:1,limit:10,name:""}},loading:{user:!1},tableData:{user:[]},total:{user:0},showDialog:{user:!1},multipleSelection:[],currentRow:{},subForm:{id:"",user_id:"",nickName:"",user_name:"",true_user_name:"",mobile:"",text:""},subFormRules:{user_id:{required:!0,type:"number",message:"请选择关联用户",trigger:"blur"},user_name:{required:!0,validator:this.$reg.isNotNull,text:this.$t("action.brokerName")+"姓名",reg_type:2,trigger:"blur"},true_user_name:{required:!0,validator:this.$reg.isNotNull,text:"真实姓名",reg_type:2,trigger:"blur"},mobile:{required:!0,validator:this.$reg.isTel,text:"手机号",reg_type:2,trigger:"blur"}}}},created:function(){var e=this;return c()(u.a.mark(function t(){var r;return u.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.$route.query.id)){t.next=5;break}return e.subForm.id=r,t.next=5,e.getDetail(r);case 5:e.navTitle=e.$t(r?"menu.CoachbrokerEdit":"menu.CoachbrokerAdd");case 6:case"end":return t.stop()}},t,e)}))()},computed:s()({},Object(m.e)({routesItem:function(e){return e.routes}})),methods:{getDetail:function(e){var t=this;return c()(u.a.mark(function r(){var a,o,n;return u.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$api.coachbroker.brokerInfo({id:e});case 2:for(n in a=r.sent,o=a.data,t.subForm)t.subForm[n]=o[n];t.have_user_id=o.id&&o.user_id;case 6:case"end":return r.stop()}},r,t)}))()},toShowDialog:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return c()(u.a.mark(function a(){return u.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=JSON.parse(o()(r)),"user"!==e||!t.have_user_id){a.next=3;break}return a.abrupt("return");case 3:return t.currentRow={},t.searchForm[e].name="",a.next=7,t.getTableDataList(1,e);case 7:t.showDialog[e]=!t.showDialog[e];case 8:case"end":return a.stop()}},a,t)}))()},resetForm:function(e){var t=e+"Form";this.$refs[t].resetFields(),this.getTableDataList(1,e)},handleSizeChange:function(e,t){this.searchForm[t].limit=e,this.handleCurrentChange(1,t)},handleCurrentChange:function(e,t){this.searchForm[t].page=e,this.getTableDataList("",t)},getTableDataList:function(e,t){var r=this;return c()(u.a.mark(function a(){var n,s,i,l,c,m,d;return u.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e&&(r.searchForm[t].page=e),r.tableData[t]=[],r.loading[t]=!0,n=JSON.parse(o()(r.searchForm[t])),s={user:{methodKey:"coachbroker",methodModel:"noBrokerUserList"}}[t],i=s.methodKey,l=s.methodModel,a.next=8,r.$api[i][l](n);case 8:if(c=a.sent,m=c.code,d=c.data,r.loading[t]=!1,200===m){a.next=14;break}return a.abrupt("return");case 14:r.tableData[t]=d.data,r.total[t]=d.total;case 16:case"end":return a.stop()}},a,r)}))()},handleSelectionChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments[1];e=JSON.parse(o()(e)),this.currentRow=e},handleDialogConfirm:function(e){if(null!==this.currentRow&&this.currentRow.id){var t=this.currentRow,r=t.id,a=void 0===r?0:r,o=t.nickName,n=void 0===o?"":o,s=t.phone,i=void 0===s?"":s;"user"===e&&(this.subForm.user_id=a,this.subForm.nickName=n,!this.subForm.mobile&&i&&(this.subForm.mobile=i)),this.showDialog[e]=!1}else this.$message.error("请选择用户")},submitFormInfo:function(e){var t=this,r=!0;if(this.$refs[e+"Form"].validate(function(e){e||(r=!1)}),r){var a=JSON.parse(o()(this[e+"Form"]));delete a.nickName;var n=a.id?"brokerUpdate":"brokerAdd";this.$api.coachbroker[n](a).then(function(e){200===e.code&&(t.$message.success(t.$t(a.id?"tips.successRev":"tips.successSub")),t.$router.back(-1))})}}},filters:{handleTime:function(e,t){return 1===t?h()(1e3*e).format("YYYY-MM-DD"):2===t?h()(1e3*e).format("HH:mm:ss"):h()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},p={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-coachbroker-edit"},[r("top-nav",{attrs:{title:e.navTitle,isBack:!0}}),e._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"120px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"关联用户",prop:"user_id"}},[r("el-tag",{staticClass:"cursor-pointer",attrs:{type:e.have_user_id?"info":"primary"},on:{click:function(t){return e.toShowDialog("user")}}},[e._v(e._s(e.subForm.user_id?e.subForm.nickName:"选择关联用户"))])],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("action.brokerName")+"姓名",prop:"user_name"}},[r("el-input",{attrs:{maxlength:"20","show-word-limit":"",placeholder:"请输入"+e.$t("action.brokerName")+"姓名"},model:{value:e.subForm.user_name,callback:function(t){e.$set(e.subForm,"user_name",t)},expression:"subForm.user_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"真实姓名",prop:"true_user_name"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":"",placeholder:"请输入真实姓名"},model:{value:e.subForm.true_user_name,callback:function(t){e.$set(e.subForm,"true_user_name",t)},expression:"subForm.true_user_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[r("el-input",{attrs:{maxlength:"11","show-word-limit":"",placeholder:"请输入手机号"},model:{value:e.subForm.mobile,callback:function(t){e.$set(e.subForm,"mobile",t)},expression:"subForm.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"text"}},[r("el-input",{attrs:{type:"textarea",rows:10,maxlength:"300",resize:"none","show-word-limit":"",placeholder:"请输入备注信息"},model:{value:e.subForm.text,callback:function(t){e.$set(e.subForm,"text",t)},expression:"subForm.text"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFormInfo("sub")}}},[e._v(e._s(e.$t("action.submit")))]),e._v(" "),r("lb-button",{on:{click:function(t){return e.$router.back(-1)}}},[e._v(e._s(e.$t("action.back")))])],1)],1),e._v(" "),r("el-dialog",{attrs:{title:"关联用户",visible:e.showDialog.user,width:"800px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"user",t)}}},[e.routesItem.userInfo.is_admin?e._e():r("lb-tips",[e._v("请输入用户昵称/手机号后点击查询数据")]),e._v(" "),r("el-form",{ref:"userForm",attrs:{inline:!0,model:e.searchForm.user,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入用户昵称/手机号"},model:{value:e.searchForm.user.name,callback:function(t){e.$set(e.searchForm.user,"name",t)},expression:"searchForm.user.name"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"user")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("user")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.user,expression:"loading.user"}],ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.user,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark","highlight-current-row":""},on:{"current-change":function(t){return e.handleSelectionChange(t,"user")}}},[r("el-table-column",{attrs:{prop:"id",label:"用户ID"}}),e._v(" "),r("el-table-column",{attrs:{prop:"avatarUrl",label:"头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("lb-image",{attrs:{src:e.row.avatarUrl}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"nickName",label:"昵称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"phone",label:"手机号"}})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.user.page,pageSize:e.searchForm.user.limit,total:e.total.user},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"user")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"user")}}}),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.user=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleDialogConfirm("user")}}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var f=r("C7Lr")(b,p,!1,function(e){r("2+oe")},"data-v-5bd6edf4",null);t.default=f.exports}});