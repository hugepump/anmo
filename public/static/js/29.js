webpackJsonp([29],{"9M/0":function(e,t){},eOGO:function(e,t){},mpqJ:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("p00s"),n=r.n(a),i=r("aA9S"),s=r.n(i),o=r("3cXf"),c=r.n(o),l=r("rVsN"),_=r.n(l),d=r("KH7x"),m=r.n(d),u=r("4YfN"),p=r.n(u),f=r("lC5x"),h=r.n(f),v=r("J0Oq"),b=r.n(v),g=r("PxTW"),y=r.n(g),x=r("bSIt"),w={data:function(){return{pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(y()(y()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},statusOptions:[{label:"全部订单",value:0},{label:"已取消",value:-1},{label:"待支付",value:1},{label:"待接单",value:2},{label:"已接单",value:3},{label:"已出发",value:4},{label:"已到达",value:5},{label:"服务中",value:6},{label:"已完成",value:7}],coachTypeList:[{id:0,title:"全部"+this.$t("action.attendantName")},{id:1,title:"入驻"+this.$t("action.attendantName")},{id:2,title:"非入驻"+this.$t("action.attendantName")}],serviceTypeList:[{id:0,title:"全部服务"},{id:2,title:"上门服务"},{id:1,title:"到店服务"}],transfreTypeList:[{id:1,title:"距离最近"},{id:2,title:"最早可预约"}],base_agent:[],base_agent_coach:[],primaryColor:"",subColor:"",carType:{0:"公交/地铁",1:"出租车"},payType:{1:"微信支付",2:"余额支付",3:"支付宝支付",4:"折扣卡支付"},statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},technicianStatusOperType:{2:"orderTaking",3:"setOut",4:"arrive",5:"startService",6:"serviceCompletion"},cityType:{3:{type:"success",text:"省"},1:{type:"primary",text:"市"},2:{type:"danger",text:"区县"}},loading:{list:!1,transfer:!1},searchForm:{list:{page:1,limit:10,goods_name:"",coach_name:"",channel_name:"",channel_qr_name:"",order_code:"",transaction_id:"",mobile:"",start_time:"",end_time:"",pay_type:0,is_coach:0,is_store:0,admin_id:"",is_add:0},transfer:{page:1,limit:10,order_id:"",type:1}},tableData:{list:[],transfer:[]},total:{list:0,transfer:0},count:{},print:!1,printTableData:[],downloadLoading:!1,showDialog:{transfer:!1,refund:!1},transferForm:{order_id:"",init_service_price:"",coach_type:1,coach_id:"",coach_name:"",mobile:"",text:"",admin_id:""},transferSubFormRules:{coach_name:{required:!0,validator:this.$reg.isNotNull,text:this.$t("action.attendantName")+"姓名",reg_type:2,trigger:"blur"},mobile:{required:!0,validator:this.$reg.isTel,text:"联系电话",reg_type:2,trigger:"blur"}},refundForm:{order:[]},lockTap:!1,timer:null}},activated:function(){var e=this;return b()(h.a.mark(function t(){var r;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=1,Number(window.sessionStorage.getItem("currentPage"))&&(r=Number(window.sessionStorage.getItem("currentPage")),window.sessionStorage.removeItem("currentPage")),t.next=4,e.getBaseInfo();case 4:e.getTableDataList(r,"list");case 5:case"end":return t.stop()}},t,e)}))()},beforeRouteLeave:function(e,t,r){"ShopOrderDetail"===e.name&&window.sessionStorage.setItem("currentPage",this.searchForm.list.page),r()},watch:{"showDialog.refund":function(e,t){e||this.timer&&clearInterval(this.timer)}},computed:p()({},Object(x.e)({routesItem:function(e){return e.routes}})),methods:{getBaseInfo:function(){var e=this;return b()(h.a.mark(function t(){var r,a,n,i,s,o,c;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_.a.all([e.$api.system.configInfo(),e.$api.agent.adminSelect()]);case 2:r=t.sent,a=m()(r,2),n=a[0],i=a[1],s=n.data,o=s.primaryColor,c=s.subColor,e.primaryColor=o,e.subColor=c,e.base_agent=i.data;case 10:case"end":return t.stop()}},t,e)}))()},resetForm:function(e){var t=e+"Form";this.$refs[t].resetFields(),this.getTableDataList(1,e)},handleSizeChange:function(e,t){this.searchForm[t].limit=e,this.handleCurrentChange(1,t)},handleCurrentChange:function(e,t){this.searchForm[t].page=e,this.getTableDataList("",t)},getTableDataList:function(e,t){var r=this;e&&(this.searchForm[t].page=e),this.loading[t]=!0;var a=JSON.parse(c()(this.searchForm[t]));if("list"===t){this.tableData[t]=[];var n=a.start_time;n&&n.length>1?(a.start_time=n[0]/1e3,a.end_time=n[1]/1e3):(a.start_time="",a.end_time="")}var i={list:"orderList",transfer:"orderChangeCoachList"}[t];this.$api.shop[i](a).then(function(e){if(r.loading[t]=!1,200===e.code){var a=e.data,n=a.data,i=a.total;if(r.tableData[t]=n,r.total[t]=i,"list"===t){n.map(function(e){e.refund_price=1*e.refund_price>0?e.refund_price:""});var s=r.routesItem.auth,o=s.channel,c=s.channel_auth,l=r.routesItem.userInfo.is_admin,_=o&&(l||!l&&c),d=n.map(function(e){e.goods_text="",e.add_order_text="",e.order_goods.map(function(t,a){var n=1*t.init_material_price>0?r.$t("action.materialText")+"：¥"+t.init_material_price:"";e.goods_text+=(0===a?"":"；")+t.goods_name+" 时长："+t.time_long+"分钟 "+n+" 单价：¥"+t.price+" 数量：x"+t.num+" "}),e.add_order_id&&e.add_order_id.length>0&&e.add_order_id.map(function(t,r){e.add_order_text+=(0===r?"":"；")+t.order_code+" "});var t=["","平台补贴",r.$t("action.attendantName")+"补贴",r.$t("action.agentName")+"补贴"],a=e.free_fare?t[e.free_fare]:"",n=1===e.car_type?"全程"+e.distance+"，车费"+e.car_price+" "+a:"";e.car_text=e.store_id?"":""+r.carType[e.car_type]+n+" ";var i=e.coach_id?"入驻":"非入驻",s=e.is_show?"":"用户已删除 ";e.coach_show||(s+=r.$t("action.attendantName")+"已删除");var o=r.statusType[e.pay_type]+" "+s;return[e.id,e.goods_text,e.user_name,e.mobile,e.coach_name,i+r.$t("action.attendantName"),e.store_id?"到店服务":"上门服务",y()(1e3*e.start_time).format("YYYY-MM-DD HH:mm:ss"),e.car_text,"¥"+e.init_service_price,"¥"+e.pay_price+" ",e.refund_price?"¥"+e.refund_price+" ":"",e.add_order_text,e.order_code,e.transaction_id,e.admin_name].concat(_?[e.channel_name,e.channel_qr_name,y()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),r.payType[e.pay_model],o]:[y()(1e3*e.create_time).format("YYYY-MM-DD HH:mm:ss"),r.payType[e.pay_model],o])}),m=["ID","服务项目信息","下单人","下单手机号",r.$t("action.attendantName"),r.$t("action.attendantName")+"类型","服务方式","服务开始时间","出行费用","服务项目费用","实收金额","退款金额","子订单号","系统订单号","付款订单号",r.$t("action.agentName")].concat(_?[r.$t("action.channelName"),"渠道码","下单时间","支付方式","状态"]:["下单时间","支付方式","状态"]);r.printTableData=[m,d]}}}),"list"===t&&this.$api.shop.orderTotalData(a).then(function(e){r.count=e.data})},toShowDialog:function(e,t){var r=this;return b()(h.a.mark(function a(){var n,i,s,o,l,_,d,m,u;return h.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=JSON.parse(c()(t)),n=t.id,"transfer"!==e){a.next=16;break}if([2,3,4,5,6,8].includes(t.pay_type)){a.next=7;break}return r.$message.error("当前订单不支持转单哦"),r.getTableDataList("","list"),a.abrupt("return");case 7:for(i in t.init_service_price=t.true_service_price,t.order_id=n,t.coach_type=1,r[e+"Form"])r[e+"Form"][i]=t[i];return r.searchForm.transfer.order_id=n,r.searchForm.transfer.type=1,r.currentRow={},a.next=16,r.getTableDataList(1,e);case 16:if("refund"!==e){a.next=43;break}return r.timer&&clearInterval(r.timer),a.next=20,r.$api.shop.canRefundOrderInfo({order_id:n});case 20:s=a.sent,o=s.data,l=o.empty_order_cash,_=o.order[0].pay_type,l=5===_?l:0,o.refund_empty_cash=l,o.empty_order_cash=l,o.init_empty_order_cash=l,o.is_check=!1,o.refund_car_price=o.car_price,o.total_refund_price=0,o.all_refund_num=0,d=y()(y()((new Date).getTime()).format("YYYY-MM-DD HH:mm:ss")).unix(),m=0,u=0,o.order.map(function(e){var t=0;if(e.pay_type>5&&1===o.after_service_can_refund){var r=Math.ceil((d-e.start_service_time)/60),a=o.cash_list.filter(function(e){return e.minute>=r}),n=(a&&a.length>0?a[0]:{balance:0}).balance;t=n}e.refund_comm_balance=t,e.order_goods.map(function(r){var a=r.residue_material_price,n=r.residue_service_price,i=r.can_refund_num,s=r.true_price,c=r.material_price;i&&u++;var l=0;m+=i,r.is_check=!1,r.true_single_price=s,r.true_single_material_price=c,s=(n/i).toFixed(2),c=(a/i).toFixed(2),r.true_price=s,r.material_price=c,r.refund_price=s,r.refund_material_price=c,e.pay_type>5&&1===o.after_service_can_refund&&(l=((1*s+1*c)*t/100).toFixed(2),r.refund_comm_price=l,r.refund_comm_cash=l);var _=1*((1*s+1*c-1*l)*i).toFixed(2),d=1*(1*n+1*a-l*i).toFixed(2);r.total_refund_price=_>d?d:_,r.true_total_refund_price=d,r.refund_num=i})}),o.can_refund_num=m,m||(o.total_refund_price=o.car_price),o.is_car_check=!1,o.is_empty_check=!1,r.refundForm=o,1===u&&(r.refundForm.is_check=!0,r.handleCheckOrderItem(-1)),_>5&&1===o.after_service_can_refund&&(r.timer=setInterval(function(){r.handleCheckOrderItem(-3)},6e4));case 43:r.showDialog[e]=!r.showDialog[e],["transfer"].includes(e)&&r.$refs[e+"Form"].validate&&r.$refs[e+"Form"].clearValidate();case 45:case"end":return a.stop()}},a,r)}))()},handleCheckOrderItem:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return b()(h.a.mark(function a(){var n,i,s,o,c,l,_,d,m,u,p,f,v,b,g,x,w,F,k,$,C,T,S,N,D,I,O,Y,L,z,M,R,P,H,q;return h.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:n=t.refundForm,i=n.is_check,s=n.order,o=n.can_refund_num,c=n.is_car_check,l=n.refund_car_price,_=n.is_empty_check,d=n.refund_empty_cash,m=n.empty_order_cash,u=n.init_empty_order_cash,p=n.after_service_can_refund,f=n.cash_list,v=/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/,-1===e?t.refundForm.order.map(function(e){e.order_goods.map(function(e){e.is_check=i})}):e>-1&&(b=s[e].order_goods[r],g=b.residue_service_price,x=b.residue_material_price,w=b.true_single_price,F=b.true_single_material_price,k=b.can_refund_num,$=b.refund_num,C=b.refund_price,T=b.refund_material_price,S=b.true_total_refund_price,N=b.refund_comm_price,D=b.refund_comm_cash,I=s[e].refund_comm_balance,v.test(C)||(C=1*g==0?0:.01),v.test(T)||(T=0),v.test(D)||(D=0),w=k===$?(1*g/$).toFixed(2):w,F=k===$?(1*x/$).toFixed(2):F,C=1*C>1*w?w:C,T=1*T>1*F?F:T,O=s[e],Y=O.pay_type,L=O.start_service_time,p&&Y>5&&(z=y()(y()((new Date).getTime()).format("YYYY-MM-DD HH:mm:ss")).unix(),M=Math.ceil((z-L)/60),R=f.filter(function(e){return e.minute>=M}),P=R&&R.length>0?R[0]:{balance:0},H=P.balance,I=H,N=((1*C+1*T)*H/100).toFixed(2),D=D>N?N:D),q=((1*C+1*T-1*D)*$).toFixed(2),t.$nextTick(function(){t.refundForm.order[e].order_goods[r].true_price=w,t.refundForm.order[e].order_goods[r].refund_price=C,t.refundForm.order[e].order_goods[r].material_price=F,t.refundForm.order[e].order_goods[r].refund_material_price=T,t.refundForm.order[e].refund_comm_balance=I,t.refundForm.order[e].order_goods[r].refund_comm_price=N,t.refundForm.order[e].order_goods[r].refund_comm_cash=D,t.refundForm.order[e].order_goods[r].total_refund_price=1*q>S?S:q})),v.test(l)||(l=0),v.test(d)||(d=0),t.$nextTick(function(){var e=0,r=0,a=0;t.refundForm.order.map(function(t){var n=t.pay_type,i=t.start_service_time,s=0;if(p&&n>5){var o=y()(y()((new Date).getTime()).format("YYYY-MM-DD HH:mm:ss")).unix(),c=Math.ceil((o-i)/60),l=f.filter(function(e){return e.minute>=c}),_=(l&&l.length>0?l[0]:{balance:0}).balance;s=_}t.refund_comm_balance=s,t.order_goods.map(function(t){var i=t.refund_num,o=t.refund_price,c=t.refund_material_price;if(p&&n>5){var l=((1*o+1*c)*s/100).toFixed(2),_=1*t.refund_comm_cash>l?l:t.refund_comm_cash;t.refund_comm_price=l,t.refund_comm_cash=_,t.total_refund_price=((1*o+1*c-1*_)*i).toFixed(2)}t.is_check?(e+=1*t.total_refund_price,r+=i):a++})});var n=o===r;c=!!n&&c,_=!!n&&_,n&&1*e<u&&(m=e,d=1*d>e?e:d);var i=1*e+(1*(c?l:0)+1*(_?-1*m+1*d:n?-1*m:0));t.refundForm.total_refund_price=i.toFixed(2),t.refundForm.all_refund_num=r,t.refundForm.is_check=0===a,t.refundForm.is_car_check=c,t.refundForm.is_empty_check=_,t.refundForm.refund_car_price=l,t.refundForm.empty_order_cash=m,t.refundForm.refund_empty_cash=d});case 6:case"end":return a.stop()}},a,t)}))()},toConfirmRefund:function(){var e=this;return b()(h.a.mark(function t(){var r,a,n,i,s,o,l,_,d,m,u,p,f,v;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.handleCheckOrderItem(-3);case 2:if(r=JSON.parse(c()(e.refundForm)),a=r.can_refund_num,n=r.all_refund_num,i=r.is_car_check,s=r.refund_car_price,o=r.is_empty_check,l=r.empty_order_cash,_=r.refund_empty_cash,d=r.order,s=i?s:0,_=o?_:0,l=a===n?l:0,m=[],u=0,p=0,0!==n){t.next=13;break}return e.$message.error("请先选择退款项目哦"),t.abrupt("return");case 13:if(!((f=d.filter(function(e){return!e.is_add})).length>0)){t.next=19;break}if(f[0].order_goods.map(function(e){u+=e.can_refund_num,e.is_check&&(p+=e.refund_num)}),u!==p||a===n){t.next=19;break}return e.$message.error("请把加钟项目一并退款哦"),t.abrupt("return");case 19:return d.map(function(e){var t=e.order_goods.filter(function(e){return e.is_check});if(t.length>0){var r=t.map(function(e){var t=e.refund_num,r=e.refund_price,a=e.refund_material_price,n=e.residue_service_price,i=e.residue_material_price,s=e.refund_comm_cash,o=void 0===s?0:s,c=1*(r*t).toFixed(2),l=1*(a*t).toFixed(2),_=o?1*(o*t).toFixed(2):0;return{id:e.id,num:t,true_price:c>n?n:c,material_price:l>i?i:l,refund_comm_cash:_}}),a=e.order_id,n=e.is_add,i=e.refund_comm_balance,o=void 0===i?0:i;m.push({order_id:a,list:r,car_price:n?0:s,comm_balance:o,refund_empty_cash:n?0:(1*l-1*_).toFixed(2),apply_empty_cash:n?0:_})}}),0===m.length&&m.push({order_id:d[0].order_id,list:[],car_price:s}),t.next=23,e.$api.shop.applyOrderRefund({order:m});case 23:if(v=t.sent,200===v.code){t.next=27;break}return t.abrupt("return");case 27:e.$message.success(e.$t("tips.successOper")),e.showDialog.refund=!1,e.getTableDataList("","list");case 30:case"end":return t.stop()}},t,e)}))()},changeCoachType:function(e){var t=this;return b()(h.a.mark(function r(){var a,n,i;return h.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(a=s()({},t.transferForm,{coach_id:"",coach_name:"",mobile:"",text:"",admin_id:""}),t.transferForm=a,t.currentRow={},1!==e){r.next=5;break}return r.abrupt("return");case 5:return r.next=7,t.$api.agent.adminSelect({agent_coach_auth:1});case 7:n=r.sent,i=n.data,t.base_agent_coach=i;case 10:case"end":return r.stop()}},r,t)}))()},handleTableChange:function(e,t){e=JSON.parse(c()(e)),this.currentRow=e},handleDialogConfirm:function(){var e=this;return b()(h.a.mark(function t(){var r,a,n,i,s,o,l,_,d,m;return h.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(r=!0,a=JSON.parse(c()(e.transferForm)),n=a.coach_type,1!==(void 0===n?1:n)){t.next=16;break}if(null!==e.currentRow&&e.currentRow.id){t.next=7;break}return e.$message.error("请选择"+e.$t("action.attendantName")),t.abrupt("return");case 7:i=e.currentRow,s=i.id,o=void 0===s?0:s,l=i.near_time,_=void 0===l?"":l,a.coach_id=o,a.near_time=_,delete a.coach_name,delete a.mobile,delete a.text,delete a.admin_id,t.next=18;break;case 16:a.coach_id=0,e.$refs.transferSubForm.validate(function(e){e||(r=!1)});case 18:if(delete a.coach_type,delete a.init_service_price,!e.lockTap&&r){t.next=22;break}return t.abrupt("return");case 22:return e.lockTap=!0,t.prev=23,t.next=26,e.$api.shop.orderChangeCoach(a);case 26:if(d=t.sent,m=d.code,e.lockTap=!1,200===m){t.next=31;break}return t.abrupt("return");case 31:e.$message.success(e.$t("tips.successOper")),e.getTableDataList("","list"),e.showDialog.transfer=!1,t.next=39;break;case 36:t.prev=36,t.t0=t.catch(23),e.lockTap=!1;case 39:case"end":return t.stop()}},t,e,[[23,36]])}))()},toOperOrderItem:function(e){var t=this;return b()(h.a.mark(function r(){var a,n;return h.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:a=e.type,e.type=1*a+1,n=t.$t("action."+t.technicianStatusOperType[a]),t.$confirm("你确认要操作"+n+"吗？",t.$t("tips.reminder"),{confirmButtonText:t.$t("action.comfirm"),cancelButtonText:t.$t("action.cancel"),type:"warning"}).then(function(){var r=e.is_add;delete e.is_add,7!==e.type||r?t.toConfirmOperOrder(e):t.toCheckOrder(e)}).catch(function(){});case 4:case"end":return r.stop()}},r,t)}))()},toCheckOrder:function(e){var t=this;return b()(h.a.mark(function r(){var a,n,i,s,o;return h.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$api.shop.orderInfo({id:e.order_id});case 2:a=r.sent,n=a.data,i=n.add_service,(s=void 0===i?[]:i)&&s.length>0?(o="",s.map(function(e){o+="【"+e+"】"}),t.$confirm("该订单还有"+o+s.length+"项加钟服务，完成主订单会将加钟订单一并结束，确认是否结束？",t.$t("tips.reminder"),{confirmButtonText:t.$t("action.comfirm"),cancelButtonText:t.$t("action.cancel"),type:"warning"}).then(function(){t.toConfirmOperOrder(e)})):t.toConfirmOperOrder(e);case 6:case"end":return r.stop()}},r,t)}))()},toConfirmOperOrder:function(e){var t=this;return b()(h.a.mark(function r(){var a,n;return h.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(!t.lockTap){r.next=2;break}return r.abrupt("return");case 2:return t.lockTap=!0,r.prev=3,r.next=6,t.$api.shop.adminUpdateOrder(e);case 6:a=r.sent,n=a.code,t.lockTap=!1,200===n&&t.$message.success(t.$t("tips.successOper")),t.getTableDataList("","list"),r.next=16;break;case 13:r.prev=13,r.t0=r.catch(3),t.lockTap=!1;case 16:case"end":return r.stop()}},r,t,[[3,13]])}))()},toExportExcel:function(){var e=this,t=this.total.list;if(t>1e4)this.$message.error("最多只能导出10000条数据，当前"+t+"条，请筛选数据点击搜索后再操作导出数据！");else{this.downloadLoading=!0;var r=JSON.parse(c()(this.searchForm.list)),a=r.start_time;a&&a.length>1?(r.start_time=a[0]/1e3,r.end_time=a[1]/1e3):(r.start_time="",r.end_time="");var i=this.$util.getProCurrentHref(),s=i.indexOf("?")>0?"":"?",o=i.indexOf("?")>0;n()(r).forEach(function(e,t){s+=o?"&"+e+"="+r[e]:e+"="+r[e],o=!0});var l=window.localStorage.getItem("massage_minitk"),_=i+"/massage/admin/AdminExcel/orderList"+s+"&token="+l;window.location.href=_,setTimeout(function(){e.downloadLoading=!1},5e3)}},printTable:function(){var e=this;this.print=!0,setTimeout(function(){e.$print(e.$refs.print),e.print=!1},50)}},filters:{handleTime:function(e,t){return 1===t?y()(1e3*e).format("YYYY-MM-DD"):2===t?y()(1e3*e).format("HH:mm:ss"):y()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},F={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-shop-order-list"},[r("top-nav"),e._v(" "),r("div",{staticClass:"page-main"},[r("el-row",{staticClass:"page-search-form"},[r("el-form",{ref:"listForm",attrs:{inline:!0,model:e.searchForm.list},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"服务名称",prop:"goods_name"}},[r("el-input",{attrs:{placeholder:"请输入服务名称"},model:{value:e.searchForm.list.goods_name,callback:function(t){e.$set(e.searchForm.list,"goods_name",t)},expression:"searchForm.list.goods_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("action.attendantName")+"姓名",prop:"coach_name"}},[r("el-input",{attrs:{placeholder:"请输入"+e.$t("action.attendantName")+"姓名"},model:{value:e.searchForm.list.coach_name,callback:function(t){e.$set(e.searchForm.list,"coach_name",t)},expression:"searchForm.list.coach_name"}})],1),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?r("el-form-item",{attrs:{label:e.$t("action.channelName")+"姓名",prop:"channel_name"}},[r("el-input",{attrs:{placeholder:"请输入"+e.$t("action.channelName")+"姓名"},model:{value:e.searchForm.list.channel_name,callback:function(t){e.$set(e.searchForm.list,"channel_name",t)},expression:"searchForm.list.channel_name"}})],1):e._e(),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?r("el-form-item",{attrs:{label:"渠道码名称",prop:"channel_qr_name"}},[r("el-input",{attrs:{placeholder:"请输入渠道码名称"},model:{value:e.searchForm.list.channel_qr_name,callback:function(t){e.$set(e.searchForm.list,"channel_qr_name",t)},expression:"searchForm.list.channel_qr_name"}})],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"系统订单号",prop:"order_code"}},[r("el-input",{attrs:{placeholder:"请输入系统订单号"},model:{value:e.searchForm.list.order_code,callback:function(t){e.$set(e.searchForm.list,"order_code",t)},expression:"searchForm.list.order_code"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"付款订单号",prop:"transaction_id"}},[r("el-input",{attrs:{placeholder:"请输入付款订单号"},model:{value:e.searchForm.list.transaction_id,callback:function(t){e.$set(e.searchForm.list,"transaction_id",t)},expression:"searchForm.list.transaction_id"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"下单手机号",prop:"mobile"}},[r("el-input",{staticStyle:{width:"200px"},attrs:{placeholder:"请输入下单时填写的手机号"},model:{value:e.searchForm.list.mobile,callback:function(t){e.$set(e.searchForm.list,"mobile",t)},expression:"searchForm.list.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"日期",prop:"start_time"}},[r("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1,"list")}},model:{value:e.searchForm.list.start_time,callback:function(t){e.$set(e.searchForm.list,"start_time",t)},expression:"searchForm.list.start_time"}})],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("action.attendantName")+"类型",prop:"is_coach"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1,"list")}},model:{value:e.searchForm.list.is_coach,callback:function(t){e.$set(e.searchForm.list,"is_coach",t)},expression:"searchForm.list.is_coach"}},e._l(e.coachTypeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),e.routesItem.auth.store?r("el-form-item",{attrs:{label:"服务方式",prop:"is_store"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1,"list")}},model:{value:e.searchForm.list.is_store,callback:function(t){e.$set(e.searchForm.list,"is_store",t)},expression:"searchForm.list.is_store"}},e._l(e.serviceTypeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:""+e.$t("action.agentName"),prop:"admin_id"}},[r("el-select",{attrs:{placeholder:"请选择"+e.$t("action.agentName"),filterable:"",clearable:""},on:{change:function(t){return e.getTableDataList(1,"list")}},model:{value:e.searchForm.list.admin_id,callback:function(t){e.$set(e.searchForm.list,"admin_id",t)},expression:"searchForm.list.admin_id"}},e._l(e.base_agent,function(e){return r("el-option",{key:e.id,attrs:{label:e.agent_name,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",{attrs:{label:"状态",prop:"pay_type"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1,"list")}},model:{value:e.searchForm.list.pay_type,callback:function(t){e.$set(e.searchForm.list,"pay_type",t)},expression:"searchForm.list.pay_type"}},e._l(e.statusOptions,function(e){return r("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"list")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("list")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),r("el-row",{staticClass:"page-top-operate"},[r("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-print",expression:"`${$route.name}-print`"}],attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-printer"},on:{click:e.printTable}},[e._v("\n        "+e._s(e.$t("action.print")))]),e._v(" "),r("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-export",expression:"`${$route.name}-export`"}],attrs:{size:"mini",plain:"",type:"primary",icon:"el-icon-download",loading:e.downloadLoading},on:{click:e.toExportExcel}},[e._v("\n        "+e._s(e.$t("action.export")))])],1),e._v(" "),r("div",{staticClass:"pb-lg"},[e._v("\n      共"),r("span",{staticClass:"c-warning"},[e._v(e._s(e.total.list||0)+"条")]),e._v("数据，订单总额共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.pay_price||0)+"元")]),e._v("，服务费共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.service_price||0)+"元")]),e._v("，"+e._s(e.$t("action.materialText"))+"共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.material_price||0)+"元")]),e._v("，车费共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.car_price||0)+"元")]),e._v("，服务费退款共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_service_price||0)+"元")]),e._v("，"+e._s(e.$t("action.materialText"))+"退款共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_material_price||0)+"元")]),e._v("，车费退款共计："),r("span",{staticClass:"c-warning"},[e._v(e._s(e.count.refund_car_price||0)+"元")])]),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.list,expression:"loading.list"}],staticStyle:{width:"100%"},attrs:{data:e.tableData.list,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[r("el-table-column",{attrs:{prop:"id",label:"ID",width:"80",fixed:""}}),e._v(" "),r("el-table-column",{attrs:{prop:"goods_info_text",width:"210",label:"服务项目信息"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.order_goods,function(t,a){return r("div",{key:a,staticClass:"goods-info-text flex-warp pt-md pb-sm"},[r("lb-image",{staticClass:"radius-5",attrs:{src:t.goods_cover}}),e._v(" "),r("div",{staticClass:"info-item flex-1 f-icontext c-caption ml-md"},[r("div",{staticClass:"flex-between"},[r("div",{staticClass:"f-caption c-title ellipsis",class:[{"max-160":t.refund_num>0}],staticStyle:{"line-height":"1.2"}},[e._v("\n                  "+e._s(t.goods_name)+"\n                ")]),e._v(" "),t.refund_num>0?r("div",{staticClass:"c-warning"},[e._v("\n                  已退x"+e._s(t.refund_num)+"\n                ")]):e._e()]),e._v(" "),r("div",{staticClass:"flex-y-center",staticStyle:{"line-height":"1.4"}},[e._v("\n                时长："+e._s(t.time_long)+" 分钟\n              ")]),e._v(" "),1*t.init_material_price>0?r("div",{staticClass:"flex-y-center",staticStyle:{"line-height":"1.4"}},[e._v("\n                "+e._s(e.$t("action.materialText"))+"：\n                "),r("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.init_material_price))])]):e._e(),e._v(" "),r("div",{staticClass:"flex-between mt-sm",staticStyle:{"line-height":"1.4"}},[r("div",{staticClass:"c-warning"},[e._v("¥"+e._s(t.price))]),e._v(" "),r("div",[e._v("x"+e._s(t.num))])])])],1)})}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"user_name",label:"下单人"}}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile","min-width":"110",label:"下单手机号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"coach_name",label:e.$t("action.attendantName")}}),e._v(" "),r("el-table-column",{attrs:{prop:"coach_id","min-width":"100",label:e.$t("action.attendantName")+"类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("\n            "+e._s(t.row.coach_id?"入驻":"非入驻")+e._s(e.$t("action.attendantName"))+"\n          ")])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"store_id",label:"服务方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(t.row.store_id?"到店服务":"上门服务"))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"start_time","min-width":"110",label:"服务开始时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,1)))]),e._v(" "),r("div",[e._v(e._s(e._f("handleTime")(t.row.start_time,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"car_type","min-width":"120",label:"出行费用"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.store_id?void 0:[r("div",[e._v("\n            "+e._s(e.carType[t.row.car_type])+"\n          ")]),e._v(" "),1==t.row.car_type?r("div",{staticClass:"flex-warp"},[e._v("\n            全程"+e._s(t.row.distance)+"，车费¥"+e._s(t.row.car_price)+"\n          ")]):e._e(),e._v(" "),t.row.free_fare?r("div",{staticClass:"c-warning"},[e._v("\n            "+e._s(["","平台补贴",e.$t("action.attendantName")+"补贴",e.$t("action.agentName")+"补贴"][t.row.free_fare])+"\n          ")]):e._e()]}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{prop:"init_service_price",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          ¥"+e._s(t.row.init_service_price)+"\n        ")]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"pay_price",label:"实收金额"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v("¥"+e._s(t.row.pay_price))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"refund_price",label:"退款金额"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.refund_price?[r("div",[e._v("¥"+e._s(t.row.refund_price))])]:void 0}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{prop:"add_order_id","min-width":"130",label:"子订单号"},scopedSlots:e._u([{key:"default",fn:function(t){return t.row.add_order_id&&t.row.add_order_id.length>0?e._l(t.row.add_order_id,function(t,a){return r("div",{key:a,staticClass:"c-warning cursor-pointer",class:[{"mt-sm":0!==a}],staticStyle:{"line-height":"20px"},on:{click:function(r){return e.$router.push("/shop/order/detail?id="+t.id)}}},[e._v("\n            "+e._s(t.order_code)+"\n          ")])}):void 0}}],null,!0)}),e._v(" "),r("el-table-column",{attrs:{prop:"order_code","min-width":"130",label:"系统订单号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"transaction_id","min-width":"130",label:"付款订单号"}}),e._v(" "),r("el-table-column",{attrs:{prop:"admin_name",label:""+e.$t("action.agentName")}}),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?r("el-table-column",{attrs:{prop:"channel_name",label:e.$t("action.channelName")}}):e._e(),e._v(" "),e.routesItem.auth.channel&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.channel_auth)?r("el-table-column",{attrs:{prop:"channel_qr_name","min-width":"100",label:"渠道码"}}):e._e(),e._v(" "),r("el-table-column",{attrs:{prop:"create_time","min-width":"110",label:"下单时间"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),r("div",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"pay_model",label:"支付方式"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.payType[t.row.pay_model])+"\n        ")]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"status",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(e.statusType[t.row.pay_type])+"\n          "),t.row.coach_refund_time&&-1===t.row.pay_type?r("div",{staticClass:"f-icontext c-warning"},[e._v("\n            "+e._s(e.$t("action.attendantName"))+"拒单\n          ")]):e._e(),e._v(" "),t.row.is_show?e._e():r("div",{staticClass:"f-icontext c-warning",staticStyle:{"line-height":"1.4"}},[e._v("\n            用户已删除\n          ")]),e._v(" "),t.row.coach_show?e._e():r("div",{staticClass:"f-icontext c-warning",staticStyle:{"line-height":"1.4"}},[e._v("\n            "+e._s(e.$t("action.attendantName"))+"已删除\n          ")])]}}])}),e._v(" "),e.routesItem.auth.abnormalorder?r("el-table-column",{attrs:{prop:"status",label:"是否异常","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-operAbnormal",expression:"`${$route.name}-operAbnormal`"},{name:"show",rawName:"v-show",value:t.row.pay_type>1,expression:"scope.row.pay_type > 1"}],attrs:{size:"mini",type:t.row.abn_order_id?"success":"danger",plain:""},on:{click:function(r){return e.$router.push("/shop/abnormal/detail?id="+t.row.id+"&aid="+(t.row.abn_order_id||0))}}},[e._v(e._s(t.row.abn_order_id?"查看标记":e.$t("action.operAbnormal")))])]}}],null,!1,3280383050)}):e._e(),e._v(" "),r("el-table-column",{attrs:{label:"操作",width:"160",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(t){return[r("div",{staticClass:"table-operate"},[r("lb-button",{directives:[{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-view",expression:"`${$route.name}-view`"}],attrs:{size:"mini",type:"primary",plain:""},on:{click:function(r){return e.$router.push("/shop/order/detail?id="+t.row.id)}}},[e._v(e._s(e.$t("action.view")))]),e._v(" "),r("lb-button",{directives:[{name:"show",rawName:"v-show",value:[2,3,4,5,6,8].includes(t.row.pay_type),expression:"[2, 3, 4, 5, 6, 8].includes(scope.row.pay_type)"},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-transferOrder",expression:"`${$route.name}-transferOrder`"}],attrs:{size:"mini",type:"danger",plain:""},on:{click:function(r){return e.toShowDialog("transfer",t.row)}}},[e._v(e._s(e.$t("action.transferOrder")))]),e._v(" "),r("lb-button",{directives:[{name:"show",rawName:"v-show",value:[2,3,4,5,6].includes(3===t.row.pay_type&&(t.row.store_id||t.row.is_add)?5:t.row.pay_type),expression:"\n                [2, 3, 4, 5, 6].includes(\n                  scope.row.pay_type === 3 &&\n                    (scope.row.store_id || scope.row.is_add)\n                    ? 5\n                    : scope.row.pay_type\n                )\n              "},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-"+e.technicianStatusOperType[3===t.row.pay_type&&(t.row.store_id||t.row.is_add)?5:t.row.pay_type],expression:"\n                `${$route.name}-${\n                  technicianStatusOperType[\n                    scope.row.pay_type === 3 &&\n                    (scope.row.store_id || scope.row.is_add)\n                      ? 5\n                      : scope.row.pay_type\n                  ]\n                }`\n              "}],attrs:{size:"mini",type:"success",plain:""},on:{click:function(r){return e.toOperOrderItem({order_id:t.row.id,type:3===t.row.pay_type&&t.row.store_id?5:t.row.pay_type,is_add:t.row.is_add})}}},[e._v(e._s(e.$t("action."+e.technicianStatusOperType[3===t.row.pay_type&&(t.row.store_id||t.row.is_add)?5:t.row.pay_type])))]),e._v(" "),r("lb-button",{directives:[{name:"show",rawName:"v-show",value:t.row.admin_apply_refund,expression:"scope.row.admin_apply_refund"},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-operRefund",expression:"`${$route.name}-operRefund`"}],attrs:{size:"mini",type:"warning",plain:""},on:{click:function(r){return e.toShowDialog("refund",t.row)}}},[e._v(e._s(e.$t("action.operRefund")))])],1)]}}])})],1),e._v(" "),r("table",{directives:[{name:"show",rawName:"v-show",value:e.print,expression:"print"}],ref:"print",staticStyle:{"font-size":"12px"},attrs:{border:"0",cellspacing:"0",cellapdding:"0"}},[r("thead",[r("tr",e._l(e.printTableData[0],function(t,a){return r("th",{key:a,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)]),e._v(" "),r("tbody",e._l(e.printTableData[1],function(t,a){return r("tr",{key:a},e._l(t,function(t,a){return r("td",{key:a,staticStyle:{border:"1px solid"}},[e._v("\n            "+e._s(t)+"\n          ")])}),0)}),0)]),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.list.page,pageSize:e.searchForm.list.limit,total:e.total.list},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"list")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"list")}}}),e._v(" "),r("el-dialog",{attrs:{title:"转派"+e.$t("action.attendantName"),visible:e.showDialog.transfer,width:"1000px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"transfer",t)}}},[r("lb-tips",[e._v("\n        温馨提示：\n        "),r("div",{staticClass:"mt-sm"},[e._v("\n          1、本单用户实际支付服务项目费用"),r("span",{staticClass:"c-warning"},[e._v("¥"+e._s(e.transferForm.init_service_price))]),e._v("，因平台/"+e._s(e.$t("action.agentName"))+"可在服务管理里面为每位"+e._s(e.$t("action.attendantName"))+"设置不同的服务价格，因此存在服务项目费用有偏差，转派订单前需联系"+e._s(e.$t("action.attendantName"))+"说明此单实际服务项目费用情况\n        ")]),e._v(" "),r("div",{staticClass:"mt-sm"},[e._v("\n          2、转派给线下"+e._s(e.$t("action.attendantName"))+"的服务提成按照系统内最低比例核算，加钟订单遵循加钟比例设置提成\n        ")])]),e._v(" "),r("el-form",{ref:"transferSubForm",staticClass:"dialog-form",attrs:{model:e.transferForm,rules:e.transferSubFormRules,"label-width":"100px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"转派订单",prop:"coach_type"}},[r("el-radio-group",{on:{change:e.changeCoachType},model:{value:e.transferForm.coach_type,callback:function(t){e.$set(e.transferForm,"coach_type",t)},expression:"transferForm.coach_type"}},[r("el-radio",{attrs:{label:1}},[e._v("更换"+e._s(e.$t("action.attendantName")))]),e._v(" "),e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&e.routesItem.auth.delegated_coach?r("el-radio",{attrs:{label:2}},[e._v("委派"+e._s(e.$t("action.attendantName")))]):e._e()],1)],1),e._v(" "),2===e.transferForm.coach_type?r("block",[r("el-form-item",{attrs:{label:e.$t("action.attendantName")+"姓名",prop:"coach_name"}},[r("el-input",{attrs:{placeholder:"请输入线下"+e.$t("action.attendantName")+"姓名",maxlength:"15","show-word-limit":""},model:{value:e.transferForm.coach_name,callback:function(t){e.$set(e.transferForm,"coach_name",t)},expression:"transferForm.coach_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"联系电话",prop:"mobile"}},[r("el-input",{attrs:{placeholder:"请输入联系电话",maxlength:"11","show-word-limit":""},model:{value:e.transferForm.mobile,callback:function(t){e.$set(e.transferForm,"mobile",t)},expression:"transferForm.mobile"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"转派备注",prop:"text"}},[r("el-input",{attrs:{type:"textarea",rows:5,maxlength:"400","show-word-limit":"",resize:"none",placeholder:"若订单有其他特殊情况可单独备注在此处"},model:{value:e.transferForm.text,callback:function(t){e.$set(e.transferForm,"text",t)},expression:"transferForm.text"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"关联"+e.$t("action.agentName"),prop:"admin_id"}},[r("div",{staticClass:"flex-y-center"},[r("el-select",{attrs:{placeholder:"请选择"+e.$t("action.agentName"),filterable:"",clearable:""},model:{value:e.transferForm.admin_id,callback:function(t){e.$set(e.transferForm,"admin_id",t)},expression:"transferForm.admin_id"}},e._l(e.base_agent_coach,function(e){return r("el-option",{key:e.id,attrs:{label:e.agent_name,value:e.id}})}),1),e._v(" "),r("div",{staticClass:"lb-text-red-tips ml-md"},[e._v("\n                不关联"+e._s(e.$t("action.agentName"))+"则默认是平台的"+e._s(e.$t("action.attendantName"))+"\n              ")])],1)])],1):e._e()],1),e._v(" "),1===e.transferForm.coach_type?r("div",{staticStyle:{"padding-left":"30px"}},[r("el-form",{ref:"transferForm",attrs:{inline:!0,model:e.searchForm.transfer,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"coach_name"}},[r("el-input",{attrs:{placeholder:"请输入"+e.$t("action.attendantName")+"姓名"},model:{value:e.searchForm.transfer.coach_name,callback:function(t){e.$set(e.searchForm.transfer,"coach_name",t)},expression:"searchForm.transfer.coach_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"筛选排序",prop:"type"}},[r("el-select",{attrs:{placeholder:"请选择"},on:{change:function(t){return e.getTableDataList(1,"transfer")}},model:{value:e.searchForm.transfer.type,callback:function(t){e.$set(e.searchForm.transfer,"type",t)},expression:"searchForm.transfer.type"}},e._l(e.transfreTypeList,function(e){return r("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"transfer")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("transfer")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.transfer,expression:"loading.transfer"}],ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.transfer,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark","highlight-current-row":""},on:{"current-change":e.handleTableChange}},[r("el-table-column",{attrs:{prop:"coach_name",label:e.$t("action.attendantName")+"姓名"}}),e._v(" "),r("el-table-column",{attrs:{prop:"work_img",width:"150",label:e.$t("action.attendantName")+"头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("lb-image",{attrs:{src:e.row.work_img}})]}}],null,!1,1359628658)}),e._v(" "),r("el-table-column",{attrs:{prop:"distance",label:"距离"}}),e._v(" "),r("el-table-column",{attrs:{prop:"near_time",label:"最早可预约"}}),e._v(" "),r("el-table-column",{attrs:{prop:"price",label:"服务项目费用"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" ¥"+e._s(t.row.price)+" ")]}}],null,!1,3098777173)}),e._v(" "),r("el-table-column",{attrs:{prop:"admin_info.username",label:"所属"+e.$t("action.agentName")},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.admin_id?r("div",[e._v("平台")]):r("div",[r("div",[e._v(e._s(t.row.admin_info.username))]),e._v(" "),r("el-tag",{attrs:{size:"small",type:e.cityType[t.row.admin_info.city_type].type}},[e._v(e._s(e.cityType[t.row.admin_info.city_type].text)+"代理")])],1)]}}],null,!1,4099677802)}),e._v(" "),r("el-table-column",{attrs:{prop:"mobile",label:"联系电话"}})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.transfer.page,pageSize:e.searchForm.transfer.limit,total:e.total.transfer},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"transfer")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"transfer")}}})],1):e._e(),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.transfer=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.handleDialogConfirm}},[e._v("确 定")])],1)],1),e._v(" "),r("el-dialog",{staticClass:"lbmax-dialog",attrs:{title:e.$t("action.operRefund"),visible:e.showDialog.refund,width:"1000px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"refund",t)}}},[1*e.refundForm.car_price>0||1*e.refundForm.empty_order_cash>0?r("lb-tips",[r("div",{staticClass:"text-bold"},[e._v("退款注意事项：")]),e._v(" "),r("div",{staticClass:"mt-sm"},[e._v("\n          选择「全选项目」后才可选择退"+e._s(1*e.refundForm.car_price>0&&1*e.refundForm.empty_order_cash>0?"车费、空单费":1*e.refundForm.car_price>0?"车费":"空单费")+"。\n          "),r("span",{staticClass:"c-warning"},[e._v("\n            若选择退相应费用且退款金额设置为0，操作确定按钮后此单将取消，无法再次操作退款\n          ")])])]):e._e(),e._v(" "),e._l(e.refundForm.order,function(t,a){return r("block",{key:a},[t.order_goods.length>0?r("block",[0==a||a>0&&t.is_add!==e.refundForm.order[a-1].is_add?r("div",{staticClass:"c-title text-bold pb-lg",class:[{"mt-lg":0!==a}]},[e._v("\n            "+e._s(t.is_add?"加钟项目":"首单项目")+"\n          ")]):e._e(),e._v(" "),a>0&&t.is_add===e.refundForm.order[a-1].is_add?r("div",{staticClass:"mt-lg"}):e._e(),e._v(" "),e._l(t.order_goods,function(n,i){return r("div",{key:i,staticClass:"flex-warp pb-lg"},[r("div",{staticClass:"flex-y-center mr-lg",staticStyle:{height:"60px"}},[r("el-checkbox",{on:{change:function(t){return e.handleCheckOrderItem(a,i)}},model:{value:n.is_check,callback:function(t){e.$set(n,"is_check",t)},expression:"aitem.is_check"}})],1),e._v(" "),r("lb-image",{staticClass:"avatar radius-5",attrs:{src:n.goods_cover}}),e._v(" "),r("div",{staticClass:"flex-1 ml-md"},[r("div",{staticClass:"flex-between"},[r("div",{staticClass:"c-title"},[e._v(e._s(n.goods_name))]),e._v(" "),r("div",{style:{color:2==t.pay_type?e.primaryColor:[3,4,5].includes(t.pay_type)?e.subColor:6==t.pay_type?"#11C95E":"#333"}},[e._v("\n                  "+e._s(e.statusType[t.pay_type])+"\n                ")])]),e._v(" "),r("div",{staticClass:"flex-y-center",staticStyle:{"margin-top":"3px",height:"16px"}},[1*n.material_price>0?r("div",{staticClass:"flex-y-baseline f-caption c-title mr-md"},[e._v("\n                  "+e._s(e.$t("action.materialText"))+"：\n                  "),r("div",{staticClass:"c-warning"},[e._v("\n                    ¥"+e._s(n.material_price||0)+"\n                  ")])]):e._e(),e._v(" "),1*n.refund_comm_price>0?r("div",{staticClass:"flex-y-baseline f-caption c-title"},[e._v("\n                  手续费：\n                  "),r("div",{staticClass:"c-warning"},[e._v("\n                    ¥"+e._s(n.refund_comm_price||0)+"\n                  ")]),e._v(" "),r("div",{staticClass:"ml-md",staticStyle:{color:"#ff6e00"}},[e._v("\n                    扣除（项目费"+e._s(1*n.material_price>0?"+物料费":"")+"）的"+e._s(t.refund_comm_balance)+"%作为退款手续费\n                  ")])]):e._e()]),e._v(" "),r("div",{staticClass:"flex-between",staticStyle:{"margin-top":"3px"}},[r("div",{staticClass:"flex-y-baseline"},[r("div",{staticClass:"c-warning mr-md"},[e._v("\n                    ¥"+e._s(n.true_price||0)+"\n                  ")])]),e._v(" "),r("div",{staticClass:"c-caption"},[e._v("x"+e._s(n.can_refund_num))])]),e._v(" "),n.is_check?r("div",{staticClass:"flex-y-center f-caption mt-md"},[1*n.true_price>0?r("div",{staticClass:"mr-md"},[e._v("\n                  项目金额：\n                  "),r("el-input-number",{staticClass:"lb-input-number",staticStyle:{width:"80px"},attrs:{controls:!1,min:.01,max:n.true_price,precision:2,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(a,i)}},model:{value:n.refund_price,callback:function(t){e.$set(n,"refund_price",t)},expression:"aitem.refund_price"}})],1):e._e(),e._v(" "),1*n.material_price>0?r("div",{staticClass:"mr-md"},[e._v("\n                  + "+e._s(e.$t("action.materialText"))+"：\n                  "),r("el-input-number",{staticClass:"lb-input-number",staticStyle:{width:"80px"},attrs:{controls:!1,min:0,max:n.material_price,precision:2,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(a,i)}},model:{value:n.refund_material_price,callback:function(t){e.$set(n,"refund_material_price",t)},expression:"aitem.refund_material_price"}})],1):e._e(),e._v(" "),1*n.refund_comm_price>0?r("div",{staticClass:"mr-md"},[e._v("\n                  - 手续费：\n                  "),r("el-input-number",{staticClass:"lb-input-number",staticStyle:{width:"80px"},attrs:{controls:!1,min:0,max:n.refund_comm_price,precision:2,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(a,i)}},model:{value:n.refund_comm_cash,callback:function(t){e.$set(n,"refund_comm_cash",t)},expression:"aitem.refund_comm_cash"}})],1):e._e(),e._v(" "),r("div",{staticClass:"mr-lg"},[e._v("\n                  退款数量："),r("el-input-number",{staticStyle:{width:"90px"},attrs:{min:1,max:n.can_refund_num,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(a,i)}},model:{value:n.refund_num,callback:function(t){e.$set(n,"refund_num",t)},expression:"aitem.refund_num"}})],1),e._v(" "),r("div",{staticClass:"flex-y-center"},[e._v("\n                  累计退款金额：\n                  "),r("div",{staticClass:"c-warning text-bold"},[e._v("\n                    ¥"+e._s(n.total_refund_price)+"\n                  ")])])]):e._e()])],1)}),e._v(" "),r("div",{staticClass:"pt-md pb-md b-1px-t",staticStyle:{"margin-left":"30px"}},[e._v("\n            服务时间："+e._s(e._f("handleTime")(t.start_time))+" 至\n            "+e._s(e._f("handleTime")(t.end_time))+"\n          ")])],2):e._e()],1)}),e._v(" "),1*e.refundForm.car_price>0||1*e.refundForm.discount>0?r("div",{staticClass:"pt-md pb-md",staticStyle:{"margin-left":"30px","border-top":"1px dashed rgba(0, 0, 0, 0.1)"}},[1*e.refundForm.car_price>0?r("div",{staticClass:"flex-y-center mr-lg"},[e.refundForm.can_refund_num!==e.refundForm.all_refund_num?r("div",{staticClass:"flex-y-center"},[e._v("\n            车费：\n            "),r("div",{staticClass:"c-title"},[e._v("¥"+e._s(e.refundForm.car_price))])]):e._e(),e._v(" "),e.refundForm.can_refund_num===e.refundForm.all_refund_num?r("div",{staticClass:"flex-y-center"},[r("el-checkbox",{attrs:{label:e.refundForm.is_car_check?"车费退款金额：":"车费："},on:{change:function(t){return e.handleCheckOrderItem(-1)}},model:{value:e.refundForm.is_car_check,callback:function(t){e.$set(e.refundForm,"is_car_check",t)},expression:"refundForm.is_car_check"}}),e._v(" "),e.refundForm.is_car_check?r("el-input-number",{staticClass:"lb-input-number",staticStyle:{width:"80px"},attrs:{controls:!1,min:0,max:e.refundForm.car_price,precision:2,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(-2)}},model:{value:e.refundForm.refund_car_price,callback:function(t){e.$set(e.refundForm,"refund_car_price",t)},expression:"refundForm.refund_car_price"}}):r("div",{staticClass:"c-title"},[e._v("\n              ¥"+e._s(e.refundForm.car_price)+"\n              "),r("span",{staticClass:"ml-md lb-text-red-tips"},[e._v("勾选可退车费")])])],1):e._e()]):e._e(),e._v(" "),1*e.refundForm.discount>0?r("div",{staticClass:"mr-lg"},[e._v("\n          卡券抵扣：¥"+e._s(e.refundForm.discount)+"\n        ")]):e._e()]):e._e(),e._v(" "),1*e.refundForm.empty_order_cash>0&&e.refundForm.can_refund_num===e.refundForm.all_refund_num?r("div",{staticClass:"pt-md pb-md",staticStyle:{"margin-left":"30px","border-top":"1px dashed rgba(0, 0, 0, 0.1)"}},[r("div",{staticClass:"flex-y-center c-title mb-sm"},[r("div",{staticClass:"text-bold"},[e._v("扣费项")]),e._v(" "),e.refundForm.is_empty_check?r("div",{staticClass:"c-title ml-sm"},[e._v("\n            (空单费：¥"+e._s(e.refundForm.empty_order_cash)+")\n          ")]):e._e()]),e._v(" "),r("div",{staticClass:"flex-y-center"},[r("el-checkbox",{attrs:{label:e.refundForm.is_empty_check?"空单费退款金额：":"空单费："},on:{change:function(t){return e.handleCheckOrderItem(-1)}},model:{value:e.refundForm.is_empty_check,callback:function(t){e.$set(e.refundForm,"is_empty_check",t)},expression:"refundForm.is_empty_check"}}),e._v(" "),e.refundForm.is_empty_check?r("block",[r("el-input-number",{staticClass:"lb-input-number",staticStyle:{width:"80px"},attrs:{controls:!1,min:0,max:e.refundForm.empty_order_cash,precision:2,size:"mini"},on:{change:function(t){return e.handleCheckOrderItem(-3)}},model:{value:e.refundForm.refund_empty_cash,callback:function(t){e.$set(e.refundForm,"refund_empty_cash",t)},expression:"refundForm.refund_empty_cash"}}),e._v(" "),r("span",{staticClass:"lb-text-red-tips"},[e._v("\n              ，未退部分的空单费，将继续参与分佣\n            ")])],1):r("div",{staticClass:"c-title"},[e._v("\n            ¥"+e._s(e.refundForm.empty_order_cash)+"\n            "),r("span",{staticClass:"ml-md lb-text-red-tips"},[e._v("勾选可退空单费")])])],1)]):e._e(),e._v(" "),r("div",{staticClass:"flex-y-center pt-lg pb-sm",staticStyle:{"margin-left":"30px","border-top":"1px dashed rgba(0, 0, 0, 0.1)"}},[e.refundForm.can_refund_num>0?r("div",{staticClass:"mr-lg"},[r("el-checkbox",{attrs:{label:"全选项目"},on:{change:function(t){return e.handleCheckOrderItem(-1)}},model:{value:e.refundForm.is_check,callback:function(t){e.$set(e.refundForm,"is_check",t)},expression:"refundForm.is_check"}})],1):e._e(),e._v(" "),r("div",{staticClass:"flex-y-center"},[e._v("\n          总计退款金额：\n          "),r("div",{staticClass:"c-warning text-bold"},[e._v("\n            ¥"+e._s(e.refundForm.total_refund_price)+"\n          ")])])]),e._v(" "),r("div",{staticClass:"lb-text-red-tips",staticStyle:{"margin-left":"30px"}},[e._v("\n        总计退款金额 = A项目(项目费+"+e._s(e.$t("action.materialText"))+e._s(e.refundForm.after_service_can_refund&&e.refundForm.order[0].pay_type>5&&e.refundForm.order.filter(function(e){return 1*e.refund_comm_balance>0}).length>0?"-手续费":"")+") * 退款数量 + B项目(项目费+"+e._s(e.$t("action.materialText"))+e._s(e.refundForm.after_service_can_refund&&e.refundForm.order[0].pay_type>5&&e.refundForm.order.filter(function(e){return 1*e.refund_comm_balance>0}).length>0?"-手续费":"")+") * 退款数量 + ... + N项目(项目费+"+e._s(e.$t("action.materialText"))+e._s(e.refundForm.after_service_can_refund&&e.refundForm.order[0].pay_type>5&&e.refundForm.order.filter(function(e){return 1*e.refund_comm_balance>0}).length>0?"-手续费":"")+") * 退款数量\n        "+e._s(e.refundForm.car_price&&e.refundForm.is_car_check&&e.refundForm.can_refund_num===e.refundForm.all_refund_num?"+ 车费退款金额":"")+"\n        "+e._s(e.refundForm.empty_order_cash&&e.refundForm.can_refund_num===e.refundForm.all_refund_num?e.refundForm.is_empty_check?"- 空单费 + 空单费退款金额":"- 空单费":"")+"\n      ")]),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.refund=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.toConfirmRefund}},[e._v("确 定")])],1)],2)],1)],1)},staticRenderFns:[]};var k=r("C7Lr")(w,F,!1,function(e){r("eOGO"),r("9M/0")},"data-v-0d81763c",null);t.default=k.exports}});