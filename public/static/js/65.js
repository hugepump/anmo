webpackJsonp([65],{gZig:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=r("3cXf"),o=r.n(a),n=r("IHPB"),s=r.n(n),c=r("lC5x"),i=r.n(c),p=r("hRKE"),l=r.n(p),u=r("J0Oq"),_=r.n(u),m=r("4YfN"),b=r.n(m),v=r("bSIt"),d={data:function(){return{subForm:{app_logo:[],app_text:"",coach_app_text:"",web_coach_port:1,app_wechat_pay:1,map_secret:"",tencent_map_key:[]},subFormRules:{app_logo:{required:!0,type:"array",message:"请上传应用图标",trigger:"blur"},app_text:{required:!0,type:"string",message:"请输入应用名称",trigger:"blur"},coach_app_text:{required:!0,type:"string",message:"请输入应用名称",trigger:"blur"},web_coach_port:{required:!0,type:"number",message:"请选择",trigger:"blur"},app_wechat_pay:{required:!0,type:"number",message:"请选择",trigger:"blur"},map_secret:{required:!0,validator:this.$reg.isNotNull,text:"腾讯地图key",reg_type:2,trigger:"blur"},tencent_map_key:{required:!0,validator:function(t,e,r){for(var a in e){var o=1*a+1,n=e[a].secret;if(!(n=n?n.replace(/(^\s*)|(\s*$)/g,""):""))return void r(new Error("第"+o+"条数据：请输入"+t.text))}e.filter(function(t){return t.secret}).length===e.length&&r()},text:"腾讯地图key",trigger:"blur"}}}},created:function(){this.getFormInfo()},computed:b()({},Object(v.e)({routesItem:function(t){return t.routes}})),methods:{getFormInfo:function(){var t=this;return _()(i.a.mark(function e(){var r,a,o,n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.system.configInfo();case 2:if(r=e.sent,a=r.code,o=r.data,200===a){e.next=7;break}return e.abrupt("return");case 7:for(n in o.app_logo=o.app_logo?[{url:o.app_logo}]:[],o.tencent_map_key=o.tencent_map_key&&o.tencent_map_key.length>0&&"object"===l()(o.tencent_map_key)?o.tencent_map_key.map(function(t){return{secret:t}}):[{secret:""}],t.subForm)t.subForm[n]=o[n];case 10:case"end":return e.stop()}},e,t)}))()},getCover:function(t,e){this.subForm[e]=t},selectedFiles:function(t,e){var r;(r=this.subForm[e]).push.apply(r,s()(t))},moveFiles:function(t,e){this.subForm[e]=t},toAddItem:function(t,e){var r=this;return _()(i.a.mark(function a(){return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:2===t?r.subForm.tencent_map_key.splice(e,1):r.subForm.tencent_map_key.push({secret:""});case 1:case"end":return a.stop()}},a,r)}))()},submitFormInfo:function(){var t=this,e=!0;if(this.$refs.subForm.validate(function(t){t||(e=!1)}),e){var r=JSON.parse(o()(this.subForm));r.app_logo=r.app_logo[0].url,r.tencent_map_key=r.tencent_map_key.map(function(t){return t.secret}),this.$api.system.configUpdate(r).then(function(e){200===e.code&&t.$message.success(t.$t("tips.successSub"))})}}}},f={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"lb-system-employ"},[r("top-nav"),t._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",staticClass:"config-form",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"160px"},nativeOn:{submit:function(t){t.preventDefault()}}},[r("el-form-item",{attrs:{label:"应用图标",prop:"app_logo"}},[r("lb-cover",{attrs:{fileList:t.subForm.app_logo},on:{selectedFiles:function(e){return t.getCover(e,"app_logo")}}}),t._v(" "),r("lb-tool-tips",[t._v("图片建议尺寸：400 * 400，用于登录页面展示")])],1),t._v(" "),r("el-form-item",{attrs:{label:"应用名称"+(t.routesItem.auth.coachport?" (用户端)":""),prop:"app_text"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":"",placeholder:"请输入应用名称"},model:{value:t.subForm.app_text,callback:function(e){t.$set(t.subForm,"app_text",e)},expression:"subForm.app_text"}}),t._v(" "),r("lb-tool-tips",[t._v("用于"+t._s(t.routesItem.auth.coachport?"用户端":"")+"登录页面展示")])],1),t._v(" "),t.routesItem.auth.coachport?r("block",[r("el-form-item",{attrs:{label:"应用名称 ("+t.$t("action.attendantName")+"端)",prop:"coach_app_text"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":"",placeholder:"请输入应用名称"},model:{value:t.subForm.coach_app_text,callback:function(e){t.$set(t.subForm,"coach_app_text",e)},expression:"subForm.coach_app_text"}}),t._v(" "),r("lb-tool-tips",[t._v("用于"+t._s(t.$t("action.attendantName"))+"端登录页面展示")])],1),t._v(" "),r("el-form-item",{attrs:{label:"切换"+t.$t("action.attendantName")+"端",prop:"web_coach_port"}},[r("el-radio-group",{model:{value:t.subForm.web_coach_port,callback:function(e){t.$set(t.subForm,"web_coach_port",e)},expression:"subForm.web_coach_port"}},[r("el-radio",{attrs:{label:1}},[t._v(t._s(t.$t("action.ON")))]),t._v(" "),r("el-radio",{attrs:{label:0}},[t._v(t._s(t.$t("action.OFF")))])],1),t._v(" "),r("lb-tool-tips",[t._v("选择开启，"+t._s(t.$t("action.attendantName"))+"可在用户端切换"+t._s(t.$t("action.attendantName"))+"端\n          ")])],1),t._v(" "),t.routesItem.auth.app?r("el-form-item",{attrs:{label:"APP端是否开启微信支付",prop:"web_coach_port"}},[r("el-radio-group",{model:{value:t.subForm.app_wechat_pay,callback:function(e){t.$set(t.subForm,"app_wechat_pay",e)},expression:"subForm.app_wechat_pay"}},[r("el-radio",{attrs:{label:1}},[t._v(t._s(t.$t("action.ON")))]),t._v(" "),r("el-radio",{attrs:{label:0}},[t._v(t._s(t.$t("action.OFF")))])],1),t._v(" "),r("lb-tool-tips",[t._v("选择关闭，APP端不可使用微信支付功能。主要用于APP提交审核时无法正常使用微信支付导致审核被驳回\n          ")])],1):t._e()],1):t._e(),t._v(" "),r("el-form-item",{attrs:{label:"腾讯地图key",prop:"map_secret"}},[r("el-input",{attrs:{placeholder:"请输入腾讯地图key"},model:{value:t.subForm.map_secret,callback:function(e){t.$set(t.subForm,"map_secret",e)},expression:"subForm.map_secret"}}),t._v(" "),r("lb-tool-tips",[t._v("请输入腾讯地图key，输入错误会影响系统的正常使用，谨慎修改\n        ")]),t._v(" "),r("div",{staticClass:"mt-md lb-text-red-tips"},[t._v("\n          系统主要需要使用腾讯地图的“ip定位”、“地点搜索”、“逆地址解析”、“路线规划：驾车”功能，超过限制额度后，对应相关功能将无法使用\n          "),r("div",[t._v("\n            超额或封禁后可重新申请一个账号再重新配置，保存配置后需要点击页面右上清除缓存，手机端重新进入系统或刷新页面后可正常使用上述功能\n          ")]),t._v(" "),r("div",{staticClass:"mt-sm"},[r("a",{staticClass:"c-link cursor-pointer",attrs:{href:"https://docs.qq.com/doc/DWkNrWGVRWEVtTGV4",target:"_blank"}},[t._v("如何配置腾讯地图Key？")])])])],1),t._v(" "),r("el-form-item",{attrs:{label:"地址搜索/解析配置",prop:"tencent_map_key"}},[r("div",{staticClass:"mt-md mb-md lb-text-red-tips"},[t._v("\n          系统主要需要使用腾讯地图的“地点搜索”、“逆地址解析”等功能，保存配置后需要点击页面右上清除缓存\n          "),r("div",[t._v("\n            同一个账号创建的应用共享额度，因此配置的Key需是不同账号下申请的腾讯地图Key才能有效避免额度超额的问题\n          ")]),t._v(" "),r("div",[t._v("\n            当其中一个Key超过限制额度后，系统会自动调取配置中的未超额的Key来进行搜索/解析\n          ")])]),t._v(" "),t._l(t.subForm.tencent_map_key,function(e,a){return r("div",{key:a,staticClass:"mb-md"},[r("el-input",{staticClass:"mini",attrs:{placeholder:"请输入腾讯地图Key"},model:{value:e.secret,callback:function(r){t.$set(e,"secret",r)},expression:"item.secret"}}),t._v(" "),t.subForm.tencent_map_key.length>1||1===t.subForm.tencent_map_key.length&&0!==a?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"danger",size:"mini",plain:"",icon:"el-icon-delete"},on:{click:function(e){return t.toAddItem(2,a)}}},[t._v("删除")]):t._e(),t._v(" "),a===t.subForm.tencent_map_key.length-1&&t.subForm.tencent_map_key.length<20?r("lb-button",{staticStyle:{"margin-left":"16px"},attrs:{type:"primary",size:"mini",plain:"",icon:"el-icon-plus"},on:{click:function(e){return t.toAddItem(1)}}},[t._v("新增")]):t._e()],1)})],2),t._v(" "),r("el-form-item",[r("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.submitFormInfo}},[t._v(t._s(t.$t("action.submit")))])],1)],1)],1)],1)},staticRenderFns:[]};var h=r("C7Lr")(d,f,!1,function(t){r("yBVm")},"data-v-9706139c",null);e.default=h.exports},yBVm:function(t,e){}});