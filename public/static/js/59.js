webpackJsonp([59],{"+knM":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("3cXf"),i=a.n(r),s=a("lC5x"),n=a.n(s),l=a("J0Oq"),o=a.n(l),c=a("4YfN"),m=a.n(c),u=a("bSIt"),p=a("PxTW"),_=a.n(p),d={data:function(){return{statusText:{2:{type:"info",text:"审核中"},4:{type:"",text:"审核通过"},3:{type:"danger",text:"已驳回"}},ratioSex:{0:"不限",1:"只限男生",2:"只限女生",3:"男女对半"},moneyType:{1:"免费",2:"请客",3:"AA"},pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(_()(_()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},subForm:{id:0,status:4,text:""},subFormRules:{status:{required:!0,type:"number",message:"请选择",trigger:"blur"}},searchForm:{page:1,limit:10,status:0,start_time:"",end_time:"",create_name:"",type_pid:"",type_id:""},loading:!1,tableData:[],total:0,count:{},industryList:[],showDialog:!1,detail:{img_list:[],status:0,content:[]}}},created:function(){this.partnerTypeSelect(),this.getTableDataList(1)},computed:m()({},Object(u.e)({routesItem:function(e){return e.routes}})),methods:{resetForm:function(e){this.$refs[e].resetFields(),this.getTableDataList(1)},handleSizeChange:function(e){this.searchForm.limit=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){this.searchForm.page=e,this.getTableDataList()},submitFormInfo:function(){var e=this;return o()(n.a.mark(function t(){var a,r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.market.partnerCheck(e.subForm);case 2:if(a=t.sent,r=a.code,a.data,200===r){t.next=7;break}return t.abrupt("return");case 7:e.$message.success(e.$t("tips.successOper")),e.showDialog=!1,e.getTableDataList();case 10:case"end":return t.stop()}},t,e)}))()},partnerTypeSelect:function(){var e=this;return o()(n.a.mark(function t(){var a,r,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.market.partnerTypeSelect();case 2:if(a=t.sent,r=a.code,i=a.data,200===r){t.next=7;break}return t.abrupt("return");case 7:i.map(function(e){0===e.children.length&&delete e.children}),i.unshift({name:"全部",id:0}),e.industryList=i;case 10:case"end":return t.stop()}},t,e)}))()},toShowDialog:function(e){var t=this;return o()(n.a.mark(function a(){var r,i,s,l;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.$api.market.getPartnerInfo({id:e});case 2:if(r=a.sent,i=r.code,s=r.data,200===i){a.next=7;break}return a.abrupt("return");case 7:l=[],s.img.split(",").forEach(function(e){l.push({url:e})}),s.img_list=l,s.field.unshift({name:"手机号"}),t.detail=s,t.subForm={id:e,status:4,text:""},t.showDialog=!0;case 14:case"end":return a.stop()}},a,t)}))()},toChange:function(e){var t=this;return o()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.searchForm.status=e,t.getTableDataList(1);case 2:case"end":return a.stop()}},a,t)}))()},getTableDataList:function(e){var t=this;return o()(n.a.mark(function a(){var r,s,l,o,c,m,u,p,_,d,v;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e&&(t.searchForm.page=e),t.tableData=[],t.loading=!0,r=JSON.parse(i()(t.searchForm)),(s=r.start_time)&&s.length>1?(r.start_time=s[0]/1e3,r.end_time=s[1]/1e3):(r.start_time="",r.end_time=""),-1===r.status&&(r.is_update=1,delete r.status),r.type_id=r.type_id[r.type_id.length-1],a.next=10,t.$api.market.getPartnerList(r);case 10:if(l=a.sent,o=l.code,c=l.data,t.loading=!1,200===o){a.next=16;break}return a.abrupt("return");case 16:c.data.map(function(e){e.text=e.text?e.text.replace(/\n/g,"<br>"):"没有填写评论内容哦"}),m=c.all_count,u=c.refuse_count,p=c.check_count,_=void 0===p?0:p,d=c.pass_count,v=c.total,t.tableData=c.data,t.total=v,t.count={all:m,nopass:u,ing:_,pass:d};case 21:case"end":return a.stop()}},a,t)}))()},confirmDel:function(e,t){var a=this;this.$confirm("你确认要删除吗？",this.$t("tips.reminder"),{confirmButtonText:this.$t("action.comfirm"),cancelButtonText:this.$t("action.cancel"),type:"warning"}).then(function(){a.updateItem(e,t)}).catch(function(){})},updateItem:function(e,t){var a=this;return o()(n.a.mark(function r(){var i;return n.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:i=-1===t?"partnerDel":"commentCheck",a.$api.market[i]({id:e,status:t}).then(function(e){if(200===e.code)a.$message.success(a.$t(-1===t?"tips.successDel":"tips.successOper")),-1===t&&(a.searchForm.page=a.searchForm.page<Math.ceil((a.total-1)/a.searchForm.limit)?a.searchForm.page:Math.ceil((a.total-1)/a.searchForm.limit)),a.getTableDataList();else{if(-1===t)return;a.getTableDataList()}});case 2:case"end":return r.stop()}},r,a)}))()}},filters:{handleTime:function(e,t){return 1===t?_()(1e3*e).format("YYYY-MM-DD"):2===t?_()(1e3*e).format("HH:mm:ss"):_()(1e3*e).format("YYYY-MM-DD HH:mm:ss")},handleMinute:function(e){return{30:"半小时",60:"1小时",120:"2小时"}[e]}}},v={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"lb-partner-examine"},[a("top-nav"),e._v(" "),a("div",{staticClass:"page-main"},[a("el-row",{staticClass:"page-top-operate"},[a("el-button",{attrs:{type:0===e.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(t){return e.toChange(0)}}},[e._v("全部（"+e._s(e.count.all||0)+"）")]),e._v(" "),a("el-badge",{staticStyle:{margin:"14px 12px 0 0"},style:{marginRight:e.count.ing>99?"32px":e.count.ing>9?"22px":"12px"},attrs:{value:e.count.ing>0?e.count.ing:"",max:99}},[a("el-button",{staticStyle:{"margin-right":"0"},attrs:{type:2===e.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(t){return e.toChange(2)}}},[e._v("审核中"),0===e.count.ing?a("span",[e._v("（0）")]):e._e()])],1),e._v(" "),a("el-button",{attrs:{type:4===e.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(t){return e.toChange(4)}}},[e._v("审核通过（"+e._s(e.count.pass||0)+"）")]),e._v(" "),a("el-button",{attrs:{type:3===e.searchForm.status?"primary":"",plain:"",size:"medium"},on:{click:function(t){return e.toChange(3)}}},[e._v("已驳回（"+e._s(e.count.nopass||0)+"）")])],1),e._v(" "),a("el-row",{staticClass:"page-search-form"},[a("el-form",{ref:"searchForm",attrs:{inline:!0,model:e.searchForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{attrs:{label:"输入查询",prop:"create_name"}},[a("el-input",{attrs:{placeholder:"请输入发布人昵称"},model:{value:e.searchForm.create_name,callback:function(t){e.$set(e.searchForm,"create_name",t)},expression:"searchForm.create_name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"发布时间",prop:"start_time"}},[a("el-date-picker",{attrs:{type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"timestamp","picker-options":e.pickerOptions,"default-time":["00:00:00","23:59:59"]},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.start_time,callback:function(t){e.$set(e.searchForm,"start_time",t)},expression:"searchForm.start_time"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"组局分类",prop:"type_id"}},[a("el-cascader",{attrs:{placeholder:"请选择",options:e.industryList,props:{label:"name",value:"id",checkStrictly:!0},filterable:""},on:{change:function(t){return e.getTableDataList(1)}},model:{value:e.searchForm.type_id,callback:function(t){e.$set(e.searchForm,"type_id",t)},expression:"searchForm.type_id"}})],1),e._v(" "),a("el-form-item",[a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1)}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),a("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("searchForm")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[a("el-table-column",{attrs:{prop:"id",label:"ID"}}),e._v(" "),a("el-table-column",{attrs:{prop:"cover",label:"封面图"},scopedSlots:e._u([{key:"default",fn:function(e){return[a("lb-image",{attrs:{src:e.row.cover}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"title",label:"活动名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"type_name",label:"活动分类"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_name",label:"局主"}}),e._v(" "),a("el-table-column",{attrs:{prop:"money_type",label:"请客形式"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-tag",[e._v(e._s(e.moneyType[t.row.money_type]))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"partner_money",label:"发布费"}}),e._v(" "),a("el-table-column",{attrs:{prop:"create_time",label:"发布时间","min-width":"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("p",[e._v(e._s(e._f("handleTime")(t.row.create_time,1)))]),e._v(" "),a("p",[e._v(e._s(e._f("handleTime")(t.row.create_time,2)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"status",label:"状态","min-width":"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticStyle:{display:"inline-block"}},[a("el-tag",{attrs:{size:"small",type:e.statusText[t.row.status].type}},[e._v("\n              "+e._s(e.statusText[t.row.status].text)+"\n            ")]),e._v(" "),1==t.row.is_cancel?a("div",{staticClass:"c-warning text-center f-icontext"},[e._v("\n              已取消\n            ")]):e._e()],1)]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作",width:"160"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",{staticClass:"table-operate"},[a("lb-button",{directives:[{name:"show",rawName:"v-show",value:2!==t.row.status||1===t.row.is_cancel,expression:"scope.row.status !== 2 || scope.row.is_cancel === 1"},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-view",expression:"`${$route.name}-view`"}],attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(a){return e.toShowDialog(t.row.id)}}},[e._v(e._s(e.$t("action.view")))]),e._v(" "),a("lb-button",{directives:[{name:"show",rawName:"v-show",value:2===t.row.status&&1!==t.row.is_cancel,expression:"scope.row.status === 2 && scope.row.is_cancel !== 1"},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-examine",expression:"`${$route.name}-examine`"}],attrs:{size:"mini",plain:"",type:"primary"},on:{click:function(a){return e.toShowDialog(t.row.id)}}},[e._v(e._s(e.$t("action.examine")))]),e._v(" "),a("lb-button",{directives:[{name:"show",rawName:"v-show",value:2!==t.row.status||1===t.row.is_cancel,expression:"scope.row.status !== 2 || scope.row.is_cancel === 1"},{name:"hasPermi",rawName:"v-hasPermi",value:e.$route.name+"-delete",expression:"`${$route.name}-delete`"}],attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(a){return e.confirmDel(t.row.id,-1)}}},[e._v(e._s(e.$t("action.delete")))])],1)]}}])})],1),e._v(" "),a("lb-page",{attrs:{batch:!1,page:e.searchForm.page,pageSize:e.searchForm.limit,total:e.total},on:{handleSizeChange:e.handleSizeChange,handleCurrentChange:e.handleCurrentChange}}),e._v(" "),a("el-dialog",{attrs:{title:2==e.detail.status&&1!==e.detail.is_cancel?"申请详情":"活动详情",visible:e.showDialog,width:"800px",center:"",top:"4vh"},on:{"update:visible":function(t){e.showDialog=t}}},[a("el-form",{ref:"subForm",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"180px",size:"mini"}},[a("el-form-item",{attrs:{label:"组局方式：",prop:"user_id"}},[a("div",[a("el-tag",[e._v(e._s(1==e.detail.is_open?"公开局":"私密局"))])],1)]),e._v(" "),a("el-form-item",{attrs:{label:"组局类型：",prop:"type_name"}},[a("div",[e._v(e._s(e.detail.type_name))])]),e._v(" "),a("el-form-item",{attrs:{label:"组局标题：",prop:"title"}},[a("div",[e._v(e._s(e.detail.title))])]),e._v(" "),a("el-form-item",{attrs:{label:"组局封面：",prop:"cover"}},[a("lb-cover",{attrs:{fileList:[{url:e.detail.cover}],fileType:"image",type:"more",fileSize:1,isToDel:!1}})],1),e._v(" "),a("el-form-item",{attrs:{label:"详情图：",prop:"img_list"}},[a("lb-cover",{attrs:{fileList:e.detail.img_list,fileType:"image",type:"more",fileSize:e.detail.img_list.length,isToDel:!1}})],1),e._v(" "),a("el-form-item",{attrs:{label:"图文详情：",prop:"content"}},[a("div",[0==e.detail.content.length?a("div",[e._v("暂无")]):a("block",e._l(e.detail.content,function(t,r){return a("block",{key:r},[1==t.type?a("div",{staticStyle:{"white-space":"pre-line"}},[e._v("\n                  "+e._s(t.value)+"\n                ")]):a("div",{staticStyle:{width:"300px"}},[a("lb-cover",{attrs:{fileList:[{url:t.value}],fileType:"image",type:"more",fileSize:1,isToDel:!1}})],1)])}),1)],1)]),e._v(" "),a("el-form-item",{attrs:{label:"组局起止时间：",prop:"start_time"}},[a("div",[e._v("\n            "+e._s(e._f("handleTime")(e.detail.start_time))+" -\n            "+e._s(e._f("handleTime")(e.detail.end_time))+"\n          ")])]),e._v(" "),a("el-form-item",{attrs:{label:"报名截止时间：",prop:"type_name"}},[a("div",[e._v(e._s(e._f("handleTime")(e.detail.join_end_time)))])]),e._v(" "),a("el-form-item",{attrs:{label:"组局场所：",prop:"address"}},[a("div",[e._v(e._s(e.detail.address))]),e._v(" "),a("div",[e._v(e._s(e.detail.address_info))])]),e._v(" "),a("el-form-item",{attrs:{label:"报名字段：",prop:"field"}},e._l(e.detail.field,function(t,r){return a("el-tag",{key:r,staticClass:"mr-md"},[e._v(e._s(t.name))])}),1),e._v(" "),e.detail.phone?a("el-form-item",{attrs:{label:"局主手机号：",prop:"phone"}},[a("div",[e._v(e._s(e.detail.phone))])]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"报名人数：",prop:"sign_num"}},[a("div",[e._v(e._s(e.detail.sign_num))])]),e._v(" "),a("el-form-item",{attrs:{label:"是否限制参与人年龄：",prop:"limit_age"}},[a("div",[a("el-tag",{attrs:{type:1==e.detail.limit_age?"":"info"}},[e._v(e._s(1==e.detail.limit_age?"是":"否"))])],1)]),e._v(" "),e.detail.limit_age?a("el-form-item",{attrs:{label:"参与人年龄：",prop:"min_age"}},[a("div",[e._v(e._s(e.detail.min_age+" - "+e.detail.max_age))])]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"参与人性别比例：",prop:"limit_sex"}},[a("div",[e._v(e._s(e.ratioSex[e.detail.limit_sex]))])]),e._v(" "),a("el-form-item",{attrs:{label:"成员资料是否可见：",prop:"show_user_info"}},[a("div",[a("el-tag",{attrs:{type:1==e.detail.show_user_info?"":"info"}},[e._v(e._s(1==e.detail.show_user_info?"是":"否"))])],1)]),e._v(" "),a("el-form-item",{attrs:{label:"是否要审核：",prop:"is_check"}},[a("div",[a("el-tag",{attrs:{type:1==e.detail.is_check?"":"info"}},[e._v(e._s(1==e.detail.is_check?"是":"否"))])],1)]),e._v(" "),a("el-form-item",{attrs:{label:"请客形式：",prop:"money_type"}},[a("div",[e._v(e._s(e.moneyType[e.detail.money_type]))])]),e._v(" "),1*e.detail.join_price>0?a("el-form-item",{attrs:{label:"人均：",prop:"join_price"}},[a("div",[e._v(e._s(e.detail.join_price)+"元")])]):e._e(),e._v(" "),a("el-form-item",{attrs:{label:"签到开始时间：",prop:"sign_start_minute"}},[a("div",[e._v(e._s(e._f("handleMinute")(e.detail.sign_start_minute)))])]),e._v(" "),e.detail.status>2||2==e.detail.status&&1==e.detail.is_cancel?a("el-form-item",{attrs:{label:"审核状态："}},[a("el-tag",{attrs:{size:"small",type:e.statusText[e.detail.status].type}},[e._v("\n            "+e._s(e.statusText[e.detail.status].text)+"\n          ")])],1):e._e(),e._v(" "),e.detail.partner_check_time?a("el-form-item",{attrs:{label:"审核时间：",prop:"partner_check_time"}},[a("div",[e._v(e._s(e._f("handleTime")(e.detail.partner_check_time)))])]):e._e(),e._v(" "),e.detail.partner_check_text?a("el-form-item",{attrs:{label:"审核原因：",prop:"partner_check_text"}},[a("div",{staticClass:"pre-wrap"},[e._v(e._s(e.detail.partner_check_text))])]):e._e()],1),e._v(" "),a("div",{staticClass:"space-xl"}),e._v(" "),2==e.detail.status&&1!==e.detail.is_cancel?a("el-form",{ref:"subForm",staticClass:"dialog-form",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"审核",prop:"status"}},[a("el-radio-group",{model:{value:e.subForm.status,callback:function(t){e.$set(e.subForm,"status",t)},expression:"subForm.status"}},[a("el-radio",{attrs:{label:4}},[e._v("同意")]),e._v(" "),a("el-radio",{attrs:{label:3}},[e._v("驳回")])],1)],1),e._v(" "),3==e.subForm.status?a("el-form-item",{attrs:{label:"审核原因",prop:"text"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",rows:10,maxlength:"300",resize:"none","show-word-limit":"",placeholder:"请输入审核原因"},model:{value:e.subForm.text,callback:function(t){e.$set(e.subForm,"text",t)},expression:"subForm.text"}})],1):e._e()],1):e._e(),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.showDialog=!1}}},[e._v("取 消")]),e._v(" "),2==e.detail.status&&1!==e.detail.is_cancel?a("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:e.submitFormInfo}},[e._v("确 定")]):e._e()],1)],1)],1)],1)},staticRenderFns:[]};var f=a("C7Lr")(d,v,!1,function(e){a("cYWq")},"data-v-abb6818c",null);t.default=f.exports},cYWq:function(e,t){}});