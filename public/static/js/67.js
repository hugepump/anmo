webpackJsonp([67],{BVGa:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=r("3cXf"),s=r.n(a),n=r("rVsN"),i=r.n(n),l=r("KH7x"),o=r.n(l),u=r("4YfN"),c=r.n(u),m=r("lC5x"),d=r.n(m),b=r("J0Oq"),_=r.n(b),p=r("bSIt"),v=r("PxTW"),h=r.n(v),f={data:function(){var e=this,t=function(t,r,a){var s=e.max_balance,n=e.routesItem.userInfo.is_admin,i=e.subForm.admin_id,l=n&&!(void 0===i?0:i)?100:1*s;""!==r&&(!/^(?:0|[1-9][0-9]?|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2}))|100)$/.test(r)||1*r>l)?a(new Error("请输入正确的"+t.text+"，0-"+l+"，支持2位小数")):a()};return{pickerOptions:{disabledDate:function(e){return e.getTime()>1e3*(h()(h()(Date.now()).format("YYYY-MM-DD")).unix()+86400-1)}},navTitle:"",cityType:{3:{type:"success",text:"省"},1:{type:"primary",text:"市"},2:{type:"danger",text:"区县"}},base_agent:[],reseller_cash_type:"",max_balance:"",have_user_id:!1,searchForm:{user:{page:1,limit:10,nickName:""}},loading:{user:!1},tableData:{user:[]},total:{user:0},showDialog:{user:!1},multipleSelection:[],currentRow:{},subForm:{id:"",user_id:"",nickName:"",user_name:"",true_user_name:"",mobile:"",admin_id:"",admin_name:"",balance:"",level_balance:"",text:""},subFormRules:{user_id:{required:!0,type:"number",message:"请选择关联用户",trigger:"blur"},user_name:{required:!0,validator:this.$reg.isNotNull,text:this.$t("action.resellerName")+"姓名",reg_type:2,trigger:"blur"},true_user_name:{required:!0,validator:this.$reg.isNotNull,text:"真实姓名",reg_type:2,trigger:"blur"},mobile:{required:!0,validator:this.$reg.isTel,text:"手机号",reg_type:2,trigger:"blur"},balance:{required:!1,validator:t,text:"一级提成比例",trigger:"blur"},level_balance:{required:!1,validator:t,text:"二级提成比例",trigger:"blur"}}}},created:function(){var e=this;return _()(d.a.mark(function t(){var r,a,s,n,i,l,o;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=e.$route.query.id,a=e.routesItem.userInfo,s=a.is_admin,n=a.id,i=a.admin_id,l=void 0===i?0:i,o=a.agent_name,n=l||n,e.subForm.admin_id=s?"":n,e.subForm.admin_name=s?"":o,t.next=7,e.getBaseInfo();case 7:if(!r){t.next=11;break}return e.subForm.id=r,t.next=11,e.getDetail(r);case 11:e.navTitle=e.$t(r?"menu.DistributionEdit":"menu.DistributionAdd");case 12:case"end":return t.stop()}},t,e)}))()},computed:c()({},Object(p.e)({routesItem:function(e){return e.routes}})),methods:{getBaseInfo:function(){var e=this;return _()(d.a.mark(function t(){var r,a,s,n;return d.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.a.all([e.$api.agent.adminSelect({reseller_auth:1}),e.$api.system.configInfo()]);case 2:r=t.sent,a=o()(r,2),s=a[0],n=a[1],e.base_agent=s.data,e.reseller_cash_type=n.data.reseller_cash_type,e.max_balance=n.data.agent_reseller_max_balance;case 9:case"end":return t.stop()}},t,e)}))()},getDetail:function(e){var t=this;return _()(d.a.mark(function r(){var a,s,n;return d.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,t.$api.distribution.resellerInfo({id:e});case 2:for(n in a=r.sent,(s=a.data).admin_id=s.admin_id||"",s.balance=1*s.balance==-1?"":s.balance,s.level_balance=1*s.level_balance==-1?"":s.level_balance,t.subForm)t.subForm[n]=s[n];t.have_user_id=s.id&&s.user_id;case 9:case"end":return r.stop()}},r,t)}))()},toShowDialog:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return _()(d.a.mark(function a(){return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(r=JSON.parse(s()(r)),"user"!==e||!t.have_user_id){a.next=3;break}return a.abrupt("return");case 3:return t.currentRow={},t.searchForm[e].nickName="",a.next=7,t.getTableDataList(1,e);case 7:t.showDialog[e]=!t.showDialog[e];case 8:case"end":return a.stop()}},a,t)}))()},resetForm:function(e){var t=e+"Form";this.$refs[t].resetFields(),this.getTableDataList(1,e)},handleSizeChange:function(e,t){this.searchForm[t].limit=e,this.handleCurrentChange(1,t)},handleCurrentChange:function(e,t){this.searchForm[t].page=e,this.getTableDataList("",t)},getTableDataList:function(e,t){var r=this;return _()(d.a.mark(function a(){var n,i,l,o,u,c,m;return d.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return e&&(r.searchForm[t].page=e),r.tableData[t]=[],r.loading[t]=!0,n=JSON.parse(s()(r.searchForm[t])),i={user:{methodKey:"distribution",methodModel:"noresellerUserList"}}[t],l=i.methodKey,o=i.methodModel,a.next=8,r.$api[l][o](n);case 8:if(u=a.sent,c=u.code,m=u.data,r.loading[t]=!1,200===c){a.next=14;break}return a.abrupt("return");case 14:r.tableData[t]=m.data,r.total[t]=m.total;case 16:case"end":return a.stop()}},a,r)}))()},handleSelectionChange:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};arguments[1];e=JSON.parse(s()(e)),this.currentRow=e},handleDialogConfirm:function(e){if(null!==this.currentRow&&this.currentRow.id){var t=this.currentRow,r=t.id,a=void 0===r?0:r,s=t.nickName,n=void 0===s?"":s,i=t.phone,l=void 0===i?"":i;"user"===e&&(this.subForm.user_id=a,this.subForm.nickName=n,!this.subForm.mobile&&l&&(this.subForm.mobile=l)),this.showDialog[e]=!1}else this.$message.error("user"===e?"请选择用户":"请选择"+this.$t("action.agentName"))},submitFormInfo:function(e){var t=this,r=!0;if(this.$refs[e+"Form"].validate(function(e){e||(r=!1)}),r){var a=JSON.parse(s()(this[e+"Form"]));a.balance=""===a.balance?"-1":a.balance,a.level_balance=""===a.level_balance?"-1":a.level_balance,delete a.nickName,delete a.admin_name;var n=a.id?"resellerUpdate":"applyReseller";this.$api.distribution[n](a).then(function(e){200===e.code&&(t.$message.success(t.$t(a.id?"tips.successRev":"tips.successSub")),t.$router.back(-1))})}}},filters:{handleTime:function(e,t){return 1===t?h()(1e3*e).format("YYYY-MM-DD"):2===t?h()(1e3*e).format("HH:mm:ss"):h()(1e3*e).format("YYYY-MM-DD HH:mm:ss")}}},g={render:function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"lb-distribution-edit"},[r("top-nav",{attrs:{title:e.navTitle,isBack:!0}}),e._v(" "),r("div",{staticClass:"page-main"},[e.$route.query.id?r("el-form",{ref:"subForm",attrs:{model:e.subForm,rules:e.subFormRules,"label-width":"150px"},nativeOn:{submit:function(e){e.preventDefault()}}},[r("el-form-item",{attrs:{label:"关联用户",prop:"user_id"}},[r("el-tag",{staticClass:"cursor-pointer",attrs:{type:e.have_user_id?"info":"primary"},on:{click:function(t){return e.toShowDialog("user")}}},[e._v(e._s(e.subForm.user_id?e.subForm.nickName:"选择关联用户"))])],1),e._v(" "),r("el-form-item",{attrs:{label:e.$t("action.resellerName")+"姓名",prop:"user_name"}},[r("el-input",{attrs:{maxlength:"20","show-word-limit":"",placeholder:"请输入"+e.$t("action.resellerName")+"姓名"},model:{value:e.subForm.user_name,callback:function(t){e.$set(e.subForm,"user_name",t)},expression:"subForm.user_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"真实姓名",prop:"true_user_name"}},[r("el-input",{attrs:{maxlength:"10","show-word-limit":"",placeholder:"请输入真实姓名"},model:{value:e.subForm.true_user_name,callback:function(t){e.$set(e.subForm,"true_user_name",t)},expression:"subForm.true_user_name"}})],1),e._v(" "),r("el-form-item",{attrs:{label:"手机号",prop:"mobile"}},[r("el-input",{attrs:{maxlength:"11","show-word-limit":"",placeholder:"请输入手机号"},model:{value:e.subForm.mobile,callback:function(t){e.$set(e.subForm,"mobile",t)},expression:"subForm.mobile"}})],1),e._v(" "),r("el-form-item",{directives:[{name:"show",rawName:"v-show",value:e.routesItem.auth.payreseller&&!e.subForm.id,expression:"routesItem.auth.payreseller && !subForm.id"}],attrs:{label:e.$t("action.resellerName")+"身份",prop:"reseller_level"}},[r("el-radio-group",{model:{value:e.subForm.reseller_level,callback:function(t){e.$set(e.subForm,"reseller_level",t)},expression:"subForm.reseller_level"}},[r("el-radio",{attrs:{label:1}},[e._v("一级"+e._s(e.$t("action.resellerName")))]),e._v(" "),r("el-radio",{attrs:{label:0}},[e._v("二级"+e._s(e.$t("action.resellerName")))])],1),e._v(" "),r("div",{staticClass:"lb-text-red-tips"},[e._v("\n          添加的用户将免费成为所选择身份的"+e._s(e.$t("action.resellerName"))+"\n        ")])],1),e._v(" "),!e.reseller_cash_type&&(e.routesItem.userInfo.is_admin||!e.routesItem.userInfo.is_admin&&1*e.max_balance>0)?r("block",[r("el-form-item",{attrs:{label:"一级提成比例",prop:"balance"}},[r("el-input",{attrs:{placeholder:"请输入一级提成比例"},model:{value:e.subForm.balance,callback:function(t){e.$set(e.subForm,"balance",t)},expression:"subForm.balance"}},[r("template",{slot:"append"},[e._v("%")])],2),e._v(" "),r("lb-tool-tips",[e._v("取值0-"+e._s(e.routesItem.userInfo.is_admin&&!e.subForm.admin_id?"100":e.max_balance)+"\n            "),r("div",{staticClass:"mt-sm"},[e._v("不输入则表示不单独设置，使用全局设置比例")])])],1),e._v(" "),r("el-form-item",{attrs:{label:"二级提成比例",prop:"level_balance"}},[r("el-input",{attrs:{placeholder:"请输入二级提成比例"},model:{value:e.subForm.level_balance,callback:function(t){e.$set(e.subForm,"level_balance",t)},expression:"subForm.level_balance"}},[r("template",{slot:"append"},[e._v("%")])],2),e._v(" "),r("lb-tool-tips",[e._v("取值0-"+e._s(e.routesItem.userInfo.is_admin&&!e.subForm.admin_id?"100":e.max_balance)+"\n            "),r("div",{staticClass:"mt-sm"},[e._v("不输入则表示不单独设置，使用全局设置比例")])])],1)],1):e._e(),e._v(" "),r("el-form-item",{attrs:{label:"所属"+e.$t("action.agentName"),prop:"admin_id"}},[e.routesItem.userInfo.is_admin?r("el-select",{attrs:{placeholder:"请选择"+e.$t("action.agentName"),filterable:"",clearable:""},model:{value:e.subForm.admin_id,callback:function(t){e.$set(e.subForm,"admin_id",t)},expression:"subForm.admin_id"}},e._l(e.base_agent,function(e){return r("el-option",{key:e.id,attrs:{label:e.agent_name,value:e.id}})}),1):r("block",[e._v(e._s(e.subForm.admin_name||"-"))])],1),e._v(" "),r("el-form-item",{attrs:{label:"备注",prop:"text"}},[r("el-input",{attrs:{type:"textarea",rows:10,maxlength:"300",resize:"none","show-word-limit":"",placeholder:"请输入备注信息"},model:{value:e.subForm.text,callback:function(t){e.$set(e.subForm,"text",t)},expression:"subForm.text"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitFormInfo("sub")}}},[e._v(e._s(e.$t("action.submit")))]),e._v(" "),r("lb-button",{on:{click:function(t){return e.$router.back(-1)}}},[e._v(e._s(e.$t("action.back")))])],1)],1):r("div",[e._v("暂无新增"+e._s(e.$t("action.resellerName"))+"功能")]),e._v(" "),r("el-dialog",{attrs:{title:"关联用户",visible:e.showDialog.user,width:"800px",top:"5vh",center:""},on:{"update:visible":function(t){return e.$set(e.showDialog,"user",t)}}},[e.routesItem.userInfo.is_admin?e._e():r("lb-tips",[e._v("请输入用户昵称/手机号后点击查询数据")]),e._v(" "),r("el-form",{ref:"userForm",attrs:{inline:!0,model:e.searchForm.user,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"nickName"}},[r("el-input",{attrs:{placeholder:"请输入用户昵称/手机号"},model:{value:e.searchForm.user.nickName,callback:function(t){e.$set(e.searchForm.user,"nickName",t)},expression:"searchForm.user.nickName"}})],1),e._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.getTableDataList(1,"user")}}},[e._v(e._s(e.$t("action.search")))]),e._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(t){return e.resetForm("user")}}},[e._v(e._s(e.$t("action.reset")))])],1)],1),e._v(" "),r("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading.user,expression:"loading.user"}],ref:"singleTable",staticStyle:{width:"100%"},attrs:{data:e.tableData.user,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark","highlight-current-row":""},on:{"current-change":function(t){return e.handleSelectionChange(t,"user")}}},[r("el-table-column",{attrs:{prop:"id",label:"用户ID"}}),e._v(" "),r("el-table-column",{attrs:{prop:"avatarUrl",label:"头像"},scopedSlots:e._u([{key:"default",fn:function(e){return[r("lb-image",{attrs:{src:e.row.avatarUrl}})]}}])}),e._v(" "),r("el-table-column",{attrs:{prop:"nickName",label:"昵称"}}),e._v(" "),r("el-table-column",{attrs:{prop:"phone",label:"手机号"}})],1),e._v(" "),r("lb-page",{attrs:{batch:!1,page:e.searchForm.user.page,pageSize:e.searchForm.user.limit,total:e.total.user},on:{handleSizeChange:function(t){return e.handleSizeChange(t,"user")},handleCurrentChange:function(t){return e.handleCurrentChange(t,"user")}}}),e._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(t){e.showDialog.user=!1}}},[e._v("取 消")]),e._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:function(t){return e.handleDialogConfirm("user")}}},[e._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var F=r("C7Lr")(f,g,!1,function(e){r("Ek2T")},"data-v-943d3508",null);t.default=F.exports},Ek2T:function(e,t){}});