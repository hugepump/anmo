webpackJsonp([84],{Kk4w:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r("3cXf"),i=r.n(o),n=r("lC5x"),s=r.n(n),a=r("J0Oq"),l=r.n(a),c={data:function(){var t=this,e=function(e,r,o){var i=t.subForm.rights,n=t.send_coupon_id;"rights"===e.key&&(!i.includes(n)&&0===r.length||i.includes(n)&&1===r.length)?o(new Error("请选择会员权益")):"send_coupon"===e.key&&i.includes(n)&&0===r.length?o(new Error("请选择卡券")):o()};return{navTitle:"",colorList:["#739bc6","#60a06a","#d4b64c","#c09e51","#d5964b","#c26a51","#ffb6b1","#b0b4c7","#616570","#616570"],colorInd:0,primaryColor:"#739bc6",base_rights:[],top:"",cur_growth:"40",total_growth:"100",next_level:{},send_coupon_id:0,subForm:{id:"",title:"",color:"#739bc6",growth:"",rights:[],coupon:[]},subFormRules:{title:{required:!0,validator:this.$reg.isNotNull,reg_type:2,text:"会员等级名称",trigger:"blur"},color:{required:!0,type:"string",message:"请选择背景色",trigger:"blur"},growth:{required:!0,validator:this.$reg.isNum,text:"成长值",trigger:"blur"},rights:{required:!0,validator:e,key:"rights",trigger:["blur","change"]},coupon:{validator:e,key:"send_coupon",trigger:["blur","change"]}},searchForm:{page:1,limit:10,status:1,send_type:3,name:""},total:0,loading:!1,tableData:[],multipleSelection:[],showDialog:{coupon:!1}}},created:function(){var t=this;return l()(s.a.mark(function e(){var r,o,i,n,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.$route.query,o=r.id,i=void 0===o?0:o,n=r.top,a=void 0===n?1:n,t.navTitle=t.$t(i?"menu.CustomMemberLevelEdit":"menu.CustomMemberLevelAdd"),t.subForm.id=i,t.top=a,e.next=6,t.getBaseInfo();case 6:if(!i){e.next=9;break}return e.next=9,t.getDetail();case 9:case"end":return e.stop()}},e,t)}))()},methods:{getBaseInfo:function(){var t=this;return l()(s.a.mark(function e(){var r,o,i,n;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.member.rightsSelect();case 2:if(r=e.sent,o=r.code,i=r.data,200===o){e.next=7;break}return e.abrupt("return");case 7:n=i.findIndex(function(t){return"send_coupon"===t.key}),t.send_coupon_id=-1===n?0:i[n].id,t.base_rights=i;case 10:case"end":return e.stop()}},e,t)}))()},getDetail:function(){var t=this;return l()(s.a.mark(function e(){var r,o,i,n,a,l,c,u,d,m,p,h,v,b;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.subForm.id,t.subForm.color=t.colorList[t.colorInd],e.next=4,t.$api.member.levelInfo({id:r});case 4:if(o=e.sent,i=o.code,n=o.data,200===i){e.next=9;break}return e.abrupt("return");case 9:for(l in n.color&&"0"!==n.color||(n.color=t.colorList[0]),a=-1,t.colorList.map(function(t,e){t===n.color&&(a=e)}),t.colorInd=-1===a&&n.color?t.colorList.length-1:a,-1===a&&n.color&&(t.colorList[t.colorList.length-1]=n.color),n.coupon=n.coupon.map(function(t){return{id:t.coupon_id,title:t.title,num:t.num}}),t.subForm)t.subForm[l]=n[l];c=n.next_level,m=(d=u=null==(u=void 0===c?{id:0,growth:0}:c)?{id:0,growth:0}:u).id,p=void 0===m?0:m,h=d.growth,v=p?1*(void 0===h?0:h):1*n.growth,b=.4*v,t.cur_growth=b,t.total_growth=v,t.next_level=n.next_level;case 24:case"end":return e.stop()}},e,t)}))()},changeIndex:function(t){var e=this;return l()(s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:e.colorInd=t,e.subForm.color=e.colorList[t];case 2:case"end":return r.stop()}},r,e)}))()},changeColor:function(t){this.subForm.color=t},toShowDialog:function(t){var e=this;return l()(s.a.mark(function r(){return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return e.searchForm.page=1,e.searchForm.name="",r.next=4,e.getTableDataList();case 4:e.showDialog[t]=!e.showDialog[t];case 5:case"end":return r.stop()}},r,e)}))()},resetForm:function(t){this.$refs[t].resetFields(),this.getTableDataList(1)},handleSizeChange:function(t){this.searchForm.limit=t,this.handleCurrentChange(1)},handleCurrentChange:function(t){this.searchForm.page=t,this.getTableDataList()},getTableDataList:function(t){var e=this;return l()(s.a.mark(function r(){var o,i,n,a,l;return s.a.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:return t&&(e.searchForm.page=t),e.loading=!0,r.next=4,e.$api.market.couponList(e.searchForm);case 4:if(o=r.sent,i=o.code,n=o.data,e.loading=!1,200===i){r.next=10;break}return r.abrupt("return");case 10:a=e.subForm.coupon,l=a.map(function(t){return t.id}),n.data.map(function(t){if(t.num=1,l.includes(t.id)){var e=a.findIndex(function(e){return t.id===e.id});t.num=a[e].num}}),e.tableData=n.data,e.total=n.total;case 15:case"end":return r.stop()}},r,e)}))()},handleSelectionChange:function(t){this.multipleSelection=t},handleDialogConfirm:function(){if(0!==this.multipleSelection.length){var t=JSON.parse(i()(this.subForm.coupon)),e=t.length>0?t.map(function(t){return t.id}):[];this.multipleSelection.map(function(r){if(e.includes(r.id)){var o=t.findIndex(function(t){return t.id===r.id});t[o].num=r.num}else t.push(r)}),this.subForm.coupon=t,this.showDialog.coupon=!1}else this.$message.error("请选择卡券")},toDelItem:function(t){this.subForm.coupon.splice(t,1)},submitFormInfo:function(){var t=this;return l()(s.a.mark(function e(){var r,o,n,a,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r=!0,t.$refs.subForm.validate(function(t){t||(r=!1)}),r){e.next=4;break}return e.abrupt("return");case 4:if(o=JSON.parse(i()(t.subForm)),n=[],o.coupon.map(function(t){n.push({coupon_id:t.id,num:t.num||0})}),o.coupon=o.rights.includes(t.send_coupon_id)?n:[],!(o.rights.includes(t.send_coupon_id)&&o.coupon.filter(function(t){return 1*t.num<1}).length>0)){e.next=11;break}return t.$message.error("请输入卡券数量"),e.abrupt("return");case 11:return a=o.id?"levelUpdate":"levelAdd",e.next=14,t.$api.member[a](o);case 14:if(l=e.sent,200===l.code){e.next=18;break}return e.abrupt("return");case 18:t.$message.success(t.$t("tips.successSub")),t.$router.back(-1);case 20:case"end":return e.stop()}},e,t)}))()}}},u={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{staticClass:"lb-custom-member-level-edit"},[r("top-nav",{attrs:{title:t.navTitle,isBack:!0}}),t._v(" "),r("div",{staticClass:"page-main"},[r("el-form",{ref:"subForm",staticClass:"basic-form",attrs:{model:t.subForm,rules:t.subFormRules,"label-width":"160px"},nativeOn:{submit:function(t){t.preventDefault()}}},[r("lb-classify-title",{attrs:{title:"基础信息"}}),t._v(" "),r("div",{staticStyle:{height:"30px"}}),t._v(" "),r("div",{staticClass:"flex-warp"},[r("div",{staticClass:"mr-lg"},[r("el-form-item",{attrs:{label:"等级名称",prop:"title"}},[r("el-input",{attrs:{type:"text",maxlength:"6","show-word-limit":"",placeholder:"请输入会员等级名称"},model:{value:t.subForm.title,callback:function(e){t.$set(t.subForm,"title",e)},expression:"subForm.title"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"等级背景色",prop:"color"}},[r("div",{staticClass:"flex-warp mt-sm"},t._l(t.colorList,function(e,o){return r("div",{key:o},[o<t.colorList.length-1?r("div",{staticClass:"color-item",class:[{active:o===t.colorInd}],on:{click:function(e){return t.changeIndex(o)}}},[r("div",{staticClass:"flex-center"},[r("div",{staticClass:"primaryColor flex-center"},[r("div",{staticClass:"color-bg",style:{background:e}})])]),t._v(" "),o===t.colorInd?r("i",{staticClass:"iconfont icon-xuanze-fill flex-center"}):t._e()]):t._e(),t._v(" "),o==t.colorList.length-1?r("div",[r("div",{staticClass:"color-item",class:[{active:o===t.colorInd}],staticStyle:{width:"auto",padding:"0 2px"},on:{click:function(e){return t.changeIndex(o)}}},[r("div",{staticClass:"flex-center",staticStyle:{"margin-top":"4px"}},[r("el-color-picker",{staticStyle:{"margin-right":"4px"},attrs:{size:"mini"},on:{change:t.changeColor},model:{value:t.colorList[o],callback:function(e){t.$set(t.colorList,o,e)},expression:"colorList[index]"}})],1),t._v(" "),r("div",{staticClass:"flex-y-center",staticStyle:{height:"18px","margin-top":"4px"}},[r("div",{staticStyle:{"line-height":"18px","font-size":"10px"}},[t._v("\n                        自定义配色\n                      ")]),t._v(" "),r("i",{staticClass:"iconfont icongouxuan-weixuanzhong-xianxingyuankuang flex-center",class:[{"icon-xuanze-fill":o===t.colorInd}],staticStyle:{margin:"0"}})])])]):t._e()])}),0)]),t._v(" "),r("el-form-item",{attrs:{label:"获得等级条件",prop:"growth"}},[r("el-input",{attrs:{placeholder:t.last_level_growth},model:{value:t.subForm.growth,callback:function(e){t.$set(t.subForm,"growth",t._n(e))},expression:"subForm.growth"}},[r("template",{slot:"prepend"},[t._v("成长值达到")])],2),t._v(" "),r("lb-tool-tips",[t._v("修改成长值会影响现有会员用户的会员等级，请谨慎操作")])],1)],1),t._v(" "),r("div",{staticClass:"ml-lg"},[r("div",{staticClass:"swiper-item radius-26 rel"},[r("div",{staticClass:"swiper-item has-shadow c-base radius-26",style:{background:t.subForm.color||t.primaryColor}}),t._v(" "),r("div",{staticClass:"swiper-item abs",staticStyle:{top:"0",left:"0"}},[r("div",{staticClass:"flex-between item-child"},[r("div",{staticStyle:{width:"170px"}},[r("div",{staticClass:"flex-y-baseline mt-lg",style:{color:t.subForm.color||t.primaryColor}},[r("div",{staticClass:"vip-icon flex-center rel"},[r("i",{staticClass:"iconfont iconvIP1"}),t._v(" "),r("div",{staticClass:"f-desc flex-center c-base abs"},[t._v("v"+t._s(t.top))])]),t._v(" "),r("div",{staticClass:"f-sm-title text-bold ml-sm"},[t._v("\n                      "+t._s(t.subForm.title||"会员等级名称")+"\n                    ")])]),t._v(" "),r("div",{staticClass:"f-icontext",staticStyle:{height:"15px"},style:{color:t.subForm.color||t.primaryColor}},[t._v("\n                    等级有效期: 长期有效\n                  ")]),t._v(" "),r("div",{staticStyle:{height:"22px"}}),t._v(" "),r("div",{staticClass:"f-icontext ellipsis",staticStyle:{color:"#525252",height:"17px"}},[t.subForm.id?r("block",[t.next_level&&t.next_level.id?r("block",[t._v("\n                      还差"+t._s(t.next_growth)+"成长值升级至"+t._s(t.next_level.title)+"\n                    ")]):r("block",[t._v("已是最高会员等级")])],1):t._e()],1),t._v(" "),r("div",{staticClass:"mb-sm line-bg rel radius",staticStyle:{"margin-top":"8px"}},[r("div",{staticClass:"line-bg abs radius",style:{width:"40%",background:t.subForm.color||t.primaryColor}})]),t._v(" "),r("div",{staticClass:"f-desc text-bold",staticStyle:{color:"#525252"}},[t._v("\n                    "+t._s(t.cur_growth)+"/"+t._s(t.total_growth)+"\n                  ")])]),t._v(" "),r("img",{staticClass:"member-img",attrs:{src:"https://lbqny.migugu.com/admin/anmo/member/member.png"}})])])]),t._v(" "),r("lb-tool-tips",{attrs:{mode:"text"}},[r("div",{staticClass:"c-warning"},[t._v("\n              仅为模拟效果，实际以显示效果为准\n            ")])])],1)]),t._v(" "),r("div",{staticStyle:{height:"30px"}}),t._v(" "),r("lb-classify-title",{attrs:{title:"权益信息"}}),t._v(" "),r("div",{staticStyle:{height:"30px"}}),t._v(" "),r("el-form-item",{attrs:{label:"会员权益",prop:"rights"}},[r("el-checkbox-group",{model:{value:t.subForm.rights,callback:function(e){t.$set(t.subForm,"rights",e)},expression:"subForm.rights"}},t._l(t.base_rights,function(e,o){return r("div",{directives:[{name:"show",rawName:"v-show",value:"send_coupon"!==e.key,expression:"item.key !== 'send_coupon'"}],key:o,staticClass:"c-title",staticStyle:{height:"30px"}},[r("el-checkbox",{attrs:{label:e.id}},[t._v(t._s(e.title))])],1)}),0)],1),t._v(" "),t.send_coupon_id?r("el-form-item",{attrs:{label:"升级礼包",prop:"coupon"}},[r("el-checkbox-group",{model:{value:t.subForm.rights,callback:function(e){t.$set(t.subForm,"rights",e)},expression:"subForm.rights"}},t._l(t.base_rights,function(e,o){return r("div",{directives:[{name:"show",rawName:"v-show",value:"send_coupon"===e.key,expression:"item.key === 'send_coupon'"}],key:o,staticClass:"c-title",staticStyle:{height:"30px"}},[r("el-checkbox",{attrs:{label:e.id}},[t._v(t._s(e.title))]),t._v(" "),t.send_coupon_id&&t.subForm.rights.includes(t.send_coupon_id)?r("lb-button",{staticClass:"ml-md",attrs:{type:"danger",size:"small",icon:"el-icon-plus"},on:{click:function(e){return t.toShowDialog("coupon")}}},[t._v("选择卡券")]):t._e()],1)}),0),t._v(" "),t.send_coupon_id&&t.subForm.rights.includes(t.send_coupon_id)?r("div",{staticClass:"mt-lg pt-sm"},[r("el-table",{staticStyle:{width:"600px"},attrs:{data:t.subForm.coupon,"header-cell-style":{background:"#f5f7fa",color:"#606266"}}},[r("el-table-column",{attrs:{prop:"title",label:"优惠券名称"}}),t._v(" "),r("el-table-column",{attrs:{prop:"num",label:"数量",width:"220"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-input-number",{attrs:{precision:0,min:1,max:1e3},model:{value:e.row.num,callback:function(r){t.$set(e.row,"num",r)},expression:"scope.row.num"}})]}}],null,!1,574389587)}),t._v(" "),r("el-table-column",{attrs:{label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("div",{staticClass:"table-operate"},[r("lb-button",{attrs:{size:"mini",plain:"",type:"danger"},on:{click:function(r){return t.toDelItem(e.$index)}}},[t._v(t._s(t.$t("action.delete")))])],1)]}}],null,!1,2461405206)})],1)],1):t._e()],1):t._e(),t._v(" "),r("div",{staticStyle:{height:"30px"}}),t._v(" "),r("el-form-item",[r("lb-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.submitFormInfo}},[t._v(t._s(t.$t("action.submit")))]),t._v(" "),r("lb-button",{on:{click:function(e){return t.$router.back(-1)}}},[t._v(t._s(t.$t("action.back")))])],1)],1),t._v(" "),r("el-dialog",{attrs:{title:"选择卡券",visible:t.showDialog.coupon,width:"900px",top:"5vh",center:""},on:{"update:visible":function(e){return t.$set(t.showDialog,"coupon",e)}}},[r("el-form",{ref:"searchForm",staticClass:"dialog-form",attrs:{inline:!0,model:t.searchForm,"label-width":"70px"}},[r("el-form-item",{attrs:{label:"输入查询",prop:"name"}},[r("el-input",{attrs:{placeholder:"请输入卡券名称"},model:{value:t.searchForm.name,callback:function(e){t.$set(t.searchForm,"name",e)},expression:"searchForm.name"}})],1),t._v(" "),r("el-form-item",[r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",type:"primary",icon:"el-icon-search"},on:{click:function(e){return t.getTableDataList(1)}}},[t._v(t._s(t.$t("action.search")))]),t._v(" "),r("lb-button",{staticStyle:{"margin-right":"5px"},attrs:{size:"medium",icon:"el-icon-refresh-left"},on:{click:function(e){return t.resetForm("searchForm")}}},[t._v(t._s(t.$t("action.reset")))])],1)],1),t._v(" "),r("el-table",{ref:"multipleTable",staticStyle:{width:"100%"},attrs:{data:t.tableData,"header-cell-style":{background:"#f5f7fa",color:"#606266"},"tooltip-effect":"dark"},on:{"selection-change":t.handleSelectionChange}},[r("el-table-column",{attrs:{type:"selection",width:"55"}}),t._v(" "),r("el-table-column",{attrs:{prop:"id",label:"ID"}}),t._v(" "),r("el-table-column",{attrs:{prop:"title",label:"卡券名称"}}),t._v(" "),r("el-table-column",{attrs:{prop:"type",label:"使用条件"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("p",[t._v("\n              "+t._s(0===e.row.type?"消费满¥"+e.row.full+"减¥"+e.row.discount:"立减¥"+e.row.discount)+"\n            ")])]}}])}),t._v(" "),r("el-table-column",{attrs:{prop:"title",label:"数量",width:"260"},scopedSlots:t._u([{key:"default",fn:function(e){return[r("el-input-number",{attrs:{precision:0,min:1,max:1e3},model:{value:e.row.num,callback:function(r){t.$set(e.row,"num",r)},expression:"scope.row.num"}})]}}])})],1),t._v(" "),r("lb-page",{attrs:{batch:!1,page:t.searchForm.page,pageSize:t.searchForm.limit,total:t.total},on:{handleSizeChange:t.handleSizeChange,handleCurrentChange:t.handleCurrentChange}}),t._v(" "),r("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[r("el-button",{on:{click:function(e){t.showDialog.coupon=!1}}},[t._v("取 消")]),t._v(" "),r("el-button",{directives:[{name:"preventReClick",rawName:"v-preventReClick"}],attrs:{type:"primary"},on:{click:t.handleDialogConfirm}},[t._v("确 定")])],1)],1)],1)],1)},staticRenderFns:[]};var d=r("C7Lr")(c,u,!1,function(t){r("NRLb")},"data-v-73d3d826",null);e.default=d.exports},NRLb:function(t,e){}});