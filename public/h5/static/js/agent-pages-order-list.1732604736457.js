(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["agent-pages-order-list"],{"36b2":function(t,e,a){"use strict";a.r(e);var i=a("d6c5"),n=a("a6fd");for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);var r=a("828b"),o=Object(r["a"])(n["default"],i["b"],i["c"],!1,null,"b572724e",null,!1,i["a"],void 0);e["default"]=o.exports},a6fd:function(t,e,a){"use strict";a.r(e);var i=a("b0fa"),n=a.n(i);for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},b0fa:function(t,e,a){"use strict";a("6a54");var i=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("c223"),a("fd3c"),a("dd2b");var n=i(a("5de6")),s=i(a("2634")),r=i(a("2fdc")),o=i(a("9b1b")),c=a("8f59"),l={components:{},data:function(){return{isLoad:!1,options:{},activeIndex:0,tabList:[],tabOrderList:[{title:"全部",id:0},{title:"已取消",id:-1},{title:"待接单",id:2,number:0},{title:"已接单",id:3,number:0},{title:"已出发",id:4,number:0},{title:"已到达",id:5,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],tabBellList:[{title:"全部",id:0},{title:"已取消",id:-1},{title:"待接单",id:2,number:0},{title:"已接单",id:3,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},technicianStatusOperType:{"-1":"agreeRefund",2:"orderTaking",3:"setOut",4:"arrive",5:"startService",6:"serviceCompletion",8:"transferOrder"},param:{page:1,pay_type:0,order_code:""},list:{data:[]},loading:!0,index:-1,lockTap:!1,popupInfo:{title:"",index:"",type:"",param:{},imgs:[],location:{lat:0,lng:0,address:""}}}},computed:(0,c.mapState)({configInfo:function(t){return t.config.configInfo}}),onLoad:function(t){var e=t.agent,a=void 0===e?0:e,i=t.bell,n=void 0===i?0:i,s=t.tab,r=void 0===s?0:s;t.agent=1*a,t.bell=1*n,this.options=t,uni.setNavigationBarTitle({title:8==r?"拒单管理":1==n?"加钟管理":"订单管理"}),this.tabList=8==r?[]:1==n?this.tabBellList:this.tabOrderList,this.activeIndex=r,this.initIndex()},onPullDownRefresh:function(){uni.showNavigationBarLoading(),this.initRefresh(),uni.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:(0,o.default)((0,o.default)((0,o.default)({},(0,c.mapActions)(["getConfigInfo"])),(0,c.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,r.default)((0,s.default)().mark((function a(){var i;return(0,s.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!i&&e.userInfo.id){a.next=4;break}return a.next=4,e.getConfigInfo();case 4:return a.next=6,e.getList();case 6:e.isLoad=!0,e.$util.setNavigationBarColor({bg:e.primaryColor}),i||e.$jweixin.hideOptionMenu();case 9:case"end":return a.stop()}}),a)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toSearch:function(t){this.param.page=1,this.param.order_code=t,this.getList()},getList:function(){var t=arguments,e=this;return(0,r.default)((0,s.default)().mark((function a(){var i,n,r,o,c,l,d,u,p,f,v,g,_,h;return(0,s.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return i=t.length>0&&void 0!==t[0]&&t[0],n=e.list,r=e.param,o=e.tabList,c=e.activeIndex,l=e.options,d=l.tab,u=void 0===d?0:d,p=l.bell,f=void 0===p?0:p,v=l.agent,g=void 0===v?0:v,_=g?"agent":"admin",r.pay_type=8==u?8:o[c].id,8!=u&&(r.is_add=f),a.next=8,e.$api[_].orderList(r);case 8:h=a.sent,i||(1==e.param.page||(h.data=n.data.concat(h.data)),e.list=h),e.loading=!1,e.$util.hideAll();case 12:case"end":return a.stop()}}),a)})))()},handerTabChange:function(t){this.activeIndex=t,this.param.page=1,this.getList()},toConfirm:function(t){var e=this;return(0,r.default)((0,s.default)().mark((function a(){var i,n,r,o,c,l,d,u,p,f,v;return(0,s.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!e.lockTap){a.next=2;break}return a.abrupt("return");case 2:i=e.list.data[t],n=i.id,r=i.pay_type,o=i.can_refund_price,c=i.is_add,l=void 0===c?0:c,d=i.store_id,u=void 0===d?0:d,p=i.add_flow_path,f=void 0===p?1:p,v=l&&2==r&&2==f||3===r&&(l||u)?5:8==r?-1:r,e.popupInfo={index:t,order_id:n,type:v,text_type:l&&2==r?2:v,can_refund_price:o},e.$refs.change_item.open();case 6:case"end":return a.stop()}}),a)})))()},confirmChangeOrder:function(){var t=this;return(0,r.default)((0,s.default)().mark((function e(){var a,i,r,o,c,l,d,u,p,f,v,g,_,h,m,b,y,x,w;return(0,s.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.$util.deepCopy(t.popupInfo),i=a.index,r=a.type,o=a.text_type,a.type=-1==r?r:r+1,c=t.list.data[i].is_add,l="",d=0,7!=a.type||c){e.next=17;break}return u=t.options.agent,p=u?"agent":"admin",e.next=11,t.$api[p].orderInfo({id:a.order_id});case 11:f=e.sent,f.pay_type,v=f.add_service,g=void 0===v?[]:v,d=g.length,g&&g.length>0&&g.map((function(t){l+="【".concat(t,"】")}));case 17:if(!(l&&l.length>0)){e.next=27;break}return e.next=20,uni.showModal({content:"该订单还有".concat(l).concat(d,"项加钟服务，完成主订单会将加钟订单一并结束，确认是否结束？"),confirmText:"确认"});case 20:if(_=e.sent,h=(0,n.default)(_,2),h[0],m=h[1].confirm,m){e.next=27;break}return t.$refs.change_item.close(),e.abrupt("return");case 27:if(delete a.index,delete a.can_refund_price,delete a.text_type,b=t.activeIndex,t.technicianStatusOperType,y=-1==o?"退款成功":"操作成功",!t.lockTap){e.next=34;break}return e.abrupt("return");case 34:return t.lockTap=!0,t.$util.showLoading(),x=t.options.agent,w=x?"agent":"admin",e.prev=38,t.$refs.change_item.close(),e.next=42,t.$api[w].adminUpdateOrder(a);case 42:if(t.$util.showToast({title:y}),0==b?t.list.data[i].pay_type=a.type:t.list.data.splice(i,1),t.$util.hideAll(),t.updateTechnicianItem({key:"haveOperItem",val:!0}),!b){e.next=49;break}return e.next=49,t.getList(!0);case 49:setTimeout((function(){t.lockTap=!1}),500),e.next=56;break;case 52:e.prev=52,e.t0=e["catch"](38),t.updateTechnicianItem({key:"haveOperItem",val:!0}),setTimeout((function(){t.param.page=1,t.getList(),t.lockTap=!1,t.$util.hideAll()}),2e3);case 56:case"end":return e.stop()}}),e,null,[[38,52]])})))()},goDetail:function(t){var e=this.list.data[t].id,a=this.options.agent,i="/agent/pages/order/detail?id=".concat(e,"&agent=").concat(a);this.$util.goUrl({url:i})}})};e.default=l},d6c5:function(t,e,a){"use strict";a.d(e,"b",(function(){return i})),a.d(e,"c",(function(){return n})),a.d(e,"a",(function(){}));var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isLoad?a("v-uni-view",{staticClass:"order-pages",style:{background:t.pageColor}},[a("fixed",[a("v-uni-view",{staticClass:"fill-base pt-lg pl-md pr-md pb-md"},[a("search",{attrs:{type:"input",padding:0,radius:30,height:"70rpx",placeholder:"请输入系统订单号查询"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.toSearch.apply(void 0,arguments)}}})],1),8!=t.options.tab?a("tab",{attrs:{list:t.tabList,activeIndex:1*t.activeIndex,activeColor:t.primaryColor,height:"100rpx"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.handerTabChange.apply(void 0,arguments)}}}):t._e(),a("v-uni-view",{staticClass:"b-1px-b"})],1),t._l(t.list.data,(function(e,i){return a("v-uni-view",{key:i,staticClass:"item-child mt-md ml-lg mr-lg pd-lg fill-base radius-16 rel",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goDetail(i)}}},[e.is_add?a("v-uni-view",[e.is_add?a("v-uni-view",{staticClass:"bell-tag flex-center f-icontext c-base abs",style:{background:t.primaryColor}},[t._v("加钟服务")]):t._e(),a("v-uni-view",{staticClass:"space-md"})],1):t._e(),a("v-uni-view",{staticClass:"flex-between pb-lg b-1px-b"},[a("v-uni-view",{staticClass:"f-paragraph c-title max-450 ellipsis"},[t._v("订单号："+t._s(e.order_code))]),a("v-uni-view",{staticClass:"f-caption text-bold",style:{color:2==e.pay_type?t.primaryColor:[3,4,5].includes(e.pay_type)?t.subColor:6==e.pay_type?"#11C95E":"#333"}},[t._v(t._s(t.statusType[e.pay_type]))])],1),t._l(e.order_goods,(function(i,n){return a("v-uni-view",{key:n,staticClass:"flex-center mb-lg",class:[{"mt-lg":0==n}]},[a("v-uni-view",{staticClass:"avatar lg radius-16"},[a("v-uni-view",{staticClass:"h5-image avatar lg radius-16",style:{backgroundImage:"url('"+i.goods_cover+"')"}})],1),a("v-uni-view",{staticClass:"flex-1 ml-md"},[a("v-uni-view",{staticClass:"flex-between"},[a("v-uni-view",{staticClass:"f-mini-title c-title text-bold max-380 ellipsis"},[t._v(t._s(i.goods_name))]),a("v-uni-view",{staticClass:"c-paragraph"},[t._v("x"+t._s(i.num))])],1),a("v-uni-view",{staticClass:"flex-between mt-md"},[a("v-uni-view",{staticClass:"f-caption c-caption ellipsis",class:[{"max-300":i.refund_num>0},{"max-450":0==i.refund_num}]},[t._v(t._s("服务"===t.$t("action.attendantName").substring(0,2)?"":"服务")+t._s(t.$t("action.attendantName"))+"："+t._s(e.coach_info?e.coach_info.coach_name:"-"))]),i.refund_num>0?a("v-uni-view",{staticClass:"f-caption c-warning"},[t._v("已退x"+t._s(i.refund_num))]):t._e()],1),a("v-uni-view",{staticClass:"f-caption c-caption",staticStyle:{"margin-top":"5rpx"}},[t._v("服务时间："+t._s(e.start_time))])],1)],1)})),a("v-uni-view",{staticClass:"flex-between pt-lg b-1px-t"},[a("v-uni-view",{staticClass:"flex-y-center f-desc c-title"},[t._v("总计："),a("v-uni-view",{staticClass:"f-paragraph text-bold"},[t._v("¥"+t._s(e.pay_price))])],1),a("v-uni-view",{staticClass:"flex-warp"},[[2,3,4,5,6,8].includes(e.pay_type)&&!e.is_add||([2,3,6].includes(e.pay_type)&&1===e.add_flow_path||2==e.pay_type&&2==e.add_flow_path)&&e.is_add?[e.is_add?t._e():a("v-uni-button",{staticClass:"clear-btn order",staticStyle:{"margin-left":"0"},on:{click:function(a){a.stopPropagation(),arguments[0]=a=t.$handleEvent(a),t.$util.goUrl({url:"/agent/pages/order/change?id="+e.id+"&agent="+t.options.agent})}}},[t._v("转单")]),a("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,borderColor:t.primaryColor},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toConfirm(i)}}},[t._v(t._s(t.$t("action."+t.technicianStatusOperType[3===e.pay_type&&(e.store_id||e.is_add)?5:8==e.pay_type?-1:e.pay_type])))])]:t._e()],2)],1)],2)})),t.loading?a("load-more",{attrs:{noMore:t.list.current_page>=t.list.last_page&&t.list.data.length>0,loading:t.loading}}):t._e(),!t.loading&&t.list.data.length<=0&&1==t.list.current_page?a("abnor",{attrs:{tip:[{text:"暂无订单数据"}],percent:"calc(100vh - 220rpx - calc(30rpx + env(safe-area-inset-bottom) / 2))"}}):t._e(),a("v-uni-view",{staticClass:"space-footer"}),a("uni-popup",{ref:"change_item",attrs:{type:"center",custom:!0}},[a("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[a("v-uni-view",{staticClass:"title"},[t._v("温馨提示")]),a("v-uni-view",{staticClass:"desc"},[t._v("你确认要操作"+t._s(t.$t("action."+t.technicianStatusOperType[t.popupInfo.text_type]))+"吗?")]),-1==t.popupInfo.type?a("v-uni-view",{staticClass:"f-caption c-warning"},[t._v("退款金额：¥"+t._s(t.popupInfo.can_refund_price))]):t._e(),a("v-uni-view",{staticClass:"button"},[a("v-uni-view",{staticClass:"item-child",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$refs.change_item.close()}}},[t._v("取消")]),a("v-uni-view",{staticClass:"item-child",style:{background:t.primaryColor,color:"#fff"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.confirmChangeOrder.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],2):t._e()},n=[]}}]);