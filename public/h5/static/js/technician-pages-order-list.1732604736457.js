(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["technician-pages-order-list"],{"177b":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"order-pages",style:{background:e.pageColor}},[n("v-uni-view",{staticClass:"fix",staticStyle:{top:"-100%",left:"-100%"}},[e._l(e.order_unix_list,(function(t,a){return[t.id===e.recorder_order_id?[n("min-countdown",{attrs:{targetTime:1e3*t.start_service_time_unix},on:{callback:function(n){arguments[0]=n=e.$handleEvent(n),e.toCountDownEnd(t.id)}}})]:e._e()]}))],2),n("fixed",[n("tab",{attrs:{list:e.tabList,activeIndex:1*e.activeIndex,activeColor:e.primaryColor,width:100/e.tabList.length+"%",height:"100rpx"},on:{change:function(t){arguments[0]=t=e.$handleEvent(t),e.handerTabChange.apply(void 0,arguments)}}}),n("v-uni-view",{staticClass:"b-1px-b"})],1),e._l(e.list.data,(function(t,a){return n("v-uni-view",{key:a,staticClass:"item-child mt-md ml-lg mr-lg pd-lg fill-base radius-16 rel",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.goDetail(a)}}},[n("v-uni-view",{staticClass:"flex-between pb-lg",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.goShop(a)}}},[n("v-uni-view",{staticClass:"f-paragraph c-title max-500 ellipsis"},[e._v("订单号："+e._s(t.order_code))]),n("v-uni-view",{staticClass:"f-caption text-bold",style:{color:2==t.pay_type?e.primaryColor:[3,4,5].includes(t.pay_type)?e.subColor:6==t.pay_type?"#11C95E":"#333"}},[e._v(e._s(e.statusType[t.pay_type]))])],1),e._l(t.order_goods,(function(a,r){return n("v-uni-view",{key:r,staticClass:"flex-center mb-lg"},[n("v-uni-view",{staticClass:"avatar lg radius-16"},[n("v-uni-view",{staticClass:"h5-image avatar lg radius-16",style:{backgroundImage:"url('"+a.goods_cover+"')"}})],1),n("v-uni-view",{staticClass:"flex-1 ml-md"},[n("v-uni-view",{staticClass:"flex-between"},[n("v-uni-view",{staticClass:"f-mini-title c-title text-bold ellipsis",class:[{"max-300":a.refund_num>0},{"max-450":0==a.refund_num}]},[e._v(e._s(a.goods_name))]),a.refund_num>0?n("v-uni-view",{staticClass:"f-caption c-warning"},[e._v("已退x"+e._s(a.refund_num))]):e._e()],1),n("v-uni-view",{staticClass:"f-caption c-caption mt-md"},[e._v("服务时间："+e._s(t.start_time))]),n("v-uni-view",{staticClass:"flex-between"},[n("v-uni-view",{staticClass:"flex-y-baseline f-caption c-warning"},[e._v("¥"),n("v-uni-view",{staticClass:"f-title text-bold"},[e._v(e._s(a.price))])],1),n("v-uni-view",{staticClass:"c-paragraph"},[e._v("x"+e._s(a.num))])],1)],1)],1)})),n("v-uni-view",{staticClass:"flex-between pt-lg b-1px-t"},[n("v-uni-view",{staticClass:"flex-y-center f-desc c-title"},[e._v("总计："),n("v-uni-view",{staticClass:"f-paragraph c-warning text-bold"},[e._v("¥"+e._s(t.pay_price))])],1),n("v-uni-view",{staticClass:"flex-warp"},[2==t.pay_type?[n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toRefuse(a)}}},[e._v("拒绝接单")]),n("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:e.primaryColor,borderColor:e.primaryColor},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toConfirm(a,3)}}},[e._v("确认接单")])]:e._e(),[3,4,5].includes(t.pay_type)?[n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toTel(a)}}},[e._v("联系客户")]),n("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:e.primaryColor,borderColor:e.primaryColor},on:{click:function(n){n.stopPropagation(),arguments[0]=n=e.$handleEvent(n),e.toConfirm(a,t.is_add||t.store_id?6:1*t.pay_type+1)}}},[e._v(e._s(t.is_add||t.store_id?"开始服务":3==t.pay_type?"确认出发":4==t.pay_type?"拍照确认到达":"开始服务"))])]:e._e(),6==t.pay_type?[n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toTel(a)}}},[e._v("联系客户")]),n("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:e.primaryColor,borderColor:e.primaryColor},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toConfirm(a,7)}}},[e._v("拍照完成服务")])]:e._e(),7==t.pay_type?[t.label_time?[n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toChangeItem(a,"del_item")}}},[e._v("删除")]),t.can_shield?n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toShield(a)}}},[e._v("拉黑用户")]):e._e()]:[t.can_shield?n("v-uni-view",{staticClass:"flex-center rel"},[n("v-uni-view",{staticClass:"flex-center f-desc",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toShowMore(a)}}},[e._v("更多")]),t.is_show_more?[n("v-uni-view",{staticClass:"show-more-tag abs"}),n("v-uni-view",{staticClass:"show-more-info pd-md abs"},[n("v-uni-view",{staticClass:"pt-md pb-md flex-center f-paragraph b-1px-b",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toShield(a)}}},[e._v("拉黑用户")]),n("v-uni-view",{staticClass:"pt-md pb-md flex-center f-paragraph",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toChangeItem(a,"del_item")}}},[e._v("删除")])],1)]:e._e()],2):n("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toChangeItem(a,"del_item")}}},[e._v("删除")]),n("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:e.primaryColor,borderColor:e.primaryColor},on:{click:function(n){n.stopPropagation(),arguments[0]=n=e.$handleEvent(n),e.$util.goUrl({url:"/technician/pages/order/label?id="+t.id+"&uid="+t.user_id})}}},[e._v("评价客户")])]]:e._e()],2)],1)],2)})),e.loading?n("load-more",{attrs:{noMore:e.list.current_page>=e.list.last_page&&e.list.data.length>0,loading:e.loading}}):e._e(),!e.loading&&e.list.data.length<=0&&1==e.list.current_page?n("abnor",{attrs:{isCenter:!0,tip:[{text:"暂无订单数据"}]}}):e._e(),n("v-uni-view",{staticClass:"space-footer"}),n("common-popup",{ref:"del_item",attrs:{type:"DELETE_ORDER",info:e.popupInfo},on:{confirm:function(t){arguments[0]=t=e.$handleEvent(t),e.confirmOperItem.apply(void 0,arguments)}}}),n("uni-popup",{ref:"refuse_item",attrs:{type:"center",custom:!0}},[n("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[n("v-uni-view",{staticClass:"title"},[e._v("拒绝接单")]),n("v-uni-view",{staticClass:"desc"},[e._v("请确认是否拒接接单")]),n("v-uni-textarea",{staticClass:"pd-lg textarea f-desc c-title mt-lg radius-20",attrs:{maxlength:"200",placeholder:"请输入拒单原因","placeholder-class":"f-desc c-caption"},model:{value:e.coach_refund_text,callback:function(t){e.coach_refund_text=t},expression:"coach_refund_text"}}),n("v-uni-view",{staticClass:"flex-center mt-md",staticStyle:{width:"540rpx"}},[n("v-uni-view",{staticClass:"flex-1"}),n("v-uni-view",[e._v(e._s(e.coach_refund_text.length>200?200:e.coach_refund_text.length)+"/200")])],1),n("v-uni-view",{staticClass:"button"},[n("v-uni-view",{staticClass:"item-child",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$refs.refuse_item.close()}}},[e._v("取消")]),n("v-uni-view",{staticClass:"item-child c-base",style:{background:e.primaryColor,color:"#fff"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.confirmRefuse.apply(void 0,arguments)}}},[e._v("确定")])],1)],1)],1),n("uni-popup",{ref:"oper_item",attrs:{type:"center",custom:!0}},[n("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[n("v-uni-view",{staticClass:"title"},[e._v(e._s(e.popupInfo.title))]),n("v-uni-view",{staticClass:"desc",staticStyle:{color:"#F13F26"}},[e._v("温馨提示：定位需要5秒左右才能返回结果，若打卡位置与您实际位置不符，请使用手动搜索位置获取定位")]),n("v-uni-view",{staticClass:"space-sm"}),4!==e.popupInfo.type?n("v-uni-view",{staticClass:"flex-warp mt-md",staticStyle:{width:"100%"}},[n("v-uni-view",[e._v("拍照打卡：")]),n("v-uni-view",{staticClass:"flex-1"},[n("upload",{attrs:{imagelist:e.popupInfo.imgs,filetype:"picture",imgtype:"imgs",text:"拍摄图片",imgsize:1,sourceType:2},on:{upload:function(t){arguments[0]=t=e.$handleEvent(t),e.imgUpload.apply(void 0,arguments)},del:function(t){arguments[0]=t=e.$handleEvent(t),e.imgUpload.apply(void 0,arguments)}}})],1)],1):e._e(),e.popupInfo.location?n("v-uni-view",{staticClass:"flex-warp mt-md",staticStyle:{width:"100%"}},[n("v-uni-view",[e._v("当前地点：")]),n("v-uni-view",{staticClass:"flex-1",class:[{"c-title":e.popupInfo.location.address},{"c-caption":!e.popupInfo.location.address}]},[e.popupInfo.location.address?n("span",[e._v(e._s(e.popupInfo.location.address))]):n("span",[e._v(e._s(e.popupInfo.isLoca?"定位失败,请选择手动定位":"定位中请耐心等待"))]),e.popupInfo.isLoca?n("span",{staticClass:"c-warning ml-sm",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toChooseLocation.apply(void 0,arguments)}}},[e._v("手动定位")]):e._e()])],1):e._e(),n("v-uni-view",{staticClass:"flex-y-center f-paragraph mt-md",staticStyle:{width:"100%",color:"#5a677e"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$refs.show_fail_item.open()}}},[e._v("定位失败或不准确时您可以这样操作"),n("i",{staticClass:"iconfont iconwentifankui3 ml-sm",staticStyle:{"font-size":"28rpx"}})]),n("v-uni-view",{staticClass:"button"},[n("v-uni-view",{staticClass:"item-child",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$refs.oper_item.close()}}},[e._v("取消")]),n("v-uni-view",{staticClass:"item-child c-base",style:{background:e.primaryColor,color:"#fff"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.confirmOper.apply(void 0,arguments)}}},[e._v("确定")])],1)],1)],1),n("uni-popup",{ref:"show_fail_item",attrs:{type:"center",maskClick:!1}},[n("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34",staticStyle:{width:"700rpx"}},[n("v-uni-view",{staticClass:"title"},[e._v("定位失败或不准确")]),n("v-uni-view",{staticClass:"f-desc c-title mt-lg"},[e._v("因诸多原因影响（例如：网速低、信号差、拒绝授权定位等），可能导致您的定位失败或不准确。当您发现时，可以尝试通过以下操作来重新定位：")]),n("v-uni-view",{staticClass:"f-desc c-title mt-md"},[e._v("请在手机「系统设置 - 定位相关权限」将微信位置信息访问权限「禁止」后选择「仅使用期间允许」，然后返回系统查看定位功能是否恢复正常")]),n("v-uni-view",{staticClass:"f-desc c-warning mt-sm",staticStyle:{width:"100%"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$util.goUrl({url:"https://lbqnyv3.migugu.com/video/666/24/03/zEKjTz0hOYtosc7k4LB9DvPgMPha6g8b.mp4",openType:"video"})}}},[e._v("点击查看操作视频")]),n("v-uni-view",{staticClass:"button"},[n("v-uni-view",{staticClass:"item-child c-base",style:{background:e.primaryColor,color:"#fff"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$refs.show_fail_item.close()}}},[e._v("知道了")])],1)],1)],1),n("uni-popup",{ref:"shield_item",attrs:{type:"center",custom:!0}},[n("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[n("v-uni-view",{staticClass:"title"},[e._v("温馨提示")]),n("v-uni-view",{staticClass:"desc"},[e._v("拉黑客户之后，该客户将不能在列表看到您的信息，会影响你的接单，可以在"+e._s(e.$t("action.attendantName"))+"端 -\n\t\t\t\t拉黑客户页面移除拉黑客户，确认拉黑吗？")]),n("v-uni-view",{staticClass:"button"},[n("v-uni-view",{staticClass:"item-child",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$refs.shield_item.close()}}},[e._v("我再想想")]),n("v-uni-view",{staticClass:"item-child c-base",style:{background:e.primaryColor,color:"#fff"},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.confirmShield.apply(void 0,arguments)}}},[e._v("确定")])],1)],1)],1),e.configInfo.plugAuth.recording&&e.configInfo.service_recording_show?[n("media-recorder",{ref:"recorder",on:{success:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerSuccess.apply(void 0,arguments)},save:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerOnSave.apply(void 0,arguments)},error:function(t){arguments[0]=t=e.$handleEvent(t),e.handlerError.apply(void 0,arguments)}}})]:e._e()],2)},r=[]},"28fc":function(e,t,n){var a=n("ff8c");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[e.i,a,""]]),a.locals&&(e.exports=a.locals);var r=n("967d").default;r("493cc1e0",a,!0,{sourceMap:!1,shadowMode:!1})},"2cbd":function(e,t,n){"use strict";n.r(t);var a=n("177b"),r=n("bd82");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);n("fe52");var o=n("828b"),s=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"68d6db65",null,!1,a["a"],void 0);t["default"]=s.exports},"2f6c":function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){}));var a=function(){var e=this.$createElement,t=this._self._c||e;return t("v-uni-view",{staticClass:"recorder"})},r=[]},"45b4":function(e,t,n){"use strict";n.r(t);var a=n("6af0"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},"65fd":function(e,t,n){"use strict";n("6a54");var a=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("fd3c"),n("8f71"),n("bf0f"),n("4626"),n("5ac7"),n("c223"),n("e966"),n("18f7"),n("de6c"),n("dc89"),n("2425"),n("5c47"),n("a1c1"),n("dd2b"),n("bd06"),n("aa9c");var r=a(n("5de6")),i=a(n("9b1b")),o=a(n("2634")),s=a(n("2fdc")),c=n("8f59"),u=a(n("ec8d")),l={components:{MediaRecorder:u.default},data:function(){return{options:{},activeIndex:0,tabList:[{title:"待接单",id:2,number:0},{title:"待服务",id:5,number:0},{title:"服务中",id:6,number:0},{title:"已完成",id:7,number:0}],statusType:{2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},param:{page:1,pay_type:0},list:{data:[]},loading:!0,index:-1,coach_refund_text:"",lockTap:!1,popupInfo:{title:"",type:"",index:"",param:{},imgs:[],isLoca:!1,location:{lat:0,lng:0,address:""}}}},computed:(0,c.mapState)({configInfo:function(e){return e.config.configInfo},isUserMedia:function(e){return e.order.isUserMedia},recorder:function(e){return e.order.recorder},recorder_status:function(e){return e.order.recorder_status},recorder_order_id:function(e){return e.order.recorder_order_id},order_unix_list:function(e){return e.order.order_unix_list}}),onLoad:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.options=e,a=e.tab,r=void 0===a?0:a,t.activeIndex=r,t.initIndex();case 4:case"end":return n.stop()}}),n)})))()},destroyed:function(){this.toUnload()},onPullDownRefresh:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:uni.showNavigationBarLoading(),e.initRefresh(),uni.stopPullDownRefresh(),e.toUpdateCoachLoca();case 4:case"end":return t.stop()}}),t)})))()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:(0,i.default)((0,i.default)((0,i.default)({},(0,c.mapActions)(["getConfigInfo","toPlayAudio"])),(0,c.mapMutations)(["updateUserItem","updateOrderItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i,s,c,u;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&!a&&t.userInfo.id){n.next=4;break}return n.next=4,t.getConfigInfo();case 4:return n.next=6,t.getList();case 6:if(t.$util.setNavigationBarColor({bg:t.primaryColor}),!a){n.next=9;break}return n.abrupt("return");case 9:a||(r=t.userCoachStatus,i=r.status,s=void 0===i?0:i,c=r.coach_position,u=void 0===c?0:c,u&&2==s?(t.$util.getCoachUtilLoca(),t.$jweixin.hideOptionMenu()):t.$jweixin.initJssdk((function(){t.$jweixin.hideOptionMenu()})));case 10:case"end":return n.stop()}}),n)})))()},initRefresh:function(){uni.pageScrollTo({duration:0,scrollTop:0}),this.param.page=1,this.initIndex(!0)},getList:function(){var e=arguments,t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i,s,c,u,l,d,f,p;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=e.length>0&&void 0!==e[0]&&e[0],r=t.list,i=t.param,s=t.tabList,c=t.activeIndex,i.pay_type=s[c].id,n.next=5,t.$api.technician.orderList(i);case 5:u=n.sent,u.data.map((function(e){e.is_show_more=!1})),l=u.data.filter((function(e){return e.pay_type>6})),l.length>0&&(d=l.map((function(e){return e.id})),f=t.order_unix_list,p=f.filter((function(e){return!d.includes(e.id)})),p.length!==f.length&&t.updateOrderItem({key:"order_unix_list",val:p})),a||(1==t.param.page||(u.data=r.data.concat(u.data)),t.list=u),t.tabList[0].number=u.agent_order_count,t.tabList[1].number=u.wait_order_count,t.tabList[2].number=u.service_order_count,t.loading=!1,t.$util.hideAll();case 15:case"end":return n.stop()}}),n)})))()},handerTabChange:function(e){this.activeIndex=e,this.param.page=1,this.getList()},toUnload:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.updateOrderItem({key:"recorder_status",val:!1}),e.updateOrderItem({key:"recorder_order_id",val:0});case 2:case"end":return t.stop()}}),t)})))()},handlerOnChanger:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=e.recorder_status,e.duration_time,n?e.$refs.recorder.stop():e.$refs.recorder.start(),e.updateOrderItem({key:"recorder_status",val:!n});case 3:case"end":return t.stop()}}),t)})))()},handlerOnEnd:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$refs.recorder.stop(),setTimeout((function(){e.handlerOnSave()}),1e3),e.updateOrderItem({key:"recorder_status",val:!1});case 3:case"end":return t.stop()}}),t)})))()},handlerOnSave:function(){var e=arguments,t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i,s,c,u,l,d;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.length>0&&void 0!==e[0]?e[0]:{},t.$util.showLoading({title:"录音上传中"}),"",r=parseInt((new Date).getTime()/1e3),i="服务过程录音-".concat(r,".mp3"),s=t.recorder.data,c=new File([s],i,{type:"audio/mp3"}),a=URL.createObjectURL(c),n.next=10,t.$api.base.uploadFile({filePath:a,formData:{type:"audio",name:i}});case 10:return u=n.sent,l=u.attachment_path,d=t.recorder_order_id,n.next=15,t.$api.technician.recordingAdd({order_id:d,link:l});case 15:t.$util.hideAll();case 16:case"end":return n.stop()}}),n)})))()},handlerSuccess:function(e){this.updateOrderItem({key:"recorder",val:e})},handlerError:function(e){switch(e){case"101":uni.showModal({content:"当前浏览器版本较低，请更换浏览器使用，推荐在微信中打开。"});break;case"201":uni.showModal({content:"麦克风权限被拒绝，请刷新页面后授权麦克风权限。"});break;default:uni.showModal({content:"未知错误，请刷新页面重试"});break}},toCountDownEnd:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r,i,s,c,u,l;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(a=t.recorder_status,r=t.recorder_order_id,r!=e||!a){n.next=11;break}return n.next=4,t.$api.technician.orderInfo({id:e});case 4:if(i=n.sent,s=i.total_time_long,c=i.start_service_time,u=void 0===c?"":c,l=Math.ceil((1e3*(t.$util.DateToUnix(u)+60*s)-(new Date).getTime())/1e3),!(l<1)){n.next=11;break}return n.next=10,t.handlerOnEnd();case 10:t.$refs.recorder.clear();case 11:case"end":return n.stop()}}),n)})))()},toRefuse:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:t.index=e,t.coach_refund_text="",t.$refs.refuse_item.open();case 3:case"end":return n.stop()}}),n)})))()},confirmRefuse:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.coach_refund_text,n=n.length>0?n.replace(/(^\s*)|(\s*$)/g,""):"",0!=n.length){t.next=5;break}return e.$util.showToast({title:"请输入拒单原因"}),t.abrupt("return");case 5:e.coach_refund_text=e.coach_refund_text.substring(0,200),a=e.index,e.toConfirm(a,-1);case 8:case"end":return t.stop()}}),t)})))()},toGetLocation:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a,r,i,s,c;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.popupInfo.isLoca=!1,e.popupInfo.location={isIp:!1,lat:0,lng:0,address:""},e.$util.showLoading({title:"定位中"}),t.prev=3,t.next=6,e.$util.getCoachUtilLoca(!1);case 6:n=t.sent,a=n.lat,r=n.lng,e.initUtilLocaData(a,r,!1),t.next=21;break;case 12:return t.prev=12,t.t0=t["catch"](3),console.log(t.t0,"=====catch e"),t.next=17,e.$util.getLocation();case 17:i=t.sent,s=i.lat,c=i.lng,e.initUtilLocaData(s,c,!1);case 21:case"end":return t.stop()}}),t,null,[[3,12]])})))()},initUtilLocaData:function(e,t,n){var a=this;return(0,s.default)((0,o.default)().mark((function r(){var i,s,c,u;return(0,o.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(e||t){r.next=4;break}return a.popupInfo.isLoca=!0,a.$util.hideAll(),r.abrupt("return");case 4:return r.next=6,a.$util.getMapAddr({lat:e,lng:t});case 6:i=r.sent,s=i.address,c={lat:e,lng:t,address:s},n||a.$util.updateCoachAddr(c),u=Object.assign({},a.popupInfo,{isLoca:!0,location:c}),a.$nextTick((function(){a.popupInfo=u})),a.$util.hideAll();case 13:case"end":return r.stop()}}),r)})))()},imgUpload:function(e){var t=e.imagelist,n=e.imgtype;this.popupInfo[n]=t},toChooseLocation:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.toConfirmChooseLoca();case 1:case"end":return t.stop()}}),t)})))()},toConfirmChooseLoca:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a,r,i,s;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$util.chooseLocation();case 2:if(n=t.sent,a=n.lat,r=n.lng,i=n.address,s=n.name,a||r){t.next=9;break}return t.abrupt("return");case 9:if(!s||i){t.next=12;break}return e.$util.showToast({title:"请选择具体的地址"}),t.abrupt("return");case 12:e.popupInfo.location={map_type:1,isIp:!1,lat:a,lng:r,address:"".concat(i," ").concat(s)};case 13:case"end":return t.stop()}}),t)})))()},confirmOper:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a,r,i,s,c,u,l,d,f,p;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$util.deepCopy(e.popupInfo),a=n.index,r=n.type,i=n.param,s=n.imgs,c=n.location,u=c.lat,l=void 0===u?0:u,d=c.lng,f=void 0===d?0:d,![5,7].includes(r)||0!==s.length){t.next=6;break}return e.$util.showToast({title:"请先拍照"}),t.abrupt("return");case 6:if(l||f){t.next=9;break}return e.toGetLocation(),t.abrupt("return");case 9:[5,7].includes(r)&&(p=s[0].path,c.path=p),e.toConfirmUpdate(a,r,i,c);case 11:case"end":return t.stop()}}),t)})))()},toConfirm:function(e,t){var n=this;return(0,s.default)((0,o.default)().mark((function a(){var r,i,s,c;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.lockTap){a.next=2;break}return a.abrupt("return");case 2:r=n.list.data[e].id,r*=1,i={order_id:r,type:t},-1==t&&(i.coach_refund_text=n.coach_refund_text),[4,5,7].includes(t)?(s={4:"确认出发",5:"确认到达",7:"确认完成"},c=s[t],n.popupInfo=Object.assign({},n.popupInfo,{title:c,index:e,type:t,param:i,imgs:[],isLoca:!1,location:{lat:0,lng:0,address:""}}),n.$refs.oper_item.open(),n.toGetLocation()):n.toConfirmUpdate(e,t,i);case 7:case"end":return a.stop()}}),a)})))()},toConfirmUpdate:function(e,t,n){var a=arguments,i=this;return(0,s.default)((0,o.default)().mark((function s(){var c,u,l,d,f,p,v,h,m,_,g,w,b,x,k,C,y,$,I,T,E,L,O,P,U,M,R,S,D,A;return(0,o.default)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:if(c=a.length>3&&void 0!==a[3]?a[3]:{},[4,5,7].includes(t)&&(u=c.lat,l=c.lng,d=c.address,f=c.path,p=c.map_type,v=void 0===p?0:p,n.map_type=v,4===t&&(n.serout_lat=u,n.serout_lng=l,n.serout_address=d),5==t&&(n.arrive_img=f,n.arr_lat=u,n.arr_lng=l,n.arr_address=d),7==t&&(n.end_img=f,n.end_lat=u,n.end_lng=l,n.end_address=d)),h={"-1":"已拒绝接单",3:"接单成功",4:"已成功出发",5:"已成功到达",6:"已开始服务",7:"服务已完成"},!i.lockTap){o.next=5;break}return o.abrupt("return");case 5:return i.lockTap=!0,m=i.configInfo,_=m.plugAuth,g=m.service_recording_show,w=_.recording,b=i.isUserMedia,x=i.recorder_order_id,k=i.recorder_status,C=!0,y=n.order_id,$={},o.prev=12,o.next=15,i.$api.technician.orderInfo({id:y});case 15:$=o.sent,o.next=27;break;case 18:return o.prev=18,o.t0=o["catch"](12),-1==t&&i.$refs.refuse_item.close(),[4,5,7].includes(t)&&i.$refs.oper_item.close(),i.param.page=1,i.getList(),i.lockTap=!1,i.$util.hideAll(),o.abrupt("return");case 27:if(I=$,T=I.pay_type,7!=T||x!=y||!k){o.next=32;break}return o.next=31,i.handlerOnEnd();case 31:i.$refs.recorder.clear();case 32:if(!(T<t&&6===t&&x!=y&&k)){o.next=46;break}return o.next=35,uni.showModal({title:"提示",content:"已有开始的服务还未结束录音，请确认是否完成录音并开始新的服务？"});case 35:if(E=o.sent,L=(0,r.default)(E,2),L[0],O=L[1].confirm,!O){o.next=45;break}return o.next=42,i.handlerOnEnd();case 42:i.$refs.recorder.clear(),o.next=46;break;case 45:C=!1;case 46:if(i.$util.showLoading(),C){o.next=51;break}return i.lockTap=!1,i.$util.hideAll(),o.abrupt("return");case 51:return o.prev=51,-1==t&&i.$refs.refuse_item.close(),[4,5,7].includes(t)&&i.$refs.oper_item.close(),o.next=56,i.$api.technician.updateOrder(n);case 56:if(4==t||5==t?(i.list.data[e].pay_type=t,i.updateOrderItem({key:4==t?"coach_travel_order_id":"coach_travel_arrive_id",val:y})):i.list.data.splice(e,1),6!=t){o.next=76;break}if(i.toPlayAudio({key:"service_start_recording"}),!(b&&w&&g)){o.next=65;break}return i.$util.hideAll(),o.next=63,uni.showModal({title:"提示",content:"服务过程将自动录音，直至服务结束！若录音中退出页面将不会记录录音的音频！",showCancel:!1,confirmText:"知道了"});case 63:i.updateOrderItem({key:"recorder_order_id",val:y}),i.handlerOnChanger();case 65:return o.next=67,i.$api.technician.orderInfo({id:y});case 67:P=o.sent,U=P.total_time_long,M=P.start_service_time,R=i.$util.DateToUnix(M)+60*U,S={id:y,time_long:U,start_service_time:M,start_service_time_unix:R},D=i.order_unix_list,A=D.findIndex((function(e){return e.id===y})),-1!=A?D[A]=S:D.push(S),i.updateOrderItem({key:"order_unix_list",val:D});case 76:if(7!=t){o.next=81;break}if(x!=y||!k){o.next=81;break}return o.next=80,i.handlerOnEnd();case 80:i.$refs.recorder.clear();case 81:return i.$util.hideAll(),i.$util.showToast({title:h[t]}),o.next=85,i.getList(!0);case 85:i.updateOrderItem({key:"haveOperItem",val:!0}),setTimeout((function(){i.lockTap=!1}),500),o.next=93;break;case 89:o.prev=89,o.t1=o["catch"](51),i.updateOrderItem({key:"haveOperItem",val:!0}),setTimeout((function(){i.param.page=1,i.getList(),i.lockTap=!1,i.$util.hideAll()}),2e3);case 93:case"end":return o.stop()}}),s,null,[[12,18],[51,89]])})))()},toShowMore:function(e){var t=this.list.data[e].is_show_more;this.list.data[e].is_show_more=!t},toChangeItem:function(e,t){var n=this;return(0,s.default)((0,o.default)().mark((function a(){var r,i,s,c,u;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(!n.lockTap){a.next=2;break}return a.abrupt("return");case 2:n.list.data[e].is_show_more=!1,r=n.list.data[e],i=r.id,s=r.order_code,c=r.order_goods,u=c[0].goods_cover,n.popupInfo={id:i,name:"单号：".concat(s),image:u,index:e,refs_key:t},n.$refs[t].open();case 7:case"end":return a.stop()}}),a)})))()},confirmOperItem:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a,r,i,s,c,u;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.popupInfo,a=n.id,r=n.index,i=n.refs_key,s={del_item:["delOrder","删除成功",-1]},c=s[i][0],u=s[i][1],!e.lockTap){t.next=6;break}return t.abrupt("return");case 6:return e.lockTap=!0,t.prev=7,e.$refs[i].close(),t.next=11,e.$api.technician[c]({id:a});case 11:e.list.data.splice(r,1),e.$util.showToast({title:u}),setTimeout((function(){"del_item"==i&&e.list.data.length<5&&e.initRefresh(),e.lockTap=!1}),1e3),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](7),setTimeout((function(){e.getList(1),e.lockTap=!1}),2e3);case 19:case"end":return t.stop()}}),t,null,[[7,16]])})))()},toShield:function(e){this.index=e,this.list.data[e].is_show_more=!1;var t=this.configInfo.block_user_type,n=void 0===t?1:t;1!=n?this.$util.goUrl({url:"/user/pages/feedback/box?blockuser=1&index=".concat(e)}):this.$refs.shield_item.open()},confirmShield:function(){var e=this;return(0,s.default)((0,o.default)().mark((function t(){var n,a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.index,!e.lockTap){t.next=3;break}return t.abrupt("return");case 3:return e.lockTap=!0,e.$util.showLoading(),a=e.list.data[n].user_id,t.prev=6,t.next=9,e.$api.technician.shieldUserAdd({user_id:a});case 9:e.$util.hideAll(),e.$refs.shield_item.close(),e.$util.showToast({title:"屏蔽成功"}),e.initRefresh(),setTimeout((function(){e.lockTap=!1}),1e3),t.next=19;break;case 16:t.prev=16,t.t0=t["catch"](6),setTimeout((function(){e.lockTap=!1,e.$util.hideAll()}),2e3);case 19:case"end":return t.stop()}}),t,null,[[6,16]])})))()},toTel:function(e){var t=this;return(0,s.default)((0,o.default)().mark((function n(){var a,r;return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return a=t.list.data[e].id,n.next=3,t.$api.technician.getVirtualPhone({order_id:a});case 3:if(r=n.sent,r){n.next=7;break}return t.$util.showToast({title:"稍后会有电话打入，请注意接听哦"}),n.abrupt("return");case 7:t.$util.goUrl({url:r,openType:"call"});case 8:case"end":return n.stop()}}),n)})))()},goDetail:function(e){var t=this.list.data[e].id;this.list.data[e].is_show_more=!1;var n="/technician/pages/order/detail?id=".concat(t);this.$util.goUrl({url:n})}})};t.default=l},"6af0":function(e,t,n){"use strict";n("6a54");var a=n("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r=a(n("2634")),i=a(n("2fdc")),o=a(n("9b1b"));n("5ef2"),n("bf0f"),n("2797"),n("18f7"),n("de6c"),n("aa9c");var s=n("8f59"),c=null,u={data:function(){return{stream:null,recorder:null,chunks:[],startTime:0,duration_time:300,duration:0,is_save:!1}},mounted:function(){if(-1===origin.indexOf("https"))throw this.$emit("error","100"),"请在 https 环境中使用本插件。";if(!navigator.mediaDevices||!window.MediaRecorder)throw this.$emit("error","101"),"当前浏览器不支持";this.getRecorderManager()},computed:(0,s.mapState)({isUserMedia:function(e){return e.order.isUserMedia},recorder_status:function(e){return e.order.recorder_status}}),watch:{duration:function(e,t){var n=this.recorder_status,a=this.duration_time,r=!(a-e>1);console.log(e,n,r,"========newVal, recorder_status, isReset"),n&&r&&this.save()}},methods:(0,o.default)((0,o.default)({},(0,s.mapMutations)(["updateOrderItem"])),{},{getRecorderManager:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.updateOrderItem({key:"isUserMedia",val:!0}),t.getTracks().forEach((function(e){e.stop()}))})).catch((function(t){e.onErrorHandler(t)}))},start:function(){var e=this;return(0,i.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.isUserMedia){t.next=2;break}return t.abrupt("return",console.log("设备不支持"));case 2:navigator.mediaDevices.getUserMedia({audio:!0}).then((function(t){e.stream=t,e.recorder=new MediaRecorder(t),e.recorder.ondataavailable=e.getRecordingData,e.recorder.onstop=e.saveRecordingData,e.recorder.start(),e.recordingTimer()})).catch((function(t){e.onErrorHandler(t)}));case 3:case"end":return t.stop()}}),t)})))()},stop:function(){var e=this;return(0,i.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.recorder.stop(),e.stream.getTracks().forEach((function(e){e.stop()}));case 2:case"end":return t.stop()}}),t)})))()},save:function(){var e=this;return(0,i.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.is_save=!0,t.next=3,Promise.all([e.stop(),e.recordingTimer(!1)]);case 3:setTimeout((function(){e.chunks=[],e.start()}),500);case 4:case"end":return t.stop()}}),t)})))()},clear:function(){this.chunks=[],c&&clearInterval(c)},recordingTimer:function(){var e=arguments,t=this;return(0,i.default)((0,r.default)().mark((function n(){var a;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:a=!(e.length>0&&void 0!==e[0])||e[0],a?c=setInterval((function(){var e=t.duration;e++,t.duration=e}),1e3):(t.duration=0,clearInterval(c),c=null,console.log("暂停计时 recordingTimer",c));case 2:case"end":return n.stop()}}),n)})))()},getRecordingData:function(e){this.chunks.push(e.data)},saveRecordingData:function(){var e=new Blob(this.chunks,{type:"audio/mpeg"});this.$emit("success",{data:e}),this.is_save&&(this.$emit("save"),this.is_save=!1)},onErrorHandler:function(e){if(console.log(e,"========onErrorHandler"),"NotAllowedError"===e.name)throw this.$emit("error","201"),"用户拒绝了当前的浏览器实例的访问请求";if("NotReadableError"===e.name)throw this.$emit("error","101"),"当前浏览器不支持";throw this.$emit("error","500"),"调用失败，原因不详"}}),destroyed:function(){this.stop(),c&&clearInterval(c)}};t.default=u},bd82:function(e,t,n){"use strict";n.r(t);var a=n("65fd"),r=n.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},ec8d:function(e,t,n){"use strict";n.r(t);var a=n("2f6c"),r=n("45b4");for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n("828b"),s=Object(o["a"])(r["default"],a["b"],a["c"],!1,null,"28afc4ea",null,!1,a["a"],void 0);t["default"]=s.exports},fe52:function(e,t,n){"use strict";var a=n("28fc"),r=n.n(a);r.a},ff8c:function(e,t,n){var a=n("c86c");t=a(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.show-more-tag[data-v-68d6db65]{width:%?20?%;height:%?20?%;top:%?70?%;left:50%;margin-left:%?-10?%;background:#fff;-webkit-transform:rotate(45deg);transform:rotate(45deg);box-shadow:0 0 4px 4px hsla(0,0%,87.1%,.37);z-index:99990}.show-more-info[data-v-68d6db65]{top:%?80?%;right:%?-71?%;width:%?200?%;background:#fff;box-shadow:0 6px 16px 0 hsla(0,0%,87.1%,.37);border-radius:16px;border:1px solid #f5f5f5;z-index:99999}',""]),e.exports=t}}]);