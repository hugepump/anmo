(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["agent-pages-refund-refund"],{"062b":function(e,t,r){"use strict";r("6a54");var n=r("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,r("fd3c"),r("5c47"),r("0506"),r("d4b5"),r("aa9c");var i=n(r("2634")),a=n(r("2fdc")),c=n(r("9b1b")),o=r("8f59"),s={components:{},data:function(){return{isLoad:!1,options:{},statusType:{"-1":"已取消",1:"待支付",2:"待接单",3:"已接单",4:"已出发",5:"已到达",6:"服务中",7:"已完成",8:"待转单"},refundForm:{},lockTap:!1}},computed:(0,o.mapState)({configInfo:function(e){return e.config.configInfo}}),onLoad:function(e){var t=e.agent,r=void 0===t?0:t,n=e.detail,i=void 0===n?0:n;e.agent=1*r,e.detail=1*i,this.options=e,this.initIndex()},methods:(0,c.default)((0,c.default)((0,c.default)({},(0,o.mapActions)(["getConfigInfo","getCoachInfo"])),(0,o.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,a.default)((0,i.default)().mark((function r(){var n,a,c,o,s,d,u,l,f;return(0,i.default)().wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],t.configInfo.id&&!n){r.next=4;break}return r.next=4,t.getConfigInfo();case 4:return t.$util.setNavigationBarColor({bg:t.primaryColor}),a=t.options,c=a.id,o=a.agent,s=o?"agent":"admin",r.next=9,t.$api[s].refundOrderInfo({id:c});case 9:d=r.sent,u=t.$util.pick(d,["id","car_price","material_price","order_goods","pay_type","refund_empty_cash","apply_comm_cash","comm_balance"]),u.refund_car_price=u.car_price,l=u.refund_empty_cash,u.init_empty_order_cash=l,u.empty_order_cash=l,u.refund_empty_cash=l,u.is_empty_check=!1,f=0,u.order_goods.map((function(e){var t=e.num,r=e.goods_price,n=e.material_price,i=e.apply_comm_cash;i=1*(i/t).toFixed(2),e.refund_price=r,e.refund_material_price=n,e.apply_comm_cash=i,e.refund_comm_price=i,e.refund_comm_cash=i,e.total_refund_price=((1*r+1*n-1*i)*t).toFixed(2),f+=1*e.total_refund_price})),u.total_refund_price=(f+u.car_price-l).toFixed(2),t.refundForm=u,t.isLoad=!0,n||t.$jweixin.hideOptionMenu();case 23:case"end":return r.stop()}}),r)})))()},initRefresh:function(){this.initIndex(!0)},checkInput:function(e,t,r){var n=this,i=this.$util.formatMoney(e.detail.value);this.$nextTick((function(){-1==t?n.refundForm[r]=i:n.refundForm.order_goods[t][r]=i}))},handleCheckOrderItem:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.refundForm,i=(n.is_check,n.order_goods),a=n.refund_car_price,c=n.car_price,o=n.is_empty_check,s=n.refund_empty_cash,d=n.empty_order_cash,u=n.init_empty_order_cash,l=n.comm_balance;if(3==t){var f=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;f.test(a)||(a=0),1*a>1*c&&(a=c),this.$nextTick((function(){e.refundForm.refund_car_price=a}))}if(4==t&&(o=!o,this.$nextTick((function(){e.refundForm.is_empty_check=o}))),5==t){var p=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;p.test(s)||(s=0),1*s>1*d&&(s=d),this.$nextTick((function(){e.refundForm.refund_empty_cash=s}))}if(0==t){var m=i[r],_=m.num,v=m.refund_price,h=m.refund_material_price,g=m.goods_price,b=m.material_price,w=m.refund_comm_price,x=m.refund_comm_cash,C=/^(([1-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/;C.test(v)&&1*v!=0||(v=.01),1*v>g&&(v=g),C.test(h)||(h=0),1*h>b&&(h=b),C.test(x)||(x=0),w=((1*v+1*h)*l/100).toFixed(2),x=x>w?w:x;var y=((1*v+1*h-1*x)*_).toFixed(2);this.$nextTick((function(){e.refundForm.order_goods[r].refund_price=v,e.refundForm.order_goods[r].refund_material_price=h,e.refundForm.order_goods[r].refund_comm_price=w,e.refundForm.order_goods[r].refund_comm_cash=x,e.refundForm.order_goods[r].total_refund_price=y}))}this.$nextTick((function(){var t=0;e.refundForm.order_goods.map((function(e){t+=1*e.total_refund_price})),1*t<u&&(d=t,s=1*s>t?t:s);var r=o?-1*d+1*s:-1*d,n=1*t+(1*a+1*r);e.refundForm.total_refund_price=n.toFixed(2),e.refundForm.empty_order_cash=d,e.refundForm.refund_empty_cash=s}))},toConfirmRefund:function(){var e=this;return(0,a.default)((0,i.default)().mark((function t(){return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:setTimeout((function(){e.toRefundOrder()}),200);case 1:case"end":return t.stop()}}),t)})))()},toRefundOrder:function(){var e=this;return(0,a.default)((0,i.default)().mark((function t(){var r,n,a,c,o,s,d,u,l,f,p,m,_,v,h,g;return(0,i.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r=JSON.parse(JSON.stringify(e.refundForm)),n=r.id,a=r.refund_car_price,c=void 0===a?0:a,o=r.total_refund_price,s=r.is_empty_check,d=r.empty_order_cash,u=r.refund_empty_cash,l=r.order_goods,f=[],p=1*c,l.map((function(e){var t=e.id,r=e.num,n=e.refund_price,i=e.refund_material_price,a=e.refund_comm_cash,c=void 0===a?0:a;f.push({id:t,goods_price:n,material_price:i,refund_comm_cash:c}),p+=(1*n+1*i-1*c)*r})),1*p!==1*o&&(o=p),u=s?u:0,o=(1*o-1*d+1*u).toFixed(2),m={order_id:n,list:f,car_price:c,price:o,refund_empty_cash:(1*d-1*u).toFixed(2),apply_empty_cash:u,text:""},_=e.options,v=_.agent,h=_.detail,g=v?"agent":"admin",e.$util.showLoading(),!e.lockTap){t.next=14;break}return t.abrupt("return");case 14:return e.lockTap=!0,t.prev=15,t.next=18,e.$api[g].passRefundV2(m);case 18:e.$util.hideAll(),e.$util.showToast({title:"操作成功"}),setTimeout((function(){e.$util.back(),e.updateTechnicianItem({key:"haveOperItem",val:!0}),h&&e.$util.getPage(-2).initRefresh(),e.$util.goUrl({url:1,openType:"navigateBack"})}),1e3),t.next=27;break;case 23:t.prev=23,t.t0=t["catch"](15),e.lockTap=!1,e.$util.hideAll();case 27:case"end":return t.stop()}}),t,null,[[15,23]])})))()}})};t.default=s},"4eb1":function(e,t,r){var n=r("e331");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var i=r("967d").default;i("35f6d98d",n,!0,{sourceMap:!1,shadowMode:!1})},"564d":function(e,t,r){"use strict";r.r(t);var n=r("5cbe"),i=r("6833");for(var a in i)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return i[e]}))}(a);r("79df");var c=r("828b"),o=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"012c71b9",null,!1,n["a"],void 0);t["default"]=o.exports},"5cbe":function(e,t,r){"use strict";r.d(t,"b",(function(){return n})),r.d(t,"c",(function(){return i})),r.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return e.isLoad?r("v-uni-view",{staticClass:"user-order-refund",staticStyle:{"padding-top":"1rpx"},style:{background:e.pageColor}},[r("v-uni-view",{staticClass:"fill-base pd-lg mt-md ml-md mr-md radius-16"},[e._l(e.refundForm.order_goods,(function(t,n){return[r("v-uni-view",{key:n+"_0",staticClass:"item-child",class:[{"mt-lg":0!=n},{"pb-lg b-1px-b":n!=e.refundForm.order_goods.length-1}]},[r("v-uni-view",{staticClass:"flex-warp",on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(1,n)}}},[r("v-uni-view",{staticClass:"goods-img"},[r("v-uni-view",{staticClass:"h5-image goods-img",style:{backgroundImage:"url('"+t.goods_cover+"')"}})],1),r("v-uni-view",{staticClass:"flex-1 ml-md"},[r("v-uni-view",{staticClass:"flex-between"},[r("v-uni-view",{staticClass:"f-title c-title text-bold max-300 ellipsis"},[e._v(e._s(t.goods_name))]),r("v-uni-view",{staticClass:"f-desc",style:{color:2==e.refundForm.pay_type?e.primaryColor:[3,4,5].includes(e.refundForm.pay_type)?e.subColor:6==e.refundForm.pay_type?"#11C95E":"#333"}},[e._v(e._s(e.statusType[e.refundForm.pay_type]))])],1),r("v-uni-view",{staticClass:"f-caption c-caption mt-sm",staticStyle:{height:"30rpx"}},[1*t.material_price>0?[e._v(e._s(e.$t("action.materialText"))+"：¥"+e._s(t.material_price))]:e._e()],2),r("v-uni-view",{staticClass:"flex-between mt-md"},[r("v-uni-view",{staticClass:"f-desc c-warning text-bold"},[e._v("¥"+e._s(t.goods_price))]),r("v-uni-view",{staticClass:"f-desc",staticStyle:{color:"#4D4D4D"}},[e._v("x"+e._s(t.num))])],1)],1)],1),r("v-uni-view",{staticClass:"mt-sm"},[1*t.goods_price>0?r("v-uni-view",{staticClass:"flex-between f-paragraph mt-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("项目金额")]),r("v-uni-view",{staticClass:"flex-y-center c-title"},[r("v-uni-input",{staticClass:"text-right",attrs:{type:"number",placeholder:"请输入"+e.$t("action.materialText")},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.checkInput(t,n,"refund_price")},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(0,n)}},model:{value:e.refundForm.order_goods[n].refund_price,callback:function(t){e.$set(e.refundForm.order_goods[n],"refund_price",t)},expression:"refundForm.order_goods[aindex].refund_price"}}),r("v-uni-view",{staticClass:"ml-sm"},[e._v("元")])],1)],1):e._e(),1*t.material_price>0?r("v-uni-view",{staticClass:"flex-between f-paragraph mt-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v(e._s(e.$t("action.materialText")))]),r("v-uni-view",{staticClass:"flex-y-center c-title"},[r("v-uni-input",{staticClass:"text-right",attrs:{type:"number",placeholder:"请输入"+e.$t("action.materialText")},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.checkInput(t,n,"refund_material_price")},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(0,n)}},model:{value:e.refundForm.order_goods[n].refund_material_price,callback:function(t){e.$set(e.refundForm.order_goods[n],"refund_material_price",t)},expression:"refundForm.order_goods[aindex].refund_material_price"}}),r("v-uni-view",{staticClass:"ml-sm"},[e._v("元")])],1)],1):e._e(),1*t.refund_comm_price>0?r("v-uni-view",{staticClass:"flex-between f-paragraph mt-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("手续费")]),r("v-uni-view",{staticClass:"flex-y-center c-title"},[r("v-uni-input",{staticClass:"text-right",attrs:{type:"number",placeholder:"请输入手续费"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.checkInput(t,n,"refund_comm_cash")},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(0,n)}},model:{value:e.refundForm.order_goods[n].refund_comm_cash,callback:function(t){e.$set(e.refundForm.order_goods[n],"refund_comm_cash",t)},expression:"refundForm.order_goods[aindex].refund_comm_cash"}}),r("v-uni-view",{staticClass:"ml-sm"},[e._v("元")])],1)],1):e._e(),r("v-uni-view",{staticClass:"flex-between f-paragraph mt-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("累计退款金额")]),r("v-uni-view",{staticClass:"c-title text-bold"},[e._v("¥"+e._s(t.total_refund_price))])],1)],1)],1)]}))],2),r("v-uni-view",{staticClass:"fill-base pd-lg mt-md ml-md mr-md radius-16"},[1*e.refundForm.car_price>0?r("v-uni-view",{staticClass:"flex-between f-paragraph mb-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("车费")]),r("v-uni-view",{staticClass:"flex-y-center c-title"},[r("v-uni-input",{staticClass:"text-right",attrs:{type:"number",placeholder:"请输入车费"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.checkInput(t,-1,"refund_car_price")},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(3)}},model:{value:e.refundForm.refund_car_price,callback:function(t){e.$set(e.refundForm,"refund_car_price",t)},expression:"refundForm.refund_car_price"}}),r("v-uni-view",{staticClass:"ml-sm"},[e._v("元")])],1)],1):e._e(),1*e.refundForm.empty_order_cash>0?[r("v-uni-view",{staticClass:"flex-between f-paragraph mb-md"},[r("v-uni-view",{staticClass:"flex-center",staticStyle:{height:"38rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(4)}}},[r("i",{staticClass:"iconfont mr-sm",class:[{"icon-xuanze":!e.refundForm.is_empty_check},{"icon-xuanze-fill":e.refundForm.is_empty_check}],style:{color:e.refundForm.is_empty_check?e.primaryColor:"#CACACA"}}),r("v-uni-view",{staticClass:"c-paragraph"},[e._v("空单费"+e._s(e.refundForm.is_empty_check?"退款金额":""))])],1),e.refundForm.is_empty_check?r("v-uni-view",{staticClass:"flex-y-center c-title"},[r("v-uni-input",{staticClass:"text-right",attrs:{type:"number",placeholder:"请输入空单费"},on:{input:function(t){arguments[0]=t=e.$handleEvent(t),e.checkInput(t,-1,"refund_empty_cash")},blur:function(t){arguments[0]=t=e.$handleEvent(t),e.handleCheckOrderItem(5)}},model:{value:e.refundForm.refund_empty_cash,callback:function(t){e.$set(e.refundForm,"refund_empty_cash",t)},expression:"refundForm.refund_empty_cash"}}),r("v-uni-view",{staticClass:"ml-sm"},[e._v("元")])],1):r("v-uni-view",{staticClass:"c-title"},[e._v("-¥"+e._s(e.refundForm.empty_order_cash))])],1)]:e._e(),1*e.refundForm.discount>0?r("v-uni-view",{staticClass:"flex-between f-paragraph mb-md"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("卡券抵扣")]),r("v-uni-view",{staticClass:"c-title"},[e._v("¥"+e._s(e.refundForm.discount))])],1):e._e(),r("v-uni-view",{staticClass:"flex-between f-paragraph"},[r("v-uni-view",{staticClass:"c-paragraph"},[e._v("总计")]),r("v-uni-view",{staticClass:"c-warning text-bold"},[e._v("¥"+e._s(e.refundForm.total_refund_price))])],1)],2),r("v-uni-view",{staticClass:"space-max-footer"}),r("v-uni-view",{staticClass:"refund-bottom-info fill-base fix pl-lg pr-lg"},[r("v-uni-view",{staticClass:"flex-between"},[r("v-uni-view"),r("v-uni-view",{staticClass:"flex-center"},[r("v-uni-button",{staticClass:"clear-btn order",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.$util.goUrl({url:1,openType:"navigateBack"})}}},[e._v("取消")]),r("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:e.primaryColor,borderColor:e.primaryColor},on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toConfirmRefund.apply(void 0,arguments)}}},[e._v("确认")])],1)],1),r("v-uni-view",{staticClass:"space-safe"})],1)],1):e._e()},i=[]},6833:function(e,t,r){"use strict";r.r(t);var n=r("062b"),i=r.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){r.d(t,e,(function(){return n[e]}))}(a);t["default"]=i.a},"79df":function(e,t,r){"use strict";var n=r("4eb1"),i=r.n(n);i.a},e331:function(e,t,r){var n=r("c86c");t=n(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.user-order-refund .item-child .icon-xuanze[data-v-012c71b9],\n.user-order-refund .item-child .icon-xuanze-fill[data-v-012c71b9]{font-size:%?38?%}.user-order-refund .item-child .goods-img[data-v-012c71b9]{width:%?147?%;height:%?147?%;border-radius:%?26?%}.user-order-refund .item-child .goods-num[data-v-012c71b9]{width:%?200?%}.user-order-refund .item-child .textarea-info[data-v-012c71b9]{background:#f7f7f7}.user-order-refund .item-child .textarea-info .input-textarea[data-v-012c71b9]{width:%?570?%;height:%?300?%}.user-order-refund .refund-bottom-info[data-v-012c71b9]{bottom:0}.user-order-refund .refund-bottom-info .iconfont[data-v-012c71b9]{font-size:%?38?%}.user-order-refund .refund-bottom-info .flex-between[data-v-012c71b9]{height:%?122?%}.user-order-refund .refund-bottom-info .flex-between .order[data-v-012c71b9]{width:%?189?%;height:%?76?%;color:#333;font-size:%?30?%;border-radius:%?50?%;border:%?1?% solid #c7c7c7}',""]),e.exports=t}}]);