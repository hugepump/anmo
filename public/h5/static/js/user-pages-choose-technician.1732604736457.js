(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user-pages-choose-technician"],{"0461":function(t,e,a){"use strict";a("6a54");var n=a("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,a("bd06"),a("c223");var i=n(a("9b1b")),o=n(a("2634")),c=n(a("2fdc")),r=a("8f59"),s=n(a("4c72")),l=n(a("9cb1")),u={components:{longbingbingTechnicianListItem:s.default,longbingbingTechnicianListPopup:l.default},data:function(){return{isLoad:!1,options:{},navTitle:"",param:{page:1,ser_id:0,coach_name:""},list:{data:[]},loading:!0,lockTap:!1,pageLen:1,appMethod:""}},computed:(0,r.mapState)({configInfo:function(t){return t.config.configInfo},cityList:function(t){return t.technician.cityList},technicianParam:function(t){return t.technician.param},loginType:function(t){return t.user.loginType}}),onLoad:function(t){var e=this;return(0,c.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log("====onLoad choose-technician"),e.options=t,a.next=4,e.initIndex();case 4:n="选择".concat(e.$t("action.attendantName")),e.navTitle=n,uni.setNavigationBarTitle({title:n}),e.isLoad=!0;case 8:case"end":return a.stop()}}),a)})))()},onShow:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:!t.location.lat&&t.locaRefuse&&t.toResetUtilLoca();case 1:case"end":return e.stop()}}),e)})))()},onPullDownRefresh:function(){uni.showNavigationBarLoading(),this.configInfo.realtime_location&&this.updateUserItem({key:"changeAddr",val:!1}),this.initRefresh(),uni.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},watch:{locaRefuse:function(t,e){t||this.toResetUtilLoca()}},methods:(0,i.default)((0,i.default)((0,i.default)({},(0,r.mapActions)(["getConfigInfo","getCityList"])),(0,r.mapMutations)(["updateUserItem","updateServiceItem","updateTechnicianItem","updateMapItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,c.default)((0,o.default)().mark((function a(){var n;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!n){a.next=4;break}return a.next=4,e.getConfigInfo();case 4:return e.pageLen=getCurrentPages().length,a.next=7,e.isNotLoca();case 7:n||e.$jweixin.hideOptionMenu();case 8:case"end":return a.stop()}}),a)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toResetUtilLoca:function(){return(0,c.default)((0,o.default)().mark((function t(){return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:case"end":return t.stop()}}),t)})))()},toConfirmAppCheckAuth:function(){var t=this.appMethod;this[t]()},toOpenLocation:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.toConfirmOpenLoca();case 1:case"end":return e.stop()}}),e)})))()},toConfirmOpenLoca:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.initRefresh();case 1:case"end":return e.stop()}}),e)})))()},toSearch:function(t){this.param.page=1,this.param.coach_name=t,this.getList()},toChooseLocation:function(){var t=arguments,e=this;return(0,c.default)((0,o.default)().mark((function a(){var n,i,c,r;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=t.length>0&&void 0!==t[0]?t[0]:0,e.updateUserItem({key:"changeAddr",val:!0}),!n){a.next=6;break}return i=e.location,c=i.lat,r=i.lng,a.next=6,e.getCityList({lat:c,lng:r,change:1});case 6:return e.param.page=1,a.next=9,e.getList();case 9:case"end":return a.stop()}}),a)})))()},isNotLoca:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){var a,n,i,c,r,s,l,u,d;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(a=t.location,t.locaRefuse,n=t.changeAddr,i=t.configInfo.realtime_location,c=void 0===i?0:i,r=t.userCoachStatus,s=r.status,l=void 0===s?0:s,u=r.coach_position,d=void 0===u?0:u,d&&2==l&&a.lat&&"暂未获取到位置信息"!=a.address&&t.updateUserItem({key:"isChangeCoachLoca",val:!0}),!(!a.lat||a.lat&&"暂未获取到位置信息"==a.address||c&&!n)){e.next=9;break}return e.next=7,t.$util.getUtilLocation();case 7:t.updateServiceItem({key:"pageActive",val:!1}),t.updateMapItem({key:"pageActive",val:!1});case 9:t.initUtilLocaData();case 10:case"end":return e.stop()}}),e)})))()},getUtilLocation:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$util.getUtilLocation();case 2:t.initUtilLocaData();case 3:case"end":return e.stop()}}),e)})))()},initUtilLocaData:function(){var t=this;return(0,c.default)((0,o.default)().mark((function e(){var a,n,i,c,r,s,l,u,d,f,p,h,v,g,m;return(0,o.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a=t.technicianParam.city_id,n=void 0===a?0:a,i=t.city_info.id,c=void 0===i?0:i,r=t.$util.deepCopy(t.technicianParam),r.city_id=n||c,t.updateTechnicianItem({key:"param",val:r}),e.next=7,t.getList(!t.technicianParam.city_id||!t.changeAddr);case 7:s=t.changeAddr,l=t.configInfo.realtime_location,u=void 0===l?0:l,d=t.location,f=d.lat,void 0===f?0:f,p=d.lng,void 0===p?0:p,h=d.is_util_loca,v=void 0===h?0:h,g=d.isIp,m=void 0===g||g,(v||u&&!s)&&t.$util.getMapInfo(m,!0,{},s);case 11:case"end":return e.stop()}}),e)})))()},getList:function(){var t=arguments,e=this;return(0,c.default)((0,o.default)().mark((function a(){var n,i,c,r,s,l,u,d,f,p,h,v,g,m,_,w,x,y,C,b,k;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=t.length>0&&void 0!==t[0]&&t[0],i=e.location,c=i.lat,r=void 0===c?0:c,s=i.lng,l=void 0===s?0:s,u=i.is_util_loca,void 0===u?0:u,d=i.isIp,void 0===d||d,!n&&0!=e.cityList.length){a.next=5;break}return a.next=5,e.getCityList({lat:r,lng:l,change:n?1:e.technicianParam.city_id?0:1});case 5:if(f=e.options,p=f.id,h=f.store_id,v=void 0===h?0:h,g=e.list,m=e.param,_=e.cityList,w=e.technicianParam.city_id,x=_.findIndex((function(t){return t.id==w})),-1!=x){a.next=15;break}return e.loading=!1,e.$util.hideAll(),e.list={data:[],last_page:1,current_page:1},e.$refs.choose_city_item.open(),a.abrupt("return");case 15:return m=Object.assign({},m,{lat:r,lng:l,ser_id:p,city_id:w,store_id:v}),y=e.configInfo.coach_format,C=void 0===y?1:y,b=2==C?"typeServiceCoachList":"serviceCoachList",a.next=20,e.$api.service[b](m);case 20:k=a.sent,1==e.param.page||(k.data=g.data.concat(k.data)),e.list=k,e.loading=!1,e.$util.hideAll();case 24:case"end":return a.stop()}}),a)})))()},toShowPopup:function(t,e){var a=this;return(0,c.default)((0,o.default)().mark((function n(){return(0,o.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:a.$refs.technician_list_popup.toShowPopup(a.list.data[t],e);case 1:case"end":return n.stop()}}),n)})))()},toCollect:function(t){var e=this;return(0,c.default)((0,o.default)().mark((function a(){var n,i,c,r,s;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return n=e.list.data[t],i=n.id,c=n.is_collect,r=n.collect_num,s=c?"delCollect":"addCollect",a.next=4,e.$api.mine[s]({coach_id:i});case 4:e.$util.showToast({title:c?"取消成功":"收藏成功"}),e.list.data[t].is_collect=1==c?0:1,e.list.data[t].collect_num=1==c?r-1:r+1;case 7:case"end":return a.stop()}}),a)})))()},toOrder:function(t){var e=this;return(0,c.default)((0,o.default)().mark((function a(){var n,i,c,r,s,l;return(0,o.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(n=e.list.data[t],i=n.id,c=n.is_work,r=void 0===c?0:c,r){a.next=3;break}return a.abrupt("return");case 3:if(s=e.options.id,!e.lockTap){a.next=6;break}return a.abrupt("return");case 6:return e.lockTap=!0,a.prev=7,a.next=10,e.$api.order.addCar({service_id:s,coach_id:i,num:1,is_top:1,coach_service:1});case 10:e.lockTap=!1,l="/user/pages/order?id=".concat(i,"&ser_id=").concat(s),e.$util.goUrl({url:l}),a.next=18;break;case 15:a.prev=15,a.t0=a["catch"](7),e.lockTap=!1;case 18:case"end":return a.stop()}}),a,null,[[7,15]])})))()},toBack:function(){var t=this.pageLen,e=t>1?1:"/pages/service",a=t>1?"navigateBack":"reLaunch";this.$util.goUrl({url:e,openType:a})}}),filters:{handleAddrText:function(t){var e="定位中...";if(t&&t.lat){var a=t.address,n=void 0===a?"":a,i=t.address_info,o=void 0===i?"":i;if(n||o){if(!o){var c=n.split(" ");o=c[c.length-1]}e=o}}return e},handleCityText:function(t){var e="未知城市";return t&&t.title&&(e=t.title),e}}};e.default=u},"36ad":function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){}));var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"pages-technician",style:{background:t.pageColor}},[a("fixed",{attrs:{initHeight:t.configInfo}},[3!==t.configInfo.coach_format?[a("uni-nav-bar",{attrs:{fixed:!1,shadow:!1,statusBar:!0,onlyLeft:!0,color:"#fff",backgroundColor:t.primaryColor}},[a("v-uni-view",{staticClass:"map-info flex-y-center",attrs:{slot:"left"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$util.goUrl({url:"/user/pages/choose/index?type=1"})}},slot:"left"},[a("v-uni-view",{staticClass:"flex-y-center c-base"},[a("i",{staticClass:"iconfont iconjuli mr-sm"}),a("v-uni-view",{staticClass:"map-text max-400 ellipsis"},[t.configInfo.user_update_location?[t._v(t._s(t._f("handleAddrText")(t.location)))]:[t._v(t._s(t._f("handleCityText")(t.city_info)))]],2),a("i",{staticClass:"iconfont icon-down"})],1)],1)],1)]:void 0,a("v-uni-view",{staticClass:"fix-info choose rel",style:{background:t.pageColor,height:3!==t.configInfo.coach_format?"129rpx":"214rpx"}},[3!==t.configInfo.coach_format?a("v-uni-view",{staticClass:"space-top abs",style:{background:t.primaryColor}}):t._e(),a("v-uni-view",{staticClass:"search-info fill-base pt-lg pl-lg pr-lg pb-md abs",style:{borderRadius:3==t.configInfo.coach_format?"0rpx":""}},[a("v-uni-view",{staticClass:"pb-sm"},[3==t.configInfo.coach_format?a("v-uni-view",{staticClass:"map-info flex-y-center pb-lg",staticStyle:{color:"#7A7D7C"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$util.goUrl({url:"/user/pages/choose/index"})}}},[a("v-uni-view",{staticClass:"flex-y-center"},[a("i",{staticClass:"iconfont iconjuli mr-sm",style:{color:t.primaryColor}}),a("v-uni-view",{staticClass:"map-text ellipsis",staticStyle:{"max-width":"600rpx"}},[t.configInfo.user_update_location?[t._v(t._s(t._f("handleAddrText")(t.location)))]:[t._v(t._s(t._f("handleCityText")(t.city_info)))]],2),a("i",{staticClass:"iconfont icon-down"})],1)],1):t._e(),a("v-uni-view",{staticClass:"flex-1"},[a("search",{attrs:{type:"input",keyword:t.param.coach_name,padding:0,radius:30,height:"70rpx",backgroundColor:"#F0F0F0",placeholder:"请输入"+t.$t("action.attendantName")+"姓名"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.toSearch.apply(void 0,arguments)}}})],1)],1)],1)],1)],2),t.list.data&&t.list.data.length>0?a("v-uni-view",{staticClass:"ml-md mr-md",class:[{"flex-warp":2===t.configInfo.coach_list_format||2===t.configInfo.plugAuth.industrytype}]},t._l(t.list.data,(function(e,n){return a("v-uni-view",{key:n,staticClass:"mt-md",class:[{"mr-md":(2==t.configInfo.coach_list_format||2===t.configInfo.plugAuth.industrytype)&&n%2==0}]},[a("longbingbing-technician-list-item",{attrs:{info:e},on:{comment:function(e){arguments[0]=e=t.$handleEvent(e),t.toShowPopup(n,"message")},collect:function(e){arguments[0]=e=t.$handleEvent(e),t.toCollect(n)},order:function(e){arguments[0]=e=t.$handleEvent(e),t.toOrder(n)}}})],1)})),1):t._e(),t.loading?a("load-more",{attrs:{noMore:t.list.current_page>=t.list.last_page&&t.list.data.length>0&&t.location.lng,loading:t.loading}}):t._e(),!t.loading&&t.list.data.length<=0&&1==t.list.current_page?[t.location.lat&&t.location.lng?a("abnor"):t._e(),t.location.lat||t.location.lng?t._e():[a("abnor",{attrs:{type:"NOT_LOCATION",title:"暂无"+t.$t("action.attendantName")+"数据"}})]]:t._e(),a("longbingbing-technician-list-popup",{ref:"technician_list_popup"}),a("uni-popup",{ref:"choose_city_item",attrs:{type:"top",custom:!0,zIndex:999}},[a("v-uni-view",{style:{height:t.configInfo.user_update_location?t.configInfo.navBarHeight+8+"px":"9px"}}),a("v-uni-view",{staticClass:"choose-city-popup rel"},[a("v-uni-image",{staticClass:"city-img",attrs:{src:"https://lbqny.migugu.com/admin/anmo/technician/no_city.png"}}),a("v-uni-view",{staticClass:"text f-paragraph c-base abs"},[t._v("很抱歉,该城市未开通, 点击左上角切换其他城市下单服务")]),a("v-uni-view",{staticClass:"flex-between"},[a("v-uni-view"),a("v-uni-view",{staticClass:"item-btn flex-center f-paragraph c-title text-bold radius",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$refs.choose_city_item.close()}}},[t._v("知道了")])],1)],1)],1),a("v-uni-view",{staticClass:"space-max-footer"}),a("fix-bottom-button",{attrs:{text:[{type:"confirm",text:t.pageLen>1?"返回上页":"返回首页"}],bgColor:"#fff"},on:{confirm:function(e){arguments[0]=e=t.$handleEvent(e),t.toBack.apply(void 0,arguments)}}})],2)},i=[]},3908:function(t,e,a){"use strict";a.r(e);var n=a("0461"),i=a.n(n);for(var o in n)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(o);e["default"]=i.a},"95fc":function(t,e,a){"use strict";a.r(e);var n=a("36ad"),i=a("3908");for(var o in i)["default"].indexOf(o)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(o);var c=a("828b"),r=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,"33b5065a",null,!1,n["a"],void 0);e["default"]=r.exports}}]);