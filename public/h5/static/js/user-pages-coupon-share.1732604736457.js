(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["user-pages-coupon-share"],{"00bf":function(e,t,i){"use strict";var n=i("ee49"),s=i.n(n);s.a},"02ed3":function(e,t,i){"use strict";i.r(t);var n=i("503b"),s=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t["default"]=s.a},"503b":function(e,t,i){"use strict";i("6a54");var n=i("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,i("c223"),i("d4b5");var s=n(i("9b1b")),a=n(i("2634")),o=n(i("2fdc")),r=i("8f59"),c=n(i("c57d")),u={components:{},data:function(){return{shareImg:"https://lbqny.migugu.com/admin/anmo/coupon/bg.png",isLoad:!1,options:{},detail:{end_time:""},record_list:{},qr_code:""}},computed:(0,r.mapState)({configInfo:function(e){return e.config.configInfo},isGzhLogin:function(e){return e.user.isGzhLogin},over_time_text:function(){return(new Date).getTime()+1e3*this.detail.end_time}}),onLoad:function(e){var t=this;return(0,o.default)((0,a.default)().mark((function i(){var n,s;return(0,a.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return n=e.pid,s=void 0===n?0:n,e.pid=1*s,t.options=e,t.$util.showLoading(),i.next=6,t.initIndex();case 6:t.scanRecordId&&t.updateScanRecord();case 7:case"end":return i.stop()}}),i)})))()},onPullDownRefresh:function(){uni.showNavigationBarLoading(),this.initRefresh(),uni.stopPullDownRefresh()},onShareAppMessage:function(e){var t=this.detail,i=t.id,n=t.share_img,s=this.userInfo.id,a=void 0===s?0:s,o="/user/pages/coupon/share?pid=".concat(a,"&coupon_atv_id=").concat(i);return this.$util.log(o),this.$refs.show_share_item.close(),{title:"",imageUrl:n,path:o}},methods:(0,s.default)((0,s.default)((0,s.default)({},(0,r.mapActions)(["getConfigInfo","getUserInfo","addScanRecord","updateScanRecord"])),(0,r.mapMutations)(["updateUserItem"])),{},{initIndex:function(){var e=arguments,t=this;return(0,o.default)((0,a.default)().mark((function i(){var n,s,o,r,c,u;return(0,a.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(n=e.length>0&&void 0!==e[0]&&e[0],s=t.options.pid,o=void 0===s?0:s,r=t.scanRecordId,r=t.$util.getQueryString("code"),o&&!r&&t.addScanRecord({type:2,qr_id:o,is_qr:0}),c=t.userInfo.id,u=void 0===c?0:c,!(!t.configInfo.id||n||o&&r&&!u)){i.next=9;break}return i.next=9,t.getConfigInfo();case 9:if(!o||r||u){i.next=12;break}return i.next=12,t.getUserInfo();case 12:if(!o||r||t.userInfo.id){i.next=14;break}return i.abrupt("return");case 14:return i.next=16,t.getDetail();case 16:t.$util.setNavigationBarColor({bg:t.primaryColor}),t.$jweixin.initJssdk((function(){t.toAppShare()}));case 18:case"end":return i.stop()}}),i)})))()},initRefresh:function(){this.initIndex(!0)},getDetail:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){var i,n,s,o,r;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=e.options.coupon_atv_id,n=void 0===i?0:i,t.next=3,e.$api.mine.couponAtvInfo({id:n});case 3:s=t.sent,o=s.record_list,r=s.atv_info,1!==r.status&&(r.end_time=0),e.detail=r,e.record_list=o,e.isLoad=!0,e.$util.hideAll();case 11:case"end":return t.stop()}}),t)})))()},countEnd:function(){var e=this;this.$util.log("倒计时完了"),setTimeout((function(){e.initRefresh(),e.$util.back()}),1e3)},toShare:function(){var e=this;return(0,o.default)((0,a.default)().mark((function t(){var i,n;return(0,a.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(1==e.detail.status){t.next=2;break}return t.abrupt("return");case 2:if(e.qr_code){t.next=10;break}return e.$util.showLoading(),i=e.detail.id,t.next=7,e.$api.mine.atvQr({page:"user/pages/coupon/share",coupon_atv_id:i});case 7:n=t.sent,e.$util.hideAll(),e.qr_code=n;case 10:if(e.$refs.show_share_item.open(),e.detail.user_id!=e.userInfo.id){t.next=13;break}return t.abrupt("return");case 13:e.getDetail();case 14:case"end":return t.stop()}}),t)})))()},toPoster:function(){this.$refs.show_share_item.close(),this.$util.goUrl({url:"/user/pages/coupon/poster"})},toAppShare:function(){var e=this.detail,t=e.id,i=e.share_img,n=e.status,s=this.userInfo.id,a=void 0===s?0:s,o="邀请有礼",r="邀请新人 获得福利",u=c.default.siteroot,l=u.split("/index.php")[0],d="".concat(l,"/h5/#/user/pages/coupon/share?coupon_atv_id=").concat(t,"&pid=").concat(a);1*n==1?(this.$jweixin.showOptionMenu(),this.$jweixin.shareAppMessage(o,r,d,i),this.$jweixin.shareTimelineMessage(o,d,i)):this.$jweixin.hideOptionMenu()},toTransImg:function(e){var t=this,i=this.$util.DateToUnix(this.$util.formatTime(new Date,"YY-M-D h:m:s"));uni.downloadFile({url:e.imageUrl,success:function(n){plus.zip.compressImage({src:n.tempFilePath,dst:"_doc/".concat(i,".jpg"),format:"jpg"},(function(n){plus.zip.compressImage({src:n.target,dst:"_doc/".concat(i,"-img.jpg"),quality:50},(function(i){e.imageUrl=i.target||"/static/img/logo.png",t.sharePage(e)}),(function(i){e.imageUrl="/static/img/logo.png",t.sharePage(e)}))}))}})},sharePage:function(e){this.$util.hideAll();var t=e.scene,i=e.href,n=e.title,s=e.summary,a=e.imageUrl;uni.share({provider:"weixin",scene:t,type:0,href:i,title:n,summary:s,imageUrl:a,success:function(e){console.log("success:"+JSON.stringify(e))},fail:function(e){console.log("fail:"+JSON.stringify(e))}})}})};t.default=u},"95d2":function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"c",(function(){return s})),i.d(t,"a",(function(){}));var n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.isLoad?i("v-uni-view",{staticClass:"user-coupon-share",style:{background:e.pageColor}},[e.options.pid?i("v-uni-view",{staticClass:"abs",class:[{"back-user-ios none":e.configInfo.isIos},{"back-user-android none":!e.configInfo.isIos}],staticStyle:{"z-index":"1",right:"30rpx"},on:{click:function(t){arguments[0]=t=e.$handleEvent(t),e.$util.goUrl({url:"/pages/service",openType:"reLaunch"})}}},[i("v-uni-view",{staticClass:"iconshouye iconfont"}),i("v-uni-view",{staticClass:"back-user_text"},[e._v("回到首页")])],1):e._e(),i("v-uni-image",{staticClass:"coupon-img",attrs:{mode:"aspectFill",src:e.shareImg}}),i("v-uni-view",{staticClass:"coupon-content"},[i("v-uni-view",{staticClass:"flex-center flex-column"},[i("v-uni-view",{staticClass:"flex-center f-paragraph pt-lg pb-md",style:{color:e.primaryColor}},[e._v(e._s(1==e.detail.status?"距活动结束还剩":"活动已结束"))]),i("v-uni-view",{staticClass:"count-down"},[i("min-countdown",{attrs:{type:2,countdownClass:"coupon-share",color:e.primaryColor,targetTime:e.over_time_text},on:{callback:function(t){arguments[0]=t=e.$handleEvent(t),e.countEnd.apply(void 0,arguments)}}})],1),i("v-uni-view",{staticClass:"space-lg"}),i("v-uni-view",{staticClass:"space-lg"}),i("v-uni-view",{staticClass:"ml-lg mr-lg pt-lg pb-sm pl-lg pr-lg rel radius-20",staticStyle:{background:"#FFFAF4"}},[i("v-uni-view",{staticClass:"menu-img mt-lg abs"},[i("v-uni-image",{staticClass:"menu-img",attrs:{mode:"aspectFill",src:"https://lbqny.migugu.com/admin/anmo/coupon/menu.png"}}),i("v-uni-view",{staticClass:"menu-title flex-center abs",style:{color:e.primaryColor}},[e._v("邀请记录")])],1),i("v-uni-view",{staticClass:"space-lg"}),i("v-uni-view",{staticClass:"space-lg"}),i("v-uni-view",{staticClass:"flex-center f-desc pb-md",style:{color:e.primaryColor}},[i("v-uni-view",{staticClass:"user-item"},[e._v("用户")]),i("v-uni-view",{staticClass:"time-item"},[e._v("时间")])],1),i("v-uni-image",{staticClass:"line-img",attrs:{mode:"aspectFill",src:"https://lbqny.migugu.com/admin/anmo/coupon/line.png"}}),e.record_list.data.length>0?i("v-uni-scroll-view",{staticClass:"user-list-info",attrs:{"scroll-y":!0}},e._l(e.record_list.data,(function(t,n){return i("v-uni-view",{key:n,staticClass:"user-list flex-between f-desc c-title b-1px-b"},[i("v-uni-view",{staticClass:"flex-y-center pt-md pb-md"},[i("v-uni-image",{staticClass:"avatar radius",attrs:{mode:"aspectFill",src:t.avatarUrl}}),i("v-uni-view",{staticClass:"ml-md max-300 ellipsis"},[e._v(e._s(t.nickName||"用户"+t.id))])],1),i("v-uni-view",[e._v(e._s(t.create_time))])],1)})),1):e._e(),0==e.record_list.data.length?i("abnor",{attrs:{percent:"70%"}}):e._e(),i("v-uni-view",{staticClass:"space-sm"})],1),e.detail.id?i("v-uni-view",{staticClass:"mt-md ml-lg mr-lg pt-lg pb-lg pl-lg pr-lg rel radius-20",staticStyle:{background:"#FFFAF4"}},[i("v-uni-view",{staticClass:"atv-rule pd-md radius-16",style:{border:"1px solid "+e.primaryColor}},[i("v-uni-view",{staticClass:"flex-center f-paragraph pt-sm pb-md",style:{color:e.primaryColor}},[e._v("活动规则")]),i("v-uni-view",{staticClass:"f-desc c-desc"},[e._v("1、活动总计可发起"+e._s(e.detail.atv_num)+"次；")]),1==e.detail.to_inv_user?i("v-uni-view",{staticClass:"f-desc c-desc"},[e._v("2、被推荐人授权用户信息后即可获得相应奖励；")]):e._e(),i("v-uni-view",{staticClass:"f-desc c-desc"},[e._v(e._s(1==e.detail.to_inv_user?3:2)+"、活动发起人每成功邀请"+e._s(e.detail.inv_user_num)+"位好友授权用户信息后，即可获得以下卡券：")]),e._l(e.detail.coupon,(function(t,n){return i("v-uni-view",{key:n,staticClass:"flex-warp f-desc c-desc"},[i("v-uni-view",[e._v("（"+e._s(1*n+1)+"）卡券："+e._s(t.title)+"；数量：x"+e._s(t.num))])],1)})),i("v-uni-view",{staticClass:"space-md"})],2)],1):e._e(),i("v-uni-view",{staticClass:"space-footer"})],1)],1),i("uni-popup",{ref:"show_share_item",attrs:{type:"bottom"}},[i("v-uni-view",{staticClass:"popup-share pd-lg f-desc c-desc fill-base"},[i("v-uni-view",{staticClass:"flex-center"},[i("v-uni-view",{staticClass:"list-item flex-center flex-column",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toAppShare(1)}}},[i("v-uni-image",{staticClass:"item-image",attrs:{mode:"aspectFill",src:"https://lbqny.migugu.com/admin/anmo/coupon/wechat.png"}}),i("v-uni-view",{staticStyle:{"font-size":"26rpx",color:"#666"}},[e._v("分享给好友")])],1),i("v-uni-view",{staticClass:"list-item flex-center flex-column",on:{click:function(t){t.stopPropagation(),arguments[0]=t=e.$handleEvent(t),e.toAppShare(2)}}},[i("v-uni-image",{staticClass:"item-image",attrs:{mode:"aspectFill",src:"https://lbqny.migugu.com/admin/anmo/coupon/wechat-moments.png"}}),i("v-uni-view",[e._v("分享到朋友圈")])],1)],1),i("v-uni-view",{staticClass:"space-footer"})],1)],1)],1):e._e()},s=[]},c322:function(e,t,i){"use strict";i.r(t);var n=i("95d2"),s=i("02ed3");for(var a in s)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(a);i("00bf");var o=i("828b"),r=Object(o["a"])(s["default"],n["b"],n["c"],!1,null,"39f5de3f",null,!1,n["a"],void 0);t["default"]=r.exports},ee49:function(e,t,i){var n=i("ffd1");n.__esModule&&(n=n.default),"string"===typeof n&&(n=[[e.i,n,""]]),n.locals&&(e.exports=n.locals);var s=i("967d").default;s("4b6b3579",n,!0,{sourceMap:!1,shadowMode:!1})},ffd1:function(e,t,i){var n=i("c86c");t=n(!1),t.push([e.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */.user-coupon-share .coupon-img[data-v-39f5de3f]{width:%?750?%;height:%?560?%}.user-coupon-share .coupon-content[data-v-39f5de3f]{width:%?750?%;min-height:%?1431?%;background:linear-gradient(0deg,#a40035,#ffae89)}.user-coupon-share .coupon-content .count-down[data-v-39f5de3f]{height:%?56?%}.user-coupon-share .coupon-content .menu-img[data-v-39f5de3f]{width:%?426?%;height:%?100?%}.user-coupon-share .coupon-content .menu-img.abs[data-v-39f5de3f]{top:%?-56?%;left:50%;margin-left:%?-213?%}.user-coupon-share .coupon-content .menu-title[data-v-39f5de3f]{width:%?426?%;height:%?90?%;font-size:%?36?%;top:0}.user-coupon-share .coupon-content .line-img[data-v-39f5de3f]{width:%?630?%;height:%?1?%}.user-coupon-share .coupon-content .user-item[data-v-39f5de3f]{width:%?360?%}.user-coupon-share .coupon-content .time-item[data-v-39f5de3f]{width:%?220?%}.user-coupon-share .coupon-content .user-list-info[data-v-39f5de3f]{height:%?746?%}.user-coupon-share .coupon-content .user-list-info .user-list .avatar[data-v-39f5de3f]{width:%?56?%;height:%?56?%;background:#ffae89}.user-coupon-share .coupon-content .share-img[data-v-39f5de3f]{width:%?541?%;height:%?140?%;margin:0 auto}.user-coupon-share .coupon-content .share-title[data-v-39f5de3f]{width:%?541?%;height:%?125?%;font-size:%?36?%;top:0}.user-coupon-share .coupon-content .atv-rule[data-v-39f5de3f]{-webkit-transform:rotate(1turn);transform:rotate(1turn)}.user-coupon-share .popup-share .list-item[data-v-39f5de3f]{width:50%}.user-coupon-share .popup-share .list-item .item-image[data-v-39f5de3f]{width:%?66?%;height:%?66?%}',""]),e.exports=t}}]);