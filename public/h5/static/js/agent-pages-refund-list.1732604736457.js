(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["agent-pages-refund-list"],{1369:function(t,e,i){"use strict";i.r(e);var a=i("c9fe"),n=i.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return a[t]}))}(s);e["default"]=n.a},c9fe:function(t,e,i){"use strict";i("6a54");var a=i("f5bd").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,i("c223"),i("5c47"),i("0506"),i("dd2b");var n=a(i("2634")),s=a(i("2fdc")),r=a(i("9b1b")),o=i("8f59"),l={components:{},data:function(){return{options:{},activeIndex:0,tabList:[{title:"全部",id:0},{title:"待退款",id:1},{title:"同意退款",id:2},{title:"拒绝退款",id:3},{title:"退款中",id:4},{title:"退款失败",id:5}],statusType:{"-1":"已取消",1:"待退款",2:"同意退款",3:"拒绝退款",4:"退款中",5:"退款失败"},param:{page:1},list:{data:[]},loading:!0,popupInfo:{},lockTap:!1}},computed:(0,o.mapState)({configInfo:function(t){return t.config.configInfo}}),onLoad:function(t){var e=t.agent,i=void 0===e?0:e,a=t.bell,n=void 0===a?0:a,s=t.tab,r=void 0===s?0:s;t.agent=1*i,this.options=t,this.activeIndex=r,uni.setNavigationBarTitle({title:1==n?"加钟退款":"服务退款"}),this.initIndex()},onPullDownRefresh:function(){uni.showNavigationBarLoading(),this.initRefresh(),uni.stopPullDownRefresh()},onReachBottom:function(){this.list.current_page>=this.list.last_page||this.loading||(this.param.page=this.param.page+1,this.loading=!0,this.getList())},methods:(0,r.default)((0,r.default)((0,r.default)({},(0,o.mapActions)(["getConfigInfo"])),(0,o.mapMutations)(["updateTechnicianItem"])),{},{initIndex:function(){var t=arguments,e=this;return(0,s.default)((0,n.default)().mark((function i(){var a;return(0,n.default)().wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(a=t.length>0&&void 0!==t[0]&&t[0],e.configInfo.id&&!a&&e.userInfo.id){i.next=4;break}return i.next=4,e.getConfigInfo();case 4:return i.next=6,e.getList();case 6:e.$util.setNavigationBarColor({bg:e.primaryColor}),a||e.$jweixin.hideOptionMenu();case 8:case"end":return i.stop()}}),i)})))()},initRefresh:function(){this.param.page=1,this.initIndex(!0)},toSearch:function(t){this.param.page=1,this.param.order_code=t,this.getList()},getList:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var i,a,s,r,o,l,c,u,p,d;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return i=t.list,a=t.param,s=t.tabList,r=t.activeIndex,a.status=s[r].id,o=t.options,l=o.bell,c=void 0===l?0:l,u=o.agent,a.is_add=c,p=u?"agent":"admin",e.next=7,t.$api[p].refundOrderList(a);case 7:d=e.sent,1==t.param.page||(d.data=i.data.concat(d.data)),t.list=d,t.loading=!1,t.$util.hideAll();case 11:case"end":return e.stop()}}),e)})))()},handerTabChange:function(t){this.activeIndex=t,this.param.page=1,this.getList()},toConfirm:function(t,e){var i=this;return(0,s.default)((0,n.default)().mark((function a(){var s,r,o;return(0,n.default)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:s=i.list.data[t],r=s.id,o=s.apply_price,i.popupInfo={index:t,id:r,type:e,apply_price:o,price:2==e?o:"",text:""},i.$refs.change_item.open();case 3:case"end":return a.stop()}}),a)})))()},confirmChangeOrder:function(){var t=this;return(0,s.default)((0,n.default)().mark((function e(){var i,a,s,r,o,l,c,u,p,d,f;return(0,n.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i=t.popupInfo,a=i.type,s=i.index,r=i.price,o=i.apply_price,l=t.$util.pick(t.popupInfo,["id","price","text"]),c=/^(([0-9][0-9]*)|(([0]\.\d{1,2}|[1-9][0-9]*\.\d{1,2})))$/,2!=a||r&&c.test(r)&&!(1*r>1*o)){e.next=6;break}return t.$util.showToast({title:r?c.test(r)?"退款金额不能大于可退款金额":"请输入正确的退款金额，最多保留2位小数":"请输入退款金额"}),e.abrupt("return");case 6:if(u=t.activeIndex,!t.lockTap){e.next=9;break}return e.abrupt("return");case 9:return t.lockTap=!0,t.$util.showLoading(),p=t.options.agent,d=p?"agent":"admin",f=2==a?"passRefund":"noPassRefund",e.prev=14,e.next=17,t.$api[d][f](l);case 17:if(t.$refs.change_item.close(),t.$util.showToast({title:"操作成功"}),0==u?t.list.data[s].status=a:t.list.data.splice(s,1),t.$util.hideAll(),t.updateTechnicianItem({key:"haveOperItem",val:!0}),t.lockTap=!1,0!=u){e.next=25;break}return e.abrupt("return");case 25:return e.next=27,t.getList(!0);case 27:e.next=33;break;case 29:return e.prev=29,e.t0=e["catch"](14),setTimeout((function(){t.lockTap=!1,t.$util.hideAll()}),2e3),e.abrupt("return");case 33:case"end":return e.stop()}}),e,null,[[14,29]])})))()},goDetail:function(t,e){var i=this.list.data[t].id,a=this.options.agent,n="/agent/pages/refund/".concat(e,"?id=").concat(i,"&agent=").concat(a);this.$util.goUrl({url:n})},toTel:function(){var t=this.configInfo.mobile;this.$util.goUrl({url:t,openType:"call"})}})};e.default=l},def0:function(t,e,i){"use strict";i.d(e,"b",(function(){return a})),i.d(e,"c",(function(){return n})),i.d(e,"a",(function(){}));var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-uni-view",{staticClass:"order-pages",style:{background:t.pageColor}},[i("fixed",[i("v-uni-view",{staticClass:"fill-base pt-lg pl-md pr-md pb-md"},[i("search",{attrs:{type:"input",padding:0,radius:30,height:"70rpx",placeholder:"请输入系统订单号查询"},on:{input:function(e){arguments[0]=e=t.$handleEvent(e),t.toSearch.apply(void 0,arguments)}}})],1),i("tab",{attrs:{list:t.tabList,activeIndex:1*t.activeIndex,activeColor:t.primaryColor,height:"100rpx"},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.handerTabChange.apply(void 0,arguments)}}}),i("v-uni-view",{staticClass:"b-1px-b"})],1),t._l(t.list.data,(function(e,a){return i("v-uni-view",{key:a,staticClass:"item-child mt-md ml-lg mr-lg pd-lg fill-base radius-16",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goDetail(a,"detail")}}},[i("v-uni-view",{staticClass:"flex-between pb-lg b-1px-b"},[i("v-uni-view",{staticClass:"f-paragraph c-title max-450 ellipsis"},[t._v("订单号："+t._s(e.order_code))]),i("v-uni-view",{staticClass:"f-caption text-bold",style:{color:1==e.status||4==e.status?t.subColor:2==e.status?"#11C95E":"#333"}},[t._v(t._s(t.statusType[e.status]))])],1),t._l(e.order_goods,(function(a,n){return i("v-uni-view",{key:n,staticClass:"flex-center mb-lg",class:[{"mt-lg":0==n}]},[i("v-uni-view",{staticClass:"avatar lg radius-16"},[i("v-uni-view",{staticClass:"h5-image avatar lg radius-16",style:{backgroundImage:"url('"+a.goods_cover+"')"}})],1),i("v-uni-view",{staticClass:"flex-1 ml-md"},[i("v-uni-view",{staticClass:"flex-between"},[i("v-uni-view",{staticClass:"f-mini-title c-title text-bold max-380 ellipsis"},[t._v(t._s(a.goods_name))]),i("v-uni-view",{staticClass:"c-paragraph"},[t._v("x"+t._s(a.num))])],1),i("v-uni-view",{staticClass:"mt-md f-caption c-caption max-450 ellipsis"},[t._v(t._s("服务"===t.$t("action.attendantName").substring(0,2)?"":"服务")+t._s(t.$t("action.attendantName"))+"："+t._s(e.coach_info?e.coach_info.coach_name:"-"))]),i("v-uni-view",{staticClass:"f-caption c-caption",staticStyle:{"margin-top":"5rpx"}},[t._v("服务时间："+t._s(e.start_time))])],1)],1)})),i("v-uni-view",{staticClass:"flex-between pt-lg b-1px-t"},[i("v-uni-view",{staticClass:"flex-y-center f-desc c-title"},[t._v("总计："),i("v-uni-view",{staticClass:"f-paragraph text-bold"},[t._v("¥"+t._s(e.apply_price))])],1),i("v-uni-view",{staticClass:"flex-warp"},[[1,5].includes(e.status)?[i("v-uni-button",{staticClass:"clear-btn order",staticStyle:{"margin-left":"0"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.toConfirm(a,3)}}},[t._v("拒绝退款")]),i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,border:"1rpx solid "+t.primaryColor},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.goDetail(a,"refund")}}},[t._v("同意退款")])]:i("v-uni-view",[i("v-uni-button",{staticClass:"clear-btn order",style:{color:"#fff",background:t.primaryColor,border:"1rpx solid "+t.primaryColor}},[t._v("查看详情")])],1)],2)],1)],2)})),t.loading?i("load-more",{attrs:{noMore:t.list.current_page>=t.list.last_page&&t.list.data.length>0,loading:t.loading}}):t._e(),!t.loading&&t.list.data.length<=0&&1==t.list.current_page?i("abnor",{attrs:{tip:[{text:"暂无订单数据"}],percent:"calc(100vh - 220rpx - calc(30rpx + env(safe-area-inset-bottom) / 2))"}}):t._e(),i("v-uni-view",{staticClass:"space-footer"}),i("uni-popup",{ref:"change_item",attrs:{type:"center",custom:!0}},[i("v-uni-view",{staticClass:"common-popup-content fill-base pd-lg radius-34"},[i("v-uni-view",{staticClass:"title"},[t._v("温馨提示")]),i("v-uni-view",{staticClass:"desc"},[t._v("你确认要操作"+t._s(t.statusType[t.popupInfo.type])+"吗?")]),2==t.popupInfo.type?i("v-uni-view",{staticClass:"mt-lg"},[i("v-uni-input",{staticClass:"input flex-y-center pl-lg pr-lg f-sm-title c-title radius-16",attrs:{type:"digit","placeholder-class":"c-placeholder",placeholder:"请输入退款金额"},model:{value:t.popupInfo.price,callback:function(e){t.$set(t.popupInfo,"price",e)},expression:"popupInfo.price"}}),i("v-uni-view",{staticClass:"f-desc c-caption mt-md"},[i("v-uni-view",{staticClass:"flex-y-center"},[t._v("实际可退款金额"),i("v-uni-view",{staticClass:"ml-sm c-warning"},[t._v("¥"+t._s(t.popupInfo.apply_price))])],1),i("v-uni-view",[t._v("退款金额不能大于可退款金额")])],1)],1):t._e(),i("v-uni-view",{staticClass:"button"},[i("v-uni-view",{staticClass:"item-child",on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.$refs.change_item.close()}}},[t._v("取消")]),i("v-uni-view",{staticClass:"item-child c-base",style:{background:t.primaryColor,color:"#fff"},on:{click:function(e){e.stopPropagation(),arguments[0]=e=t.$handleEvent(e),t.confirmChangeOrder.apply(void 0,arguments)}}},[t._v("确定")])],1)],1)],1)],2)},n=[]},f757:function(t,e,i){"use strict";i.r(e);var a=i("def0"),n=i("1369");for(var s in n)["default"].indexOf(s)<0&&function(t){i.d(e,t,(function(){return n[t]}))}(s);var r=i("828b"),o=Object(r["a"])(n["default"],a["b"],a["c"],!1,null,"785c3d18",null,!1,a["a"],void 0);e["default"]=o.exports}}]);